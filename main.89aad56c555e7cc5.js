"use strict";(self.webpackChunkang_three=self.webpackChunkang_three||[]).push([[179],{322:()=>{function dt(n){return"function"==typeof n}function El(n){const t=n(r=>{Error.call(r),r.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const Nu=El(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((r,i)=>`${i+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function To(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Qn{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:r}=this;if(dt(r))try{r()}catch(s){e=s instanceof Nu?s.errors:[s]}const{_finalizers:i}=this;if(i){this._finalizers=null;for(const s of i)try{A_(s)}catch(o){e=null!=e?e:[],o instanceof Nu?e=[...e,...o.errors]:e.push(o)}}if(e)throw new Nu(e)}}add(e){var t;if(e&&e!==this)if(this.closed)A_(e);else{if(e instanceof Qn){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&To(t,e)}remove(e){const{_finalizers:t}=this;t&&To(t,e),e instanceof Qn&&e._removeParent(this)}}Qn.EMPTY=(()=>{const n=new Qn;return n.closed=!0,n})();const T_=Qn.EMPTY;function N_(n){return n instanceof Qn||n&&"closed"in n&&dt(n.remove)&&dt(n.add)&&dt(n.unsubscribe)}function A_(n){dt(n)?n():n.unsubscribe()}const ks={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Au={setTimeout(n,e,...t){const{delegate:r}=Au;return(null==r?void 0:r.setTimeout)?r.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=Au;return((null==e?void 0:e.clearTimeout)||clearTimeout)(n)},delegate:void 0};function I_(n){Au.setTimeout(()=>{const{onUnhandledError:e}=ks;if(!e)throw n;e(n)})}function Cl(){}const aA=Kf("C",void 0,void 0);function Kf(n,e,t){return{kind:n,value:e,error:t}}let Bs=null;function Iu(n){if(ks.useDeprecatedSynchronousErrorHandling){const e=!Bs;if(e&&(Bs={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:r}=Bs;if(Bs=null,t)throw r}}else n()}class Qf extends Qn{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,N_(e)&&e.add(this)):this.destination=pA}static create(e,t,r){return new Ru(e,t,r)}next(e){this.isStopped?tp(function cA(n){return Kf("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?tp(function lA(n){return Kf("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?tp(aA,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const dA=Function.prototype.bind;function ep(n,e){return dA.call(n,e)}class hA{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(r){Pu(r)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(r){Pu(r)}else Pu(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){Pu(t)}}}class Ru extends Qf{constructor(e,t,r){let i;if(super(),dt(e)||!e)i={next:null!=e?e:void 0,error:null!=t?t:void 0,complete:null!=r?r:void 0};else{let s;this&&ks.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),i={next:e.next&&ep(e.next,s),error:e.error&&ep(e.error,s),complete:e.complete&&ep(e.complete,s)}):i=e}this.destination=new hA(i)}}function Pu(n){ks.useDeprecatedSynchronousErrorHandling?function uA(n){ks.useDeprecatedSynchronousErrorHandling&&Bs&&(Bs.errorThrown=!0,Bs.error=n)}(n):I_(n)}function tp(n,e){const{onStoppedNotification:t}=ks;t&&Au.setTimeout(()=>t(n,e))}const pA={closed:!0,next:Cl,error:function fA(n){throw n},complete:Cl},np="function"==typeof Symbol&&Symbol.observable||"@@observable";function _i(n){return n}function R_(...n){return P_(n)}function P_(n){return 0===n.length?_i:1===n.length?n[0]:function(t){return n.reduce((r,i)=>i(r),t)}}let Gt=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const r=new n;return r.source=this,r.operator=t,r}subscribe(t,r,i){const s=function mA(n){return n&&n instanceof Qf||function gA(n){return n&&dt(n.next)&&dt(n.error)&&dt(n.complete)}(n)&&N_(n)}(t)?t:new Ru(t,r,i);return Iu(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(r){t.error(r)}}forEach(t,r){return new(r=L_(r))((i,s)=>{const o=new Ru({next:a=>{try{t(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:i});this.subscribe(o)})}_subscribe(t){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(t)}[np](){return this}pipe(...t){return P_(t)(this)}toPromise(t){return new(t=L_(t))((r,i)=>{let s;this.subscribe(o=>s=o,o=>i(o),()=>r(s))})}}return n.create=e=>new n(e),n})();function L_(n){var e;return null!==(e=null!=n?n:ks.Promise)&&void 0!==e?e:Promise}const yA=El(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let er=(()=>{class n extends Gt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const r=new F_(this,this);return r.operator=t,r}_throwIfClosed(){if(this.closed)throw new yA}next(t){Iu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(t)}})}error(t){Iu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:r}=this;for(;r.length;)r.shift().error(t)}})}complete(){Iu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:r,isStopped:i,observers:s}=this;return r||i?T_:(this.currentObservers=null,s.push(t),new Qn(()=>{this.currentObservers=null,To(s,t)}))}_checkFinalizedStatuses(t){const{hasError:r,thrownError:i,isStopped:s}=this;r?t.error(i):s&&t.complete()}asObservable(){const t=new Gt;return t.source=this,t}}return n.create=(e,t)=>new F_(e,t),n})();class F_ extends er{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)}error(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:T_}}function O_(n){return dt(null==n?void 0:n.lift)}function $t(n){return e=>{if(O_(e))return e.lift(function(t){try{return n(t,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Vt(n,e,t,r,i){return new vA(n,e,t,r,i)}class vA extends Qf{constructor(e,t,r,i,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=i?function(a){try{i(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function mt(n,e){return $t((t,r)=>{let i=0;t.subscribe(Vt(r,s=>{r.next(n.call(e,s,i++))}))})}function ip(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]])}return t}function Us(n){return this instanceof Us?(this.v=n,this):new Us(n)}function bA(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i,r=t.apply(n,e||[]),s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(h){r[h]&&(i[h]=function(f){return new Promise(function(p,m){s.push([h,f,p,m])>1||a(h,f)})})}function a(h,f){try{!function l(h){h.value instanceof Us?Promise.resolve(h.value.v).then(c,u):d(s[0][2],h)}(r[h](f))}catch(p){d(s[0][3],p)}}function c(h){a("next",h)}function u(h){a("throw",h)}function d(h,f){h(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function xA(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function U_(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){!function i(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=n[s](o)).done,o.value)})}}}const sp=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function H_(n){return dt(null==n?void 0:n.then)}function G_(n){return dt(n[np])}function V_(n){return Symbol.asyncIterator&&dt(null==n?void 0:n[Symbol.asyncIterator])}function z_(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const j_=function SA(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function W_(n){return dt(null==n?void 0:n[j_])}function $_(n){return bA(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:r,done:i}=yield Us(t.read());if(i)return yield Us(void 0);yield yield Us(r)}}finally{t.releaseLock()}})}function q_(n){return dt(null==n?void 0:n.getReader)}function gr(n){if(n instanceof Gt)return n;if(null!=n){if(G_(n))return function EA(n){return new Gt(e=>{const t=n[np]();if(dt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(sp(n))return function CA(n){return new Gt(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(H_(n))return function DA(n){return new Gt(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,I_)})}(n);if(V_(n))return Z_(n);if(W_(n))return function TA(n){return new Gt(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(q_(n))return function NA(n){return Z_($_(n))}(n)}throw z_(n)}function Z_(n){return new Gt(e=>{(function AA(n,e){var t,r,i,s;return function _A(n,e,t,r){return new(t||(t=Promise))(function(s,o){function a(u){try{c(r.next(u))}catch(d){o(d)}}function l(u){try{c(r.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function i(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,l)}c((r=r.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=xA(n);!(r=yield t.next()).done;)if(e.next(r.value),e.closed)return}catch(o){i={error:o}}finally{try{r&&!r.done&&(s=t.return)&&(yield s.call(t))}finally{if(i)throw i.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function Mi(n,e,t,r=0,i=!1){const s=e.schedule(function(){t(),i?n.add(this.schedule(null,r)):this.unsubscribe()},r);if(n.add(s),!i)return s}function fn(n,e,t=1/0){return dt(e)?fn((r,i)=>mt((s,o)=>e(r,s,i,o))(gr(n(r,i))),t):("number"==typeof e&&(t=e),$t((r,i)=>function IA(n,e,t,r,i,s,o,a){const l=[];let c=0,u=0,d=!1;const h=()=>{d&&!l.length&&!c&&e.complete()},f=m=>c<r?p(m):l.push(m),p=m=>{s&&e.next(m),c++;let g=!1;gr(t(m,u++)).subscribe(Vt(e,v=>{null==i||i(v),s?f(v):e.next(v)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){const v=l.shift();o?Mi(e,o,()=>p(v)):p(v)}h()}catch(v){e.error(v)}}))};return n.subscribe(Vt(e,f,()=>{d=!0,h()})),()=>{null==a||a()}}(r,i,n,t)))}function Dl(n=1/0){return fn(_i,n)}const bi=new Gt(n=>n.complete());function X_(n){return n&&dt(n.schedule)}function op(n){return n[n.length-1]}function Y_(n){return dt(op(n))?n.pop():void 0}function Tl(n){return X_(op(n))?n.pop():void 0}function J_(n,e=0){return $t((t,r)=>{t.subscribe(Vt(r,i=>Mi(r,n,()=>r.next(i),e),()=>Mi(r,n,()=>r.complete(),e),i=>Mi(r,n,()=>r.error(i),e)))})}function K_(n,e=0){return $t((t,r)=>{r.add(n.schedule(()=>t.subscribe(r),e))})}function Q_(n,e){if(!n)throw new Error("Iterable cannot be null");return new Gt(t=>{Mi(t,e,()=>{const r=n[Symbol.asyncIterator]();Mi(t,e,()=>{r.next().then(i=>{i.done?t.complete():t.next(i.value)})},0,!0)})})}function e0(n,e){if(null!=n){if(G_(n))return function LA(n,e){return gr(n).pipe(K_(e),J_(e))}(n,e);if(sp(n))return function OA(n,e){return new Gt(t=>{let r=0;return e.schedule(function(){r===n.length?t.complete():(t.next(n[r++]),t.closed||this.schedule())})})}(n,e);if(H_(n))return function FA(n,e){return gr(n).pipe(K_(e),J_(e))}(n,e);if(V_(n))return Q_(n,e);if(W_(n))return function kA(n,e){return new Gt(t=>{let r;return Mi(t,e,()=>{r=n[j_](),Mi(t,e,()=>{let i,s;try{({value:i,done:s}=r.next())}catch(o){return void t.error(o)}s?t.complete():t.next(i)},0,!0)}),()=>dt(null==r?void 0:r.return)&&r.return()})}(n,e);if(q_(n))return function BA(n,e){return Q_($_(n),e)}(n,e)}throw z_(n)}function Cn(n,e){return e?e0(n,e):gr(n)}function Nl(n){return n<=0?()=>bi:$t((e,t)=>{let r=0;e.subscribe(Vt(t,i=>{++r<=n&&(t.next(i),n<=r&&t.complete())}))})}function Lu(n={}){const{connector:e=(()=>new er),resetOnError:t=!0,resetOnComplete:r=!0,resetOnRefCountZero:i=!0}=n;return s=>{let o=null,a=null,l=null,c=0,u=!1,d=!1;const h=()=>{null==a||a.unsubscribe(),a=null},f=()=>{h(),o=l=null,u=d=!1},p=()=>{const m=o;f(),null==m||m.unsubscribe()};return $t((m,g)=>{c++,!d&&!u&&h();const v=l=null!=l?l:e();g.add(()=>{c--,0===c&&!d&&!u&&(a=ap(p,i))}),v.subscribe(g),o||(o=new Ru({next:y=>v.next(y),error:y=>{d=!0,h(),a=ap(f,t,y),v.error(y)},complete:()=>{u=!0,h(),a=ap(f,r),v.complete()}}),Cn(m).subscribe(o))})(s)}}function ap(n,e,...t){return!0===e?(n(),null):!1===e?null:e(...t).pipe(Nl(1)).subscribe(()=>n())}function Tt(n){for(let e in n)if(n[e]===Tt)return e;throw Error("Could not find renamed property on target object.")}function lp(n,e){for(const t in e)e.hasOwnProperty(t)&&!n.hasOwnProperty(t)&&(n[t]=e[t])}function xt(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(xt).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function cp(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const HA=Tt({__forward_ref__:Tt});function up(n){return n.__forward_ref__=up,n.toString=function(){return xt(this())},n}function Xe(n){return t0(n)?n():n}function t0(n){return"function"==typeof n&&n.hasOwnProperty(HA)&&n.__forward_ref__===up}class vt extends Error{constructor(e,t){super(function dp(n,e){return`NG0${Math.abs(n)}${e?": "+e:""}`}(e,t)),this.code=e}}function Dn(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():function Ue(n){return"string"==typeof n?n:null==n?"":String(n)}(n)}function Fu(n,e){const t=e?` in ${e}`:"";throw new vt(-201,`No provider for ${Dn(n)} found${t}`)}function nr(n,e){null==n&&function Lt(n,e,t,r){throw new Error(`ASSERTION ERROR: ${n}`+(null==r?"":` [Expected=> ${t} ${r} ${e} <=Actual]`))}(e,n,null,"!=")}function rt(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function bn(n){return{providers:n.providers||[],imports:n.imports||[]}}function hp(n){return n0(n,Ou)||n0(n,s0)}function n0(n,e){return n.hasOwnProperty(e)?n[e]:null}function r0(n){return n&&(n.hasOwnProperty(fp)||n.hasOwnProperty(qA))?n[fp]:null}const Ou=Tt({\u0275prov:Tt}),fp=Tt({\u0275inj:Tt}),s0=Tt({ngInjectableDef:Tt}),qA=Tt({ngInjectorDef:Tt});var ke=(()=>((ke=ke||{})[ke.Default=0]="Default",ke[ke.Host=1]="Host",ke[ke.Self=2]="Self",ke[ke.SkipSelf=4]="SkipSelf",ke[ke.Optional=8]="Optional",ke))();let pp;function Yi(n){const e=pp;return pp=n,e}function o0(n,e,t){const r=hp(n);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:t&ke.Optional?null:void 0!==e?e:void Fu(xt(n),"Injector")}function Ji(n){return{toString:n}.toString()}var Rr=(()=>((Rr=Rr||{})[Rr.OnPush=0]="OnPush",Rr[Rr.Default=1]="Default",Rr))(),Yr=(()=>{return(n=Yr||(Yr={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Yr;var n})();const XA="undefined"!=typeof globalThis&&globalThis,YA="undefined"!=typeof window&&window,JA="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Ct=XA||"undefined"!=typeof global&&global||YA||JA,No={},Nt=[],ku=Tt({\u0275cmp:Tt}),gp=Tt({\u0275dir:Tt}),mp=Tt({\u0275pipe:Tt}),a0=Tt({\u0275mod:Tt}),wi=Tt({\u0275fac:Tt}),Al=Tt({__NG_ELEMENT_ID__:Tt});let KA=0;function rr(n){return Ji(()=>{const t={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:t,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Rr.OnPush,directiveDefs:null,pipeDefs:null,selectors:n.selectors||Nt,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Yr.Emulated,id:"c",styles:n.styles||Nt,_:null,setInput:null,schemas:n.schemas||null,tView:null},i=n.directives,s=n.features,o=n.pipes;return r.id+=KA++,r.inputs=d0(n.inputs,t),r.outputs=d0(n.outputs),s&&s.forEach(a=>a(r)),r.directiveDefs=i?()=>("function"==typeof i?i():i).map(l0):null,r.pipeDefs=o?()=>("function"==typeof o?o():o).map(c0):null,r})}function l0(n){return Rn(n)||function Ki(n){return n[gp]||null}(n)}function c0(n){return function Hs(n){return n[mp]||null}(n)}const u0={};function Tn(n){return Ji(()=>{const e={type:n.type,bootstrap:n.bootstrap||Nt,declarations:n.declarations||Nt,imports:n.imports||Nt,exports:n.exports||Nt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null};return null!=n.id&&(u0[n.id]=n.type),e})}function d0(n,e){if(null==n)return No;const t={};for(const r in n)if(n.hasOwnProperty(r)){let i=n[r],s=i;Array.isArray(i)&&(s=i[1],i=i[0]),t[i]=r,e&&(e[i]=s)}return t}const Ot=rr;function Rn(n){return n[ku]||null}function mr(n,e){const t=n[a0]||null;if(!t&&!0===e)throw new Error(`Type ${xt(n)} does not have '\u0275mod' property.`);return t}function Jr(n){return Array.isArray(n)&&"object"==typeof n[1]}function Lr(n){return Array.isArray(n)&&!0===n[1]}function _p(n){return 0!=(8&n.flags)}function Gu(n){return 2==(2&n.flags)}function Vu(n){return 1==(1&n.flags)}function Fr(n){return null!==n.template}function s1(n){return 0!=(512&n[2])}function js(n,e){return n.hasOwnProperty(wi)?n[wi]:null}class l1{constructor(e,t,r){this.previousValue=e,this.currentValue=t,this.firstChange=r}isFirstChange(){return this.firstChange}}function Ws(){return f0}function f0(n){return n.type.prototype.ngOnChanges&&(n.setInput=u1),c1}function c1(){const n=g0(this),e=null==n?void 0:n.current;if(e){const t=n.previous;if(t===No)n.previous=e;else for(let r in e)t[r]=e[r];n.current=null,this.ngOnChanges(e)}}function u1(n,e,t,r){const i=g0(n)||function d1(n,e){return n[p0]=e}(n,{previous:No,current:null}),s=i.current||(i.current={}),o=i.previous,a=this.declaredInputs[t],l=o[a];s[a]=new l1(l&&l.currentValue,e,o===No),n[r]=e}Ws.ngInherit=!0;const p0="__ngSimpleChanges__";function g0(n){return n[p0]||null}let Sp;function qt(n){return!!n.listen}const m0={createRenderer:(n,e)=>function Ep(){return void 0!==Sp?Sp:"undefined"!=typeof document?document:void 0}()};function nn(n){for(;Array.isArray(n);)n=n[0];return n}function _r(n,e){return nn(e[n.index])}function Cp(n,e){return n.data[e]}function sr(n,e){const t=e[n];return Jr(t)?t:t[0]}function y0(n){return 4==(4&n[2])}function Dp(n){return 128==(128&n[2])}function Qi(n,e){return null==e?null:n[e]}function v0(n){n[18]=0}function Tp(n,e){n[5]+=e;let t=n,r=n[3];for(;null!==r&&(1===e&&1===t[5]||-1===e&&0===t[5]);)r[5]+=e,t=r,r=r[3]}const Fe={lFrame:C0(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function _0(){return Fe.bindingsEnabled}function te(){return Fe.lFrame.lView}function ft(){return Fe.lFrame.tView}function pn(){let n=M0();for(;null!==n&&64===n.type;)n=n.parent;return n}function M0(){return Fe.lFrame.currentTNode}function Kr(n,e){const t=Fe.lFrame;t.currentTNode=n,t.isParent=e}function Np(){return Fe.lFrame.isParent}function Ap(){Fe.lFrame.isParent=!1}function ju(){return Fe.isInCheckNoChangesMode}function Wu(n){Fe.isInCheckNoChangesMode=n}function N1(n,e){const t=Fe.lFrame;t.bindingIndex=t.bindingRootIndex=n,Ip(e)}function Ip(n){Fe.lFrame.currentDirectiveIndex=n}function w0(){return Fe.lFrame.currentQueryIndex}function Pp(n){Fe.lFrame.currentQueryIndex=n}function I1(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function S0(n,e,t){if(t&ke.SkipSelf){let i=e,s=n;for(;!(i=i.parent,null!==i||t&ke.Host||(i=I1(s),null===i||(s=s[15],10&i.type))););if(null===i)return!1;e=i,n=s}const r=Fe.lFrame=E0();return r.currentTNode=e,r.lView=n,!0}function $u(n){const e=E0(),t=n[1];Fe.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function E0(){const n=Fe.lFrame,e=null===n?null:n.child;return null===e?C0(n):e}function C0(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function D0(){const n=Fe.lFrame;return Fe.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const T0=D0;function qu(){const n=D0();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Bn(){return Fe.lFrame.selectedIndex}function es(n){Fe.lFrame.selectedIndex=n}function Zu(n,e){for(let t=e.directiveStart,r=e.directiveEnd;t<r;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=s;o&&(n.contentHooks||(n.contentHooks=[])).push(-t,o),a&&((n.contentHooks||(n.contentHooks=[])).push(t,a),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,a)),l&&(n.viewHooks||(n.viewHooks=[])).push(-t,l),c&&((n.viewHooks||(n.viewHooks=[])).push(t,c),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,c)),null!=u&&(n.destroyHooks||(n.destroyHooks=[])).push(t,u)}}function Xu(n,e,t){N0(n,e,3,t)}function Yu(n,e,t,r){(3&n[2])===t&&N0(n,e,t,r)}function Lp(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function N0(n,e,t,r){const s=null!=r?r:-1,o=e.length-1;let a=0;for(let l=void 0!==r?65535&n[18]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=r&&a>=r)break}else e[l]<0&&(n[18]+=65536),(a<s||-1==s)&&(H1(n,t,e,l),n[18]=(4294901760&n[18])+l+2),l++}function H1(n,e,t,r){const i=t[r]<0,s=t[r+1],a=n[i?-t[r]:t[r]];if(i){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{s.call(a)}finally{}}}else try{s.call(a)}finally{}}class Fl{constructor(e,t,r){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=r}}function Ju(n,e,t){const r=qt(n);let i=0;for(;i<t.length;){const s=t[i];if("number"==typeof s){if(0!==s)break;i++;const o=t[i++],a=t[i++],l=t[i++];r?n.setAttribute(e,a,l,o):e.setAttributeNS(o,a,l)}else{const o=s,a=t[++i];Op(o)?r&&n.setProperty(e,o,a):r?n.setAttribute(e,o,a):e.setAttribute(o,a),i++}}return i}function A0(n){return 3===n||4===n||6===n}function Op(n){return 64===n.charCodeAt(0)}function Ku(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?t=i:0===t||I0(n,t,i,null,-1===t||2===t?e[++r]:null)}}return n}function I0(n,e,t,r,i){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===r)return void(null!==i&&(n[s+1]=i));if(r===n[s+1])return void(n[s+2]=i)}s++,null!==r&&s++,null!==i&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==r&&n.splice(s++,0,r),null!==i&&n.splice(s++,0,i)}function R0(n){return-1!==n}function Oo(n){return 32767&n}function ko(n,e){let t=function W1(n){return n>>16}(n),r=e;for(;t>0;)r=r[15],t--;return r}let kp=!0;function Qu(n){const e=kp;return kp=n,e}let $1=0;function kl(n,e){const t=Up(n,e);if(-1!==t)return t;const r=e[1];r.firstCreatePass&&(n.injectorIndex=e.length,Bp(r.data,n),Bp(e,null),Bp(r.blueprint,null));const i=ed(n,e),s=n.injectorIndex;if(R0(i)){const o=Oo(i),a=ko(i,e),l=a[1].data;for(let c=0;c<8;c++)e[s+c]=a[o+c]|l[o+c]}return e[s+8]=i,s}function Bp(n,e){n.push(0,0,0,0,0,0,0,0,e)}function Up(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function ed(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,r=null,i=e;for(;null!==i;){const s=i[1],o=s.type;if(r=2===o?s.declTNode:1===o?i[6]:null,null===r)return-1;if(t++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|t<<16}return-1}function td(n,e,t){!function q1(n,e,t){let r;"string"==typeof t?r=t.charCodeAt(0)||0:t.hasOwnProperty(Al)&&(r=t[Al]),null==r&&(r=t[Al]=$1++);const i=255&r;e.data[n+(i>>5)]|=1<<i}(n,e,t)}function F0(n,e,t){if(t&ke.Optional)return n;Fu(e,"NodeInjector")}function O0(n,e,t,r){if(t&ke.Optional&&void 0===r&&(r=null),0==(t&(ke.Self|ke.Host))){const i=n[9],s=Yi(void 0);try{return i?i.get(e,r,t&ke.Optional):o0(e,r,t&ke.Optional)}finally{Yi(s)}}return F0(r,e,t)}function k0(n,e,t,r=ke.Default,i){if(null!==n){const s=function J1(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(Al)?n[Al]:void 0;return"number"==typeof e?e>=0?255&e:X1:e}(t);if("function"==typeof s){if(!S0(e,n,r))return r&ke.Host?F0(i,t,r):O0(e,t,r,i);try{const o=s(r);if(null!=o||r&ke.Optional)return o;Fu(t)}finally{T0()}}else if("number"==typeof s){let o=null,a=Up(n,e),l=-1,c=r&ke.Host?e[16][6]:null;for((-1===a||r&ke.SkipSelf)&&(l=-1===a?ed(n,e):e[a+8],-1!==l&&H0(r,!1)?(o=e[1],a=Oo(l),e=ko(l,e)):a=-1);-1!==a;){const u=e[1];if(U0(s,a,u.data)){const d=Y1(a,e,t,o,r,c);if(d!==B0)return d}l=e[a+8],-1!==l&&H0(r,e[1].data[a+8]===c)&&U0(s,a,e)?(o=u,a=Oo(l),e=ko(l,e)):a=-1}}}return O0(e,t,r,i)}const B0={};function X1(){return new Bo(pn(),te())}function Y1(n,e,t,r,i,s){const o=e[1],a=o.data[n+8],u=nd(a,o,t,null==r?Gu(a)&&kp:r!=o&&0!=(3&a.type),i&ke.Host&&s===a);return null!==u?Bl(e,o,u,a):B0}function nd(n,e,t,r,i){const s=n.providerIndexes,o=e.data,a=1048575&s,l=n.directiveStart,u=s>>20,h=i?a+u:n.directiveEnd;for(let f=r?a:a+u;f<h;f++){const p=o[f];if(f<l&&t===p||f>=l&&p.type===t)return f}if(i){const f=o[l];if(f&&Fr(f)&&f.type===t)return l}return null}function Bl(n,e,t,r){let i=n[t];const s=e.data;if(function G1(n){return n instanceof Fl}(i)){const o=i;o.resolving&&function GA(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new vt(-200,`Circular dependency in DI detected for ${n}${t}`)}(Dn(s[t]));const a=Qu(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?Yi(o.injectImpl):null;S0(n,r,ke.Default);try{i=n[t]=o.factory(void 0,s,n,r),e.firstCreatePass&&t>=r.directiveStart&&function U1(n,e,t){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:s}=e.type.prototype;if(r){const o=f0(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,o)}i&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,i),s&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,s))}(t,s[t],e)}finally{null!==l&&Yi(l),Qu(a),o.resolving=!1,T0()}}return i}function U0(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function H0(n,e){return!(n&ke.Self||n&ke.Host&&e)}class Bo{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,r){return k0(this._tNode,this._lView,e,r,t)}}function Mr(n){return Ji(()=>{const e=n.prototype.constructor,t=e[wi]||Hp(e),r=Object.prototype;let i=Object.getPrototypeOf(n.prototype).constructor;for(;i&&i!==r;){const s=i[wi]||Hp(i);if(s&&s!==t)return s;i=Object.getPrototypeOf(i)}return s=>new s})}function Hp(n){return t0(n)?()=>{const e=Hp(Xe(n));return e&&e()}:js(n)}const Ho="__parameters__";function Vo(n,e,t){return Ji(()=>{const r=function Gp(n){return function(...t){if(n){const r=n(...t);for(const i in r)this[i]=r[i]}}}(e);function i(...s){if(this instanceof i)return r.apply(this,s),this;const o=new i(...s);return a.annotation=o,a;function a(l,c,u){const d=l.hasOwnProperty(Ho)?l[Ho]:Object.defineProperty(l,Ho,{value:[]})[Ho];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),l}}return t&&(i.prototype=Object.create(t.prototype)),i.prototype.ngMetadataName=n,i.annotationCls=i,i})}class _e{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=rt({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Q1=new _e("AnalyzeForEntryComponents");function br(n,e){void 0===e&&(e=n);for(let t=0;t<n.length;t++){let r=n[t];Array.isArray(r)?(e===n&&(e=n.slice(0,t)),br(r,e)):e!==n&&e.push(r)}return e}function Qr(n,e){n.forEach(t=>Array.isArray(t)?Qr(t,e):e(t))}function V0(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function rd(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}function Vl(n,e){const t=[];for(let r=0;r<n;r++)t.push(e);return t}function or(n,e,t){let r=zo(n,e);return r>=0?n[1|r]=t:(r=~r,function nI(n,e,t,r){let i=n.length;if(i==e)n.push(t,r);else if(1===i)n.push(r,n[0]),n[0]=t;else{for(i--,n.push(n[i-1],n[i]);i>e;)n[i]=n[i-2],i--;n[e]=t,n[e+1]=r}}(n,r,e,t)),r}function zp(n,e){const t=zo(n,e);if(t>=0)return n[1|t]}function zo(n,e){return function W0(n,e,t){let r=0,i=n.length>>t;for(;i!==r;){const s=r+(i-r>>1),o=n[s<<t];if(e===o)return s<<t;o>e?i=s:r=s+1}return~(i<<t)}(n,e,1)}const zl={},Wp="__NG_DI_FLAG__",sd="ngTempTokenPath",cI=/\n/gm,q0="__source",dI=Tt({provide:String,useValue:Tt});let jl;function Z0(n){const e=jl;return jl=n,e}function hI(n,e=ke.Default){if(void 0===jl)throw new vt(203,"");return null===jl?o0(n,void 0,e):jl.get(n,e&ke.Optional?null:void 0,e)}function xe(n,e=ke.Default){return(function ZA(){return pp}()||hI)(Xe(n),e)}const Wl=xe;function $p(n){const e=[];for(let t=0;t<n.length;t++){const r=Xe(n[t]);if(Array.isArray(r)){if(0===r.length)throw new vt(900,"");let i,s=ke.Default;for(let o=0;o<r.length;o++){const a=r[o],l=fI(a);"number"==typeof l?-1===l?i=a.token:s|=l:i=a}e.push(xe(i,s))}else e.push(xe(r))}return e}function $l(n,e){return n[Wp]=e,n.prototype[Wp]=e,n}function fI(n){return n[Wp]}const od=$l(Vo("Inject",n=>({token:n})),-1),ns=$l(Vo("Optional"),8),ql=$l(Vo("SkipSelf"),4);const fM="__ngContext__";function Ln(n,e){n[fM]=e}function ng(n){const e=function Kl(n){return n[fM]||null}(n);return e?Array.isArray(e)?e:e.lView:null}function ig(n){return n.ngOriginalError}function sR(n,...e){n.error(...e)}class Ql{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e),r=function iR(n){return n&&n.ngErrorLogger||sR}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&ig(e);for(;t&&ig(t);)t=ig(t);return t||null}}const gR=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Ct))();function ti(n){return n instanceof Function?n():n}var ar=(()=>((ar=ar||{})[ar.Important=1]="Important",ar[ar.DashCase=2]="DashCase",ar))();function og(n,e){return undefined(n,e)}function ec(n){const e=n[3];return Lr(e)?e[3]:e}function ag(n){return xM(n[13])}function lg(n){return xM(n[4])}function xM(n){for(;null!==n&&!Lr(n);)n=n[4];return n}function qo(n,e,t,r,i){if(null!=r){let s,o=!1;Lr(r)?s=r:Jr(r)&&(o=!0,r=r[0]);const a=nn(r);0===n&&null!==t?null==i?TM(e,t,a):$s(e,t,a,i||null,!0):1===n&&null!==t?$s(e,t,a,i||null,!0):2===n?function FM(n,e,t){const r=hd(n,e);r&&function NR(n,e,t,r){qt(n)?n.removeChild(e,t,r):e.removeChild(t)}(n,r,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function RR(n,e,t,r,i){const s=t[7];s!==nn(t)&&qo(e,n,r,s,i);for(let a=10;a<t.length;a++){const l=t[a];tc(l[1],l,n,e,r,s)}}(e,n,s,t,i)}}function ug(n,e,t){if(qt(n))return n.createElement(e,t);{const r=null!==t?function g1(n){const e=n.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(t):null;return null===r?n.createElement(e):n.createElementNS(r,e)}}function SM(n,e){const t=n[9],r=t.indexOf(e),i=e[3];1024&e[2]&&(e[2]&=-1025,Tp(i,-1)),t.splice(r,1)}function dg(n,e){if(n.length<=10)return;const t=10+e,r=n[t];if(r){const i=r[17];null!==i&&i!==n&&SM(i,r),e>0&&(n[t-1][4]=r[4]);const s=rd(n,10+e);!function bR(n,e){tc(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(r[1],r);const o=s[19];null!==o&&o.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}function EM(n,e){if(!(256&e[2])){const t=e[11];qt(t)&&t.destroyNode&&tc(n,e,t,3,null,null),function SR(n){let e=n[13];if(!e)return hg(n[1],n);for(;e;){let t=null;if(Jr(e))t=e[13];else{const r=e[10];r&&(t=r)}if(!t){for(;e&&!e[4]&&e!==n;)Jr(e)&&hg(e[1],e),e=e[3];null===e&&(e=n),Jr(e)&&hg(e[1],e),t=e&&e[4]}e=t}}(e)}}function hg(n,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function TR(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let r=0;r<t.length;r+=2){const i=e[t[r]];if(!(i instanceof Fl)){const s=t[r+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=i[s[o]],l=s[o+1];try{l.call(a)}finally{}}else try{s.call(i)}finally{}}}}(n,e),function DR(n,e){const t=n.cleanup,r=e[7];let i=-1;if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+1],a="function"==typeof o?o(e):nn(e[o]),l=r[i=t[s+2]],c=t[s+3];"boolean"==typeof c?a.removeEventListener(t[s],l,c):c>=0?r[i=c]():r[i=-c].unsubscribe(),s+=2}else{const o=r[i=t[s+1]];t[s].call(o)}if(null!==r){for(let s=i+1;s<r.length;s++)r[s]();e[7]=null}}(n,e),1===e[1].type&&qt(e[11])&&e[11].destroy();const t=e[17];if(null!==t&&Lr(e[3])){t!==e[3]&&SM(t,e);const r=e[19];null!==r&&r.detachView(n)}}}function CM(n,e,t){return function DM(n,e,t){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return t[0];if(2&r.flags){const i=n.data[r.directiveStart].encapsulation;if(i===Yr.None||i===Yr.Emulated)return null}return _r(r,t)}(n,e.parent,t)}function $s(n,e,t,r,i){qt(n)?n.insertBefore(e,t,r,i):e.insertBefore(t,r,i)}function TM(n,e,t){qt(n)?n.appendChild(e,t):e.appendChild(t)}function NM(n,e,t,r,i){null!==r?$s(n,e,t,r,i):TM(n,e,t)}function hd(n,e){return qt(n)?n.parentNode(e):e.parentNode}function AM(n,e,t){return RM(n,e,t)}let RM=function IM(n,e,t){return 40&n.type?_r(n,t):null};function fd(n,e,t,r){const i=CM(n,r,e),s=e[11],a=AM(r.parent||e[6],r,e);if(null!=i)if(Array.isArray(t))for(let l=0;l<t.length;l++)NM(s,i,t[l],a,!1);else NM(s,i,t,a,!1)}function pd(n,e){if(null!==e){const t=e.type;if(3&t)return _r(e,n);if(4&t)return pg(-1,n[e.index]);if(8&t){const r=e.child;if(null!==r)return pd(n,r);{const i=n[e.index];return Lr(i)?pg(-1,i):nn(i)}}if(32&t)return og(e,n)()||nn(n[e.index]);{const r=LM(n,e);return null!==r?Array.isArray(r)?r[0]:pd(ec(n[16]),r):pd(n,e.next)}}return null}function LM(n,e){return null!==e?n[16][6].projection[e.projection]:null}function pg(n,e){const t=10+n+1;if(t<e.length){const r=e[t],i=r[1].firstChild;if(null!==i)return pd(r,i)}return e[7]}function gg(n,e,t,r,i,s,o){for(;null!=t;){const a=r[t.index],l=t.type;if(o&&0===e&&(a&&Ln(nn(a),r),t.flags|=4),64!=(64&t.flags))if(8&l)gg(n,e,t.child,r,i,s,!1),qo(e,n,i,a,s);else if(32&l){const c=og(t,r);let u;for(;u=c();)qo(e,n,i,u,s);qo(e,n,i,a,s)}else 16&l?OM(n,e,r,t,i,s):qo(e,n,i,a,s);t=o?t.projectionNext:t.next}}function tc(n,e,t,r,i,s){gg(t,r,n.firstChild,e,i,s,!1)}function OM(n,e,t,r,i,s){const o=t[16],l=o[6].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)qo(e,n,i,l[c],s);else gg(n,e,l,o[3],i,s,!0)}function kM(n,e,t){qt(n)?n.setAttribute(e,"style",t):e.style.cssText=t}function mg(n,e,t){qt(n)?""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t):e.className=t}function BM(n,e,t){let r=n.length;for(;;){const i=n.indexOf(e,t);if(-1===i)return i;if(0===i||n.charCodeAt(i-1)<=32){const s=e.length;if(i+s===r||n.charCodeAt(i+s)<=32)return i}t=i+1}}const UM="ng-template";function LR(n,e,t){let r=0;for(;r<n.length;){let i=n[r++];if(t&&"class"===i){if(i=n[r],-1!==BM(i.toLowerCase(),e,0))return!0}else if(1===i){for(;r<n.length&&"string"==typeof(i=n[r++]);)if(i.toLowerCase()===e)return!0;return!1}}return!1}function HM(n){return 4===n.type&&n.value!==UM}function FR(n,e,t){return e===(4!==n.type||t?n.value:UM)}function OR(n,e,t){let r=4;const i=n.attrs||[],s=function UR(n){for(let e=0;e<n.length;e++)if(A0(n[e]))return e;return n.length}(i);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&r){if(r=2|1&r,""!==l&&!FR(n,l,t)||""===l&&1===e.length){if(Or(r))return!1;o=!0}}else{const c=8&r?l:e[++a];if(8&r&&null!==n.attrs){if(!LR(n.attrs,c,t)){if(Or(r))return!1;o=!0}continue}const d=kR(8&r?"class":l,i,HM(n),t);if(-1===d){if(Or(r))return!1;o=!0;continue}if(""!==c){let h;h=d>s?"":i[d+1].toLowerCase();const f=8&r?h:null;if(f&&-1!==BM(f,c,0)||2&r&&c!==h){if(Or(r))return!1;o=!0}}}}else{if(!o&&!Or(r)&&!Or(l))return!1;if(o&&Or(l))continue;o=!1,r=l|1&r}}return Or(r)||o}function Or(n){return 0==(1&n)}function kR(n,e,t,r){if(null===e)return-1;let i=0;if(r||!t){let s=!1;for(;i<e.length;){const o=e[i];if(o===n)return i;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++i];for(;"string"==typeof a;)a=e[++i];continue}if(4===o)break;if(0===o){i+=4;continue}}i+=s?1:2}return-1}return function HR(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const r=n[t];if("number"==typeof r)return-1;if(r===e)return t;t++}return-1}(e,n)}function GM(n,e,t=!1){for(let r=0;r<e.length;r++)if(OR(n,e[r],t))return!0;return!1}function GR(n,e){e:for(let t=0;t<e.length;t++){const r=e[t];if(n.length===r.length){for(let i=0;i<n.length;i++)if(n[i]!==r[i])continue e;return!0}}return!1}function VM(n,e){return n?":not("+e.trim()+")":e}function VR(n){let e=n[0],t=1,r=2,i="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&r){const a=n[++t];i+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&r?i+="."+o:4&r&&(i+=" "+o);else""!==i&&!Or(o)&&(e+=VM(s,i),i=""),r=o,s=s||!Or(r);t++}return""!==i&&(e+=VM(s,i)),e}const He={};function nc(n){zM(ft(),te(),Bn()+n,ju())}function zM(n,e,t,r){if(!r)if(3==(3&e[2])){const s=n.preOrderCheckHooks;null!==s&&Xu(e,s,t)}else{const s=n.preOrderHooks;null!==s&&Yu(e,s,0,t)}es(t)}function gd(n,e){return n<<17|e<<2}function kr(n){return n>>17&32767}function yg(n){return 2|n}function Ci(n){return(131068&n)>>2}function vg(n,e){return-131069&n|e<<2}function _g(n){return 1|n}function eb(n,e){const t=n.contentQueries;if(null!==t)for(let r=0;r<t.length;r+=2){const i=t[r],s=t[r+1];if(-1!==s){const o=n.data[s];Pp(i),o.contentQueries(2,e[s],s)}}}function rc(n,e,t,r,i,s,o,a,l,c){const u=e.blueprint.slice();return u[0]=i,u[2]=140|r,v0(u),u[3]=u[15]=n,u[8]=t,u[10]=o||n&&n[10],u[11]=a||n&&n[11],u[12]=l||n&&n[12]||null,u[9]=c||n&&n[9]||null,u[6]=s,u[16]=2==e.type?n[16]:u,u}function Zo(n,e,t,r,i){let s=n.data[e];if(null===s)s=function Tg(n,e,t,r,i){const s=M0(),o=Np(),l=n.data[e]=function oP(n,e,t,r,i,s){return{type:t,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,r,i);return null===n.firstChild&&(n.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l)),l}(n,e,t,r,i),function T1(){return Fe.lFrame.inI18n}()&&(s.flags|=64);else if(64&s.type){s.type=t,s.value=r,s.attrs=i;const o=function Ll(){const n=Fe.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return Kr(s,!0),s}function Xo(n,e,t,r){if(0===t)return-1;const i=e.length;for(let s=0;s<t;s++)e.push(r),n.blueprint.push(r),n.data.push(null);return i}function ic(n,e,t){$u(e);try{const r=n.viewQuery;null!==r&&kg(1,r,t);const i=n.template;null!==i&&tb(n,e,i,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&eb(n,e),n.staticViewQueries&&kg(2,n.viewQuery,t);const s=n.components;null!==s&&function rP(n,e){for(let t=0;t<e.length;t++)SP(n,e[t])}(e,s)}catch(r){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),r}finally{e[2]&=-5,qu()}}function Yo(n,e,t,r){const i=e[2];if(256==(256&i))return;$u(e);const s=ju();try{v0(e),function b0(n){return Fe.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&tb(n,e,t,2,r);const o=3==(3&i);if(!s)if(o){const c=n.preOrderCheckHooks;null!==c&&Xu(e,c,null)}else{const c=n.preOrderHooks;null!==c&&Yu(e,c,0,null),Lp(e,0)}if(function xP(n){for(let e=ag(n);null!==e;e=lg(e)){if(!e[2])continue;const t=e[9];for(let r=0;r<t.length;r++){const i=t[r],s=i[3];0==(1024&i[2])&&Tp(s,1),i[2]|=1024}}}(e),function bP(n){for(let e=ag(n);null!==e;e=lg(e))for(let t=10;t<e.length;t++){const r=e[t],i=r[1];Dp(r)&&Yo(i,r,i.template,r[8])}}(e),null!==n.contentQueries&&eb(n,e),!s)if(o){const c=n.contentCheckHooks;null!==c&&Xu(e,c)}else{const c=n.contentHooks;null!==c&&Yu(e,c,1),Lp(e,1)}!function tP(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let r=0;r<t.length;r++){const i=t[r];if(i<0)es(~i);else{const s=i,o=t[++r],a=t[++r];N1(o,s),a(2,e[s])}}}finally{es(-1)}}(n,e);const a=n.components;null!==a&&function nP(n,e){for(let t=0;t<e.length;t++)wP(n,e[t])}(e,a);const l=n.viewQuery;if(null!==l&&kg(2,l,r),!s)if(o){const c=n.viewCheckHooks;null!==c&&Xu(e,c)}else{const c=n.viewHooks;null!==c&&Yu(e,c,2),Lp(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),s||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,Tp(e[3],-1))}finally{qu()}}function iP(n,e,t,r){const i=e[10],s=!ju(),o=y0(e);try{s&&!o&&i.begin&&i.begin(),o&&ic(n,e,r),Yo(n,e,t,r)}finally{s&&!o&&i.end&&i.end()}}function tb(n,e,t,r,i){const s=Bn(),o=2&r;try{es(-1),o&&e.length>20&&zM(n,e,20,ju()),t(r,i)}finally{es(s)}}function nb(n,e,t){if(_p(e)){const i=e.directiveEnd;for(let s=e.directiveStart;s<i;s++){const o=n.data[s];o.contentQueries&&o.contentQueries(1,t[s],s)}}}function Ng(n,e,t){!_0()||(function fP(n,e,t,r){const i=t.directiveStart,s=t.directiveEnd;n.firstCreatePass||kl(t,e),Ln(r,e);const o=t.initialInputs;for(let a=i;a<s;a++){const l=n.data[a],c=Fr(l);c&&vP(e,t,l);const u=Bl(e,n,a,t);Ln(u,e),null!==o&&_P(0,a-i,u,l,0,o),c&&(sr(t.index,e)[8]=u)}}(n,e,t,_r(t,e)),128==(128&t.flags)&&function pP(n,e,t){const r=t.directiveStart,i=t.directiveEnd,o=t.index,a=function A1(){return Fe.lFrame.currentDirectiveIndex}();try{es(o);for(let l=r;l<i;l++){const c=n.data[l],u=e[l];Ip(l),(null!==c.hostBindings||0!==c.hostVars||null!==c.hostAttrs)&&ub(c,u)}}finally{es(-1),Ip(a)}}(n,e,t))}function Ag(n,e,t=_r){const r=e.localNames;if(null!==r){let i=e.index+1;for(let s=0;s<r.length;s+=2){const o=r[s+1],a=-1===o?t(e,n):n[o];n[i++]=a}}}function rb(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=vd(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function vd(n,e,t,r,i,s,o,a,l,c){const u=20+r,d=u+i,h=function sP(n,e){const t=[];for(let r=0;r<e;r++)t.push(r<n?null:He);return t}(u,d),f="function"==typeof c?c():c;return h[1]={type:n,blueprint:h,template:t,queries:null,viewQuery:a,declTNode:e,data:h.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:f,incompleteFirstPass:!1}}function ob(n,e,t,r){const i=mb(e);null===t?i.push(r):(i.push(t),n.firstCreatePass&&yb(n).push(r,i.length-1))}function ab(n,e,t){for(let r in n)if(n.hasOwnProperty(r)){const i=n[r];(t=null===t?{}:t).hasOwnProperty(r)?t[r].push(e,i):t[r]=[e,i]}return t}function Ig(n,e,t,r){let i=!1;if(_0()){const s=function gP(n,e,t){const r=n.directiveRegistry;let i=null;if(r)for(let s=0;s<r.length;s++){const o=r[s];GM(t,o.selectors,!1)&&(i||(i=[]),td(kl(t,e),n,o.type),Fr(o)?(db(n,t),i.unshift(o)):i.push(o))}return i}(n,e,t),o=null===r?null:{"":-1};if(null!==s){i=!0,hb(t,n.data.length,s.length);for(let u=0;u<s.length;u++){const d=s[u];d.providersResolver&&d.providersResolver(d)}let a=!1,l=!1,c=Xo(n,e,s.length,null);for(let u=0;u<s.length;u++){const d=s[u];t.mergedAttrs=Ku(t.mergedAttrs,d.hostAttrs),fb(n,t,e,c,d),yP(c,d,o),null!==d.contentQueries&&(t.flags|=8),(null!==d.hostBindings||null!==d.hostAttrs||0!==d.hostVars)&&(t.flags|=128);const h=d.type.prototype;!a&&(h.ngOnChanges||h.ngOnInit||h.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),a=!0),!l&&(h.ngOnChanges||h.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),l=!0),c++}!function aP(n,e){const r=e.directiveEnd,i=n.data,s=e.attrs,o=[];let a=null,l=null;for(let c=e.directiveStart;c<r;c++){const u=i[c],d=u.inputs,h=null===s||HM(e)?null:MP(d,s);o.push(h),a=ab(d,c,a),l=ab(u.outputs,c,l)}null!==a&&(a.hasOwnProperty("class")&&(e.flags|=16),a.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=o,e.inputs=a,e.outputs=l}(n,t)}o&&function mP(n,e,t){if(e){const r=n.localNames=[];for(let i=0;i<e.length;i+=2){const s=t[e[i+1]];if(null==s)throw new vt(-301,!1);r.push(e[i],s)}}}(t,r,o)}return t.mergedAttrs=Ku(t.mergedAttrs,t.attrs),i}function cb(n,e,t,r,i,s){const o=s.hostBindings;if(o){let a=n.hostBindingOpCodes;null===a&&(a=n.hostBindingOpCodes=[]);const l=~e.index;(function hP(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(a)!=l&&a.push(l),a.push(r,i,o)}}function ub(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function db(n,e){e.flags|=2,(n.components||(n.components=[])).push(e.index)}function yP(n,e,t){if(t){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)t[e.exportAs[r]]=n;Fr(e)&&(t[""]=n)}}function hb(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}function fb(n,e,t,r,i){n.data[r]=i;const s=i.factory||(i.factory=js(i.type)),o=new Fl(s,Fr(i),null);n.blueprint[r]=o,t[r]=o,cb(n,e,0,r,Xo(n,t,i.hostVars,He),i)}function vP(n,e,t){const r=_r(e,n),i=rb(t),s=n[10],o=_d(n,rc(n,i,null,t.onPush?64:16,r,e,s,s.createRenderer(r,t),null,null));n[e.index]=o}function _P(n,e,t,r,i,s){const o=s[e];if(null!==o){const a=r.setInput;for(let l=0;l<o.length;){const c=o[l++],u=o[l++],d=o[l++];null!==a?r.setInput(t,d,c,u):t[u]=d}}}function MP(n,e){let t=null,r=0;for(;r<e.length;){const i=e[r];if(0!==i)if(5!==i){if("number"==typeof i)break;n.hasOwnProperty(i)&&(null===t&&(t=[]),t.push(i,n[i],e[r+1])),r+=2}else r+=2;else r+=4}return t}function pb(n,e,t,r){return new Array(n,!0,!1,e,null,0,r,t,null,null)}function wP(n,e){const t=sr(e,n);if(Dp(t)){const r=t[1];80&t[2]?Yo(r,t,r.template,t[8]):t[5]>0&&Pg(t)}}function Pg(n){for(let r=ag(n);null!==r;r=lg(r))for(let i=10;i<r.length;i++){const s=r[i];if(1024&s[2]){const o=s[1];Yo(o,s,o.template,s[8])}else s[5]>0&&Pg(s)}const t=n[1].components;if(null!==t)for(let r=0;r<t.length;r++){const i=sr(t[r],n);Dp(i)&&i[5]>0&&Pg(i)}}function SP(n,e){const t=sr(e,n),r=t[1];(function EP(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(r,t),ic(r,t,t[8])}function _d(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function Lg(n){for(;n;){n[2]|=64;const e=ec(n);if(s1(n)&&!e)return n;n=e}return null}function Og(n,e,t){const r=e[10];r.begin&&r.begin();try{Yo(n,e,n.template,t)}catch(i){throw _b(e,i),i}finally{r.end&&r.end()}}function gb(n){!function Fg(n){for(let e=0;e<n.components.length;e++){const t=n.components[e],r=ng(t),i=r[1];iP(i,r,i.template,t)}}(n[8])}function kg(n,e,t){Pp(0),e(n,t)}const NP=(()=>Promise.resolve(null))();function mb(n){return n[7]||(n[7]=[])}function yb(n){return n.cleanup||(n.cleanup=[])}function _b(n,e){const t=n[9],r=t?t.get(Ql,null):null;r&&r.handleError(e)}function Mb(n,e,t,r,i){for(let s=0;s<t.length;){const o=t[s++],a=t[s++],l=e[o],c=n.data[o];null!==c.setInput?c.setInput(l,i,r,a):l[a]=i}}function Md(n,e,t){let r=t?n.styles:null,i=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?i=cp(i,a):2==s&&(r=cp(r,a+": "+e[++o]+";"))}t?n.styles=r:n.stylesWithoutHost=r,t?n.classes=i:n.classesWithoutHost=i}const Bg=new _e("INJECTOR",-1);class bb{get(e,t=zl){if(t===zl){const r=new Error(`NullInjectorError: No provider for ${xt(e)}!`);throw r.name="NullInjectorError",r}return t}}const Ug=new _e("Set Injector scope."),sc={},RP={};let Hg;function xb(){return void 0===Hg&&(Hg=new bb),Hg}function wb(n,e=null,t=null,r){const i=Sb(n,e,t,r);return i._resolveInjectorDefTypes(),i}function Sb(n,e=null,t=null,r){return new PP(n,t,e||xb(),r)}class PP{constructor(e,t,r,i=null){this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const s=[];t&&Qr(t,a=>this.processProvider(a,e,t)),Qr([e],a=>this.processInjectorType(a,[],s)),this.records.set(Bg,Jo(void 0,this));const o=this.records.get(Ug);this.scope=null!=o?o.value:null,this.source=i||("object"==typeof e?null:xt(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,t=zl,r=ke.Default){this.assertNotDestroyed();const i=Z0(this),s=Yi(void 0);try{if(!(r&ke.SkipSelf)){let a=this.records.get(e);if(void 0===a){const l=function GP(n){return"function"==typeof n||"object"==typeof n&&n instanceof _e}(e)&&hp(e);a=l&&this.injectableDefInScope(l)?Jo(Gg(e),sc):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(r&ke.Self?xb():this.parent).get(e,t=r&ke.Optional&&t===zl?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[sd]=o[sd]||[]).unshift(xt(e)),i)throw o;return function pI(n,e,t,r){const i=n[sd];throw e[q0]&&i.unshift(e[q0]),n.message=function gI(n,e,t,r=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.substr(2):n;let i=xt(e);if(Array.isArray(e))i=e.map(xt).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):xt(a)))}i=`{${s.join(", ")}}`}return`${t}${r?"("+r+")":""}[${i}]: ${n.replace(cI,"\n  ")}`}("\n"+n.message,i,t,r),n.ngTokenPath=i,n[sd]=null,n}(o,e,"R3InjectorError",this.source)}throw o}finally{Yi(s),Z0(i)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((r,i)=>e.push(xt(i))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new vt(205,!1)}processInjectorType(e,t,r){if(!(e=Xe(e)))return!1;let i=r0(e);const s=null==i&&e.ngModule||void 0,o=void 0===s?e:s,a=-1!==r.indexOf(o);if(void 0!==s&&(i=r0(s)),null==i)return!1;if(null!=i.imports&&!a){let u;r.push(o);try{Qr(i.imports,d=>{this.processInjectorType(d,t,r)&&(void 0===u&&(u=[]),u.push(d))})}finally{}if(void 0!==u)for(let d=0;d<u.length;d++){const{ngModule:h,providers:f}=u[d];Qr(f,p=>this.processProvider(p,h,f||Nt))}}this.injectorDefTypes.add(o);const l=js(o)||(()=>new o);this.records.set(o,Jo(l,sc));const c=i.providers;if(null!=c&&!a){const u=e;Qr(c,d=>this.processProvider(d,u,c))}return void 0!==s&&void 0!==e.providers}processProvider(e,t,r){let i=Ko(e=Xe(e))?e:Xe(e&&e.provide);const s=function FP(n,e,t){return Cb(n)?Jo(void 0,n.useValue):Jo(Eb(n),sc)}(e);if(Ko(e)||!0!==e.multi)this.records.get(i);else{let o=this.records.get(i);o||(o=Jo(void 0,sc,!0),o.factory=()=>$p(o.multi),this.records.set(i,o)),i=e,o.multi.push(e)}this.records.set(i,s)}hydrate(e,t){return t.value===sc&&(t.value=RP,t.value=t.factory()),"object"==typeof t.value&&t.value&&function HP(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this.onDestroy.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Xe(e.providedIn);return"string"==typeof t?"any"===t||t===this.scope:this.injectorDefTypes.has(t)}}function Gg(n){const e=hp(n),t=null!==e?e.factory:js(n);if(null!==t)return t;if(n instanceof _e)throw new vt(204,!1);if(n instanceof Function)return function LP(n){const e=n.length;if(e>0)throw Vl(e,"?"),new vt(204,!1);const t=function WA(n){const e=n&&(n[Ou]||n[s0]);if(e){const t=function $A(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new vt(204,!1)}function Eb(n,e,t){let r;if(Ko(n)){const i=Xe(n);return js(i)||Gg(i)}if(Cb(n))r=()=>Xe(n.useValue);else if(function kP(n){return!(!n||!n.useFactory)}(n))r=()=>n.useFactory(...$p(n.deps||[]));else if(function OP(n){return!(!n||!n.useExisting)}(n))r=()=>xe(Xe(n.useExisting));else{const i=Xe(n&&(n.useClass||n.provide));if(!function UP(n){return!!n.deps}(n))return js(i)||Gg(i);r=()=>new i(...$p(n.deps))}return r}function Jo(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function Cb(n){return null!==n&&"object"==typeof n&&dI in n}function Ko(n){return"function"==typeof n}let cr=(()=>{class n{static create(t,r){var i;if(Array.isArray(t))return wb({name:""},r,t,"");{const s=null!==(i=t.name)&&void 0!==i?i:"";return wb({name:s},t.parent,t.providers,s)}}}return n.THROW_IF_NOT_FOUND=zl,n.NULL=new bb,n.\u0275prov=rt({token:n,providedIn:"any",factory:()=>xe(Bg)}),n.__NG_ELEMENT_ID__=-1,n})();function XP(n,e){Zu(ng(n)[1],pn())}function wn(n){let e=function Bb(n){return Object.getPrototypeOf(n.prototype).constructor}(n.type),t=!0;const r=[n];for(;e;){let i;if(Fr(n))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new vt(903,"");i=e.\u0275dir}if(i){if(t){r.push(i);const o=n;o.inputs=jg(n.inputs),o.declaredInputs=jg(n.declaredInputs),o.outputs=jg(n.outputs);const a=i.hostBindings;a&&QP(n,a);const l=i.viewQuery,c=i.contentQueries;if(l&&JP(n,l),c&&KP(n,c),lp(n.inputs,i.inputs),lp(n.declaredInputs,i.declaredInputs),lp(n.outputs,i.outputs),Fr(i)&&i.data.animation){const u=n.data;u.animation=(u.animation||[]).concat(i.data.animation)}}const s=i.features;if(s)for(let o=0;o<s.length;o++){const a=s[o];a&&a.ngInherit&&a(n),a===wn&&(t=!1)}}e=Object.getPrototypeOf(e)}!function YP(n){let e=0,t=null;for(let r=n.length-1;r>=0;r--){const i=n[r];i.hostVars=e+=i.hostVars,i.hostAttrs=Ku(i.hostAttrs,t=Ku(t,i.hostAttrs))}}(r)}function jg(n){return n===No?{}:n===Nt?[]:n}function JP(n,e){const t=n.viewQuery;n.viewQuery=t?(r,i)=>{e(r,i),t(r,i)}:e}function KP(n,e){const t=n.contentQueries;n.contentQueries=t?(r,i,s)=>{e(r,i,s),t(r,i,s)}:e}function QP(n,e){const t=n.hostBindings;n.hostBindings=t?(r,i)=>{e(r,i),t(r,i)}:e}let bd=null;function Qo(){if(!bd){const n=Ct.Symbol;if(n&&n.iterator)bd=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const r=e[t];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(bd=r)}}}return bd}function Fn(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function qg(n,e,t,r,i,s,o,a){const l=te(),c=ft(),u=n+20,d=c.firstCreatePass?function oL(n,e,t,r,i,s,o,a,l){const c=e.consts,u=Zo(e,n,4,o||null,Qi(c,a));Ig(e,t,u,Qi(c,l)),Zu(e,u);const d=u.tViews=vd(2,u,r,i,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}(u,c,l,e,t,r,i,s,o):c.data[u];Kr(d,!1);const h=l[11].createComment("");fd(c,l,h,d),Ln(h,l),_d(l,l[u]=pb(h,l,h,d)),Vu(d)&&Ng(c,l,d),null!=o&&Ag(l,d,a)}function Zg(n){return function Lo(n,e){return n[e]}(function D1(){return Fe.lFrame.contextLView}(),20+n)}function fe(n,e=ke.Default){const t=te();return null===t?xe(n,e):k0(pn(),t,Xe(n),e)}function Qg(){throw new Error("invalid")}function Zs(n,e,t){const r=te();return Fn(r,function Fo(){return Fe.lFrame.bindingIndex++}(),e)&&function lr(n,e,t,r,i,s,o,a){const l=_r(e,t);let u,c=e.inputs;!a&&null!=c&&(u=c[r])?(Mb(n,t,u,r,i),Gu(e)&&function cP(n,e){const t=sr(e,n);16&t[2]||(t[2]|=64)}(t,e.index)):3&e.type&&(r=function lP(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(r),i=null!=o?o(i,e.value||"",r):i,qt(s)?s.setProperty(l,r,i):Op(r)||(l.setProperty?l.setProperty(r,i):l[r]=i))}(ft(),function Zt(){const n=Fe.lFrame;return Cp(n.tView,n.selectedIndex)}(),r,n,e,r[11],t,!1),Zs}function em(n,e,t,r,i){const o=i?"class":"style";Mb(n,t,e.inputs[o],o,r)}function lc(n,e,t,r){const i=te(),s=ft(),o=20+n,a=i[11],l=i[o]=ug(a,e,function B1(){return Fe.lFrame.currentNamespace}()),c=s.firstCreatePass?function DL(n,e,t,r,i,s,o){const a=e.consts,c=Zo(e,n,2,i,Qi(a,s));return Ig(e,t,c,Qi(a,o)),null!==c.attrs&&Md(c,c.attrs,!1),null!==c.mergedAttrs&&Md(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(o,s,i,0,e,t,r):s.data[o];Kr(c,!0);const u=c.mergedAttrs;null!==u&&Ju(a,l,u);const d=c.classes;null!==d&&mg(a,l,d);const h=c.styles;return null!==h&&kM(a,l,h),64!=(64&c.flags)&&fd(s,i,l,c),0===function b1(){return Fe.lFrame.elementDepthCount}()&&Ln(l,i),function x1(){Fe.lFrame.elementDepthCount++}(),Vu(c)&&(Ng(s,i,c),nb(s,c,i)),null!==r&&Ag(i,c),lc}function cc(){let n=pn();Np()?Ap():(n=n.parent,Kr(n,!1));const e=n;!function w1(){Fe.lFrame.elementDepthCount--}();const t=ft();return t.firstCreatePass&&(Zu(t,n),_p(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function z1(n){return 0!=(16&n.flags)}(e)&&em(t,e,te(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function j1(n){return 0!=(32&n.flags)}(e)&&em(t,e,te(),e.stylesWithoutHost,!1),cc}function ua(n,e,t,r){return lc(n,e,t,r),cc(),ua}function tm(n,e,t){const r=te(),i=ft(),s=n+20,o=i.firstCreatePass?function TL(n,e,t,r,i){const s=e.consts,o=Qi(s,r),a=Zo(e,n,8,"ng-container",o);return null!==o&&Md(a,o,!0),Ig(e,t,a,Qi(s,i)),null!==e.queries&&e.queries.elementStart(e,a),a}(s,i,r,e,t):i.data[s];Kr(o,!0);const a=r[s]=r[11].createComment("");return fd(i,r,a,o),Ln(a,r),Vu(o)&&(Ng(i,r,o),nb(i,o,r)),null!=t&&Ag(r,o),tm}function nm(){let n=pn();const e=ft();return Np()?Ap():(n=n.parent,Kr(n,!1)),e.firstCreatePass&&(Zu(e,n),_p(n)&&e.queries.elementEnd(n)),nm}function rm(n,e,t){return tm(n,e,t),nm(),rm}function Sd(n){return!!n&&"function"==typeof n.then}const sx=function ix(n){return!!n&&"function"==typeof n.subscribe};function uc(n,e,t,r){const i=te(),s=ft(),o=pn();return function ax(n,e,t,r,i,s,o,a){const l=Vu(r),u=n.firstCreatePass&&yb(n),d=e[8],h=mb(e);let f=!0;if(3&r.type||a){const g=_r(r,e),v=a?a(g):g,y=h.length,M=a?_=>a(nn(_[r.index])):r.index;if(qt(t)){let _=null;if(!a&&l&&(_=function AL(n,e,t,r){const i=n.cleanup;if(null!=i)for(let s=0;s<i.length-1;s+=2){const o=i[s];if(o===t&&i[s+1]===r){const a=e[7],l=i[s+2];return a.length>l?a[l]:null}"string"==typeof o&&(s+=2)}return null}(n,e,i,r.index)),null!==_)(_.__ngLastListenerFn__||_).__ngNextListenerFn__=s,_.__ngLastListenerFn__=s,f=!1;else{s=im(r,e,d,s,!1);const x=t.listen(v,i,s);h.push(s,x),u&&u.push(i,M,y,y+1)}}else s=im(r,e,d,s,!0),v.addEventListener(i,s,o),h.push(s),u&&u.push(i,M,y,o)}else s=im(r,e,d,s,!1);const p=r.outputs;let m;if(f&&null!==p&&(m=p[i])){const g=m.length;if(g)for(let v=0;v<g;v+=2){const w=e[m[v]][m[v+1]].subscribe(s),A=h.length;h.push(s,w),u&&u.push(i,r.index,A,-(A+1))}}}(s,i,i[11],o,n,e,!!t,r),uc}function lx(n,e,t,r){try{return!1!==t(r)}catch(i){return _b(n,i),!1}}function im(n,e,t,r,i){return function s(o){if(o===Function)return r;const a=2&n.flags?sr(n.index,e):e;0==(32&e[2])&&Lg(a);let l=lx(e,0,r,o),c=s.__ngNextListenerFn__;for(;c;)l=lx(e,0,c,o)&&l,c=c.__ngNextListenerFn__;return i&&!1===l&&(o.preventDefault(),o.returnValue=!1),l}}function cx(n=1){return function R1(n){return(Fe.lFrame.contextLView=function P1(n,e){for(;n>0;)e=e[15],n--;return e}(n,Fe.lFrame.contextLView))[8]}(n)}function IL(n,e){let t=null;const r=function BR(n){const e=n.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(n);for(let i=0;i<e.length;i++){const s=e[i];if("*"!==s){if(null===r?GM(n,s,!0):GR(r,s))return i}else t=i}return t}function Ti(n){const e=te()[16][6];if(!e.projection){const r=e.projection=Vl(n?n.length:1,null),i=r.slice();let s=e.child;for(;null!==s;){const o=n?IL(s,n):0;null!==o&&(i[o]?i[o].projectionNext=s:r[o]=s,i[o]=s),s=s.next}}}function Ni(n,e=0,t){const r=te(),i=ft(),s=Zo(i,20+n,16,null,t||null);null===s.projection&&(s.projection=e),Ap(),64!=(64&s.flags)&&function IR(n,e,t){OM(e[11],0,e,t,CM(n,t,e),AM(t.parent||e[6],t,e))}(i,r,s)}function _x(n,e,t,r,i){const s=n[t+1],o=null===e;let a=r?kr(s):Ci(s),l=!1;for(;0!==a&&(!1===l||o);){const u=n[a+1];LL(n[a],e)&&(l=!0,n[a+1]=r?_g(u):yg(u)),a=r?kr(u):Ci(u)}l&&(n[t+1]=r?yg(s):_g(s))}function LL(n,e){return null===n||null==e||(Array.isArray(n)?n[1]:n)===e||!(!Array.isArray(n)||"string"!=typeof e)&&zo(n,e)>=0}function om(n,e){return function Ur(n,e,t,r){const i=te(),s=ft(),o=function Ei(n){const e=Fe.lFrame,t=e.bindingIndex;return e.bindingIndex=e.bindingIndex+n,t}(2);s.firstUpdatePass&&function Tx(n,e,t,r){const i=n.data;if(null===i[t+1]){const s=i[Bn()],o=function Dx(n,e){return e>=n.expandoStartIndex}(n,t);(function Rx(n,e){return 0!=(n.flags&(e?16:32))})(s,r)&&null===e&&!o&&(e=!1),e=function zL(n,e,t,r){const i=function Rp(n){const e=Fe.lFrame.currentDirectiveIndex;return-1===e?null:n[e]}(n);let s=r?e.residualClasses:e.residualStyles;if(null===i)0===(r?e.classBindings:e.styleBindings)&&(t=dc(t=am(null,n,e,t,r),e.attrs,r),s=null);else{const o=e.directiveStylingLast;if(-1===o||n[o]!==i)if(t=am(i,n,e,t,r),null===s){let l=function jL(n,e,t){const r=t?e.classBindings:e.styleBindings;if(0!==Ci(r))return n[kr(r)]}(n,e,r);void 0!==l&&Array.isArray(l)&&(l=am(null,n,e,l[1],r),l=dc(l,e.attrs,r),function WL(n,e,t,r){n[kr(t?e.classBindings:e.styleBindings)]=r}(n,e,r,l))}else s=function $L(n,e,t){let r;const i=e.directiveEnd;for(let s=1+e.directiveStylingLast;s<i;s++)r=dc(r,n[s].hostAttrs,t);return dc(r,e.attrs,t)}(n,e,r)}return void 0!==s&&(r?e.residualClasses=s:e.residualStyles=s),t}(i,s,e,r),function RL(n,e,t,r,i,s){let o=s?e.classBindings:e.styleBindings,a=kr(o),l=Ci(o);n[r]=t;let u,c=!1;if(Array.isArray(t)){const d=t;u=d[1],(null===u||zo(d,u)>0)&&(c=!0)}else u=t;if(i)if(0!==l){const h=kr(n[a+1]);n[r+1]=gd(h,a),0!==h&&(n[h+1]=vg(n[h+1],r)),n[a+1]=function WR(n,e){return 131071&n|e<<17}(n[a+1],r)}else n[r+1]=gd(a,0),0!==a&&(n[a+1]=vg(n[a+1],r)),a=r;else n[r+1]=gd(l,0),0===a?a=r:n[l+1]=vg(n[l+1],r),l=r;c&&(n[r+1]=yg(n[r+1])),_x(n,u,r,!0),_x(n,u,r,!1),function PL(n,e,t,r,i){const s=i?n.residualClasses:n.residualStyles;null!=s&&"string"==typeof e&&zo(s,e)>=0&&(t[r+1]=_g(t[r+1]))}(e,u,n,r,s),o=gd(a,l),s?e.classBindings=o:e.styleBindings=o}(i,s,e,t,o,r)}}(s,n,o,r),e!==He&&Fn(i,o,e)&&function Ax(n,e,t,r,i,s,o,a){if(!(3&e.type))return;const l=n.data,c=l[a+1];Ed(function $M(n){return 1==(1&n)}(c)?Ix(l,e,t,i,Ci(c),o):void 0)||(Ed(s)||function WM(n){return 2==(2&n)}(c)&&(s=Ix(l,null,t,i,a,o)),function PR(n,e,t,r,i){const s=qt(n);if(e)i?s?n.addClass(t,r):t.classList.add(r):s?n.removeClass(t,r):t.classList.remove(r);else{let o=-1===r.indexOf("-")?void 0:ar.DashCase;if(null==i)s?n.removeStyle(t,r,o):t.style.removeProperty(r);else{const a="string"==typeof i&&i.endsWith("!important");a&&(i=i.slice(0,-10),o|=ar.Important),s?n.setStyle(t,r,i,o):t.style.setProperty(r,i,a?"important":"")}}}(r,o,function zu(n,e){return nn(e[n])}(Bn(),t),i,s))}(s,s.data[Bn()],i,i[11],n,i[o+1]=function XL(n,e){return null==n||("string"==typeof e?n+=e:"object"==typeof n&&(n=xt(function rs(n){return n instanceof class rM{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}?n.changingThisBreaksApplicationSecurity:n}(n)))),n}(e,t),r,o)}(n,e,null,!0),om}function am(n,e,t,r,i){let s=null;const o=t.directiveEnd;let a=t.directiveStylingLast;for(-1===a?a=t.directiveStart:a++;a<o&&(s=e[a],r=dc(r,s.hostAttrs,i),s!==n);)a++;return null!==n&&(t.directiveStylingLast=a),r}function dc(n,e,t){const r=t?1:2;let i=-1;if(null!==e)for(let s=0;s<e.length;s++){const o=e[s];"number"==typeof o?i=o:i===r&&(Array.isArray(n)||(n=void 0===n?[]:["",n]),or(n,o,!!t||e[++s]))}return void 0===n?null:n}function Ix(n,e,t,r,i,s){const o=null===e;let a;for(;i>0;){const l=n[i],c=Array.isArray(l),u=c?l[1]:l,d=null===u;let h=t[i+1];h===He&&(h=d?Nt:void 0);let f=d?zp(h,r):u===r?h:void 0;if(c&&!Ed(f)&&(f=zp(l,r)),Ed(f)&&(a=f,o))return a;const p=n[i+1];i=o?kr(p):Ci(p)}if(null!==e){let l=s?e.residualClasses:e.residualStyles;null!=l&&(a=zp(l,r))}return a}function Ed(n){return void 0!==n}const Cd="en-US";let tw=Cd;function dm(n,e,t,r,i){if(n=Xe(n),Array.isArray(n))for(let s=0;s<n.length;s++)dm(n[s],e,t,r,i);else{const s=ft(),o=te();let a=Ko(n)?n:Xe(n.provide),l=Eb(n);const c=pn(),u=1048575&c.providerIndexes,d=c.directiveStart,h=c.providerIndexes>>20;if(Ko(n)||!n.multi){const f=new Fl(l,i,fe),p=fm(a,e,i?u:u+h,d);-1===p?(td(kl(c,o),s,a),hm(s,n,e.length),e.push(a),c.directiveStart++,c.directiveEnd++,i&&(c.providerIndexes+=1048576),t.push(f),o.push(f)):(t[p]=f,o[p]=f)}else{const f=fm(a,e,u+h,d),p=fm(a,e,u,u+h),m=f>=0&&t[f],g=p>=0&&t[p];if(i&&!g||!i&&!m){td(kl(c,o),s,a);const v=function gO(n,e,t,r,i){const s=new Fl(n,t,fe);return s.multi=[],s.index=e,s.componentProviders=0,Ew(s,i,r&&!t),s}(i?pO:fO,t.length,i,r,l);!i&&g&&(t[p].providerFactory=v),hm(s,n,e.length,0),e.push(a),c.directiveStart++,c.directiveEnd++,i&&(c.providerIndexes+=1048576),t.push(v),o.push(v)}else hm(s,n,f>-1?f:p,Ew(t[i?p:f],l,!i&&r));!i&&r&&g&&t[p].componentProviders++}}}function hm(n,e,t,r){const i=Ko(e),s=function BP(n){return!!n.useClass}(e);if(i||s){const l=(s?Xe(e.useClass):e).prototype.ngOnDestroy;if(l){const c=n.destroyHooks||(n.destroyHooks=[]);if(!i&&e.multi){const u=c.indexOf(t);-1===u?c.push(t,[r,l]):c[u+1].push(r,l)}else c.push(t,l)}}}function Ew(n,e,t){return t&&n.componentProviders++,n.multi.push(e)-1}function fm(n,e,t,r){for(let i=t;i<r;i++)if(e[i]===n)return i;return-1}function fO(n,e,t,r){return pm(this.multi,[])}function pO(n,e,t,r){const i=this.multi;let s;if(this.providerFactory){const o=this.providerFactory.componentProviders,a=Bl(t,t[1],this.providerFactory.index,r);s=a.slice(0,o),pm(i,s);for(let l=o;l<a.length;l++)s.push(a[l])}else s=[],pm(i,s);return s}function pm(n,e){for(let t=0;t<n.length;t++)e.push((0,n[t])());return e}function Ai(n,e=[]){return t=>{t.providersResolver=(r,i)=>function hO(n,e,t){const r=ft();if(r.firstCreatePass){const i=Fr(n);dm(t,r.data,r.blueprint,i,!0),dm(e,r.data,r.blueprint,i,!1)}}(r,i?i(n):n,e)}}class Cw{}class vO{resolveComponentFactory(e){throw function yO(n){const e=Error(`No component factory found for ${xt(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let mc=(()=>{class n{}return n.NULL=new vO,n})();function _O(){return pa(pn(),te())}function pa(n,e){return new oi(_r(n,e))}let oi=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=_O,n})();function MO(n){return n instanceof oi?n.nativeElement:n}class Tw{}let wO=(()=>{class n{}return n.\u0275prov=rt({token:n,providedIn:"root",factory:()=>null}),n})();class Rd{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const SO=new Rd("13.3.6"),gm={};function Pd(n,e,t,r,i=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&r.push(nn(s)),Lr(s))for(let a=10;a<s.length;a++){const l=s[a],c=l[1].firstChild;null!==c&&Pd(l[1],l,c,r)}const o=t.type;if(8&o)Pd(n,e,t.child,r);else if(32&o){const a=og(t,e);let l;for(;l=a();)r.push(l)}else if(16&o){const a=LM(e,t);if(Array.isArray(a))r.push(...a);else{const l=ec(e[16]);Pd(l[1],l,a,r,!0)}}t=i?t.projectionNext:t.next}return r}class yc{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return Pd(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(Lr(e)){const t=e[8],r=t?t.indexOf(this):-1;r>-1&&(dg(e,r),rd(t,r))}this._attachedToViewContainer=!1}EM(this._lView[1],this._lView)}onDestroy(e){ob(this._lView[1],this._lView,null,e)}markForCheck(){Lg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Og(this._lView[1],this._lView,this.context)}checkNoChanges(){!function DP(n,e,t){Wu(!0);try{Og(n,e,t)}finally{Wu(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new vt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function wR(n,e){tc(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new vt(902,"");this._appRef=e}}class EO extends yc{constructor(e){super(e),this._view=e}detectChanges(){gb(this._view)}checkNoChanges(){!function TP(n){Wu(!0);try{gb(n)}finally{Wu(!1)}}(this._view)}get context(){return null}}class Nw extends mc{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Rn(e);return new mm(t,this.ngModule)}}function Aw(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class mm extends Cw{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function zR(n){return n.map(VR).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return Aw(this.componentDef.inputs)}get outputs(){return Aw(this.componentDef.outputs)}create(e,t,r,i){const s=(i=i||this.ngModule)?function DO(n,e){return{get:(t,r,i)=>{const s=n.get(t,gm,i);return s!==gm||r===gm?s:e.get(t,r,i)}}}(e,i.injector):e,o=s.get(Tw,m0),a=s.get(wO,null),l=o.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",u=r?function sb(n,e,t){if(qt(n))return n.selectRootElement(e,t===Yr.ShadowDom);let r="string"==typeof e?n.querySelector(e):e;return r.textContent="",r}(l,r,this.componentDef.encapsulation):ug(o.createRenderer(null,this.componentDef),c,function CO(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(c)),d=this.componentDef.onPush?576:528,h=function kb(n,e){return{components:[],scheduler:n||gR,clean:NP,playerHandler:e||null,flags:0}}(),f=vd(0,null,null,1,0,null,null,null,null,null),p=rc(null,f,h,d,null,null,o,l,a,s);let m,g;$u(p);try{const v=function Fb(n,e,t,r,i,s){const o=t[1];t[20]=n;const l=Zo(o,20,2,"#host",null),c=l.mergedAttrs=e.hostAttrs;null!==c&&(Md(l,c,!0),null!==n&&(Ju(i,n,c),null!==l.classes&&mg(i,n,l.classes),null!==l.styles&&kM(i,n,l.styles)));const u=r.createRenderer(n,e),d=rc(t,rb(e),null,e.onPush?64:16,t[20],l,r,u,s||null,null);return o.firstCreatePass&&(td(kl(l,t),o,e.type),db(o,l),hb(l,t.length,1)),_d(t,d),t[20]=d}(u,this.componentDef,p,o,l);if(u)if(r)Ju(l,u,["ng-version",SO.full]);else{const{attrs:y,classes:M}=function jR(n){const e=[],t=[];let r=1,i=2;for(;r<n.length;){let s=n[r];if("string"==typeof s)2===i?""!==s&&e.push(s,n[++r]):8===i&&t.push(s);else{if(!Or(i))break;i=s}r++}return{attrs:e,classes:t}}(this.componentDef.selectors[0]);y&&Ju(l,u,y),M&&M.length>0&&mg(l,u,M.join(" "))}if(g=Cp(f,20),void 0!==t){const y=g.projection=[];for(let M=0;M<this.ngContentSelectors.length;M++){const _=t[M];y.push(null!=_?Array.from(_):null)}}m=function Ob(n,e,t,r,i){const s=t[1],o=function dP(n,e,t){const r=pn();n.firstCreatePass&&(t.providersResolver&&t.providersResolver(t),fb(n,r,e,Xo(n,e,1,null),t));const i=Bl(e,n,r.directiveStart,r);Ln(i,e);const s=_r(r,e);return s&&Ln(s,e),i}(s,t,e);if(r.components.push(o),n[8]=o,i&&i.forEach(l=>l(o,e)),e.contentQueries){const l=pn();e.contentQueries(1,o,l.directiveStart)}const a=pn();return!s.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(es(a.index),cb(t[1],a,0,a.directiveStart,a.directiveEnd,e),ub(e,o)),o}(v,this.componentDef,p,h,[XP]),ic(f,p,null)}finally{qu()}return new NO(this.componentType,m,pa(g,p),p,g)}}class NO extends class mO{}{constructor(e,t,r,i,s){super(),this.location=r,this._rootLView=i,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new EO(i),this.componentType=e}get injector(){return new Bo(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class Ii{}class Iw{}const ga=new Map;class Lw extends Ii{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Nw(this);const r=mr(e);this._bootstrapComponents=ti(r.bootstrap),this._r3Injector=Sb(e,t,[{provide:Ii,useValue:this},{provide:mc,useValue:this.componentFactoryResolver}],xt(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,t=cr.THROW_IF_NOT_FOUND,r=ke.Default){return e===cr||e===Ii||e===Bg?this:this._r3Injector.get(e,t,r)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class ym extends Iw{constructor(e){super(),this.moduleType=e,null!==mr(e)&&function IO(n){const e=new Set;!function t(r){const i=mr(r,!0),s=i.id;null!==s&&(function Rw(n,e,t){if(e&&e!==t)throw new Error(`Duplicate module registered for ${n} - ${xt(e)} vs ${xt(e.name)}`)}(s,ga.get(s),r),ga.set(s,r));const o=ti(i.imports);for(const a of o)e.has(a)||(e.add(a),t(a))}(n)}(e)}create(e){return new Lw(this.moduleType,e)}}function vm(n){return e=>{setTimeout(n,void 0,e)}}const ct=class XO extends er{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,r){var i,s,o;let a=e,l=t||(()=>null),c=r;if(e&&"object"==typeof e){const d=e;a=null===(i=d.next)||void 0===i?void 0:i.bind(d),l=null===(s=d.error)||void 0===s?void 0:s.bind(d),c=null===(o=d.complete)||void 0===o?void 0:o.bind(d)}this.__isAsync&&(l=vm(l),a&&(a=vm(a)),c&&(c=vm(c)));const u=super.subscribe({next:a,error:l,complete:c});return e instanceof Qn&&e.add(u),u}};function YO(){return this._results[Qo()]()}class _m{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const t=Qo(),r=_m.prototype;r[t]||(r[t]=YO)}get changes(){return this._changes||(this._changes=new ct)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,t){return this._results.reduce(e,t)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,t){const r=this;r.dirty=!1;const i=br(e);(this._changesDetected=!function eI(n,e,t){if(n.length!==e.length)return!1;for(let r=0;r<n.length;r++){let i=n[r],s=e[r];if(t&&(i=t(i),s=t(s)),s!==i)return!1}return!0}(r._results,i,t))&&(r._results=i,r.length=i.length,r.last=i[this.length-1],r.first=i[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Ri=(()=>{class n{}return n.__NG_ELEMENT_ID__=QO,n})();const JO=Ri,KO=class extends JO{constructor(e,t,r){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=r}createEmbeddedView(e){const t=this._declarationTContainer.tViews,r=rc(this._declarationLView,t,e,16,null,t.declTNode,null,null,null,null);r[17]=this._declarationLView[this._declarationTContainer.index];const s=this._declarationLView[19];return null!==s&&(r[19]=s.createEmbeddedView(t)),ic(t,r,e),new yc(r)}};function QO(){return Ld(pn(),te())}function Ld(n,e){return 4&n.type?new KO(e,n,pa(n,e)):null}let Gr=(()=>{class n{}return n.__NG_ELEMENT_ID__=e2,n})();function e2(){return Vw(pn(),te())}const t2=Gr,Hw=class extends t2{constructor(e,t,r){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=r}get element(){return pa(this._hostTNode,this._hostLView)}get injector(){return new Bo(this._hostTNode,this._hostLView)}get parentInjector(){const e=ed(this._hostTNode,this._hostLView);if(R0(e)){const t=ko(e,this._hostLView),r=Oo(e);return new Bo(t[1].data[r+8],t)}return new Bo(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=Gw(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,r){const i=e.createEmbeddedView(t||{});return this.insert(i,r),i}createComponent(e,t,r,i,s){const o=e&&!function Gl(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const d=t||{};a=d.index,r=d.injector,i=d.projectableNodes,s=d.ngModuleRef}const l=o?e:new mm(Rn(e)),c=r||this.parentInjector;if(!s&&null==l.ngModule){const h=(o?c:this.parentInjector).get(Ii,null);h&&(s=h)}const u=l.create(c,i,void 0,s);return this.insert(u.hostView,a),u}insert(e,t){const r=e._lView,i=r[1];if(function M1(n){return Lr(n[3])}(r)){const u=this.indexOf(e);if(-1!==u)this.detach(u);else{const d=r[3],h=new Hw(d,d[6],d[3]);h.detach(h.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;!function ER(n,e,t,r){const i=10+r,s=t.length;r>0&&(t[i-1][4]=e),r<s-10?(e[4]=t[i],V0(t,10+r,e)):(t.push(e),e[4]=null),e[3]=t;const o=e[17];null!==o&&t!==o&&function CR(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(o,e);const a=e[19];null!==a&&a.insertView(n),e[2]|=128}(i,r,o,s);const a=pg(s,o),l=r[11],c=hd(l,o[7]);return null!==c&&function xR(n,e,t,r,i,s){r[0]=i,r[6]=e,tc(n,r,t,1,i,s)}(i,o[6],l,r,c,a),e.attachToViewContainerRef(),V0(Mm(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=Gw(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),r=dg(this._lContainer,t);r&&(rd(Mm(this._lContainer),t),EM(r[1],r))}detach(e){const t=this._adjustIndex(e,-1),r=dg(this._lContainer,t);return r&&null!=rd(Mm(this._lContainer),t)?new yc(r):null}_adjustIndex(e,t=0){return null==e?this.length+t:e}};function Gw(n){return n[8]}function Mm(n){return n[8]||(n[8]=[])}function Vw(n,e){let t;const r=e[n.index];if(Lr(r))t=r;else{let i;if(8&n.type)i=nn(r);else{const s=e[11];i=s.createComment("");const o=_r(n,e);$s(s,hd(s,o),i,function AR(n,e){return qt(n)?n.nextSibling(e):e.nextSibling}(s,o),!1)}e[n.index]=t=pb(r,e,i,n),_d(e,t)}return new Hw(t,n,e)}class bm{constructor(e){this.queryList=e,this.matches=null}clone(){return new bm(this.queryList)}setDirty(){this.queryList.setDirty()}}class xm{constructor(e=[]){this.queries=e}createEmbeddedView(e){const t=e.queries;if(null!==t){const r=null!==e.contentQueries?e.contentQueries[0]:t.length,i=[];for(let s=0;s<r;s++){const o=t.getByIndex(s);i.push(this.queries[o.indexInDeclarationView].clone())}return new xm(i)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let t=0;t<this.queries.length;t++)null!==qw(e,t).matches&&this.queries[t].setDirty()}}class zw{constructor(e,t,r=null){this.predicate=e,this.flags=t,this.read=r}}class wm{constructor(e=[]){this.queries=e}elementStart(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(e,t)}elementEnd(e){for(let t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}embeddedTView(e){let t=null;for(let r=0;r<this.length;r++){const i=null!==t?t.length:0,s=this.getByIndex(r).embeddedTView(e,i);s&&(s.indexInDeclarationView=r,null!==t?t.push(s):t=[s])}return null!==t?new wm(t):null}template(e,t){for(let r=0;r<this.queries.length;r++)this.queries[r].template(e,t)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Sm{constructor(e,t=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=t}elementStart(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,t){this.elementStart(e,t)}embeddedTView(e,t){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,t),new Sm(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const t=this._declarationNodeIndex;let r=e.parent;for(;null!==r&&8&r.type&&r.index!==t;)r=r.parent;return t===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(e,t){const r=this.metadata.predicate;if(Array.isArray(r))for(let i=0;i<r.length;i++){const s=r[i];this.matchTNodeWithReadOption(e,t,s2(t,s)),this.matchTNodeWithReadOption(e,t,nd(t,e,s,!1,!1))}else r===Ri?4&t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,nd(t,e,r,!1,!1))}matchTNodeWithReadOption(e,t,r){if(null!==r){const i=this.metadata.read;if(null!==i)if(i===oi||i===Gr||i===Ri&&4&t.type)this.addMatch(t.index,-2);else{const s=nd(t,e,i,!1,!1);null!==s&&this.addMatch(t.index,s)}else this.addMatch(t.index,r)}}addMatch(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}function s2(n,e){const t=n.localNames;if(null!==t)for(let r=0;r<t.length;r+=2)if(t[r]===e)return t[r+1];return null}function a2(n,e,t,r){return-1===t?function o2(n,e){return 11&n.type?pa(n,e):4&n.type?Ld(n,e):null}(e,n):-2===t?function l2(n,e,t){return t===oi?pa(e,n):t===Ri?Ld(e,n):t===Gr?Vw(e,n):void 0}(n,e,r):Bl(n,n[1],t,e)}function jw(n,e,t,r){const i=e[19].queries[r];if(null===i.matches){const s=n.data,o=t.matches,a=[];for(let l=0;l<o.length;l+=2){const c=o[l];a.push(c<0?null:a2(e,s[c],o[l+1],t.metadata.read))}i.matches=a}return i.matches}function Em(n,e,t,r){const i=n.queries.getByIndex(t),s=i.matches;if(null!==s){const o=jw(n,e,i,t);for(let a=0;a<s.length;a+=2){const l=s[a];if(l>0)r.push(o[a/2]);else{const c=s[a+1],u=e[-l];for(let d=10;d<u.length;d++){const h=u[d];h[17]===h[3]&&Em(h[1],h,c,r)}if(null!==u[9]){const d=u[9];for(let h=0;h<d.length;h++){const f=d[h];Em(f[1],f,c,r)}}}}}return r}function Mc(n){const e=te(),t=ft(),r=w0();Pp(r+1);const i=qw(t,r);if(n.dirty&&y0(e)===(2==(2&i.metadata.flags))){if(null===i.matches)n.reset([]);else{const s=i.crossesNgTemplate?Em(t,e,r,[]):jw(t,e,i,r);n.reset(s,MO),n.notifyOnChanges()}return!0}return!1}function Cm(n,e,t){const r=ft();r.firstCreatePass&&(function $w(n,e,t){null===n.queries&&(n.queries=new wm),n.queries.track(new Sm(e,t))}(r,new zw(n,e,t),-1),2==(2&e)&&(r.staticViewQueries=!0)),function Ww(n,e,t){const r=new _m(4==(4&t));ob(n,e,r,r.destroy),null===e[19]&&(e[19]=new xm),e[19].queries.push(new bm(r))}(r,te(),e)}function bc(){return function c2(n,e){return n[19].queries[e].queryList}(te(),w0())}function qw(n,e){return n.queries.getByIndex(e)}function Zw(n,e){return Ld(n,e)}function kd(...n){}const Pm=new _e("Application Initializer");let Lm=(()=>{class n{constructor(t){this.appInits=t,this.resolve=kd,this.reject=kd,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,i)=>{this.resolve=r,this.reject=i})}runInitializers(){if(this.initialized)return;const t=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let i=0;i<this.appInits.length;i++){const s=this.appInits[i]();if(Sd(s))t.push(s);else if(sx(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}Promise.all(t).then(()=>{r()}).catch(i=>{this.reject(i)}),0===t.length&&r(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(xe(Pm,8))},n.\u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const wc=new _e("AppId",{providedIn:"root",factory:function dS(){return`${Fm()}${Fm()}${Fm()}`}});function Fm(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const hS=new _e("Platform Initializer"),fS=new _e("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),pS=new _e("appBootstrapListener");let D2=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const as=new _e("LocaleId",{providedIn:"root",factory:()=>Wl(as,ke.Optional|ke.SkipSelf)||function T2(){return"undefined"!=typeof $localize&&$localize.locale||Cd}()});class A2{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let gS=(()=>{class n{compileModuleSync(t){return new ym(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const r=this.compileModuleSync(t),s=ti(mr(t).declarations).reduce((o,a)=>{const l=Rn(a);return l&&o.push(new mm(l)),o},[]);return new A2(r,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const R2=(()=>Promise.resolve(0))();function Om(n){"undefined"==typeof Zone?R2.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Bt{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ct(!1),this.onMicrotaskEmpty=new ct(!1),this.onStable=new ct(!1),this.onError=new ct(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const i=this;i._nesting=0,i._outer=i._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(i._inner=i._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(i._inner=i._inner.fork(Zone.longStackTraceZoneSpec)),i.shouldCoalesceEventChangeDetection=!r&&t,i.shouldCoalesceRunChangeDetection=r,i.lastRequestAnimationFrameId=-1,i.nativeRequestAnimationFrame=function P2(){let n=Ct.requestAnimationFrame,e=Ct.cancelAnimationFrame;if("undefined"!=typeof Zone&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function O2(n){const e=()=>{!function F2(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Ct,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,Bm(n),n.isCheckStableRunning=!0,km(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),Bm(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,r,i,s,o,a)=>{try{return mS(n),t.invokeTask(i,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),yS(n)}},onInvoke:(t,r,i,s,o,a,l)=>{try{return mS(n),t.invoke(i,s,o,a,l)}finally{n.shouldCoalesceRunChangeDetection&&e(),yS(n)}},onHasTask:(t,r,i,s)=>{t.hasTask(i,s),r===i&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,Bm(n),km(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,r,i,s)=>(t.handleError(i,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(i)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Bt.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Bt.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,t,r){return this._inner.run(e,t,r)}runTask(e,t,r,i){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+i,e,L2,kd,kd);try{return s.runTask(o,t,r)}finally{s.cancelTask(o)}}runGuarded(e,t,r){return this._inner.runGuarded(e,t,r)}runOutsideAngular(e){return this._outer.run(e)}}const L2={};function km(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function Bm(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function mS(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function yS(n){n._nesting--,km(n)}class k2{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ct,this.onMicrotaskEmpty=new ct,this.onStable=new ct,this.onError=new ct}run(e,t,r){return e.apply(t,r)}runGuarded(e,t,r){return e.apply(t,r)}runOutsideAngular(e){return e()}runTask(e,t,r,i){return e.apply(t,r)}}let Um=(()=>{class n{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Bt.assertNotInAngularZone(),Om(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Om(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(t)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,r,i){let s=-1;r&&r>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:i})}whenStable(t,r,i){if(i&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,r,i),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,r,i){return[]}}return n.\u0275fac=function(t){return new(t||n)(xe(Bt))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})(),B2=(()=>{class n{constructor(){this._applications=new Map,Hm.addToWindow(this)}registerApplication(t,r){this._applications.set(t,r)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,r=!0){return Hm.findTestabilityInTree(this,t,r)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();class U2{addToWindow(e){}findTestabilityInTree(e,t,r){return null}}let Hm=new U2,Ys=null;const vS=new _e("AllowMultipleToken"),_S=new _e("PlatformOnDestroy");class MS{constructor(e,t){this.name=e,this.token=t}}function bS(n,e,t=[]){const r=`Platform: ${e}`,i=new _e(r);return(s=[])=>{let o=Gm();if(!o||o.injector.get(vS,!1)){const a=[...t,...s,{provide:i,useValue:!0}];n?n(a):function z2(n){if(Ys&&!Ys.get(vS,!1))throw new vt(400,"");Ys=n;const e=n.get(xS),t=n.get(hS,null);t&&t.forEach(r=>r())}(function W2(n=[],e){return cr.create({name:e,providers:[{provide:Ug,useValue:"platform"},{provide:_S,useValue:()=>Ys=null},...n]})}(a,r))}return function j2(n){const e=Gm();if(!e)throw new vt(401,"");return e}()}}function Gm(){var n;return null!==(n=null==Ys?void 0:Ys.get(xS))&&void 0!==n?n:null}let xS=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,r){const a=function $2(n,e){let t;return t="noop"===n?new k2:("zone.js"===n?void 0:n)||new Bt({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),t}(r?r.ngZone:void 0,{ngZoneEventCoalescing:r&&r.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:r&&r.ngZoneRunCoalescing||!1}),l=[{provide:Bt,useValue:a}];return a.run(()=>{const c=cr.create({providers:l,parent:this.injector,name:t.moduleType.name}),u=t.create(c),d=u.injector.get(Ql,null);if(!d)throw new vt(402,"");return a.runOutsideAngular(()=>{const h=a.onError.subscribe({next:f=>{d.handleError(f)}});u.onDestroy(()=>{zm(this._modules,u),h.unsubscribe()})}),function q2(n,e,t){try{const r=t();return Sd(r)?r.catch(i=>{throw e.runOutsideAngular(()=>n.handleError(i)),i}):r}catch(r){throw e.runOutsideAngular(()=>n.handleError(r)),r}}(d,a,()=>{const h=u.injector.get(Lm);return h.runInitializers(),h.donePromise.then(()=>(function bF(n){nr(n,"Expected localeId to be defined"),"string"==typeof n&&(tw=n.toLowerCase().replace(/_/g,"-"))}(u.injector.get(as,Cd)||Cd),this._moduleDoBootstrap(u),u))})})}bootstrapModule(t,r=[]){const i=wS({},r);return function G2(n,e,t){const r=new ym(t);return Promise.resolve(r)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,i))}_moduleDoBootstrap(t){const r=t.injector.get(Vm);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(i=>r.bootstrap(i));else{if(!t.instance.ngDoBootstrap)throw new vt(403,"");t.instance.ngDoBootstrap(r)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new vt(404,"");this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const t=this._injector.get(_S,null);null==t||t(),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(xe(cr))},n.\u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function wS(n,e){return Array.isArray(e)?e.reduce(wS,n):Object.assign(Object.assign({},n),e)}let Vm=(()=>{class n{constructor(t,r,i,s){this._zone=t,this._injector=r,this._exceptionHandler=i,this._initStatus=s,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const o=new Gt(l=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{l.next(this._stable),l.complete()})}),a=new Gt(l=>{let c;this._zone.runOutsideAngular(()=>{c=this._zone.onStable.subscribe(()=>{Bt.assertNotInAngularZone(),Om(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,l.next(!0))})})});const u=this._zone.onUnstable.subscribe(()=>{Bt.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{l.next(!1)}))});return()=>{c.unsubscribe(),u.unsubscribe()}});this.isStable=function UA(...n){const e=Tl(n),t=function PA(n,e){return"number"==typeof op(n)?n.pop():e}(n,1/0),r=n;return r.length?1===r.length?gr(r[0]):Dl(t)(Cn(r,e)):bi}(o,a.pipe(Lu()))}bootstrap(t,r){if(!this._initStatus.done)throw new vt(405,"");let i;i=t instanceof Cw?t:this._injector.get(mc).resolveComponentFactory(t),this.componentTypes.push(i.componentType);const s=function V2(n){return n.isBoundToModule}(i)?void 0:this._injector.get(Ii),a=i.create(cr.NULL,[],r||i.selector,s),l=a.location.nativeElement,c=a.injector.get(Um,null),u=c&&a.injector.get(B2);return c&&u&&u.registerApplication(l,c),a.onDestroy(()=>{this.detachView(a.hostView),zm(this.components,a),u&&u.unregisterApplication(l)}),this._loadComponent(a),a}tick(){if(this._runningTick)throw new vt(101,"");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const r=t;this._views.push(r),r.attachToAppRef(this)}detachView(t){const r=t;zm(this._views,r),r.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(pS,[]).concat(this._bootstrapListeners).forEach(i=>i(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return n.\u0275fac=function(t){return new(t||n)(xe(Bt),xe(cr),xe(Ql),xe(Lm))},n.\u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function zm(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let ES=!0,jm=(()=>{class n{}return n.__NG_ELEMENT_ID__=Y2,n})();function Y2(n){return function J2(n,e,t){if(Gu(n)&&!t){const r=sr(n.index,e);return new yc(r,r)}return 47&n.type?new yc(e[16],e):null}(pn(),te(),16==(16&n))}const d3=bS(null,"core",[]);let h3=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(xe(Vm))},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})(),Gd=null;function ls(){return Gd}const Vn=new _e("DocumentToken");let Ks=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:function(){return function m3(){return xe(OS)}()},providedIn:"platform"}),n})();const y3=new _e("Location Initialized");let OS=(()=>{class n extends Ks{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ls().getBaseHref(this._doc)}onPopState(t){const r=ls().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",t,!1),()=>r.removeEventListener("popstate",t)}onHashChange(t){const r=ls().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",t,!1),()=>r.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,r,i){kS()?this._history.pushState(t,r,i):this.location.hash=i}replaceState(t,r,i){kS()?this._history.replaceState(t,r,i):this.location.hash=i}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(xe(Vn))},n.\u0275prov=rt({token:n,factory:function(){return function v3(){return new OS(xe(Vn))}()},providedIn:"platform"}),n})();function kS(){return!!window.history.pushState}function Xm(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function BS(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function Pi(n){return n&&"?"!==n[0]?"?"+n:n}let ya=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:function(){return function _3(n){const e=xe(Vn).location;return new US(xe(Ks),e&&e.origin||"")}()},providedIn:"root"}),n})();const Ym=new _e("appBaseHref");let US=(()=>{class n extends ya{constructor(t,r){if(super(),this._platformLocation=t,this._removeListenerFns=[],null==r&&(r=this._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=r}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Xm(this._baseHref,t)}path(t=!1){const r=this._platformLocation.pathname+Pi(this._platformLocation.search),i=this._platformLocation.hash;return i&&t?`${r}${i}`:r}pushState(t,r,i,s){const o=this.prepareExternalUrl(i+Pi(s));this._platformLocation.pushState(t,r,o)}replaceState(t,r,i,s){const o=this.prepareExternalUrl(i+Pi(s));this._platformLocation.replaceState(t,r,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var r,i;null===(i=(r=this._platformLocation).historyGo)||void 0===i||i.call(r,t)}}return n.\u0275fac=function(t){return new(t||n)(xe(Ks),xe(Ym,8))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})(),M3=(()=>{class n extends ya{constructor(t,r){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(t){const r=Xm(this._baseHref,t);return r.length>0?"#"+r:r}pushState(t,r,i,s){let o=this.prepareExternalUrl(i+Pi(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,r,o)}replaceState(t,r,i,s){let o=this.prepareExternalUrl(i+Pi(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,r,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(t=0){var r,i;null===(i=(r=this._platformLocation).historyGo)||void 0===i||i.call(r,t)}}return n.\u0275fac=function(t){return new(t||n)(xe(Ks),xe(Ym,8))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})(),Jm=(()=>{class n{constructor(t,r){this._subject=new ct,this._urlChangeListeners=[],this._platformStrategy=t;const i=this._platformStrategy.getBaseHref();this._platformLocation=r,this._baseHref=BS(HS(i)),this._platformStrategy.onPopState(s=>{this._subject.emit({url:this.path(!0),pop:!0,state:s.state,type:s.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,r=""){return this.path()==this.normalize(t+Pi(r))}normalize(t){return n.stripTrailingSlash(function x3(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._baseHref,HS(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,r="",i=null){this._platformStrategy.pushState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Pi(r)),i)}replaceState(t,r="",i=null){this._platformStrategy.replaceState(i,"",t,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Pi(r)),i)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(t=0){var r,i;null===(i=(r=this._platformStrategy).historyGo)||void 0===i||i.call(r,t)}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}))}_notifyUrlChangeListeners(t="",r){this._urlChangeListeners.forEach(i=>i(t,r))}subscribe(t,r,i){return this._subject.subscribe({next:t,error:r,complete:i})}}return n.normalizeQueryParams=Pi,n.joinWithSlash=Xm,n.stripTrailingSlash=BS,n.\u0275fac=function(t){return new(t||n)(xe(ya),xe(Ks))},n.\u0275prov=rt({token:n,factory:function(){return function b3(){return new Jm(xe(ya),xe(Ks))}()},providedIn:"root"}),n})();function HS(n){return n.replace(/\/index.html$/,"")}let YS=(()=>{class n{constructor(t,r){this._viewContainer=t,this._context=new uk,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=r}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){JS("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){JS("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,r){return!0}}return n.\u0275fac=function(t){return new(t||n)(fe(Gr),fe(Ri))},n.\u0275dir=Ot({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),n})();class uk{constructor(){this.$implicit=null,this.ngIf=null}}function JS(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${xt(e)}'.`)}let QS=(()=>{class n{constructor(t){this._viewContainerRef=t,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null}ngOnChanges(t){if(t.ngTemplateOutlet){const r=this._viewContainerRef;this._viewRef&&r.remove(r.indexOf(this._viewRef)),this._viewRef=this.ngTemplateOutlet?r.createEmbeddedView(this.ngTemplateOutlet,this.ngTemplateOutletContext):null}else this._viewRef&&t.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return n.\u0275fac=function(t){return new(t||n)(fe(Gr))},n.\u0275dir=Ot({type:n,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet"},features:[Ws]}),n})(),tE=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})();let Uk=(()=>{class n{}return n.\u0275prov=rt({token:n,providedIn:"root",factory:()=>new Hk(xe(Vn),window)}),n})();class Hk{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function Gk(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const r=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let i=r.currentNode;for(;i;){const s=i.shadowRoot;if(s){const o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}i=r.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),r=t.left+this.window.pageXOffset,i=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(r-s[0],i-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=rE(this.window.history)||rE(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function rE(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class dy extends class zk extends class g3{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function p3(n){Gd||(Gd=n)}(new dy)}onAndCancel(e,t,r){return e.addEventListener(t,r,!1),()=>{e.removeEventListener(t,r,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function jk(){return Dc=Dc||document.querySelector("base"),Dc?Dc.getAttribute("href"):null}();return null==t?null:function Wk(n){Jd=Jd||document.createElement("a"),Jd.setAttribute("href",n);const e=Jd.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Dc=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function sk(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const r=t.indexOf("="),[i,s]=-1==r?[t,""]:[t.slice(0,r),t.slice(r+1)];if(i.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let Jd,Dc=null;const iE=new _e("TRANSITION_ID"),qk=[{provide:Pm,useFactory:function $k(n,e,t){return()=>{t.get(Lm).donePromise.then(()=>{const r=ls(),i=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<i.length;s++)r.remove(i[s])})}},deps:[iE,Vn,cr],multi:!0}];class hy{static init(){!function H2(n){Hm=n}(new hy)}addToWindow(e){Ct.getAngularTestability=(r,i=!0)=>{const s=e.findTestabilityInTree(r,i);if(null==s)throw new Error("Could not find testability for element.");return s},Ct.getAllAngularTestabilities=()=>e.getAllTestabilities(),Ct.getAllAngularRootElements=()=>e.getAllRootElements(),Ct.frameworkStabilizers||(Ct.frameworkStabilizers=[]),Ct.frameworkStabilizers.push(r=>{const i=Ct.getAllAngularTestabilities();let s=i.length,o=!1;const a=function(l){o=o||l,s--,0==s&&r(o)};i.forEach(function(l){l.whenStable(a)})})}findTestabilityInTree(e,t,r){if(null==t)return null;const i=e.getTestability(t);return null!=i?i:r?ls().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}let Zk=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();const Kd=new _e("EventManagerPlugins");let Qd=(()=>{class n{constructor(t,r){this._zone=r,this._eventNameToPlugin=new Map,t.forEach(i=>i.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,r,i){return this._findPluginFor(r).addEventListener(t,r,i)}addGlobalEventListener(t,r,i){return this._findPluginFor(r).addGlobalEventListener(t,r,i)}getZone(){return this._zone}_findPluginFor(t){const r=this._eventNameToPlugin.get(t);if(r)return r;const i=this._plugins;for(let s=0;s<i.length;s++){const o=i[s];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(xe(Kd),xe(Bt))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();class sE{constructor(e){this._doc=e}addGlobalEventListener(e,t,r){const i=ls().getGlobalEventTarget(this._doc,e);if(!i)throw new Error(`Unsupported event target ${i} for event ${t}`);return this.addEventListener(i,t,r)}}let oE=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const r=new Set;t.forEach(i=>{this._stylesSet.has(i)||(this._stylesSet.add(i),r.add(i))}),this.onStylesAdded(r)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})(),Tc=(()=>{class n extends oE{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,r,i){t.forEach(s=>{const o=this._doc.createElement("style");o.textContent=s,i.push(r.appendChild(o))})}addHost(t){const r=[];this._addStylesToHost(this._stylesSet,t,r),this._hostNodes.set(t,r)}removeHost(t){const r=this._hostNodes.get(t);r&&r.forEach(aE),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((r,i)=>{this._addStylesToHost(t,i,r)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(aE))}}return n.\u0275fac=function(t){return new(t||n)(xe(Vn))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();function aE(n){ls().remove(n)}const fy={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},py=/%COMP%/g;function eh(n,e,t){for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?eh(n,i,t):(i=i.replace(py,n),t.push(i))}return t}function uE(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let gy=(()=>{class n{constructor(t,r,i){this.eventManager=t,this.sharedStylesHost=r,this.appId=i,this.rendererByCompId=new Map,this.defaultRenderer=new my(t)}createRenderer(t,r){if(!t||!r)return this.defaultRenderer;switch(r.encapsulation){case Yr.Emulated:{let i=this.rendererByCompId.get(r.id);return i||(i=new eB(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,i)),i.applyToHost(t),i}case 1:case Yr.ShadowDom:return new tB(this.eventManager,this.sharedStylesHost,t,r);default:if(!this.rendererByCompId.has(r.id)){const i=eh(r.id,r.styles,[]);this.sharedStylesHost.addStyles(i),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(xe(Qd),xe(Tc),xe(wc))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();class my{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(fy[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){e.appendChild(t)}insertBefore(e,t,r){e&&e.insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r="string"==typeof e?document.querySelector(e):e;if(!r)throw new Error(`The selector "${e}" did not match any elements`);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;const s=fy[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){const i=fy[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(ar.DashCase|ar.Important)?e.style.setProperty(t,r,i&ar.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&ar.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e[t]=r}setValue(e,t){e.nodeValue=t}listen(e,t,r){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,uE(r)):this.eventManager.addEventListener(e,t,uE(r))}}class eB extends my{constructor(e,t,r,i){super(e),this.component=r;const s=eh(i+"-"+r.id,r.styles,[]);t.addStyles(s),this.contentAttr=function Jk(n){return"_ngcontent-%COMP%".replace(py,n)}(i+"-"+r.id),this.hostAttr=function Kk(n){return"_nghost-%COMP%".replace(py,n)}(i+"-"+r.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}}class tB extends my{constructor(e,t,r,i){super(e),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=eh(i.id,i.styles,[]);for(let o=0;o<s.length;o++){const a=document.createElement("style");a.textContent=s[o],this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let nB=(()=>{class n extends sE{constructor(t){super(t)}supports(t){return!0}addEventListener(t,r,i){return t.addEventListener(r,i,!1),()=>this.removeEventListener(t,r,i)}removeEventListener(t,r,i){return t.removeEventListener(r,i)}}return n.\u0275fac=function(t){return new(t||n)(xe(Vn))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();const hE=["alt","control","meta","shift"],iB={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},fE={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},sB={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let oB=(()=>{class n extends sE{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,r,i){const s=n.parseEventName(r),o=n.eventCallback(s.fullKey,i,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ls().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const r=t.toLowerCase().split("."),i=r.shift();if(0===r.length||"keydown"!==i&&"keyup"!==i)return null;const s=n._normalizeKey(r.pop());let o="";if(hE.forEach(l=>{const c=r.indexOf(l);c>-1&&(r.splice(c,1),o+=l+".")}),o+=s,0!=r.length||0===s.length)return null;const a={};return a.domEventName=i,a.fullKey=o,a}static getEventFullKey(t){let r="",i=function aB(n){let e=n.key;if(null==e){if(e=n.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===n.location&&fE.hasOwnProperty(e)&&(e=fE[e]))}return iB[e]||e}(t);return i=i.toLowerCase()," "===i?i="space":"."===i&&(i="dot"),hE.forEach(s=>{s!=i&&sB[s](t)&&(r+=s+".")}),r+=i,r}static eventCallback(t,r,i){return s=>{n.getEventFullKey(s)===t&&i.runGuarded(()=>r(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(xe(Vn))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();const dB=bS(d3,"browser",[{provide:fS,useValue:"browser"},{provide:hS,useValue:function lB(){dy.makeCurrent(),hy.init()},multi:!0},{provide:Vn,useFactory:function uB(){return function m1(n){Sp=n}(document),document},deps:[]}]),hB=[{provide:Ug,useValue:"root"},{provide:Ql,useFactory:function cB(){return new Ql},deps:[]},{provide:Kd,useClass:nB,multi:!0,deps:[Vn,Bt,fS]},{provide:Kd,useClass:oB,multi:!0,deps:[Vn]},{provide:gy,useClass:gy,deps:[Qd,Tc,wc]},{provide:Tw,useExisting:gy},{provide:oE,useExisting:Tc},{provide:Tc,useClass:Tc,deps:[Vn]},{provide:Um,useClass:Um,deps:[Bt]},{provide:Qd,useClass:Qd,deps:[Kd,Bt]},{provide:class Vk{},useClass:Zk,deps:[]}];let fB=(()=>{class n{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(t){return{ngModule:n,providers:[{provide:wc,useValue:t.appId},{provide:iE,useExisting:wc},qk]}}}return n.\u0275fac=function(t){return new(t||n)(xe(n,12))},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({providers:hB,imports:[tE,h3]}),n})();"undefined"!=typeof window&&window;class Er extends er{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:r}=this;if(e)throw t;return this._throwIfClosed(),r}next(e){super.next(this._value=e)}}const vy={now:()=>(vy.delegate||Date).now(),delegate:void 0};class Nc extends er{constructor(e=1/0,t=1/0,r=vy){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=r,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:r,_infiniteTimeWindow:i,_timestampProvider:s,_windowTime:o}=this;t||(r.push(e),!i&&r.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:r,_buffer:i}=this,s=i.slice();for(let o=0;o<s.length&&!e.closed;o+=r?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:r,_infiniteTimeWindow:i}=this,s=(i?1:2)*e;if(e<1/0&&s<r.length&&r.splice(0,r.length-s),!i){const o=t.now();let a=0;for(let l=1;l<r.length&&r[l]<=o;l+=2)a=l;a&&r.splice(0,a+1)}}}function mE(n,e=_i){return n=null!=n?n:SB,$t((t,r)=>{let i,s=!0;t.subscribe(Vt(r,o=>{const a=e(o);(s||!n(i,a))&&(s=!1,i=a,r.next(o))}))})}function SB(n,e){return n===e}function va(n){return $t((e,t)=>{gr(n).subscribe(Vt(t,()=>t.complete(),Cl)),!t.closed&&e.subscribe(t)})}function _y(n){return!!n&&(n instanceof Gt||dt(n.lift)&&dt(n.subscribe))}const{isArray:EB}=Array,{getPrototypeOf:CB,prototype:DB,keys:TB}=Object;const{isArray:IB}=Array;function yE(n){return mt(e=>function RB(n,e){return IB(e)?n(...e):n(e)}(n,e))}function vE(...n){const e=Tl(n),t=Y_(n),{args:r,keys:i}=function NB(n){if(1===n.length){const e=n[0];if(EB(e))return{args:e,keys:null};if(function AB(n){return n&&"object"==typeof n&&CB(n)===DB}(e)){const t=TB(e);return{args:t.map(r=>e[r]),keys:t}}}return{args:n,keys:null}}(n);if(0===r.length)return Cn([],e);const s=new Gt(function LB(n,e,t=_i){return r=>{_E(e,()=>{const{length:i}=n,s=new Array(i);let o=i,a=i;for(let l=0;l<i;l++)_E(e,()=>{const c=Cn(n[l],e);let u=!1;c.subscribe(Vt(r,d=>{s[l]=d,u||(u=!0,a--),a||r.next(t(s.slice()))},()=>{--o||r.complete()}))},r)},r)}}(r,e,i?o=>function PB(n,e){return n.reduce((t,r,i)=>(t[r]=e[i],t),{})}(i,o):_i));return t?s.pipe(yE(t)):s}function _E(n,e,t){n?Mi(t,n,e):e()}function Oe(...n){return Cn(n,Tl(n))}function jt(n,e,t){const r=dt(n)||e||t?{next:n,error:e,complete:t}:n;return r?$t((i,s)=>{var o;null===(o=r.subscribe)||void 0===o||o.call(r);let a=!0;i.subscribe(Vt(s,l=>{var c;null===(c=r.next)||void 0===c||c.call(r,l),s.next(l)},()=>{var l;a=!1,null===(l=r.complete)||void 0===l||l.call(r),s.complete()},l=>{var c;a=!1,null===(c=r.error)||void 0===c||c.call(r,l),s.error(l)},()=>{var l,c;a&&(null===(l=r.unsubscribe)||void 0===l||l.call(r)),null===(c=r.finalize)||void 0===c||c.call(r)}))}):_i}function _a(n,e){return dt(e)?fn(n,e,1):fn(n,1)}class FB extends Qn{constructor(e,t){super()}schedule(e,t=0){return this}}const th={setInterval(n,e,...t){const{delegate:r}=th;return(null==r?void 0:r.setInterval)?r.setInterval(n,e,...t):setInterval(n,e,...t)},clearInterval(n){const{delegate:e}=th;return((null==e?void 0:e.clearInterval)||clearInterval)(n)},delegate:void 0};class ME extends FB{constructor(e,t){super(e,t),this.scheduler=e,this.work=t,this.pending=!1}schedule(e,t=0){if(this.closed)return this;this.state=e;const r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(i,this.id,t),this}requestAsyncId(e,t,r=0){return th.setInterval(e.flush.bind(e,this),r)}recycleAsyncId(e,t,r=0){if(null!=r&&this.delay===r&&!1===this.pending)return t;th.clearInterval(t)}execute(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(e,t){let i,r=!1;try{this.work(e)}catch(s){r=!0,i=s||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),i}unsubscribe(){if(!this.closed){const{id:e,scheduler:t}=this,{actions:r}=t;this.work=this.state=this.scheduler=null,this.pending=!1,To(r,this),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null,super.unsubscribe()}}}class Ac{constructor(e,t=Ac.now){this.schedulerActionCtor=e,this.now=t}schedule(e,t=0,r){return new this.schedulerActionCtor(this,e).schedule(r,t)}}Ac.now=vy.now;class bE extends Ac{constructor(e,t=Ac.now){super(e,t),this.actions=[],this._active=!1,this._scheduled=void 0}flush(e){const{actions:t}=this;if(this._active)return void t.push(e);let r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}}const BB=new class kB extends bE{}(class OB extends ME{constructor(e,t){super(e,t),this.scheduler=e,this.work=t}schedule(e,t=0){return t>0?super.schedule(e,t):(this.delay=t,this.state=e,this.scheduler.flush(this),this)}execute(e,t){return t>0||this.closed?super.execute(e,t):this._execute(e,t)}requestAsyncId(e,t,r=0){return null!=r&&r>0||null==r&&this.delay>0?super.requestAsyncId(e,t,r):e.flush(this)}});function xE(...n){const e=Y_(n);return $t((t,r)=>{const i=n.length,s=new Array(i);let o=n.map(()=>!1),a=!1;for(let l=0;l<i;l++)gr(n[l]).subscribe(Vt(r,c=>{s[l]=c,!a&&!o[l]&&(o[l]=!0,(a=o.every(_i))&&(o=null))},Cl));t.subscribe(Vt(r,l=>{if(a){const c=[l,...s];r.next(e?e(...c):c)}}))})}function My(...n){return function UB(){return Dl(1)}()(Cn(n,Tl(n)))}function nh(...n){const e=Tl(n);return $t((t,r)=>{(e?My(n,t,e):My(n,t)).subscribe(r)})}function Fi(n,e){return $t((t,r)=>{let i=0;t.subscribe(Vt(r,s=>n.call(e,s,i++)&&r.next(s)))})}const by=new bE(ME),HB=by;function wE(n,e=by){return $t((t,r)=>{let i=null,s=null,o=null;const a=()=>{if(i){i.unsubscribe(),i=null;const c=s;s=null,r.next(c)}};function l(){const c=o+n,u=e.now();if(u<c)return i=this.schedule(void 0,c-u),void r.add(i);a()}t.subscribe(Vt(r,c=>{s=c,o=e.now(),i||(i=e.schedule(l,n),r.add(i))},()=>{a(),r.complete()},void 0,()=>{s=i=null}))})}const GB=["addListener","removeListener"],VB=["addEventListener","removeEventListener"],zB=["on","off"];function Ic(n,e,t,r){if(dt(t)&&(r=t,t=void 0),r)return Ic(n,e,t).pipe(yE(r));const[i,s]=function $B(n){return dt(n.addEventListener)&&dt(n.removeEventListener)}(n)?VB.map(o=>a=>n[o](e,a,t)):function jB(n){return dt(n.addListener)&&dt(n.removeListener)}(n)?GB.map(SE(n,e)):function WB(n){return dt(n.on)&&dt(n.off)}(n)?zB.map(SE(n,e)):[];if(!i&&sp(n))return fn(o=>Ic(o,e,t))(gr(n));if(!i)throw new TypeError("Invalid event target");return new Gt(o=>{const a=(...l)=>o.next(1<l.length?l:l[0]);return i(a),()=>s(a)})}function SE(n,e){return t=>r=>n[t](e,r)}function us(n,e){return $t((t,r)=>{let i=null,s=0,o=!1;const a=()=>o&&!i&&r.complete();t.subscribe(Vt(r,l=>{null==i||i.unsubscribe();let c=0;const u=s++;gr(n(l,u)).subscribe(i=Vt(r,d=>r.next(e?e(l,d,u,c++):d),()=>{i=null,a()}))},()=>{o=!0,a()}))})}function EE(n,e,t,r,i,s,o){try{var a=n[s](o),l=a.value}catch(c){return void t(c)}a.done?e(l):Promise.resolve(l).then(r,i)}const Jn=1001,vn=1003,an=1006,to=1009,Lc=1012,hs=1015,Fc=1016,Da=1020,Dr=1023,no=1026,Ta=1027,Na=2400,Aa=2401,Oi=3e3,Rt=3001,ki="srgb",ro="srgb-linear",Oc=35044,kc=35048;class fs{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const s=i.indexOf(t);-1!==s&&i.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const r=this._listeners[e.type];if(void 0!==r){e.target=this;const i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}const Nn=[];for(let n=0;n<256;n++)Nn[n]=(n<16?"0":"")+n.toString(16);let lC=1234567;const io=Math.PI/180,Bc=180/Math.PI;function ur(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(Nn[255&n]+Nn[n>>8&255]+Nn[n>>16&255]+Nn[n>>24&255]+"-"+Nn[255&e]+Nn[e>>8&255]+"-"+Nn[e>>16&15|64]+Nn[e>>24&255]+"-"+Nn[63&t|128]+Nn[t>>8&255]+"-"+Nn[t>>16&255]+Nn[t>>24&255]+Nn[255&r]+Nn[r>>8&255]+Nn[r>>16&255]+Nn[r>>24&255]).toLowerCase()}function en(n,e,t){return Math.max(e,Math.min(t,n))}function Fy(n,e){return(n%e+e)%e}function Uc(n,e,t){return(1-t)*n+t*e}function Oy(n){return 0==(n&n-1)&&0!==n}function hh(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}var oH=Object.freeze({__proto__:null,DEG2RAD:io,RAD2DEG:Bc,generateUUID:ur,clamp:en,euclideanModulo:Fy,mapLinear:function WU(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)},inverseLerp:function $U(n,e,t){return n!==e?(t-n)/(e-n):0},lerp:Uc,damp:function qU(n,e,t,r){return Uc(n,e,1-Math.exp(-t*r))},pingpong:function ZU(n,e=1){return e-Math.abs(Fy(n,2*e)-e)},smoothstep:function XU(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*(3-2*n)},smootherstep:function YU(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e))*n*n*(n*(6*n-15)+10)},randInt:function JU(n,e){return n+Math.floor(Math.random()*(e-n+1))},randFloat:function KU(n,e){return n+Math.random()*(e-n)},randFloatSpread:function QU(n){return n*(.5-Math.random())},seededRandom:function eH(n){void 0!==n&&(lC=n);let e=lC+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function tH(n){return n*io},radToDeg:function nH(n){return n*Bc},isPowerOfTwo:Oy,ceilPowerOfTwo:function cC(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))},floorPowerOfTwo:hh,setQuaternionFromProperEuler:function rH(n,e,t,r,i){const s=Math.cos,o=Math.sin,a=s(t/2),l=o(t/2),c=s((e+r)/2),u=o((e+r)/2),d=s((e-r)/2),h=o((e-r)/2),f=s((r-e)/2),p=o((r-e)/2);switch(i){case"XYX":n.set(a*u,l*d,l*h,a*c);break;case"YZY":n.set(l*h,a*u,l*d,a*c);break;case"ZXZ":n.set(l*d,l*h,a*u,a*c);break;case"XZX":n.set(a*u,l*p,l*f,a*c);break;case"YXY":n.set(l*f,a*u,l*p,a*c);break;case"ZYZ":n.set(l*p,l*f,a*u,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}},normalize:function sH(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}},denormalize:function iH(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}});class ${constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*r-o*i+e.x,this.y=s*i+o*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}$.prototype.isVector2=!0;class Sn{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,i,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=i,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=r,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[3],l=r[6],c=r[1],u=r[4],d=r[7],h=r[2],f=r[5],p=r[8],m=i[0],g=i[3],v=i[6],y=i[1],M=i[4],_=i[7],x=i[2],w=i[5],A=i[8];return s[0]=o*m+a*y+l*x,s[3]=o*g+a*M+l*w,s[6]=o*v+a*_+l*A,s[1]=c*m+u*y+d*x,s[4]=c*g+u*M+d*w,s[7]=c*v+u*_+d*A,s[2]=h*m+f*y+p*x,s[5]=h*g+f*M+p*w,s[8]=h*v+f*_+p*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-r*s*u+r*a*l+i*s*c-i*o*l}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,h=a*l-u*s,f=c*s-o*l,p=t*d+r*h+i*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=d*m,e[1]=(i*c-u*r)*m,e[2]=(a*r-i*o)*m,e[3]=h*m,e[4]=(u*t-i*l)*m,e[5]=(i*s-a*t)*m,e[6]=f*m,e[7]=(r*l-c*t)*m,e[8]=(o*t-r*s)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(r*l,r*c,-r*(l*o+c*a)+o+e,-i*c,i*l,-i*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){const r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this}rotate(e){const t=Math.cos(e),r=Math.sin(e),i=this.elements,s=i[0],o=i[3],a=i[6],l=i[1],c=i[4],u=i[7];return i[0]=t*s+r*l,i[3]=t*o+r*c,i[6]=t*a+r*u,i[1]=-r*s+t*l,i[4]=-r*o+t*c,i[7]=-r*a+t*u,this}translate(e,t){const r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function uC(n){for(let e=n.length-1;e>=0;--e)if(n[e]>65535)return!0;return!1}function Hc(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function so(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function fh(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}Sn.prototype.isMatrix3=!0,Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const ky={[ki]:{[ro]:so},[ro]:{[ki]:fh}},Kn={legacyMode:!0,get workingColorSpace(){return ro},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(ky[e]&&void 0!==ky[e][t]){const r=ky[e][t];return n.r=r(n.r),n.g=r(n.g),n.b=r(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},dC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},_n={r:0,g:0,b:0},jr={h:0,s:0,l:0},ph={h:0,s:0,l:0};function By(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}function gh(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}let Pa,ce=(()=>{class n{constructor(t,r,i){return void 0===r&&void 0===i?this.set(t):this.setRGB(t,r,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,r=ki){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Kn.toWorkingColorSpace(this,r),this}setRGB(t,r,i,s=ro){return this.r=t,this.g=r,this.b=i,Kn.toWorkingColorSpace(this,s),this}setHSL(t,r,i,s=ro){if(t=Fy(t,1),r=en(r,0,1),i=en(i,0,1),0===r)this.r=this.g=this.b=i;else{const o=i<=.5?i*(1+r):i+r-i*r,a=2*i-o;this.r=By(a,o,t+1/3),this.g=By(a,o,t),this.b=By(a,o,t-1/3)}return Kn.toWorkingColorSpace(this,s),this}setStyle(t,r=ki){function i(o){void 0!==o&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let o;const l=s[2];switch(s[1]){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,Kn.toWorkingColorSpace(this,r),i(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,Kn.toWorkingColorSpace(this,r),i(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){const c=parseFloat(o[1])/360,u=parseInt(o[2],10)/100,d=parseInt(o[3],10)/100;return i(o[4]),this.setHSL(c,u,d,r)}}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const o=s[1],a=o.length;if(3===a)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,Kn.toWorkingColorSpace(this,r),this;if(6===a)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,Kn.toWorkingColorSpace(this,r),this}return t&&t.length>0?this.setColorName(t,r):this}setColorName(t,r=ki){const i=dC[t.toLowerCase()];return void 0!==i?this.setHex(i,r):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=so(t.r),this.g=so(t.g),this.b=so(t.b),this}copyLinearToSRGB(t){return this.r=fh(t.r),this.g=fh(t.g),this.b=fh(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ki){return Kn.fromWorkingColorSpace(gh(this,_n),t),en(255*_n.r,0,255)<<16^en(255*_n.g,0,255)<<8^en(255*_n.b,0,255)<<0}getHexString(t=ki){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,r=ro){Kn.fromWorkingColorSpace(gh(this,_n),r);const i=_n.r,s=_n.g,o=_n.b,a=Math.max(i,s,o),l=Math.min(i,s,o);let c,u;const d=(l+a)/2;if(l===a)c=0,u=0;else{const h=a-l;switch(u=d<=.5?h/(a+l):h/(2-a-l),a){case i:c=(s-o)/h+(s<o?6:0);break;case s:c=(o-i)/h+2;break;case o:c=(i-s)/h+4}c/=6}return t.h=c,t.s=u,t.l=d,t}getRGB(t,r=ro){return Kn.fromWorkingColorSpace(gh(this,_n),r),t.r=_n.r,t.g=_n.g,t.b=_n.b,t}getStyle(t=ki){return Kn.fromWorkingColorSpace(gh(this,_n),t),t!==ki?`color(${t} ${_n.r} ${_n.g} ${_n.b})`:`rgb(${255*_n.r|0},${255*_n.g|0},${255*_n.b|0})`}offsetHSL(t,r,i){return this.getHSL(jr),jr.h+=t,jr.s+=r,jr.l+=i,this.setHSL(jr.h,jr.s,jr.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,r){return this.r=t.r+r.r,this.g=t.g+r.g,this.b=t.b+r.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,r){return this.r+=(t.r-this.r)*r,this.g+=(t.g-this.g)*r,this.b+=(t.b-this.b)*r,this}lerpColors(t,r,i){return this.r=t.r+(r.r-t.r)*i,this.g=t.g+(r.g-t.g)*i,this.b=t.b+(r.b-t.b)*i,this}lerpHSL(t,r){this.getHSL(jr),t.getHSL(ph);const i=Uc(jr.h,ph.h,r),s=Uc(jr.s,ph.s,r),o=Uc(jr.l,ph.l,r);return this.setHSL(i,s,o),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,r=0){return this.r=t[r],this.g=t[r+1],this.b=t[r+2],this}toArray(t=[],r=0){return t[r]=this.r,t[r+1]=this.g,t[r+2]=this.b,t}fromBufferAttribute(t,r){return this.r=t.getX(r),this.g=t.getY(r),this.b=t.getZ(r),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}return n.NAMES=dC,n})();ce.prototype.isColor=!0,ce.prototype.r=1,ce.prototype.g=1,ce.prototype.b=1;class oo{static getDataURL(e){if(/^data:/i.test(e.src)||"undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Pa&&(Pa=Hc("canvas")),Pa.width=e.width,Pa.height=e.height;const r=Pa.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Pa}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Hc("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=255*so(s[o]/255);return r.putImageData(i,0,0),t}if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t[r]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*so(t[r]/255)):so(t[r]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class La{constructor(e=null){this.uuid=ur(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(null!==i){let s;if(Array.isArray(i)){s=[];for(let o=0,a=i.length;o<a;o++)s.push(Uy(i[o].isDataTexture?i[o].image:i[o]))}else s=Uy(i);r.url=s}return t||(e.images[this.uuid]=r),r}}function Uy(n){return"undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&n instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&n instanceof ImageBitmap?oo.getDataURL(n):n.data?{data:Array.prototype.slice.call(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}La.prototype.isSource=!0;let lH=0,zn=(()=>{class n extends fs{constructor(t=n.DEFAULT_IMAGE,r=n.DEFAULT_MAPPING,i=Jn,s=Jn,o=an,a=1008,l=Dr,c=to,u=1,d=Oi){super(),Object.defineProperty(this,"id",{value:lH++}),this.uuid=ur(),this.name="",this.source=new La(t),this.mipmaps=[],this.mapping=r,this.wrapS=i,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new $(0,0),this.repeat=new $(1,1),this.center=new $(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Sn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const r=void 0===t||"string"==typeof t;if(!r&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),r||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case Jn:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case Jn:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n})();zn.prototype.isTexture=!0;class wt{constructor(e=0,t=0,r=0,i=1){this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*r+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*r+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*r+o[11]*i+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,s;const l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],p=l[9],m=l[2],g=l[6],v=l[10];if(Math.abs(u-h)<.01&&Math.abs(d-m)<.01&&Math.abs(p-g)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+m)<.1&&Math.abs(p+g)<.1&&Math.abs(c+f+v-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const M=(c+1)/2,_=(f+1)/2,x=(v+1)/2,w=(u+h)/4,A=(d+m)/4,b=(p+g)/4;return M>_&&M>x?M<.01?(r=0,i=.707106781,s=.707106781):(r=Math.sqrt(M),i=w/r,s=A/r):_>x?_<.01?(r=.707106781,i=0,s=.707106781):(i=Math.sqrt(_),r=w/i,s=b/i):x<.01?(r=.707106781,i=.707106781,s=0):(s=Math.sqrt(x),r=A/s,i=b/s),this.set(r,i,s,t),this}let y=Math.sqrt((g-p)*(g-p)+(d-m)*(d-m)+(h-u)*(h-u));return Math.abs(y)<.001&&(y=1),this.x=(g-p)/y,this.y=(d-m)/y,this.z=(h-u)/y,this.w=Math.acos((c+f+v-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}wt.prototype.isVector4=!0;class dr extends fs{constructor(e,t,r={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new wt(0,0,e,t),this.scissorTest=!1,this.viewport=new wt(0,0,e,t),this.texture=new zn({width:e,height:t,depth:1},r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==r.generateMipmaps&&r.generateMipmaps,this.texture.internalFormat=void 0!==r.internalFormat?r.internalFormat:null,this.texture.minFilter=void 0!==r.minFilter?r.minFilter:an,this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0!==r.stencilBuffer&&r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null,this.samples=void 0!==r.samples?r.samples:0}setSize(e,t,r=1){(this.width!==e||this.height!==t||this.depth!==r)&&(this.width=e,this.height=t,this.depth=r,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=r,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}dr.prototype.isWebGLRenderTarget=!0;class mh extends zn{constructor(e=null,t=1,r=1,i=1){super(null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=vn,this.minFilter=vn,this.wrapR=Jn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}mh.prototype.isDataArrayTexture=!0,class cH extends dr{constructor(e,t,r){super(e,t),this.depth=r,this.texture=new mh(null,e,t,r),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGLArrayRenderTarget=!0;class Hy extends zn{constructor(e=null,t=1,r=1,i=1){super(null),this.image={data:e,width:t,height:r,depth:i},this.magFilter=vn,this.minFilter=vn,this.wrapR=Jn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Hy.prototype.isData3DTexture=!0,class uH extends dr{constructor(e,t,r){super(e,t),this.depth=r,this.texture=new Hy(null,e,t,r),this.texture.isRenderTargetTexture=!0}}.prototype.isWebGL3DRenderTarget=!0,class dH extends dr{constructor(e,t,r,i={}){super(e,t,i);const s=this.texture;this.texture=[];for(let o=0;o<r;o++)this.texture[o]=s.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,s=this.texture.length;i<s;i++)this.texture[i].image.width=e,this.texture[i].image.height=t,this.texture[i].image.depth=r;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(let t=0,r=e.texture.length;t<r;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}.prototype.isWebGLMultipleRenderTargets=!0;class ln{constructor(e=0,t=0,r=0,i=1){this._x=e,this._y=t,this._z=r,this._w=i}static slerp(e,t,r,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),r.slerpQuaternions(e,t,i)}static slerpFlat(e,t,r,i,s,o,a){let l=r[i+0],c=r[i+1],u=r[i+2],d=r[i+3];const h=s[o+0],f=s[o+1],p=s[o+2],m=s[o+3];if(0===a)return e[t+0]=l,e[t+1]=c,e[t+2]=u,void(e[t+3]=d);if(1===a)return e[t+0]=h,e[t+1]=f,e[t+2]=p,void(e[t+3]=m);if(d!==m||l!==h||c!==f||u!==p){let g=1-a;const v=l*h+c*f+u*p+d*m,y=v>=0?1:-1,M=1-v*v;if(M>Number.EPSILON){const x=Math.sqrt(M),w=Math.atan2(x,v*y);g=Math.sin(g*w)/x,a=Math.sin(a*w)/x}const _=a*y;if(l=l*g+h*_,c=c*g+f*_,u=u*g+p*_,d=d*g+m*_,g===1-a){const x=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=x,c*=x,u*=x,d*=x}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,r,i,s,o){const a=r[i],l=r[i+1],c=r[i+2],u=r[i+3],d=s[o],h=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*d+l*f-c*h,e[t+1]=l*p+u*h+c*d-a*f,e[t+2]=c*p+u*f+a*h-l*d,e[t+3]=u*p-a*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const r=e._x,i=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(r/2),u=a(i/2),d=a(s/2),h=l(r/2),f=l(i/2),p=l(s/2);switch(o){case"XYZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"YZX":this._x=h*u*d+c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d-h*f*p;break;case"XZY":this._x=h*u*d-c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=r+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-i)*f}else if(r>a&&r>d){const f=2*Math.sqrt(1+r-a-d);this._w=(u-l)/f,this._x=.25*f,this._y=(i+o)/f,this._z=(s+c)/f}else if(a>d){const f=2*Math.sqrt(1+a-r-d);this._w=(s-c)/f,this._x=(i+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+d-r-a);this._w=(o-i)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(en(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(0===r)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=r*u+o*a+i*c-s*l,this._y=i*u+o*l+s*a-r*c,this._z=s*u+o*c+r*l-i*a,this._w=o*u-r*a-i*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const r=this._x,i=this._y,s=this._z,o=this._w;let a=o*e._w+r*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=r,this._y=i,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*r+t*this._x,this._y=f*i+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=o*d+this._w*h,this._x=r*d+this._x*h,this._y=i*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=Math.random(),t=Math.sqrt(1-e),r=Math.sqrt(e),i=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(i),r*Math.sin(s),r*Math.cos(s),t*Math.sin(i))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}ln.prototype.isQuaternion=!0;class S{constructor(e=0,t=0,r=0){this.x=e,this.y=t,this.z=r}set(e,t,r){return void 0===r&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(hC.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(hC.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*r+s[6]*i,this.y=s[1]*t+s[4]*r+s[7]*i,this.z=s[2]*t+s[5]*r+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*r+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*r+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*r+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*r+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*i-a*r,u=l*r+a*t-s*i,d=l*i+s*r-o*t,h=-s*t-o*r-a*i;return this.x=c*l+h*-s+u*-a-d*-o,this.y=u*l+h*-o+d*-s-c*-a,this.z=d*l+h*-a+c*-o-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*r+s[8]*i,this.y=s[1]*t+s[5]*r+s[9]*i,this.z=s[2]*t+s[6]*r+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=i*l-s*a,this.y=s*o-r*l,this.z=r*a-i*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return Gy.copy(this).projectOnVector(e),this.sub(Gy)}reflect(e){return this.sub(Gy.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(en(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,r){return void 0!==r&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,r=Math.sqrt(1-e**2);return this.x=r*Math.cos(t),this.y=r*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}S.prototype.isVector3=!0;const Gy=new S,hC=new ln;class Tr{constructor(e=new S(1/0,1/0,1/0),t=new S(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,r=1/0,i=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const u=e[l],d=e[l+1],h=e[l+2];u<t&&(t=u),d<r&&(r=d),h<i&&(i=h),u>s&&(s=u),d>o&&(o=d),h>a&&(a=h)}return this.min.set(t,r,i),this.max.set(s,o,a),this}setFromBufferAttribute(e){let t=1/0,r=1/0,i=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const u=e.getX(l),d=e.getY(l),h=e.getZ(l);u<t&&(t=u),d<r&&(r=d),h<i&&(i=h),u>s&&(s=u),d>o&&(o=d),h>a&&(a=h)}return this.min.set(t,r,i),this.max.set(s,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=ao.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(void 0!==r)if(t&&null!=r.attributes&&void 0!==r.attributes.position){const s=r.attributes.position;for(let o=0,a=s.count;o<a;o++)ao.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(ao)}else null===r.boundingBox&&r.computeBoundingBox(),Vy.copy(r.boundingBox),Vy.applyMatrix4(e.matrixWorld),this.union(Vy);const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ao),ao.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Gc),yh.subVectors(this.max,Gc),Fa.subVectors(e.a,Gc),Oa.subVectors(e.b,Gc),ka.subVectors(e.c,Gc),ps.subVectors(Oa,Fa),gs.subVectors(ka,Oa),lo.subVectors(Fa,ka);let t=[0,-ps.z,ps.y,0,-gs.z,gs.y,0,-lo.z,lo.y,ps.z,0,-ps.x,gs.z,0,-gs.x,lo.z,0,-lo.x,-ps.y,ps.x,0,-gs.y,gs.x,0,-lo.y,lo.x,0];return!(!zy(t,Fa,Oa,ka,yh)||(t=[1,0,0,0,1,0,0,0,1],!zy(t,Fa,Oa,ka,yh)))&&(vh.crossVectors(ps,gs),t=[vh.x,vh.y,vh.z],zy(t,Fa,Oa,ka,yh))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ao.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(ao).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(Bi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Bi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Bi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Bi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Bi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Bi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Bi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Bi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Bi)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Tr.prototype.isBox3=!0;const Bi=[new S,new S,new S,new S,new S,new S,new S,new S],ao=new S,Vy=new Tr,Fa=new S,Oa=new S,ka=new S,ps=new S,gs=new S,lo=new S,Gc=new S,yh=new S,vh=new S,co=new S;function zy(n,e,t,r,i){for(let s=0,o=n.length-3;s<=o;s+=3){co.fromArray(n,s);const a=i.x*Math.abs(co.x)+i.y*Math.abs(co.y)+i.z*Math.abs(co.z),l=e.dot(co),c=t.dot(co),u=r.dot(co);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const hH=new Tr,fC=new S,_h=new S,jy=new S;class uo{constructor(e=new S,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;void 0!==t?r.copy(t):hH.setFromPoints(e).getCenter(r);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,r.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){jy.subVectors(e,this.center);const t=jy.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=.5*(r-this.radius);this.center.add(jy.multiplyScalar(i/r)),this.radius+=i}return this}union(e){return!0===this.center.equals(e.center)?_h.set(0,0,1).multiplyScalar(e.radius):_h.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(fC.copy(e.center).add(_h)),this.expandByPoint(fC.copy(e.center).sub(_h)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ui=new S,Wy=new S,Mh=new S,ms=new S,$y=new S,bh=new S,qy=new S;class ho{constructor(e=new S,t=new S(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ui)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ui.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ui.copy(this.direction).multiplyScalar(t).add(this.origin),Ui.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){Wy.copy(e).add(t).multiplyScalar(.5),Mh.copy(t).sub(e).normalize(),ms.copy(this.origin).sub(Wy);const s=.5*e.distanceTo(t),o=-this.direction.dot(Mh),a=ms.dot(this.direction),l=-ms.dot(Mh),c=ms.lengthSq(),u=Math.abs(1-o*o);let d,h,f,p;if(u>0)if(d=o*l-a,h=o*a-l,p=s*u,d>=0)if(h>=-p)if(h<=p){const m=1/u;d*=m,h*=m,f=d*(d+o*h+2*a)+h*(o*d+h+2*l)+c}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h<=-p?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c):h<=p?(d=0,h=Math.min(Math.max(-s,-l),s),f=h*(h+2*l)+c):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;return r&&r.copy(this.direction).multiplyScalar(d).add(this.origin),i&&i.copy(Mh).multiplyScalar(h).add(Wy),f}intersectSphere(e,t){Ui.subVectors(e.center,this.origin);const r=Ui.dot(this.direction),i=Ui.dot(Ui)-r*r,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),a=r-o,l=r+o;return a<0&&l<0?null:this.at(a<0?l:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return null===r?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(r=(e.min.x-h.x)*c,i=(e.max.x-h.x)*c):(r=(e.max.x-h.x)*c,i=(e.min.x-h.x)*c),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),r>o||s>i||((s>r||r!=r)&&(r=s),(o<i||i!=i)&&(i=o),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),r>l||a>i)||((a>r||r!=r)&&(r=a),(l<i||i!=i)&&(i=l),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return null!==this.intersectBox(e,Ui)}intersectTriangle(e,t,r,i,s){$y.subVectors(t,e),bh.subVectors(r,e),qy.crossVectors($y,bh);let a,o=this.direction.dot(qy);if(o>0){if(i)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}ms.subVectors(this.origin,e);const l=a*this.direction.dot(bh.crossVectors(ms,bh));if(l<0)return null;const c=a*this.direction.dot($y.cross(ms));if(c<0||l+c>o)return null;const u=-a*ms.dot(qy);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Se{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,r,i,s,o,a,l,c,u,d,h,f,p,m,g){const v=this.elements;return v[0]=e,v[4]=t,v[8]=r,v[12]=i,v[1]=s,v[5]=o,v[9]=a,v[13]=l,v[2]=c,v[6]=u,v[10]=d,v[14]=h,v[3]=f,v[7]=p,v[11]=m,v[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Se).fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Ba.setFromMatrixColumn(e,0).length(),s=1/Ba.setFromMatrixColumn(e,1).length(),o=1/Ba.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*s,t[5]=r[5]*s,t[6]=r[6]*s,t[7]=0,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,r=e.x,i=e.y,s=e.z,o=Math.cos(r),a=Math.sin(r),l=Math.cos(i),c=Math.sin(i),u=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const h=o*u,f=o*d,p=a*u,m=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+p*c,t[5]=h-m*c,t[9]=-a*l,t[2]=m-h*c,t[6]=p+f*c,t[10]=o*l}else if("YXZ"===e.order){const h=l*u,f=l*d,p=c*u,m=c*d;t[0]=h+m*a,t[4]=p*a-f,t[8]=o*c,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=m+h*a,t[10]=o*l}else if("ZXY"===e.order){const h=l*u,f=l*d,p=c*u,m=c*d;t[0]=h-m*a,t[4]=-o*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=m-h*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if("ZYX"===e.order){const h=o*u,f=o*d,p=a*u,m=a*d;t[0]=l*u,t[4]=p*c-f,t[8]=h*c+m,t[1]=l*d,t[5]=m*c+h,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if("YZX"===e.order){const h=o*l,f=o*c,p=a*l,m=a*c;t[0]=l*u,t[4]=m-h*d,t[8]=p*d+f,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*d+p,t[10]=h-m*d}else if("XZY"===e.order){const h=o*l,f=o*c,p=a*l,m=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+m,t[5]=o*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=m*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(fH,e,pH)}lookAt(e,t,r){const i=this.elements;return hr.subVectors(e,t),0===hr.lengthSq()&&(hr.z=1),hr.normalize(),ys.crossVectors(r,hr),0===ys.lengthSq()&&(1===Math.abs(r.z)?hr.x+=1e-4:hr.z+=1e-4,hr.normalize(),ys.crossVectors(r,hr)),ys.normalize(),xh.crossVectors(hr,ys),i[0]=ys.x,i[4]=xh.x,i[8]=hr.x,i[1]=ys.y,i[5]=xh.y,i[9]=hr.y,i[2]=ys.z,i[6]=xh.z,i[10]=hr.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,s=this.elements,o=r[0],a=r[4],l=r[8],c=r[12],u=r[1],d=r[5],h=r[9],f=r[13],p=r[2],m=r[6],g=r[10],v=r[14],y=r[3],M=r[7],_=r[11],x=r[15],w=i[0],A=i[4],b=i[8],C=i[12],R=i[1],P=i[5],U=i[9],Z=i[13],L=i[2],k=i[6],F=i[10],X=i[14],J=i[3],H=i[7],j=i[11],ie=i[15];return s[0]=o*w+a*R+l*L+c*J,s[4]=o*A+a*P+l*k+c*H,s[8]=o*b+a*U+l*F+c*j,s[12]=o*C+a*Z+l*X+c*ie,s[1]=u*w+d*R+h*L+f*J,s[5]=u*A+d*P+h*k+f*H,s[9]=u*b+d*U+h*F+f*j,s[13]=u*C+d*Z+h*X+f*ie,s[2]=p*w+m*R+g*L+v*J,s[6]=p*A+m*P+g*k+v*H,s[10]=p*b+m*U+g*F+v*j,s[14]=p*C+m*Z+g*X+v*ie,s[3]=y*w+M*R+_*L+x*J,s[7]=y*A+M*P+_*k+x*H,s[11]=y*b+M*U+_*F+x*j,s[15]=y*C+M*Z+_*X+x*ie,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14];return e[3]*(+s*l*d-i*c*d-s*a*h+r*c*h+i*a*f-r*l*f)+e[7]*(+t*l*f-t*c*h+s*o*h-i*o*f+i*c*u-s*l*u)+e[11]*(+t*c*d-t*a*f-s*o*d+r*o*f+s*a*u-r*c*u)+e[15]*(-i*a*u-t*l*d+t*a*h+i*o*d-r*o*h+r*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],m=e[13],g=e[14],v=e[15],y=d*g*c-m*h*c+m*l*f-a*g*f-d*l*v+a*h*v,M=p*h*c-u*g*c-p*l*f+o*g*f+u*l*v-o*h*v,_=u*m*c-p*d*c+p*a*f-o*m*f-u*a*v+o*d*v,x=p*d*l-u*m*l-p*a*h+o*m*h+u*a*g-o*d*g,w=t*y+r*M+i*_+s*x;if(0===w)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/w;return e[0]=y*A,e[1]=(m*h*s-d*g*s-m*i*f+r*g*f+d*i*v-r*h*v)*A,e[2]=(a*g*s-m*l*s+m*i*c-r*g*c-a*i*v+r*l*v)*A,e[3]=(d*l*s-a*h*s-d*i*c+r*h*c+a*i*f-r*l*f)*A,e[4]=M*A,e[5]=(u*g*s-p*h*s+p*i*f-t*g*f-u*i*v+t*h*v)*A,e[6]=(p*l*s-o*g*s-p*i*c+t*g*c+o*i*v-t*l*v)*A,e[7]=(o*h*s-u*l*s+u*i*c-t*h*c-o*i*f+t*l*f)*A,e[8]=_*A,e[9]=(p*d*s-u*m*s-p*r*f+t*m*f+u*r*v-t*d*v)*A,e[10]=(o*m*s-p*a*s+p*r*c-t*m*c-o*r*v+t*a*v)*A,e[11]=(u*a*s-o*d*s-u*r*c+t*d*c+o*r*f-t*a*f)*A,e[12]=x*A,e[13]=(u*m*i-p*d*i+p*r*h-t*m*h-u*r*g+t*d*g)*A,e[14]=(p*a*i-o*m*i-p*r*l+t*m*l+o*r*g-t*a*g)*A,e[15]=(o*d*i-u*a*i+u*r*l-t*d*l-o*r*h+t*a*h)*A,this}scale(e){const t=this.elements,r=e.x,i=e.y,s=e.z;return t[0]*=r,t[4]*=i,t[8]*=s,t[1]*=r,t[5]*=i,t[9]*=s,t[2]*=r,t[6]*=i,t[10]*=s,t[3]*=r,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),s=1-r,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+r,c*a-i*l,c*l+i*a,0,c*a+i*l,u*a+r,u*l-i*o,0,c*l-i*a,u*l+i*o,s*l*l+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,s,o){return this.set(1,r,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,d=a+a,h=s*c,f=s*u,p=s*d,m=o*u,g=o*d,v=a*d,y=l*c,M=l*u,_=l*d,x=r.x,w=r.y,A=r.z;return i[0]=(1-(m+v))*x,i[1]=(f+_)*x,i[2]=(p-M)*x,i[3]=0,i[4]=(f-_)*w,i[5]=(1-(h+v))*w,i[6]=(g+y)*w,i[7]=0,i[8]=(p+M)*A,i[9]=(g-y)*A,i[10]=(1-(h+m))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let s=Ba.set(i[0],i[1],i[2]).length();const o=Ba.set(i[4],i[5],i[6]).length(),a=Ba.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Wr.copy(this);const c=1/s,u=1/o,d=1/a;return Wr.elements[0]*=c,Wr.elements[1]*=c,Wr.elements[2]*=c,Wr.elements[4]*=u,Wr.elements[5]*=u,Wr.elements[6]*=u,Wr.elements[8]*=d,Wr.elements[9]*=d,Wr.elements[10]*=d,t.setFromRotationMatrix(Wr),r.x=s,r.y=o,r.z=a,this}makePerspective(e,t,r,i,s,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const a=this.elements,c=2*s/(r-i),u=(t+e)/(t-e),d=(r+i)/(r-i),h=-(o+s)/(o-s),f=-2*o*s/(o-s);return a[0]=2*s/(t-e),a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,r,i,s,o){const a=this.elements,l=1/(t-e),c=1/(r-i),u=1/(o-s),d=(t+e)*l,h=(r+i)*c,f=(o+s)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}Se.prototype.isMatrix4=!0;const Ba=new S,Wr=new Se,fH=new S(0,0,0),pH=new S(1,1,1),ys=new S,xh=new S,hr=new S,pC=new Se,gC=new ln;class Hi{constructor(e=0,t=0,r=0,i=Hi.DefaultOrder){this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,s=i[0],o=i[4],a=i[8],l=i[1],c=i[5],u=i[9],d=i[2],h=i[6],f=i[10];switch(t){case"XYZ":this._y=Math.asin(en(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,f),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(h,c),this._z=0);break;case"YXZ":this._x=Math.asin(-en(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,f),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(en(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,f),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-en(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(en(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(a,f));break;case"XZY":this._z=Math.asin(-en(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-u,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===r&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return pC.makeRotationFromQuaternion(e),this.setFromRotationMatrix(pC,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return gC.setFromEuler(this),this.setFromQuaternion(gC,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Hi.prototype.isEuler=!0,Hi.DefaultOrder="XYZ",Hi.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Ua{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let gH=0;const mC=new S,Ha=new ln,Gi=new Se,wh=new S,Vc=new S,mH=new S,yH=new ln,yC=new S(1,0,0),vC=new S(0,1,0),_C=new S(0,0,1),vH={type:"added"},MC={type:"removed"};class _t extends fs{constructor(){super(),Object.defineProperty(this,"id",{value:gH++}),this.uuid=ur(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=_t.DefaultUp.clone();const e=new S,t=new Hi,r=new ln,i=new S(1,1,1);t._onChange(function s(){r.setFromEuler(t,!1)}),r._onChange(function o(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Se},normalMatrix:{value:new Sn}}),this.matrix=new Se,this.matrixWorld=new Se,this.matrixAutoUpdate=_t.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Ua,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Ha.setFromAxisAngle(e,t),this.quaternion.multiply(Ha),this}rotateOnWorldAxis(e,t){return Ha.setFromAxisAngle(e,t),this.quaternion.premultiply(Ha),this}rotateX(e){return this.rotateOnAxis(yC,e)}rotateY(e){return this.rotateOnAxis(vC,e)}rotateZ(e){return this.rotateOnAxis(_C,e)}translateOnAxis(e,t){return mC.copy(e).applyQuaternion(this.quaternion),this.position.add(mC.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(yC,e)}translateY(e){return this.translateOnAxis(vC,e)}translateZ(e){return this.translateOnAxis(_C,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Gi.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?wh.copy(e):wh.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Vc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Gi.lookAt(Vc,wh,this.up):Gi.lookAt(wh,Vc,this.up),this.quaternion.setFromRotationMatrix(Gi),i&&(Gi.extractRotation(i.matrixWorld),Ha.setFromRotationMatrix(Gi),this.quaternion.premultiply(Ha.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(vH)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(MC)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(MC)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Gi.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Gi.multiply(e.parent.matrixWorld)),e.applyMatrix4(Gi),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const o=this.children[r].getObjectByProperty(e,t);if(void 0!==o)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vc,e,mH),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Vc,yH,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(!0===e&&null!==r&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function s(a,l){return void 0===a[l.uuid]&&(a[l.uuid]=l.toJSON(e)),l.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){const l=a.shapes;if(Array.isArray(l))for(let c=0,u=l.length;c<u;c++)s(e.shapes,l[c]);else s(e.shapes,l)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const a=[];for(let l=0,c=this.material.length;l<c;l++)a.push(s(e.materials,this.material[l]));i.material=a}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++)i.animations.push(s(e.animations,this.animations[a]))}if(t){const a=o(e.geometries),l=o(e.materials),c=o(e.textures),u=o(e.images),d=o(e.shapes),h=o(e.skeletons),f=o(e.animations),p=o(e.nodes);a.length>0&&(r.geometries=a),l.length>0&&(r.materials=l),c.length>0&&(r.textures=c),u.length>0&&(r.images=u),d.length>0&&(r.shapes=d),h.length>0&&(r.skeletons=h),f.length>0&&(r.animations=f),p.length>0&&(r.nodes=p)}return r.object=i,r;function o(a){const l=[];for(const c in a){const u=a[c];delete u.metadata,l.push(u)}return l}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let r=0;r<e.children.length;r++)this.add(e.children[r].clone());return this}}_t.DefaultUp=new S(0,1,0),_t.DefaultMatrixAutoUpdate=!0,_t.prototype.isObject3D=!0;const $r=new S,Vi=new S,Zy=new S,zi=new S,Ga=new S,Va=new S,bC=new S,Xy=new S,Yy=new S,Jy=new S;class cn{constructor(e=new S,t=new S,r=new S){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),$r.subVectors(e,t),i.cross($r);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,r,i,s){$r.subVectors(i,t),Vi.subVectors(r,t),Zy.subVectors(e,t);const o=$r.dot($r),a=$r.dot(Vi),l=$r.dot(Zy),c=Vi.dot(Vi),u=Vi.dot(Zy),d=o*c-a*a;if(0===d)return s.set(-2,-1,-1);const h=1/d,f=(c*l-a*u)*h,p=(o*u-a*l)*h;return s.set(1-f-p,p,f)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,zi),zi.x>=0&&zi.y>=0&&zi.x+zi.y<=1}static getUV(e,t,r,i,s,o,a,l){return this.getBarycoord(e,t,r,i,zi),l.set(0,0),l.addScaledVector(s,zi.x),l.addScaledVector(o,zi.y),l.addScaledVector(a,zi.z),l}static isFrontFacing(e,t,r,i){return $r.subVectors(r,t),Vi.subVectors(e,t),$r.cross(Vi).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return $r.subVectors(this.c,this.b),Vi.subVectors(this.a,this.b),.5*$r.cross(Vi).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return cn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return cn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,r,i,s){return cn.getUV(e,this.a,this.b,this.c,t,r,i,s)}containsPoint(e){return cn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return cn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,s=this.c;let o,a;Ga.subVectors(i,r),Va.subVectors(s,r),Xy.subVectors(e,r);const l=Ga.dot(Xy),c=Va.dot(Xy);if(l<=0&&c<=0)return t.copy(r);Yy.subVectors(e,i);const u=Ga.dot(Yy),d=Va.dot(Yy);if(u>=0&&d<=u)return t.copy(i);const h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(r).addScaledVector(Ga,o);Jy.subVectors(e,s);const f=Ga.dot(Jy),p=Va.dot(Jy);if(p>=0&&f<=p)return t.copy(s);const m=f*c-l*p;if(m<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(r).addScaledVector(Va,a);const g=u*p-f*d;if(g<=0&&d-u>=0&&f-p>=0)return bC.subVectors(s,i),a=(d-u)/(d-u+(f-p)),t.copy(i).addScaledVector(bC,a);const v=1/(g+m+h);return o=m*v,a=h*v,t.copy(r).addScaledVector(Ga,o).addScaledVector(Va,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let _H=0;class un extends fs{constructor(){super(),Object.defineProperty(this,"id",{value:_H++}),this.uuid=ur(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const r=e[t];if(void 0===r){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===r;continue}const i=this[t];void 0!==i?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),void 0!==this.roughness&&(r.roughness=this.roughness),void 0!==this.metalness&&(r.metalness=this.metalness),void 0!==this.sheen&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(r.shininess=this.shininess),void 0!==this.clearcoat&&(r.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(r.combine=this.combine)),void 0!==this.envMapIntensity&&(r.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(r.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(r.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(r.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(r.size=this.size),null!==this.shadowSide&&(r.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(r.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(r.blending=this.blending),0!==this.side&&(r.side=this.side),this.vertexColors&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),!0===this.transparent&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.colorWrite=this.colorWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(r.rotation=this.rotation),!0===this.polygonOffset&&(r.polygonOffset=!0),0!==this.polygonOffsetFactor&&(r.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(r.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(r.linewidth=this.linewidth),void 0!==this.dashSize&&(r.dashSize=this.dashSize),void 0!==this.gapSize&&(r.gapSize=this.gapSize),void 0!==this.scale&&(r.scale=this.scale),!0===this.dithering&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(r.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(r.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(r.wireframe=this.wireframe),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(r.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(r.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(r.flatShading=this.flatShading),!1===this.visible&&(r.visible=!1),!1===this.toneMapped&&(r.toneMapped=!1),!1===this.fog&&(r.fog=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),t){const s=i(e.textures),o=i(e.images);s.length>0&&(r.textures=s),o.length>0&&(r.images=o)}return r}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(null!==t){const i=t.length;r=new Array(i);for(let s=0;s!==i;++s)r[s]=t[s].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}un.prototype.isMaterial=!0,un.fromType=function(){return null};class vs extends un{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new ce(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}vs.prototype.isMeshBasicMaterial=!0;const dn=new S,Sh=new $;class Pt{constructor(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===r,this.usage=Oc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let r=0;for(let i=0,s=e.length;i<s;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),o=new ce),t[r++]=o.r,t[r++]=o.g,t[r++]=o.b}return this}copyVector2sArray(e){const t=this.array;let r=0;for(let i=0,s=e.length;i<s;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),o=new $),t[r++]=o.x,t[r++]=o.y}return this}copyVector3sArray(e){const t=this.array;let r=0;for(let i=0,s=e.length;i<s;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),o=new S),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z}return this}copyVector4sArray(e){const t=this.array;let r=0;for(let i=0,s=e.length;i<s;i++){let o=e[i];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),o=new wt),t[r++]=o.x,t[r++]=o.y,t[r++]=o.z,t[r++]=o.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,r=this.count;t<r;t++)Sh.fromBufferAttribute(this,t),Sh.applyMatrix3(e),this.setXY(t,Sh.x,Sh.y);else if(3===this.itemSize)for(let t=0,r=this.count;t<r;t++)dn.fromBufferAttribute(this,t),dn.applyMatrix3(e),this.setXYZ(t,dn.x,dn.y,dn.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)dn.fromBufferAttribute(this,t),dn.applyMatrix4(e),this.setXYZ(t,dn.x,dn.y,dn.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)dn.fromBufferAttribute(this,t),dn.applyNormalMatrix(e),this.setXYZ(t,dn.x,dn.y,dn.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)dn.fromBufferAttribute(this,t),dn.transformDirection(e),this.setXYZ(t,dn.x,dn.y,dn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,s){return this.array[0+(e*=this.itemSize)]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Oc&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}}Pt.prototype.isBufferAttribute=!0;class xC extends Pt{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class wC extends Pt{constructor(e,t,r){super(new Uint32Array(e),t,r)}}(class MH extends Pt{constructor(e,t,r){super(new Uint16Array(e),t,r)}}).prototype.isFloat16BufferAttribute=!0;class we extends Pt{constructor(e,t,r){super(new Float32Array(e),t,r)}}let bH=0;const Nr=new Se,Ky=new _t,za=new S,fr=new Tr,zc=new Tr,En=new S;class Le extends fs{constructor(){super(),Object.defineProperty(this,"id",{value:bH++}),this.uuid=ur(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(uC(e)?wC:xC)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(void 0!==r){const s=(new Sn).getNormalMatrix(e);r.applyNormalMatrix(s),r.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Nr.makeRotationFromQuaternion(e),this.applyMatrix4(Nr),this}rotateX(e){return Nr.makeRotationX(e),this.applyMatrix4(Nr),this}rotateY(e){return Nr.makeRotationY(e),this.applyMatrix4(Nr),this}rotateZ(e){return Nr.makeRotationZ(e),this.applyMatrix4(Nr),this}translate(e,t,r){return Nr.makeTranslation(e,t,r),this.applyMatrix4(Nr),this}scale(e,t,r){return Nr.makeScale(e,t,r),this.applyMatrix4(Nr),this}lookAt(e){return Ky.lookAt(e),Ky.updateMatrix(),this.applyMatrix4(Ky.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(za).negate(),this.translate(za.x,za.y,za.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const s=e[r];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new we(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Tr);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++)fr.setFromBufferAttribute(t[r]),this.morphTargetsRelative?(En.addVectors(this.boundingBox.min,fr.min),this.boundingBox.expandByPoint(En),En.addVectors(this.boundingBox.max,fr.max),this.boundingBox.expandByPoint(En)):(this.boundingBox.expandByPoint(fr.min),this.boundingBox.expandByPoint(fr.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new uo);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new S,1/0);if(e){const r=this.boundingSphere.center;if(fr.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)zc.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(En.addVectors(fr.min,zc.min),fr.expandByPoint(En),En.addVectors(fr.max,zc.max),fr.expandByPoint(En)):(fr.expandByPoint(zc.min),fr.expandByPoint(zc.max));fr.getCenter(r);let i=0;for(let s=0,o=e.count;s<o;s++)En.fromBufferAttribute(e,s),i=Math.max(i,r.distanceToSquared(En));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)En.fromBufferAttribute(a,c),l&&(za.fromBufferAttribute(e,c),En.add(za)),i=Math.max(i,r.distanceToSquared(En))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const r=e.array,i=t.position.array,s=t.normal.array,o=t.uv.array,a=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new Pt(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let R=0;R<a;R++)c[R]=new S,u[R]=new S;const d=new S,h=new S,f=new S,p=new $,m=new $,g=new $,v=new S,y=new S;function M(R,P,U){d.fromArray(i,3*R),h.fromArray(i,3*P),f.fromArray(i,3*U),p.fromArray(o,2*R),m.fromArray(o,2*P),g.fromArray(o,2*U),h.sub(d),f.sub(d),m.sub(p),g.sub(p);const Z=1/(m.x*g.y-g.x*m.y);!isFinite(Z)||(v.copy(h).multiplyScalar(g.y).addScaledVector(f,-m.y).multiplyScalar(Z),y.copy(f).multiplyScalar(m.x).addScaledVector(h,-g.x).multiplyScalar(Z),c[R].add(v),c[P].add(v),c[U].add(v),u[R].add(y),u[P].add(y),u[U].add(y))}let _=this.groups;0===_.length&&(_=[{start:0,count:r.length}]);for(let R=0,P=_.length;R<P;++R){const U=_[R],Z=U.start;for(let k=Z,F=Z+U.count;k<F;k+=3)M(r[k+0],r[k+1],r[k+2])}const x=new S,w=new S,A=new S,b=new S;function C(R){A.fromArray(s,3*R),b.copy(A);const P=c[R];x.copy(P),x.sub(A.multiplyScalar(A.dot(P))).normalize(),w.crossVectors(b,P);const Z=w.dot(u[R])<0?-1:1;l[4*R]=x.x,l[4*R+1]=x.y,l[4*R+2]=x.z,l[4*R+3]=Z}for(let R=0,P=_.length;R<P;++R){const U=_[R],Z=U.start;for(let k=Z,F=Z+U.count;k<F;k+=3)C(r[k+0]),C(r[k+1]),C(r[k+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let r=this.getAttribute("normal");if(void 0===r)r=new Pt(new Float32Array(3*t.count),3),this.setAttribute("normal",r);else for(let h=0,f=r.count;h<f;h++)r.setXYZ(h,0,0,0);const i=new S,s=new S,o=new S,a=new S,l=new S,c=new S,u=new S,d=new S;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),m=e.getX(h+1),g=e.getX(h+2);i.fromBufferAttribute(t,p),s.fromBufferAttribute(t,m),o.fromBufferAttribute(t,g),u.subVectors(o,s),d.subVectors(i,s),u.cross(d),a.fromBufferAttribute(r,p),l.fromBufferAttribute(r,m),c.fromBufferAttribute(r,g),a.add(u),l.add(u),c.add(u),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(m,l.x,l.y,l.z),r.setXYZ(g,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)i.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),u.subVectors(o,s),d.subVectors(i,s),u.cross(d),r.setXYZ(h+0,u.x,u.y,u.z),r.setXYZ(h+1,u.x,u.y,u.z),r.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),r.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const r=this.attributes;for(const i in r){if(void 0===e.attributes[i])continue;const o=r[i].array,a=e.attributes[i],l=a.array,c=a.itemSize*t,u=Math.min(l.length,o.length-c);for(let d=0,h=c;d<u;d++,h++)o[h]=l[d]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)En.fromBufferAttribute(e,t),En.normalize(),e.setXYZ(t,En.x,En.y,En.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u);let f=0,p=0;for(let m=0,g=l.length;m<g;m++){f=a.isInterleavedBufferAttribute?l[m]*a.data.stride+a.offset:l[m]*u;for(let v=0;v<u;v++)h[p++]=c[f++]}return new Pt(h,u,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Le,r=this.index.array,i=this.attributes;for(const a in i){const c=e(i[a],r);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,d=c.length;u<d;u++){const f=e(c[u],r);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const l=this.parameters;for(const c in l)void 0!==l[c]&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const l in r)e.data.attributes[l]=r[l].toJSON(e.data);const i={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++)u.push(c[d].toJSON(e.data));u.length>0&&(i[l]=u,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;null!==r&&this.setIndex(r.clone(t));const i=e.attributes;for(const c in i)this.setAttribute(c,i[c].clone(t));const s=e.morphAttributes;for(const c in s){const u=[],d=s[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Le.prototype.isBufferGeometry=!0;const SC=new Se,ja=new ho,Qy=new uo,_s=new S,Ms=new S,bs=new S,ev=new S,tv=new S,nv=new S,Eh=new S,Ch=new S,Dh=new S,Th=new $,Nh=new $,Ah=new $,rv=new S,Ih=new S;class Mn extends _t{constructor(e=new Le,t=new vs){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const r=this.geometry,i=this.material,s=this.matrixWorld;if(void 0===i||(null===r.boundingSphere&&r.computeBoundingSphere(),Qy.copy(r.boundingSphere),Qy.applyMatrix4(s),!1===e.ray.intersectsSphere(Qy))||(SC.copy(s).invert(),ja.copy(e.ray).applyMatrix4(SC),null!==r.boundingBox&&!1===ja.intersectsBox(r.boundingBox)))return;let o;if(r.isBufferGeometry){const a=r.index,l=r.attributes.position,c=r.morphAttributes.position,u=r.morphTargetsRelative,d=r.attributes.uv,h=r.attributes.uv2,f=r.groups,p=r.drawRange;if(null!==a)if(Array.isArray(i))for(let m=0,g=f.length;m<g;m++){const v=f[m],y=i[v.materialIndex];for(let x=Math.max(v.start,p.start),w=Math.min(a.count,Math.min(v.start+v.count,p.start+p.count));x<w;x+=3){const A=a.getX(x),b=a.getX(x+1),C=a.getX(x+2);o=Rh(this,y,e,ja,l,c,u,d,h,A,b,C),o&&(o.faceIndex=Math.floor(x/3),o.face.materialIndex=v.materialIndex,t.push(o))}}else for(let v=Math.max(0,p.start),y=Math.min(a.count,p.start+p.count);v<y;v+=3){const M=a.getX(v),_=a.getX(v+1),x=a.getX(v+2);o=Rh(this,i,e,ja,l,c,u,d,h,M,_,x),o&&(o.faceIndex=Math.floor(v/3),t.push(o))}else if(void 0!==l)if(Array.isArray(i))for(let m=0,g=f.length;m<g;m++){const v=f[m],y=i[v.materialIndex];for(let x=Math.max(v.start,p.start),w=Math.min(l.count,Math.min(v.start+v.count,p.start+p.count));x<w;x+=3)o=Rh(this,y,e,ja,l,c,u,d,h,x,x+1,x+2),o&&(o.faceIndex=Math.floor(x/3),o.face.materialIndex=v.materialIndex,t.push(o))}else for(let v=Math.max(0,p.start),y=Math.min(l.count,p.start+p.count);v<y;v+=3)o=Rh(this,i,e,ja,l,c,u,d,h,v,v+1,v+2),o&&(o.faceIndex=Math.floor(v/3),t.push(o))}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Rh(n,e,t,r,i,s,o,a,l,c,u,d){_s.fromBufferAttribute(i,c),Ms.fromBufferAttribute(i,u),bs.fromBufferAttribute(i,d);const h=n.morphTargetInfluences;if(s&&h){Eh.set(0,0,0),Ch.set(0,0,0),Dh.set(0,0,0);for(let p=0,m=s.length;p<m;p++){const g=h[p],v=s[p];0!==g&&(ev.fromBufferAttribute(v,c),tv.fromBufferAttribute(v,u),nv.fromBufferAttribute(v,d),o?(Eh.addScaledVector(ev,g),Ch.addScaledVector(tv,g),Dh.addScaledVector(nv,g)):(Eh.addScaledVector(ev.sub(_s),g),Ch.addScaledVector(tv.sub(Ms),g),Dh.addScaledVector(nv.sub(bs),g)))}_s.add(Eh),Ms.add(Ch),bs.add(Dh)}n.isSkinnedMesh&&(n.boneTransform(c,_s),n.boneTransform(u,Ms),n.boneTransform(d,bs));const f=function xH(n,e,t,r,i,s,o,a){let l;if(l=1===e.side?r.intersectTriangle(o,s,i,!0,a):r.intersectTriangle(i,s,o,2!==e.side,a),null===l)return null;Ih.copy(a),Ih.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(Ih);return c<t.near||c>t.far?null:{distance:c,point:Ih.clone(),object:n}}(n,e,t,r,_s,Ms,bs,rv);if(f){a&&(Th.fromBufferAttribute(a,c),Nh.fromBufferAttribute(a,u),Ah.fromBufferAttribute(a,d),f.uv=cn.getUV(rv,_s,Ms,bs,Th,Nh,Ah,new $)),l&&(Th.fromBufferAttribute(l,c),Nh.fromBufferAttribute(l,u),Ah.fromBufferAttribute(l,d),f.uv2=cn.getUV(rv,_s,Ms,bs,Th,Nh,Ah,new $));const p={a:c,b:u,c:d,normal:new S,materialIndex:0};cn.getNormal(_s,Ms,bs,p.normal),f.face=p}return f}Mn.prototype.isMesh=!0;class xs extends Le{constructor(e=1,t=1,r=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:s,depthSegments:o};const a=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],d=[];let h=0,f=0;function p(m,g,v,y,M,_,x,w,A,b,C){const R=_/A,P=x/b,U=_/2,Z=x/2,L=w/2,k=A+1,F=b+1;let X=0,J=0;const H=new S;for(let j=0;j<F;j++){const ie=j*P-Z;for(let ne=0;ne<k;ne++)H[m]=(ne*R-U)*y,H[g]=ie*M,H[v]=L,c.push(H.x,H.y,H.z),H[m]=0,H[g]=0,H[v]=w>0?1:-1,u.push(H.x,H.y,H.z),d.push(ne/A),d.push(1-j/b),X+=1}for(let j=0;j<b;j++)for(let ie=0;ie<A;ie++){const le=h+ie+k*(j+1),Me=h+(ie+1)+k*(j+1),Ee=h+(ie+1)+k*j;l.push(h+ie+k*j,le,Ee),l.push(le,Me,Ee),J+=6}a.addGroup(f,J,C),f+=J,h+=X}p("z","y","x",-1,-1,r,t,e,o,s,0),p("z","y","x",1,-1,r,t,-e,o,s,1),p("x","z","y",1,1,e,r,t,i,o,2),p("x","z","y",1,-1,e,r,-t,i,o,3),p("x","y","z",1,-1,e,t,r,i,s,4),p("x","y","z",-1,-1,e,t,-r,i,s,5),this.setIndex(l),this.setAttribute("position",new we(c,3)),this.setAttribute("normal",new we(u,3)),this.setAttribute("uv",new we(d,2))}static fromJSON(e){return new xs(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Wa(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];e[t][r]=i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.clone():Array.isArray(i)?i.slice():i}}return e}function On(n){const e={};for(let t=0;t<n.length;t++){const r=Wa(n[t]);for(const i in r)e[i]=r[i]}return e}const wH={clone:Wa,merge:On};class qr extends un{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Wa(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;t.uniforms[i]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const r={};for(const i in this.extensions)!0===this.extensions[i]&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}qr.prototype.isShaderMaterial=!0;class Ph extends _t{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Se,this.projectionMatrix=new Se,this.projectionMatrixInverse=new Se}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Ph.prototype.isCamera=!0;class Ut extends Ph{constructor(e=50,t=1,r=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Bc*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*io*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Bc*Math.atan(Math.tan(.5*io*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,r,i,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*io*this.fov)/this.zoom,r=2*t,i=this.aspect*r,s=-.5*i;const o=this.view;if(null!==this.view&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*i/l,t-=o.offsetY*r/c,i*=o.width/l,r*=o.height/c}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-r,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}Ut.prototype.isPerspectiveCamera=!0;class iv extends _t{constructor(e,t,r){if(super(),this.type="CubeCamera",!0!==r.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=r;const i=new Ut(90,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new S(1,0,0)),this.add(i);const s=new Ut(90,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new S(-1,0,0)),this.add(s);const o=new Ut(90,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new S(0,1,0)),this.add(o);const a=new Ut(90,1,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new S(0,-1,0)),this.add(a);const l=new Ut(90,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new S(0,0,1)),this.add(l);const c=new Ut(90,1,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new S(0,0,-1)),this.add(c)}update(e,t){null===this.parent&&this.updateMatrixWorld();const r=this.renderTarget,[i,s,o,a,l,c]=this.children,u=e.getRenderTarget(),d=e.toneMapping,h=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const f=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0),e.render(t,i),e.setRenderTarget(r,1),e.render(t,s),e.setRenderTarget(r,2),e.render(t,o),e.setRenderTarget(r,3),e.render(t,a),e.setRenderTarget(r,4),e.render(t,l),r.texture.generateMipmaps=f,e.setRenderTarget(r,5),e.render(t,c),e.setRenderTarget(u),e.toneMapping=d,e.xr.enabled=h,r.texture.needsPMREMUpdate=!0}}class jc extends zn{constructor(e,t,r,i,s,o,a,l,c,u){super(e=void 0!==e?e:[],t=void 0!==t?t:301,r,i,s,o,a,l,c,u),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}jc.prototype.isCubeTexture=!0;class EC extends dr{constructor(e,t={}){super(e,e,t);const r={width:e,height:e,depth:1};this.texture=new jc([r,r,r,r,r,r],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:an}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r_uniforms={tEquirect:{value:null}},r_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",r_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new xs(5,5,5),s=new qr({name:"CubemapFromEquirect",uniforms:Wa(r_uniforms),vertexShader:r_vertexShader,fragmentShader:r_fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const o=new Mn(i,s),a=t.minFilter;return 1008===t.minFilter&&(t.minFilter=an),new iv(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,r,i){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,r,i);e.setRenderTarget(s)}}EC.prototype.isWebGLCubeRenderTarget=!0;const sv=new S,CH=new S,DH=new Sn;class ji{constructor(e=new S(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=sv.subVectors(r,t).cross(CH.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const r=e.delta(sv),i=this.normal.dot(r);if(0===i)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(r).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||DH.getNormalMatrix(e),i=this.coplanarPoint(sv).applyMatrix4(e),s=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}ji.prototype.isPlane=!0;const Za=new uo,Lh=new S;class Fh{constructor(e=new ji,t=new ji,r=new ji,i=new ji,s=new ji,o=new ji){this.planes=[e,t,r,i,s,o]}set(e,t,r,i,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(r),a[3].copy(i),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e){const t=this.planes,r=e.elements,i=r[0],s=r[1],o=r[2],a=r[3],l=r[4],c=r[5],u=r[6],d=r[7],h=r[8],f=r[9],p=r[10],m=r[11],g=r[12],v=r[13],y=r[14],M=r[15];return t[0].setComponents(a-i,d-l,m-h,M-g).normalize(),t[1].setComponents(a+i,d+l,m+h,M+g).normalize(),t[2].setComponents(a+s,d+c,m+f,M+v).normalize(),t[3].setComponents(a-s,d-c,m-f,M-v).normalize(),t[4].setComponents(a-o,d-u,m-p,M-y).normalize(),t[5].setComponents(a+o,d+u,m+p,M+y).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Za.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Za)}intersectsSprite(e){return Za.center.set(0,0,0),Za.radius=.7071067811865476,Za.applyMatrix4(e.matrixWorld),this.intersectsSphere(Za)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(Lh.x=i.normal.x>0?e.max.x:e.min.x,Lh.y=i.normal.y>0?e.max.y:e.min.y,Lh.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Lh)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function CC(){let n=null,e=!1,t=null,r=null;function i(s,o){t(s,o),r=n.requestAnimationFrame(i)}return{start:function(){!0!==e&&null!==t&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function TH(n,e){const t=e.isWebGL2,r=new WeakMap;return{get:function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),r.get(c)},remove:function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=r.get(c);u&&(n.deleteBuffer(u.buffer),r.delete(c))},update:function l(c,u){if(c.isGLBufferAttribute){const h=r.get(c);return void((!h||h.version<c.version)&&r.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version}))}c.isInterleavedBufferAttribute&&(c=c.data);const d=r.get(c);void 0===d?r.set(c,function i(c,u){const d=c.array,h=c.usage,f=n.createBuffer();let p;if(n.bindBuffer(u,f),n.bufferData(u,d,h),c.onUploadCallback(),d instanceof Float32Array)p=5126;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");p=5131}else p=5123;else if(d instanceof Int16Array)p=5122;else if(d instanceof Uint32Array)p=5125;else if(d instanceof Int32Array)p=5124;else if(d instanceof Int8Array)p=5120;else if(d instanceof Uint8Array)p=5121;else{if(!(d instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);p=5121}return{buffer:f,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}(c,u)):d.version<c.version&&(function s(c,u,d){const h=u.array,f=u.updateRange;n.bindBuffer(d,c),-1===f.count?n.bufferSubData(d,0,h):(t?n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1)}(d.buffer,c,u),d.version=c.version)}}}class Wc extends Le{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const s=e/2,o=t/2,a=Math.floor(r),l=Math.floor(i),c=a+1,u=l+1,d=e/a,h=t/l,f=[],p=[],m=[],g=[];for(let v=0;v<u;v++){const y=v*h-o;for(let M=0;M<c;M++)p.push(M*d-s,-y,0),m.push(0,0,1),g.push(M/a),g.push(1-v/l)}for(let v=0;v<l;v++)for(let y=0;y<a;y++){const _=y+c*(v+1),x=y+1+c*(v+1),w=y+1+c*v;f.push(y+c*v,_,w),f.push(_,x,w)}this.setIndex(f),this.setAttribute("position",new we(p,3)),this.setAttribute("normal",new we(m,3)),this.setAttribute("uv",new we(g,2))}static fromJSON(e){return new Wc(e.width,e.height,e.widthSegments,e.heightSegments)}}const lt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},ue={common:{diffuse:{value:new ce(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Sn},uv2Transform:{value:new Sn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new $(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ce(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ce(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Sn}},sprite:{diffuse:{value:new ce(16777215)},opacity:{value:1},center:{value:new $(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Sn}}},li={basic:{uniforms:On([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.fog]),vertexShader:lt.meshbasic_vert,fragmentShader:lt.meshbasic_frag},lambert:{uniforms:On([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.fog,ue.lights,{emissive:{value:new ce(0)}}]),vertexShader:lt.meshlambert_vert,fragmentShader:lt.meshlambert_frag},phong:{uniforms:On([ue.common,ue.specularmap,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.fog,ue.lights,{emissive:{value:new ce(0)},specular:{value:new ce(1118481)},shininess:{value:30}}]),vertexShader:lt.meshphong_vert,fragmentShader:lt.meshphong_frag},standard:{uniforms:On([ue.common,ue.envmap,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.roughnessmap,ue.metalnessmap,ue.fog,ue.lights,{emissive:{value:new ce(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:lt.meshphysical_vert,fragmentShader:lt.meshphysical_frag},toon:{uniforms:On([ue.common,ue.aomap,ue.lightmap,ue.emissivemap,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.gradientmap,ue.fog,ue.lights,{emissive:{value:new ce(0)}}]),vertexShader:lt.meshtoon_vert,fragmentShader:lt.meshtoon_frag},matcap:{uniforms:On([ue.common,ue.bumpmap,ue.normalmap,ue.displacementmap,ue.fog,{matcap:{value:null}}]),vertexShader:lt.meshmatcap_vert,fragmentShader:lt.meshmatcap_frag},points:{uniforms:On([ue.points,ue.fog]),vertexShader:lt.points_vert,fragmentShader:lt.points_frag},dashed:{uniforms:On([ue.common,ue.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:lt.linedashed_vert,fragmentShader:lt.linedashed_frag},depth:{uniforms:On([ue.common,ue.displacementmap]),vertexShader:lt.depth_vert,fragmentShader:lt.depth_frag},normal:{uniforms:On([ue.common,ue.bumpmap,ue.normalmap,ue.displacementmap,{opacity:{value:1}}]),vertexShader:lt.meshnormal_vert,fragmentShader:lt.meshnormal_frag},sprite:{uniforms:On([ue.sprite,ue.fog]),vertexShader:lt.sprite_vert,fragmentShader:lt.sprite_frag},background:{uniforms:{uvTransform:{value:new Sn},t2D:{value:null}},vertexShader:lt.background_vert,fragmentShader:lt.background_frag},cube:{uniforms:On([ue.envmap,{opacity:{value:1}}]),vertexShader:lt.cube_vert,fragmentShader:lt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:lt.equirect_vert,fragmentShader:lt.equirect_frag},distanceRGBA:{uniforms:On([ue.common,ue.displacementmap,{referencePosition:{value:new S},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:lt.distanceRGBA_vert,fragmentShader:lt.distanceRGBA_frag},shadow:{uniforms:On([ue.lights,ue.fog,{color:{value:new ce(0)},opacity:{value:1}}]),vertexShader:lt.shadow_vert,fragmentShader:lt.shadow_frag}};function SV(n,e,t,r,i,s){const o=new ce(0);let l,c,a=!0===i?0:1,u=null,d=0,h=null;function p(m,g){t.buffers.color.setClear(m.r,m.g,m.b,g,s)}return{getClearColor:function(){return o},setClearColor:function(m,g=1){o.set(m),a=g,p(o,a)},getClearAlpha:function(){return a},setClearAlpha:function(m){a=m,p(o,a)},render:function f(m,g){let v=!1,y=!0===g.isScene?g.background:null;y&&y.isTexture&&(y=e.get(y));const M=n.xr,_=M.getSession&&M.getSession();_&&"additive"===_.environmentBlendMode&&(y=null),null===y?p(o,a):y&&y.isColor&&(p(y,1),v=!0),(n.autoClear||v)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),y&&(y.isCubeTexture||306===y.mapping)?(void 0===c&&(c=new Mn(new xs(1,1,1),new qr({name:"BackgroundCubeMaterial",uniforms:Wa(li.cube.uniforms),vertexShader:li.cube.vertexShader,fragmentShader:li.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(x,w,A){this.matrixWorld.copyPosition(A.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(c)),c.material.uniforms.envMap.value=y,c.material.uniforms.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,(u!==y||d!==y.version||h!==n.toneMapping)&&(c.material.needsUpdate=!0,u=y,d=y.version,h=n.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null)):y&&y.isTexture&&(void 0===l&&(l=new Mn(new Wc(2,2),new qr({name:"BackgroundMaterial",uniforms:Wa(li.background.uniforms),vertexShader:li.background.vertexShader,fragmentShader:li.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),l.material.uniforms.t2D.value=y,!0===y.matrixAutoUpdate&&y.updateMatrix(),l.material.uniforms.uvTransform.value.copy(y.matrix),(u!==y||d!==y.version||h!==n.toneMapping)&&(l.material.needsUpdate=!0,u=y,d=y.version,h=n.toneMapping),l.layers.enableAll(),m.unshift(l,l.geometry,l.material,0,0,null))}}}function EV(n,e,t,r){const i=n.getParameter(34921),s=r.isWebGL2?null:e.get("OES_vertex_array_object"),o=r.isWebGL2||null!==s,a={},l=g(null);let c=l,u=!1;function f(L){return r.isWebGL2?n.bindVertexArray(L):s.bindVertexArrayOES(L)}function p(L){return r.isWebGL2?n.deleteVertexArray(L):s.deleteVertexArrayOES(L)}function g(L){const k=[],F=[],X=[];for(let J=0;J<i;J++)k[J]=0,F[J]=0,X[J]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:k,enabledAttributes:F,attributeDivisors:X,object:L,attributes:{},index:null}}function M(){const L=c.newAttributes;for(let k=0,F=L.length;k<F;k++)L[k]=0}function _(L){x(L,0)}function x(L,k){const X=c.enabledAttributes,J=c.attributeDivisors;c.newAttributes[L]=1,0===X[L]&&(n.enableVertexAttribArray(L),X[L]=1),J[L]!==k&&((r.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](L,k),J[L]=k)}function w(){const L=c.newAttributes,k=c.enabledAttributes;for(let F=0,X=k.length;F<X;F++)k[F]!==L[F]&&(n.disableVertexAttribArray(F),k[F]=0)}function A(L,k,F,X,J,H){!0!==r.isWebGL2||5124!==F&&5125!==F?n.vertexAttribPointer(L,k,F,X,J,H):n.vertexAttribIPointer(L,k,F,J,H)}function U(){Z(),u=!0,c!==l&&(c=l,f(c.object))}function Z(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function d(L,k,F,X,J){let H=!1;if(o){const j=function m(L,k,F){const X=!0===F.wireframe;let J=a[L.id];void 0===J&&(J={},a[L.id]=J);let H=J[k.id];void 0===H&&(H={},J[k.id]=H);let j=H[X];return void 0===j&&(j=g(function h(){return r.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),H[X]=j),j}(X,F,k);c!==j&&(c=j,f(c.object)),H=function v(L,k,F,X){const J=c.attributes,H=k.attributes;let j=0;const ie=F.getAttributes();for(const ne in ie)if(ie[ne].location>=0){const Me=J[ne];let Ee=H[ne];if(void 0===Ee&&("instanceMatrix"===ne&&L.instanceMatrix&&(Ee=L.instanceMatrix),"instanceColor"===ne&&L.instanceColor&&(Ee=L.instanceColor)),void 0===Me||Me.attribute!==Ee||Ee&&Me.data!==Ee.data)return!0;j++}return c.attributesNum!==j||c.index!==X}(L,X,F,J),H&&function y(L,k,F,X){const J={},H=k.attributes;let j=0;const ie=F.getAttributes();for(const ne in ie)if(ie[ne].location>=0){let Me=H[ne];void 0===Me&&("instanceMatrix"===ne&&L.instanceMatrix&&(Me=L.instanceMatrix),"instanceColor"===ne&&L.instanceColor&&(Me=L.instanceColor));const Ee={};Ee.attribute=Me,Me&&Me.data&&(Ee.data=Me.data),J[ne]=Ee,j++}c.attributes=J,c.attributesNum=j,c.index=X}(L,X,F,J)}else{const j=!0===k.wireframe;(c.geometry!==X.id||c.program!==F.id||c.wireframe!==j)&&(c.geometry=X.id,c.program=F.id,c.wireframe=j,H=!0)}null!==J&&t.update(J,34963),(H||u)&&(u=!1,function b(L,k,F,X){if(!1===r.isWebGL2&&(L.isInstancedMesh||X.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;M();const J=X.attributes,H=F.getAttributes(),j=k.defaultAttributeValues;for(const ie in H){const ne=H[ie];if(ne.location>=0){let le=J[ie];if(void 0===le&&("instanceMatrix"===ie&&L.instanceMatrix&&(le=L.instanceMatrix),"instanceColor"===ie&&L.instanceColor&&(le=L.instanceColor)),void 0!==le){const Me=le.normalized,Ee=le.itemSize,q=t.get(le);if(void 0===q)continue;const ht=q.buffer,Ie=q.type,je=q.bytesPerElement;if(le.isInterleavedBufferAttribute){const ae=le.data,et=ae.stride,K=le.offset;if(ae.isInstancedInterleavedBuffer){for(let Y=0;Y<ne.locationSize;Y++)x(ne.location+Y,ae.meshPerAttribute);!0!==L.isInstancedMesh&&void 0===X._maxInstanceCount&&(X._maxInstanceCount=ae.meshPerAttribute*ae.count)}else for(let Y=0;Y<ne.locationSize;Y++)_(ne.location+Y);n.bindBuffer(34962,ht);for(let Y=0;Y<ne.locationSize;Y++)A(ne.location+Y,Ee/ne.locationSize,Ie,Me,et*je,(K+Ee/ne.locationSize*Y)*je)}else{if(le.isInstancedBufferAttribute){for(let ae=0;ae<ne.locationSize;ae++)x(ne.location+ae,le.meshPerAttribute);!0!==L.isInstancedMesh&&void 0===X._maxInstanceCount&&(X._maxInstanceCount=le.meshPerAttribute*le.count)}else for(let ae=0;ae<ne.locationSize;ae++)_(ne.location+ae);n.bindBuffer(34962,ht);for(let ae=0;ae<ne.locationSize;ae++)A(ne.location+ae,Ee/ne.locationSize,Ie,Me,Ee*je,Ee/ne.locationSize*ae*je)}}else if(void 0!==j){const Me=j[ie];if(void 0!==Me)switch(Me.length){case 2:n.vertexAttrib2fv(ne.location,Me);break;case 3:n.vertexAttrib3fv(ne.location,Me);break;case 4:n.vertexAttrib4fv(ne.location,Me);break;default:n.vertexAttrib1fv(ne.location,Me)}}}}w()}(L,k,F,X),null!==J&&n.bindBuffer(34963,t.get(J).buffer))},reset:U,resetDefaultState:Z,dispose:function C(){U();for(const L in a){const k=a[L];for(const F in k){const X=k[F];for(const J in X)p(X[J].object),delete X[J];delete k[F]}delete a[L]}},releaseStatesOfGeometry:function R(L){if(void 0===a[L.id])return;const k=a[L.id];for(const F in k){const X=k[F];for(const J in X)p(X[J].object),delete X[J];delete k[F]}delete a[L.id]},releaseStatesOfProgram:function P(L){for(const k in a){const F=a[k];if(void 0===F[L.id])continue;const X=F[L.id];for(const J in X)p(X[J].object),delete X[J];delete F[L.id]}},initAttributes:M,enableAttribute:_,disableUnusedAttributes:w}}function CV(n,e,t,r){const i=r.isWebGL2;let s;this.setMode=function o(c){s=c},this.render=function a(c,u){n.drawArrays(s,c,u),t.update(u,s,1)},this.renderInstances=function l(c,u,d){if(0===d)return;let h,f;if(i)h=n,f="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",null===h)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[f](s,c,u,d),t.update(u,s,d)}}function DV(n,e,t){let r;function s(A){if("highp"===A){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";A="mediump"}return"mediump"===A&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&n instanceof WebGL2ComputeRenderingContext;let a=void 0!==t.precision?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=!0===t.logarithmicDepthBuffer,d=n.getParameter(34930),h=n.getParameter(35660),f=n.getParameter(3379),p=n.getParameter(34076),m=n.getParameter(34921),g=n.getParameter(36347),v=n.getParameter(36348),y=n.getParameter(36349),M=h>0,_=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:function i(){if(void 0!==r)return r;if(!0===e.has("EXT_texture_filter_anisotropic")){const A=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:g,maxVaryings:v,maxFragmentUniforms:y,vertexTextures:M,floatFragmentTextures:_,floatVertexTextures:M&&_,maxSamples:o?n.getParameter(36183):0}}function TV(n){const e=this;let t=null,r=0,i=!1,s=!1;const o=new ji,a=new Sn,l={value:null,needsUpdate:!1};function c(){l.value!==t&&(l.value=t,l.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function u(d,h,f,p){const m=null!==d?d.length:0;let g=null;if(0!==m){if(g=l.value,!0!==p||null===g){const v=f+4*m,y=h.matrixWorldInverse;a.getNormalMatrix(y),(null===g||g.length<v)&&(g=new Float32Array(v));for(let M=0,_=f;M!==m;++M,_+=4)o.copy(d[M]).applyMatrix4(y,a),o.normal.toArray(g,_),g[_+3]=o.constant}l.value=g,l.needsUpdate=!0}return e.numPlanes=m,e.numIntersection=0,g}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h,f){const p=0!==d.length||h||0!==r||i;return i=h,t=u(d,f,0),r=d.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(d,h,f){const p=d.clippingPlanes,m=d.clipIntersection,g=d.clipShadows,v=n.get(d);if(!i||null===p||0===p.length||s&&!g)s?u(null):c();else{const y=s?0:r,M=4*y;let _=v.clippingState||null;l.value=_,_=u(p,h,M,f);for(let x=0;x!==M;++x)_[x]=t[x];v.clippingState=_,this.numIntersection=m?this.numPlanes:0,this.numPlanes+=y}}}function NV(n){let e=new WeakMap;function t(o,a){return 303===a?o.mapping=301:304===a&&(o.mapping=302),o}function i(o){const a=o.target;a.removeEventListener("dispose",i);const l=e.get(a);void 0!==l&&(e.delete(a),l.dispose())}return{get:function r(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(303===a||304===a){if(e.has(o))return t(e.get(o).texture,o.mapping);{const l=o.image;if(l&&l.height>0){const c=new EC(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",i),t(c.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}li.physical={uniforms:On([li.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new $(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new ce(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new $},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ce(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ce(1,1,1)},specularColorMap:{value:null}}]),vertexShader:lt.meshphysical_vert,fragmentShader:lt.meshphysical_frag};class ws extends Ph{constructor(e=-1,t=1,r=1,i=-1,s=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=r-e,o=r+e,a=i+t,l=i-t;if(null!==this.view&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}ws.prototype.isOrthographicCamera=!0;const DC=[.125,.215,.35,.446,.526,.582],ov=new ws,TC=new ce;let av=null;const po=(1+Math.sqrt(5))/2,Ya=1/po,NC=[new S(1,1,1),new S(-1,1,1),new S(1,1,-1),new S(-1,1,-1),new S(0,po,Ya),new S(0,po,-Ya),new S(Ya,0,po),new S(-Ya,0,po),new S(po,Ya,0),new S(-po,Ya,0)];class AC{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){av=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,r,i,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=PC(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=RC(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(av),e.scissorTest=!1,Oh(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),av=this._renderer.getRenderTarget();const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:an,minFilter:an,generateMipmaps:!1,type:Fc,format:Dr,encoding:Oi,depthBuffer:!1},i=IC(e,t,r);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=IC(e,t,r);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function AV(n){const e=[],t=[],r=[];let i=n;const s=n-4+1+DC.length;for(let o=0;o<s;o++){const a=Math.pow(2,i);t.push(a);let l=1/a;o>n-4?l=DC[o-n+4-1]:0===o&&(l=0),r.push(l);const c=1/(a-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,m=3,g=2,v=1,y=new Float32Array(m*p*f),M=new Float32Array(g*p*f),_=new Float32Array(v*p*f);for(let w=0;w<f;w++){const A=w%3*2/3-1,b=w>2?0:-1;y.set([A,b,0,A+2/3,b,0,A+2/3,b+1,0,A,b,0,A+2/3,b+1,0,A,b+1,0],m*p*w),M.set(h,g*p*w),_.set([w,w,w,w,w,w],v*p*w)}const x=new Le;x.setAttribute("position",new Pt(y,m)),x.setAttribute("uv",new Pt(M,g)),x.setAttribute("faceIndex",new Pt(_,v)),e.push(x),i>4&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}(s)),this._blurMaterial=function IV(n,e,t){const r=new Float32Array(20),i=new S(0,1,0);return new qr({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(s,e,t)}return i}_compileMaterial(e){const t=new Mn(this._lodPlanes[0],e);this._renderer.compile(t,ov)}_sceneToCubeUV(e,t,r,i){const a=new Ut(90,1,t,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(TC),u.toneMapping=0,u.autoClear=!1;const f=new vs({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new Mn(new xs,f);let m=!1;const g=e.background;g?g.isColor&&(f.color.copy(g),e.background=null,m=!0):(f.color.copy(TC),m=!0);for(let v=0;v<6;v++){const y=v%3;0===y?(a.up.set(0,l[v],0),a.lookAt(c[v],0,0)):1===y?(a.up.set(0,0,l[v]),a.lookAt(0,c[v],0)):(a.up.set(0,l[v],0),a.lookAt(0,0,c[v]));const M=this._cubeSize;Oh(i,y*M,v>2?M:0,M,M),u.setRenderTarget(i),m&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=g}_textureToCubeUV(e,t){const r=this._renderer,i=301===e.mapping||302===e.mapping;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=PC()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=RC());const s=i?this._cubemapMaterial:this._equirectMaterial,o=new Mn(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const l=this._cubeSize;Oh(t,0,0,3*l,2*l),r.setRenderTarget(t),r.render(o,ov)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const s=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]);this._blur(e,i-1,i,s,NC[(i-1)%NC.length])}t.autoClear=r}_blur(e,t,r,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,r,i,"latitudinal",s),this._halfBlur(o,e,r,r,i,"longitudinal",s)}_halfBlur(e,t,r,i,s,o,a){const l=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new Mn(this._lodPlanes[i],c),h=c.uniforms,f=this._sizeLods[r]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/39,m=s/p,g=isFinite(s)?1+Math.floor(3*m):20;g>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${g} samples when the maximum is set to 20`);const v=[];let y=0;for(let A=0;A<20;++A){const b=A/m,C=Math.exp(-b*b/2);v.push(C),0===A?y+=C:A<g&&(y+=2*C)}for(let A=0;A<v.length;A++)v[A]=v[A]/y;h.envMap.value=e.texture,h.samples.value=g,h.weights.value=v,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a);const{_lodMax:M}=this;h.dTheta.value=p,h.mipInt.value=M-r;const _=this._sizeLods[i];Oh(t,3*_*(i>M-4?i-M+4:0),4*(this._cubeSize-_),3*_,2*_),l.setRenderTarget(t),l.render(d,ov)}}function IC(n,e,t){const r=new dr(n,e,t);return r.texture.mapping=306,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Oh(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function RC(){return new qr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function PC(){return new qr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function RV(n){let e=new WeakMap,t=null;function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);void 0!==c&&(e.delete(l),c.dispose())}return{get:function r(a){if(a&&a.isTexture){const l=a.mapping,c=303===l||304===l,u=301===l||302===l;if(c||u){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let d=e.get(a);return null===t&&(t=new AC(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||u&&d&&function i(a){let l=0;for(let u=0;u<6;u++)void 0!==a[u]&&l++;return 6===l}(d)){null===t&&(t=new AC(n));const h=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,h),a.addEventListener("dispose",s),h.texture}return null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function PV(n){const e={};function t(r){if(void 0!==e[r])return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return null!==t(r)},init:function(r){r.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(r){const i=t(r);return null===i&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function LV(n,e,t,r){const i={},s=new WeakMap;function o(d){const h=d.target;null!==h.index&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);h.removeEventListener("dispose",o),delete i[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),r.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,t.memory.geometries--}function c(d){const h=[],f=d.index,p=d.attributes.position;let m=0;if(null!==f){const y=f.array;m=f.version;for(let M=0,_=y.length;M<_;M+=3){const x=y[M+0],w=y[M+1],A=y[M+2];h.push(x,w,w,A,A,x)}}else{m=p.version;for(let M=0,_=p.array.length/3-1;M<_;M+=3){const x=M+0,w=M+1,A=M+2;h.push(x,w,w,A,A,x)}}const g=new(uC(h)?wC:xC)(h,1);g.version=m;const v=s.get(d);v&&e.remove(v),s.set(d,g)}return{get:function a(d,h){return!0===i[h.id]||(h.addEventListener("dispose",o),i[h.id]=!0,t.memory.geometries++),h},update:function l(d){const h=d.attributes;for(const p in h)e.update(h[p],34962);const f=d.morphAttributes;for(const p in f){const m=f[p];for(let g=0,v=m.length;g<v;g++)e.update(m[g],34962)}},getWireframeAttribute:function u(d){const h=s.get(d);if(h){const f=d.index;null!==f&&h.version<f.version&&c(d)}else c(d);return s.get(d)}}}function FV(n,e,t,r){const i=r.isWebGL2;let s,a,l;this.setMode=function o(h){s=h},this.setIndex=function c(h){a=h.type,l=h.bytesPerElement},this.render=function u(h,f){n.drawElements(s,f,a,h*l),t.update(f,s,1)},this.renderInstances=function d(h,f,p){if(0===p)return;let m,g;if(i)m=n,g="drawElementsInstanced";else if(m=e.get("ANGLE_instanced_arrays"),g="drawElementsInstancedANGLE",null===m)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");m[g](s,f,a,h*l,p),t.update(f,s,p)}}function OV(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function i(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function r(s,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(s/3);break;case 1:t.lines+=a*(s/2);break;case 3:t.lines+=a*(s-1);break;case 2:t.lines+=a*s;break;case 0:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function kV(n,e){return n[0]-e[0]}function BV(n,e){return Math.abs(e[1])-Math.abs(n[1])}function cv(n,e){let t=1;const r=e.isInterleavedBufferAttribute?e.data.array:e.array;r instanceof Int8Array?t=127:r instanceof Int16Array?t=32767:r instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),n.divideScalar(t)}function UV(n,e,t){const r={},i=new Float32Array(8),s=new WeakMap,o=new wt,a=[];for(let c=0;c<8;c++)a[c]=[c,0];return{update:function l(c,u,d,h){const f=c.morphTargetInfluences;if(!0===e.isWebGL2){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,m=void 0!==p?p.length:0;let g=s.get(u);if(void 0===g||g.count!==m){let k=function(){Z.dispose(),s.delete(u),u.removeEventListener("dispose",k)};void 0!==g&&g.texture.dispose();const M=void 0!==u.morphAttributes.position,_=void 0!==u.morphAttributes.normal,x=void 0!==u.morphAttributes.color,w=u.morphAttributes.position||[],A=u.morphAttributes.normal||[],b=u.morphAttributes.color||[];let C=0;!0===M&&(C=1),!0===_&&(C=2),!0===x&&(C=3);let R=u.attributes.position.count*C,P=1;R>e.maxTextureSize&&(P=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const U=new Float32Array(R*P*4*m),Z=new mh(U,R,P,m);Z.type=hs,Z.needsUpdate=!0;const L=4*C;for(let F=0;F<m;F++){const X=w[F],J=A[F],H=b[F],j=R*P*4*F;for(let ie=0;ie<X.count;ie++){const ne=ie*L;!0===M&&(o.fromBufferAttribute(X,ie),!0===X.normalized&&cv(o,X),U[j+ne+0]=o.x,U[j+ne+1]=o.y,U[j+ne+2]=o.z,U[j+ne+3]=0),!0===_&&(o.fromBufferAttribute(J,ie),!0===J.normalized&&cv(o,J),U[j+ne+4]=o.x,U[j+ne+5]=o.y,U[j+ne+6]=o.z,U[j+ne+7]=0),!0===x&&(o.fromBufferAttribute(H,ie),!0===H.normalized&&cv(o,H),U[j+ne+8]=o.x,U[j+ne+9]=o.y,U[j+ne+10]=o.z,U[j+ne+11]=4===H.itemSize?o.w:1)}}g={count:m,texture:Z,size:new $(R,P)},s.set(u,g),u.addEventListener("dispose",k)}let v=0;for(let M=0;M<f.length;M++)v+=f[M];const y=u.morphTargetsRelative?1:1-v;h.getUniforms().setValue(n,"morphTargetBaseInfluence",y),h.getUniforms().setValue(n,"morphTargetInfluences",f),h.getUniforms().setValue(n,"morphTargetsTexture",g.texture,t),h.getUniforms().setValue(n,"morphTargetsTextureSize",g.size)}else{const p=void 0===f?0:f.length;let m=r[u.id];if(void 0===m||m.length!==p){m=[];for(let _=0;_<p;_++)m[_]=[_,0];r[u.id]=m}for(let _=0;_<p;_++){const x=m[_];x[0]=_,x[1]=f[_]}m.sort(BV);for(let _=0;_<8;_++)_<p&&m[_][1]?(a[_][0]=m[_][0],a[_][1]=m[_][1]):(a[_][0]=Number.MAX_SAFE_INTEGER,a[_][1]=0);a.sort(kV);const g=u.morphAttributes.position,v=u.morphAttributes.normal;let y=0;for(let _=0;_<8;_++){const x=a[_],w=x[0],A=x[1];w!==Number.MAX_SAFE_INTEGER&&A?(g&&u.getAttribute("morphTarget"+_)!==g[w]&&u.setAttribute("morphTarget"+_,g[w]),v&&u.getAttribute("morphNormal"+_)!==v[w]&&u.setAttribute("morphNormal"+_,v[w]),i[_]=A,y+=A):(g&&!0===u.hasAttribute("morphTarget"+_)&&u.deleteAttribute("morphTarget"+_),v&&!0===u.hasAttribute("morphNormal"+_)&&u.deleteAttribute("morphNormal"+_),i[_]=0)}const M=u.morphTargetsRelative?1:1-y;h.getUniforms().setValue(n,"morphTargetBaseInfluence",M),h.getUniforms().setValue(n,"morphTargetInfluences",i)}}}}function HV(n,e,t,r){let i=new WeakMap;function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),null!==c.instanceColor&&t.remove(c.instanceColor)}return{update:function s(l){const c=r.render.frame,d=e.get(l,l.geometry);return i.get(d)!==c&&(e.update(d),i.set(d,c)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",a)&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),null!==l.instanceColor&&t.update(l.instanceColor,34962)),d},dispose:function o(){i=new WeakMap}}}const LC=new zn,FC=new mh,OC=new Hy,kC=new jc,BC=[],UC=[],HC=new Float32Array(16),GC=new Float32Array(9),VC=new Float32Array(4);function Ja(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let s=BC[i];if(void 0===s&&(s=new Float32Array(i),BC[i]=s),0!==e){r.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function jn(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Wn(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function kh(n,e){let t=UC[e];void 0===t&&(t=new Int32Array(e),UC[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function GV(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function VV(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(jn(t,e))return;n.uniform2fv(this.addr,e),Wn(t,e)}}function zV(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(jn(t,e))return;n.uniform3fv(this.addr,e),Wn(t,e)}}function jV(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(jn(t,e))return;n.uniform4fv(this.addr,e),Wn(t,e)}}function WV(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(jn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Wn(t,e)}else{if(jn(t,r))return;VC.set(r),n.uniformMatrix2fv(this.addr,!1,VC),Wn(t,r)}}function $V(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(jn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Wn(t,e)}else{if(jn(t,r))return;GC.set(r),n.uniformMatrix3fv(this.addr,!1,GC),Wn(t,r)}}function qV(n,e){const t=this.cache,r=e.elements;if(void 0===r){if(jn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Wn(t,e)}else{if(jn(t,r))return;HC.set(r),n.uniformMatrix4fv(this.addr,!1,HC),Wn(t,r)}}function ZV(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function XV(n,e){const t=this.cache;jn(t,e)||(n.uniform2iv(this.addr,e),Wn(t,e))}function YV(n,e){const t=this.cache;jn(t,e)||(n.uniform3iv(this.addr,e),Wn(t,e))}function JV(n,e){const t=this.cache;jn(t,e)||(n.uniform4iv(this.addr,e),Wn(t,e))}function KV(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function QV(n,e){const t=this.cache;jn(t,e)||(n.uniform2uiv(this.addr,e),Wn(t,e))}function ez(n,e){const t=this.cache;jn(t,e)||(n.uniform3uiv(this.addr,e),Wn(t,e))}function tz(n,e){const t=this.cache;jn(t,e)||(n.uniform4uiv(this.addr,e),Wn(t,e))}function nz(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2D(e||LC,i)}function rz(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||OC,i)}function iz(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||kC,i)}function sz(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||FC,i)}function az(n,e){n.uniform1fv(this.addr,e)}function lz(n,e){const t=Ja(e,this.size,2);n.uniform2fv(this.addr,t)}function cz(n,e){const t=Ja(e,this.size,3);n.uniform3fv(this.addr,t)}function uz(n,e){const t=Ja(e,this.size,4);n.uniform4fv(this.addr,t)}function dz(n,e){const t=Ja(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function hz(n,e){const t=Ja(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function fz(n,e){const t=Ja(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function pz(n,e){n.uniform1iv(this.addr,e)}function gz(n,e){n.uniform2iv(this.addr,e)}function mz(n,e){n.uniform3iv(this.addr,e)}function yz(n,e){n.uniform4iv(this.addr,e)}function vz(n,e){n.uniform1uiv(this.addr,e)}function _z(n,e){n.uniform2uiv(this.addr,e)}function Mz(n,e){n.uniform3uiv(this.addr,e)}function bz(n,e){n.uniform4uiv(this.addr,e)}function xz(n,e,t){const r=e.length,i=kh(t,r);n.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)t.setTexture2D(e[s]||LC,i[s])}function wz(n,e,t){const r=e.length,i=kh(t,r);n.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)t.setTexture3D(e[s]||OC,i[s])}function Sz(n,e,t){const r=e.length,i=kh(t,r);n.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)t.setTextureCube(e[s]||kC,i[s])}function Ez(n,e,t){const r=e.length,i=kh(t,r);n.uniform1iv(this.addr,i);for(let s=0;s!==r;++s)t.setTexture2DArray(e[s]||FC,i[s])}function Dz(n,e,t){this.id=n,this.addr=t,this.cache=[],this.setValue=function oz(n){switch(n){case 5126:return GV;case 35664:return VV;case 35665:return zV;case 35666:return jV;case 35674:return WV;case 35675:return $V;case 35676:return qV;case 5124:case 35670:return ZV;case 35667:case 35671:return XV;case 35668:case 35672:return YV;case 35669:case 35673:return JV;case 5125:return KV;case 36294:return QV;case 36295:return ez;case 36296:return tz;case 35678:case 36198:case 36298:case 36306:case 35682:return nz;case 35679:case 36299:case 36307:return rz;case 35680:case 36300:case 36308:case 36293:return iz;case 36289:case 36303:case 36311:case 36292:return sz}}(e.type)}function Tz(n,e,t){this.id=n,this.addr=t,this.cache=[],this.size=e.size,this.setValue=function Cz(n){switch(n){case 5126:return az;case 35664:return lz;case 35665:return cz;case 35666:return uz;case 35674:return dz;case 35675:return hz;case 35676:return fz;case 5124:case 35670:return pz;case 35667:case 35671:return gz;case 35668:case 35672:return mz;case 35669:case 35673:return yz;case 5125:return vz;case 36294:return _z;case 36295:return Mz;case 36296:return bz;case 35678:case 36198:case 36298:case 36306:case 35682:return xz;case 35679:case 36299:case 36307:return wz;case 35680:case 36300:case 36308:case 36293:return Sz;case 36289:case 36303:case 36311:case 36292:return Ez}}(e.type)}function zC(n){this.id=n,this.seq=[],this.map={}}zC.prototype.setValue=function(n,e,t){const r=this.seq;for(let i=0,s=r.length;i!==s;++i){const o=r[i];o.setValue(n,e[o.id],t)}};const uv=/(\w+)(\])?(\[|\.)?/g;function jC(n,e){n.seq.push(e),n.map[e.id]=e}function Nz(n,e,t){const r=n.name,i=r.length;for(uv.lastIndex=0;;){const s=uv.exec(r),o=uv.lastIndex;let a=s[1];const c=s[3];if("]"===s[2]&&(a|=0),void 0===c||"["===c&&o+2===i){jC(t,void 0===c?new Dz(a,n,e):new Tz(a,n,e));break}{let d=t.map[a];void 0===d&&(d=new zC(a),jC(t,d)),t=d}}}function Ss(n,e){this.seq=[],this.map={};const t=n.getProgramParameter(e,35718);for(let r=0;r<t;++r){const i=n.getActiveUniform(e,r);Nz(i,n.getUniformLocation(e,i.name),this)}}function WC(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}Ss.prototype.setValue=function(n,e,t,r){const i=this.map[e];void 0!==i&&i.setValue(n,t,r)},Ss.prototype.setOptional=function(n,e,t){const r=e[t];void 0!==r&&this.setValue(n,t,r)},Ss.upload=function(n,e,t,r){for(let i=0,s=e.length;i!==s;++i){const o=e[i],a=t[o.id];!1!==a.needsUpdate&&o.setValue(n,a.value,r)}},Ss.seqWithValue=function(n,e){const t=[];for(let r=0,i=n.length;r!==i;++r){const s=n[r];s.id in e&&t.push(s)}return t};let Az=0;function $C(n,e,t){const r=n.getShaderParameter(e,35713),i=n.getShaderInfoLog(e).trim();if(r&&""===i)return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const o=parseInt(s[0]);return t.toUpperCase()+"\n\n"+i+"\n\n"+function Iz(n,e){const t=n.split("\n"),r=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++)r.push(o+1+": "+t[o]);return r.join("\n")}(n.getShaderSource(e),o)}return i}function Pz(n,e){const t=function Rz(n){switch(n){case Oi:return["Linear","( value )"];case Rt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function Lz(n,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function $c(n){return""!==n}function qC(n,e){return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ZC(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const Bz=/^[ \t]*#include +<([\w\d./]+)>/gm;function dv(n){return n.replace(Bz,Uz)}function Uz(n,e){const t=lt[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return dv(t)}const Hz=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Gz=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function XC(n){return n.replace(Gz,YC).replace(Hz,Vz)}function Vz(n,e,t,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),YC(0,e,t,r)}function YC(n,e,t,r){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function JC(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function Zz(n,e,t,r){const i=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=function zz(n){let e="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),c=function jz(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function Wz(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(e="ENVMAP_MODE_REFRACTION"),e}(t),d=function $z(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),h=function qz(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}(t),f=t.isWebGL2?"":function Fz(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter($c).join("\n")}(t),p=function Oz(n){const e=[];for(const t in n){const r=n[t];!1!==r&&e.push("#define "+t+" "+r)}return e.join("\n")}(s),m=i.createProgram();let g,v,y=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(g=[p].filter($c).join("\n"),g.length>0&&(g+="\n"),v=[f,p].filter($c).join("\n"),v.length>0&&(v+="\n")):(g=[JC(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter($c).join("\n"),v=[f,JC(t),"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?lt.tonemapping_pars_fragment:"",0!==t.toneMapping?Lz("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",lt.encodings_pars_fragment,Pz("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter($c).join("\n")),o=dv(o),o=qC(o,t),o=ZC(o,t),a=dv(a),a=qC(a,t),a=ZC(a,t),o=XC(o),a=XC(a),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(y="#version 300 es\n",g=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+g,v=["#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+v);const _=y+v+a,x=WC(i,35633,y+g+o),w=WC(i,35632,_);if(i.attachShader(m,x),i.attachShader(m,w),void 0!==t.index0AttributeName?i.bindAttribLocation(m,0,t.index0AttributeName):!0===t.morphTargets&&i.bindAttribLocation(m,0,"position"),i.linkProgram(m),n.debug.checkShaderErrors){const C=i.getProgramInfoLog(m).trim(),R=i.getShaderInfoLog(x).trim(),P=i.getShaderInfoLog(w).trim();let U=!0,Z=!0;if(!1===i.getProgramParameter(m,35714)){U=!1;const L=$C(i,x,"vertex"),k=$C(i,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(m,35715)+"\n\nProgram Info Log: "+C+"\n"+L+"\n"+k)}else""!==C?console.warn("THREE.WebGLProgram: Program Info Log:",C):(""===R||""===P)&&(Z=!1);Z&&(this.diagnostics={runnable:U,programLog:C,vertexShader:{log:R,prefix:g},fragmentShader:{log:P,prefix:v}})}let A,b;return i.deleteShader(x),i.deleteShader(w),this.getUniforms=function(){return void 0===A&&(A=new Ss(i,m)),A},this.getAttributes=function(){return void 0===b&&(b=function kz(n,e){const t={},r=n.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i),o=s.name;let a=1;35674===s.type&&(a=2),35675===s.type&&(a=3),35676===s.type&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(i,m)),b},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(m),this.program=void 0},this.name=t.shaderName,this.id=Az++,this.cacheKey=e,this.usedTimes=1,this.program=m,this.vertexShader=x,this.fragmentShader=w,this}let Xz=0;class Yz{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const r=e.fragmentShader,i=this._getShaderStage(e.vertexShader),s=this._getShaderStage(r),o=this._getShaderCacheForMaterial(e);return!1===o.has(i)&&(o.add(i),i.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const r=new Jz(e);t.set(e,r)}return t.get(e)}}class Jz{constructor(e){this.id=Xz++,this.code=e,this.usedTimes=0}}function Kz(n,e,t,r,i,s,o){const a=new Ua,l=new Yz,c=[],u=i.isWebGL2,d=i.logarithmicDepthBuffer,h=i.vertexTextures;let f=i.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function m(b,C,R,P,U){const Z=P.fog,L=U.geometry,F=(b.isMeshStandardMaterial?t:e).get(b.envMap||(b.isMeshStandardMaterial?P.environment:null)),X=F&&306===F.mapping?F.image.height:null,J=p[b.type];null!==b.precision&&(f=i.getMaxPrecision(b.precision),f!==b.precision&&console.warn("THREE.WebGLProgram.getParameters:",b.precision,"not supported, using",f,"instead."));const H=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,j=void 0!==H?H.length:0;let ne,le,Me,Ee,ie=0;if(void 0!==L.morphAttributes.position&&(ie=1),void 0!==L.morphAttributes.normal&&(ie=2),void 0!==L.morphAttributes.color&&(ie=3),J){const ae=li[J];ne=ae.vertexShader,le=ae.fragmentShader}else ne=b.vertexShader,le=b.fragmentShader,l.update(b),Me=l.getVertexShaderID(b),Ee=l.getFragmentShaderID(b);const q=n.getRenderTarget(),Ie=b.clearcoat>0;return{isWebGL2:u,shaderID:J,shaderName:b.type,vertexShader:ne,fragmentShader:le,defines:b.defines,customVertexShaderID:Me,customFragmentShaderID:Ee,isRawShaderMaterial:!0===b.isRawShaderMaterial,glslVersion:b.glslVersion,precision:f,instancing:!0===U.isInstancedMesh,instancingColor:!0===U.isInstancedMesh&&null!==U.instanceColor,supportsVertexTextures:h,outputEncoding:null===q?n.outputEncoding:!0===q.isXRRenderTarget?q.texture.encoding:Oi,map:!!b.map,matcap:!!b.matcap,envMap:!!F,envMapMode:F&&F.mapping,envMapCubeUVHeight:X,lightMap:!!b.lightMap,aoMap:!!b.aoMap,emissiveMap:!!b.emissiveMap,bumpMap:!!b.bumpMap,normalMap:!!b.normalMap,objectSpaceNormalMap:1===b.normalMapType,tangentSpaceNormalMap:0===b.normalMapType,decodeVideoTexture:!!b.map&&!0===b.map.isVideoTexture&&b.map.encoding===Rt,clearcoat:Ie,clearcoatMap:Ie&&!!b.clearcoatMap,clearcoatRoughnessMap:Ie&&!!b.clearcoatRoughnessMap,clearcoatNormalMap:Ie&&!!b.clearcoatNormalMap,displacementMap:!!b.displacementMap,roughnessMap:!!b.roughnessMap,metalnessMap:!!b.metalnessMap,specularMap:!!b.specularMap,specularIntensityMap:!!b.specularIntensityMap,specularColorMap:!!b.specularColorMap,opaque:!1===b.transparent&&1===b.blending,alphaMap:!!b.alphaMap,alphaTest:b.alphaTest>0,gradientMap:!!b.gradientMap,sheen:b.sheen>0,sheenColorMap:!!b.sheenColorMap,sheenRoughnessMap:!!b.sheenRoughnessMap,transmission:b.transmission>0,transmissionMap:!!b.transmissionMap,thicknessMap:!!b.thicknessMap,combine:b.combine,vertexTangents:!!b.normalMap&&!!L.attributes.tangent,vertexColors:b.vertexColors,vertexAlphas:!0===b.vertexColors&&!!L.attributes.color&&4===L.attributes.color.itemSize,vertexUvs:!!(b.map||b.bumpMap||b.normalMap||b.specularMap||b.alphaMap||b.emissiveMap||b.roughnessMap||b.metalnessMap||b.clearcoatMap||b.clearcoatRoughnessMap||b.clearcoatNormalMap||b.displacementMap||b.transmissionMap||b.thicknessMap||b.specularIntensityMap||b.specularColorMap||b.sheenColorMap||b.sheenRoughnessMap),uvsVertexOnly:!(b.map||b.bumpMap||b.normalMap||b.specularMap||b.alphaMap||b.emissiveMap||b.roughnessMap||b.metalnessMap||b.clearcoatNormalMap||b.transmission>0||b.transmissionMap||b.thicknessMap||b.specularIntensityMap||b.specularColorMap||b.sheen>0||b.sheenColorMap||b.sheenRoughnessMap||!b.displacementMap),fog:!!Z,useFog:!0===b.fog,fogExp2:Z&&Z.isFogExp2,flatShading:!!b.flatShading,sizeAttenuation:b.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===U.isSkinnedMesh,morphTargets:void 0!==L.morphAttributes.position,morphNormals:void 0!==L.morphAttributes.normal,morphColors:void 0!==L.morphAttributes.color,morphTargetsCount:j,morphTextureStride:ie,numDirLights:C.directional.length,numPointLights:C.point.length,numSpotLights:C.spot.length,numRectAreaLights:C.rectArea.length,numHemiLights:C.hemi.length,numDirLightShadows:C.directionalShadowMap.length,numPointLightShadows:C.pointShadowMap.length,numSpotLightShadows:C.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:b.dithering,shadowMapEnabled:n.shadowMap.enabled&&R.length>0,shadowMapType:n.shadowMap.type,toneMapping:b.toneMapped?n.toneMapping:0,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:b.premultipliedAlpha,doubleSided:2===b.side,flipSided:1===b.side,useDepthPacking:!!b.depthPacking,depthPacking:b.depthPacking||0,index0AttributeName:b.index0AttributeName,extensionDerivatives:b.extensions&&b.extensions.derivatives,extensionFragDepth:b.extensions&&b.extensions.fragDepth,extensionDrawBuffers:b.extensions&&b.extensions.drawBuffers,extensionShaderTextureLOD:b.extensions&&b.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||r.has("EXT_shader_texture_lod"),customProgramCacheKey:b.customProgramCacheKey()}},getProgramCacheKey:function g(b){const C=[];if(b.shaderID?C.push(b.shaderID):(C.push(b.customVertexShaderID),C.push(b.customFragmentShaderID)),void 0!==b.defines)for(const R in b.defines)C.push(R),C.push(b.defines[R]);return!1===b.isRawShaderMaterial&&(function v(b,C){b.push(C.precision),b.push(C.outputEncoding),b.push(C.envMapMode),b.push(C.envMapCubeUVHeight),b.push(C.combine),b.push(C.vertexUvs),b.push(C.fogExp2),b.push(C.sizeAttenuation),b.push(C.morphTargetsCount),b.push(C.morphAttributeCount),b.push(C.numDirLights),b.push(C.numPointLights),b.push(C.numSpotLights),b.push(C.numHemiLights),b.push(C.numRectAreaLights),b.push(C.numDirLightShadows),b.push(C.numPointLightShadows),b.push(C.numSpotLightShadows),b.push(C.shadowMapType),b.push(C.toneMapping),b.push(C.numClippingPlanes),b.push(C.numClipIntersection),b.push(C.depthPacking)}(C,b),function y(b,C){a.disableAll(),C.isWebGL2&&a.enable(0),C.supportsVertexTextures&&a.enable(1),C.instancing&&a.enable(2),C.instancingColor&&a.enable(3),C.map&&a.enable(4),C.matcap&&a.enable(5),C.envMap&&a.enable(6),C.lightMap&&a.enable(7),C.aoMap&&a.enable(8),C.emissiveMap&&a.enable(9),C.bumpMap&&a.enable(10),C.normalMap&&a.enable(11),C.objectSpaceNormalMap&&a.enable(12),C.tangentSpaceNormalMap&&a.enable(13),C.clearcoat&&a.enable(14),C.clearcoatMap&&a.enable(15),C.clearcoatRoughnessMap&&a.enable(16),C.clearcoatNormalMap&&a.enable(17),C.displacementMap&&a.enable(18),C.specularMap&&a.enable(19),C.roughnessMap&&a.enable(20),C.metalnessMap&&a.enable(21),C.gradientMap&&a.enable(22),C.alphaMap&&a.enable(23),C.alphaTest&&a.enable(24),C.vertexColors&&a.enable(25),C.vertexAlphas&&a.enable(26),C.vertexUvs&&a.enable(27),C.vertexTangents&&a.enable(28),C.uvsVertexOnly&&a.enable(29),C.fog&&a.enable(30),b.push(a.mask),a.disableAll(),C.useFog&&a.enable(0),C.flatShading&&a.enable(1),C.logarithmicDepthBuffer&&a.enable(2),C.skinning&&a.enable(3),C.morphTargets&&a.enable(4),C.morphNormals&&a.enable(5),C.morphColors&&a.enable(6),C.premultipliedAlpha&&a.enable(7),C.shadowMapEnabled&&a.enable(8),C.physicallyCorrectLights&&a.enable(9),C.doubleSided&&a.enable(10),C.flipSided&&a.enable(11),C.useDepthPacking&&a.enable(12),C.dithering&&a.enable(13),C.specularIntensityMap&&a.enable(14),C.specularColorMap&&a.enable(15),C.transmission&&a.enable(16),C.transmissionMap&&a.enable(17),C.thicknessMap&&a.enable(18),C.sheen&&a.enable(19),C.sheenColorMap&&a.enable(20),C.sheenRoughnessMap&&a.enable(21),C.decodeVideoTexture&&a.enable(22),C.opaque&&a.enable(23),b.push(a.mask)}(C,b),C.push(n.outputEncoding)),C.push(b.customProgramCacheKey),C.join()},getUniforms:function M(b){const C=p[b.type];let R;return R=C?wH.clone(li[C].uniforms):b.uniforms,R},acquireProgram:function _(b,C){let R;for(let P=0,U=c.length;P<U;P++){const Z=c[P];if(Z.cacheKey===C){R=Z,++R.usedTimes;break}}return void 0===R&&(R=new Zz(n,C,b,s),c.push(R)),R},releaseProgram:function x(b){if(0==--b.usedTimes){const C=c.indexOf(b);c[C]=c[c.length-1],c.pop(),b.destroy()}},releaseShaderCache:function w(b){l.remove(b)},programs:c,dispose:function A(){l.dispose()}}}function Qz(){let n=new WeakMap;return{get:function e(s){let o=n.get(s);return void 0===o&&(o={},n.set(s,o)),o},remove:function t(s){n.delete(s)},update:function r(s,o,a){n.get(s)[o]=a},dispose:function i(){n=new WeakMap}}}function ej(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function KC(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function QC(){const n=[];let e=0;const t=[],r=[],i=[];function o(d,h,f,p,m,g){let v=n[e];return void 0===v?(v={id:d.id,object:d,geometry:h,material:f,groupOrder:p,renderOrder:d.renderOrder,z:m,group:g},n[e]=v):(v.id=d.id,v.object=d,v.geometry=h,v.material=f,v.groupOrder=p,v.renderOrder=d.renderOrder,v.z=m,v.group=g),e++,v}return{opaque:t,transmissive:r,transparent:i,init:function s(){e=0,t.length=0,r.length=0,i.length=0},push:function a(d,h,f,p,m,g){const v=o(d,h,f,p,m,g);f.transmission>0?r.push(v):!0===f.transparent?i.push(v):t.push(v)},unshift:function l(d,h,f,p,m,g){const v=o(d,h,f,p,m,g);f.transmission>0?r.unshift(v):!0===f.transparent?i.unshift(v):t.unshift(v)},finish:function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function c(d,h){t.length>1&&t.sort(d||ej),r.length>1&&r.sort(h||KC),i.length>1&&i.sort(h||KC)}}}function tj(){let n=new WeakMap;return{get:function e(r,i){let s;return!1===n.has(r)?(s=new QC,n.set(r,[s])):i>=n.get(r).length?(s=new QC,n.get(r).push(s)):s=n.get(r)[i],s},dispose:function t(){n=new WeakMap}}}function nj(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new S,color:new ce};break;case"SpotLight":t={position:new S,direction:new S,color:new ce,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new S,color:new ce,distance:0,decay:0};break;case"HemisphereLight":t={direction:new S,skyColor:new ce,groundColor:new ce};break;case"RectAreaLight":t={color:new ce,position:new S,halfWidth:new S,halfHeight:new S}}return n[e.id]=t,t}}}let ij=0;function sj(n,e){return(e.castShadow?1:0)-(n.castShadow?1:0)}function oj(n,e){const t=new nj,r=function rj(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)i.probe.push(new S);const s=new S,o=new Se,a=new Se;return{setup:function l(u,d){let h=0,f=0,p=0;for(let C=0;C<9;C++)i.probe[C].set(0,0,0);let m=0,g=0,v=0,y=0,M=0,_=0,x=0,w=0;u.sort(sj);const A=!0!==d?Math.PI:1;for(let C=0,R=u.length;C<R;C++){const P=u[C],U=P.color,Z=P.intensity,L=P.distance,k=P.shadow&&P.shadow.map?P.shadow.map.texture:null;if(P.isAmbientLight)h+=U.r*Z*A,f+=U.g*Z*A,p+=U.b*Z*A;else if(P.isLightProbe)for(let F=0;F<9;F++)i.probe[F].addScaledVector(P.sh.coefficients[F],Z);else if(P.isDirectionalLight){const F=t.get(P);if(F.color.copy(P.color).multiplyScalar(P.intensity*A),P.castShadow){const X=P.shadow,J=r.get(P);J.shadowBias=X.bias,J.shadowNormalBias=X.normalBias,J.shadowRadius=X.radius,J.shadowMapSize=X.mapSize,i.directionalShadow[m]=J,i.directionalShadowMap[m]=k,i.directionalShadowMatrix[m]=P.shadow.matrix,_++}i.directional[m]=F,m++}else if(P.isSpotLight){const F=t.get(P);if(F.position.setFromMatrixPosition(P.matrixWorld),F.color.copy(U).multiplyScalar(Z*A),F.distance=L,F.coneCos=Math.cos(P.angle),F.penumbraCos=Math.cos(P.angle*(1-P.penumbra)),F.decay=P.decay,P.castShadow){const X=P.shadow,J=r.get(P);J.shadowBias=X.bias,J.shadowNormalBias=X.normalBias,J.shadowRadius=X.radius,J.shadowMapSize=X.mapSize,i.spotShadow[v]=J,i.spotShadowMap[v]=k,i.spotShadowMatrix[v]=P.shadow.matrix,w++}i.spot[v]=F,v++}else if(P.isRectAreaLight){const F=t.get(P);F.color.copy(U).multiplyScalar(Z),F.halfWidth.set(.5*P.width,0,0),F.halfHeight.set(0,.5*P.height,0),i.rectArea[y]=F,y++}else if(P.isPointLight){const F=t.get(P);if(F.color.copy(P.color).multiplyScalar(P.intensity*A),F.distance=P.distance,F.decay=P.decay,P.castShadow){const X=P.shadow,J=r.get(P);J.shadowBias=X.bias,J.shadowNormalBias=X.normalBias,J.shadowRadius=X.radius,J.shadowMapSize=X.mapSize,J.shadowCameraNear=X.camera.near,J.shadowCameraFar=X.camera.far,i.pointShadow[g]=J,i.pointShadowMap[g]=k,i.pointShadowMatrix[g]=P.shadow.matrix,x++}i.point[g]=F,g++}else if(P.isHemisphereLight){const F=t.get(P);F.skyColor.copy(P.color).multiplyScalar(Z*A),F.groundColor.copy(P.groundColor).multiplyScalar(Z*A),i.hemi[M]=F,M++}}y>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(i.rectAreaLTC1=ue.LTC_FLOAT_1,i.rectAreaLTC2=ue.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=ue.LTC_HALF_1,i.rectAreaLTC2=ue.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=h,i.ambient[1]=f,i.ambient[2]=p;const b=i.hash;(b.directionalLength!==m||b.pointLength!==g||b.spotLength!==v||b.rectAreaLength!==y||b.hemiLength!==M||b.numDirectionalShadows!==_||b.numPointShadows!==x||b.numSpotShadows!==w)&&(i.directional.length=m,i.spot.length=v,i.rectArea.length=y,i.point.length=g,i.hemi.length=M,i.directionalShadow.length=_,i.directionalShadowMap.length=_,i.pointShadow.length=x,i.pointShadowMap.length=x,i.spotShadow.length=w,i.spotShadowMap.length=w,i.directionalShadowMatrix.length=_,i.pointShadowMatrix.length=x,i.spotShadowMatrix.length=w,b.directionalLength=m,b.pointLength=g,b.spotLength=v,b.rectAreaLength=y,b.hemiLength=M,b.numDirectionalShadows=_,b.numPointShadows=x,b.numSpotShadows=w,i.version=ij++)},setupView:function c(u,d){let h=0,f=0,p=0,m=0,g=0;const v=d.matrixWorldInverse;for(let y=0,M=u.length;y<M;y++){const _=u[y];if(_.isDirectionalLight){const x=i.directional[h];x.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),x.direction.sub(s),x.direction.transformDirection(v),h++}else if(_.isSpotLight){const x=i.spot[p];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(v),x.direction.setFromMatrixPosition(_.matrixWorld),s.setFromMatrixPosition(_.target.matrixWorld),x.direction.sub(s),x.direction.transformDirection(v),p++}else if(_.isRectAreaLight){const x=i.rectArea[m];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(v),a.identity(),o.copy(_.matrixWorld),o.premultiply(v),a.extractRotation(o),x.halfWidth.set(.5*_.width,0,0),x.halfHeight.set(0,.5*_.height,0),x.halfWidth.applyMatrix4(a),x.halfHeight.applyMatrix4(a),m++}else if(_.isPointLight){const x=i.point[f];x.position.setFromMatrixPosition(_.matrixWorld),x.position.applyMatrix4(v),f++}else if(_.isHemisphereLight){const x=i.hemi[g];x.direction.setFromMatrixPosition(_.matrixWorld),x.direction.transformDirection(v),g++}}},state:i}}function eD(n,e){const t=new oj(n,e),r=[],i=[];return{init:function s(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:t},setupLights:function l(d){t.setup(r,d)},setupLightsView:function c(d){t.setupView(r,d)},pushLight:function o(d){r.push(d)},pushShadow:function a(d){i.push(d)}}}function aj(n,e){let t=new WeakMap;return{get:function r(s,o=0){let a;return!1===t.has(s)?(a=new eD(n,e),t.set(s,[a])):o>=t.get(s).length?(a=new eD(n,e),t.get(s).push(a)):a=t.get(s)[o],a},dispose:function i(){t=new WeakMap}}}class hv extends un{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}hv.prototype.isMeshDepthMaterial=!0;class fv extends un{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new S,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function tD(n,e,t){let r=new Fh;const i=new $,s=new $,o=new wt,a=new hv({depthPacking:3201}),l=new fv,c={},u=t.maxTextureSize,d={0:1,1:0,2:2},h=new qr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new Le;p.setAttribute("position",new Pt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new Mn(p,h),g=this;function v(_,x){const w=e.update(m);h.defines.VSM_SAMPLES!==_.blurSamples&&(h.defines.VSM_SAMPLES=_.blurSamples,f.defines.VSM_SAMPLES=_.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),h.uniforms.shadow_pass.value=_.map.texture,h.uniforms.resolution.value=_.mapSize,h.uniforms.radius.value=_.radius,n.setRenderTarget(_.mapPass),n.clear(),n.renderBufferDirect(x,null,w,h,m,null),f.uniforms.shadow_pass.value=_.mapPass.texture,f.uniforms.resolution.value=_.mapSize,f.uniforms.radius.value=_.radius,n.setRenderTarget(_.map),n.clear(),n.renderBufferDirect(x,null,w,f,m,null)}function y(_,x,w,A,b,C){let R=null;const P=!0===w.isPointLight?_.customDistanceMaterial:_.customDepthMaterial;if(R=void 0!==P?P:!0===w.isPointLight?l:a,n.localClippingEnabled&&!0===x.clipShadows&&0!==x.clippingPlanes.length||x.displacementMap&&0!==x.displacementScale||x.alphaMap&&x.alphaTest>0){const U=R.uuid,Z=x.uuid;let L=c[U];void 0===L&&(L={},c[U]=L);let k=L[Z];void 0===k&&(k=R.clone(),L[Z]=k),R=k}return R.visible=x.visible,R.wireframe=x.wireframe,R.side=3===C?null!==x.shadowSide?x.shadowSide:x.side:null!==x.shadowSide?x.shadowSide:d[x.side],R.alphaMap=x.alphaMap,R.alphaTest=x.alphaTest,R.clipShadows=x.clipShadows,R.clippingPlanes=x.clippingPlanes,R.clipIntersection=x.clipIntersection,R.displacementMap=x.displacementMap,R.displacementScale=x.displacementScale,R.displacementBias=x.displacementBias,R.wireframeLinewidth=x.wireframeLinewidth,R.linewidth=x.linewidth,!0===w.isPointLight&&!0===R.isMeshDistanceMaterial&&(R.referencePosition.setFromMatrixPosition(w.matrixWorld),R.nearDistance=A,R.farDistance=b),R}function M(_,x,w,A,b){if(!1===_.visible)return;if(_.layers.test(x.layers)&&(_.isMesh||_.isLine||_.isPoints)&&(_.castShadow||_.receiveShadow&&3===b)&&(!_.frustumCulled||r.intersectsObject(_))){_.modelViewMatrix.multiplyMatrices(w.matrixWorldInverse,_.matrixWorld);const P=e.update(_),U=_.material;if(Array.isArray(U)){const Z=P.groups;for(let L=0,k=Z.length;L<k;L++){const F=Z[L],X=U[F.materialIndex];if(X&&X.visible){const J=y(_,X,A,w.near,w.far,b);n.renderBufferDirect(w,null,P,J,_,F)}}}else if(U.visible){const Z=y(_,U,A,w.near,w.far,b);n.renderBufferDirect(w,null,P,Z,_,null)}}const R=_.children;for(let P=0,U=R.length;P<U;P++)M(R[P],x,w,A,b)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(_,x,w){if(!1===g.enabled||!1===g.autoUpdate&&!1===g.needsUpdate||0===_.length)return;const A=n.getRenderTarget(),b=n.getActiveCubeFace(),C=n.getActiveMipmapLevel(),R=n.state;R.setBlending(0),R.buffers.color.setClear(1,1,1,1),R.buffers.depth.setTest(!0),R.setScissorTest(!1);for(let P=0,U=_.length;P<U;P++){const Z=_[P],L=Z.shadow;if(void 0===L){console.warn("THREE.WebGLShadowMap:",Z,"has no shadow.");continue}if(!1===L.autoUpdate&&!1===L.needsUpdate)continue;i.copy(L.mapSize);const k=L.getFrameExtents();i.multiply(k),s.copy(L.mapSize),(i.x>u||i.y>u)&&(i.x>u&&(s.x=Math.floor(u/k.x),i.x=s.x*k.x,L.mapSize.x=s.x),i.y>u&&(s.y=Math.floor(u/k.y),i.y=s.y*k.y,L.mapSize.y=s.y)),null===L.map&&!L.isPointLightShadow&&3===this.type&&(L.map=new dr(i.x,i.y),L.map.texture.name=Z.name+".shadowMap",L.mapPass=new dr(i.x,i.y),L.camera.updateProjectionMatrix()),null===L.map&&(L.map=new dr(i.x,i.y,{minFilter:vn,magFilter:vn,format:Dr}),L.map.texture.name=Z.name+".shadowMap",L.camera.updateProjectionMatrix()),n.setRenderTarget(L.map),n.clear();const F=L.getViewportCount();for(let X=0;X<F;X++){const J=L.getViewport(X);o.set(s.x*J.x,s.y*J.y,s.x*J.z,s.y*J.w),R.viewport(o),L.updateMatrices(Z,X),r=L.getFrustum(),M(x,w,L.camera,Z,this.type)}!L.isPointLightShadow&&3===this.type&&v(L,w),L.needsUpdate=!1}g.needsUpdate=!1,n.setRenderTarget(A,b,C)}}function uj(n,e,t){const r=t.isWebGL2,a=new function i(){let D=!1;const W=new wt;let Q=null;const ve=new wt(0,0,0,0);return{setMask:function(ge){Q!==ge&&!D&&(n.colorMask(ge,ge,ge,ge),Q=ge)},setLocked:function(ge){D=ge},setClear:function(ge,Ae,oe,Ce,tt){!0===tt&&(ge*=Ce,Ae*=Ce,oe*=Ce),W.set(ge,Ae,oe,Ce),!1===ve.equals(W)&&(n.clearColor(ge,Ae,oe,Ce),ve.copy(W))},reset:function(){D=!1,Q=null,ve.set(-1,0,0,0)}}},l=new function s(){let D=!1,W=null,Q=null,ve=null;return{setTest:function(ge){ge?Ee(2929):q(2929)},setMask:function(ge){W!==ge&&!D&&(n.depthMask(ge),W=ge)},setFunc:function(ge){if(Q!==ge){if(ge)switch(ge){case 0:n.depthFunc(512);break;case 1:n.depthFunc(519);break;case 2:n.depthFunc(513);break;case 3:default:n.depthFunc(515);break;case 4:n.depthFunc(514);break;case 5:n.depthFunc(518);break;case 6:n.depthFunc(516);break;case 7:n.depthFunc(517)}else n.depthFunc(515);Q=ge}},setLocked:function(ge){D=ge},setClear:function(ge){ve!==ge&&(n.clearDepth(ge),ve=ge)},reset:function(){D=!1,W=null,Q=null,ve=null}}},c=new function o(){let D=!1,W=null,Q=null,ve=null,ge=null,Ae=null,oe=null,Ce=null,tt=null;return{setTest:function(pt){D||(pt?Ee(2960):q(2960))},setMask:function(pt){W!==pt&&!D&&(n.stencilMask(pt),W=pt)},setFunc:function(pt,pi,gi){(Q!==pt||ve!==pi||ge!==gi)&&(n.stencilFunc(pt,pi,gi),Q=pt,ve=pi,ge=gi)},setOp:function(pt,pi,gi){(Ae!==pt||oe!==pi||Ce!==gi)&&(n.stencilOp(pt,pi,gi),Ae=pt,oe=pi,Ce=gi)},setLocked:function(pt){D=pt},setClear:function(pt){tt!==pt&&(n.clearStencil(pt),tt=pt)},reset:function(){D=!1,W=null,Q=null,ve=null,ge=null,Ae=null,oe=null,Ce=null,tt=null}}};let u={},d={},h=new WeakMap,f=[],p=null,m=!1,g=null,v=null,y=null,M=null,_=null,x=null,w=null,A=!1,b=null,C=null,R=null,P=null,U=null;const Z=n.getParameter(35661);let L=!1,k=0;const F=n.getParameter(7938);-1!==F.indexOf("WebGL")?(k=parseFloat(/^WebGL (\d)/.exec(F)[1]),L=k>=1):-1!==F.indexOf("OpenGL ES")&&(k=parseFloat(/^OpenGL ES (\d)/.exec(F)[1]),L=k>=2);let X=null,J={};const H=n.getParameter(3088),j=n.getParameter(2978),ie=(new wt).fromArray(H),ne=(new wt).fromArray(j);function le(D,W,Q){const ve=new Uint8Array(4),ge=n.createTexture();n.bindTexture(D,ge),n.texParameteri(D,10241,9728),n.texParameteri(D,10240,9728);for(let Ae=0;Ae<Q;Ae++)n.texImage2D(W+Ae,0,6408,1,1,0,6408,5121,ve);return ge}const Me={};function Ee(D){!0!==u[D]&&(n.enable(D),u[D]=!0)}function q(D){!1!==u[D]&&(n.disable(D),u[D]=!1)}Me[3553]=le(3553,3553,1),Me[34067]=le(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Ee(2929),l.setFunc(3),se(!1),be(1),Ee(2884),K(0);const ae={100:32774,101:32778,102:32779};if(r)ae[103]=32775,ae[104]=32776;else{const D=e.get("EXT_blend_minmax");null!==D&&(ae[103]=D.MIN_EXT,ae[104]=D.MAX_EXT)}const et={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function K(D,W,Q,ve,ge,Ae,oe,Ce){if(0!==D){if(!1===m&&(Ee(3042),m=!0),5===D)ge=ge||W,Ae=Ae||Q,oe=oe||ve,(W!==v||ge!==_)&&(n.blendEquationSeparate(ae[W],ae[ge]),v=W,_=ge),(Q!==y||ve!==M||Ae!==x||oe!==w)&&(n.blendFuncSeparate(et[Q],et[ve],et[Ae],et[oe]),y=Q,M=ve,x=Ae,w=oe),g=D,A=null;else if(D!==g||Ce!==A){if((100!==v||100!==_)&&(n.blendEquation(32774),v=100,_=100),Ce)switch(D){case 1:n.blendFuncSeparate(1,771,1,771);break;case 2:n.blendFunc(1,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",D)}else switch(D){case 1:n.blendFuncSeparate(770,771,1,771);break;case 2:n.blendFunc(770,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",D)}y=null,M=null,x=null,w=null,g=D,A=Ce}}else!0===m&&(q(3042),m=!1)}function se(D){b!==D&&(n.frontFace(D?2304:2305),b=D)}function be(D){0!==D?(Ee(2884),D!==C&&n.cullFace(1===D?1029:2===D?1028:1032)):q(2884),C=D}function We(D,W,Q){D?(Ee(32823),(P!==W||U!==Q)&&(n.polygonOffset(W,Q),P=W,U=Q)):q(32823)}function De(D){void 0===D&&(D=33984+Z-1),X!==D&&(n.activeTexture(D),X=D)}return{buffers:{color:a,depth:l,stencil:c},enable:Ee,disable:q,bindFramebuffer:function ht(D,W){return d[D]!==W&&(n.bindFramebuffer(D,W),d[D]=W,r&&(36009===D&&(d[36160]=W),36160===D&&(d[36009]=W)),!0)},drawBuffers:function Ie(D,W){let Q=f,ve=!1;if(D)if(Q=h.get(W),void 0===Q&&(Q=[],h.set(W,Q)),D.isWebGLMultipleRenderTargets){const ge=D.texture;if(Q.length!==ge.length||36064!==Q[0]){for(let Ae=0,oe=ge.length;Ae<oe;Ae++)Q[Ae]=36064+Ae;Q.length=ge.length,ve=!0}}else 36064!==Q[0]&&(Q[0]=36064,ve=!0);else 1029!==Q[0]&&(Q[0]=1029,ve=!0);ve&&(t.isWebGL2?n.drawBuffers(Q):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(Q))},useProgram:function je(D){return p!==D&&(n.useProgram(D),p=D,!0)},setBlending:K,setMaterial:function Y(D,W){2===D.side?q(2884):Ee(2884);let Q=1===D.side;W&&(Q=!Q),se(Q),1===D.blending&&!1===D.transparent?K(0):K(D.blending,D.blendEquation,D.blendSrc,D.blendDst,D.blendEquationAlpha,D.blendSrcAlpha,D.blendDstAlpha,D.premultipliedAlpha),l.setFunc(D.depthFunc),l.setTest(D.depthTest),l.setMask(D.depthWrite),a.setMask(D.colorWrite);const ve=D.stencilWrite;c.setTest(ve),ve&&(c.setMask(D.stencilWriteMask),c.setFunc(D.stencilFunc,D.stencilRef,D.stencilFuncMask),c.setOp(D.stencilFail,D.stencilZFail,D.stencilZPass)),We(D.polygonOffset,D.polygonOffsetFactor,D.polygonOffsetUnits),!0===D.alphaToCoverage?Ee(32926):q(32926)},setFlipSided:se,setCullFace:be,setLineWidth:function pe(D){D!==R&&(L&&n.lineWidth(D),R=D)},setPolygonOffset:We,setScissorTest:function Ne(D){D?Ee(3089):q(3089)},activeTexture:De,bindTexture:function Dt(D,W){null===X&&De();let Q=J[X];void 0===Q&&(Q={type:void 0,texture:void 0},J[X]=Q),(Q.type!==D||Q.texture!==W)&&(n.bindTexture(D,W||Me[D]),Q.type=D,Q.texture=W)},unbindTexture:function St(){const D=J[X];void 0!==D&&void 0!==D.type&&(n.bindTexture(D.type,null),D.type=void 0,D.texture=void 0)},compressedTexImage2D:function N(){try{n.compressedTexImage2D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}},texImage2D:function Re(){try{n.texImage2D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}},texImage3D:function z(){try{n.texImage3D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}},texStorage2D:function de(){try{n.texStorage2D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}},texStorage3D:function ye(){try{n.texStorage3D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}},texSubImage2D:function E(){try{n.texSubImage2D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}},texSubImage3D:function G(){try{n.texSubImage3D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}},compressedTexSubImage2D:function re(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(D){console.error("THREE.WebGLState:",D)}},scissor:function qe(D){!1===ie.equals(D)&&(n.scissor(D.x,D.y,D.z,D.w),ie.copy(D))},viewport:function Ze(D){!1===ne.equals(D)&&(n.viewport(D.x,D.y,D.z,D.w),ne.copy(D))},reset:function I(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),!0===r&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),u={},X=null,J={},d={},h=new WeakMap,f=[],p=null,m=!1,g=null,v=null,y=null,M=null,_=null,x=null,w=null,A=!1,b=null,C=null,R=null,P=null,U=null,ie.set(0,0,n.canvas.width,n.canvas.height),ne.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}}}function dj(n,e,t,r,i,s,o){const a=i.isWebGL2,l=i.maxTextures,c=i.maxCubemapSize,u=i.maxTextureSize,d=i.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let m;const g=new WeakMap;let v=!1;try{v="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(N){}function y(N,E){return v?new OffscreenCanvas(N,E):Hc("canvas")}function M(N,E,G,re){let de=1;if((N.width>re||N.height>re)&&(de=re/Math.max(N.width,N.height)),de<1||!0===E){if("undefined"!=typeof HTMLImageElement&&N instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&N instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&N instanceof ImageBitmap){const ye=E?hh:Math.floor,Re=ye(de*N.width),z=ye(de*N.height);void 0===m&&(m=y(Re,z));const qe=G?y(Re,z):m;return qe.width=Re,qe.height=z,qe.getContext("2d").drawImage(N,0,0,Re,z),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+N.width+"x"+N.height+") to ("+Re+"x"+z+")."),qe}return"data"in N&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+N.width+"x"+N.height+")."),N}return N}function _(N){return Oy(N.width)&&Oy(N.height)}function w(N,E){return N.generateMipmaps&&E&&N.minFilter!==vn&&N.minFilter!==an}function A(N){n.generateMipmap(N)}function b(N,E,G,re,de=!1){if(!1===a)return E;if(null!==N){if(void 0!==n[N])return n[N];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+N+"'")}let ye=E;return 6403===E&&(5126===G&&(ye=33326),5131===G&&(ye=33325),5121===G&&(ye=33321)),33319===E&&(5126===G&&(ye=33328),5131===G&&(ye=33327),5121===G&&(ye=33323)),6408===E&&(5126===G&&(ye=34836),5131===G&&(ye=34842),5121===G&&(ye=re===Rt&&!1===de?35907:32856),32819===G&&(ye=32854),32820===G&&(ye=32855)),(33325===ye||33326===ye||33327===ye||33328===ye||34842===ye||34836===ye)&&e.get("EXT_color_buffer_float"),ye}function C(N,E,G){return!0===w(N,G)||N.isFramebufferTexture&&N.minFilter!==vn&&N.minFilter!==an?Math.log2(Math.max(E.width,E.height))+1:void 0!==N.mipmaps&&N.mipmaps.length>0?N.mipmaps.length:N.isCompressedTexture&&Array.isArray(N.image)?E.mipmaps.length:1}function R(N){return N===vn||1004===N||1005===N?9728:9729}function P(N){const E=N.target;E.removeEventListener("dispose",P),function Z(N){const E=r.get(N);if(void 0===E.__webglInit)return;const G=N.source,re=g.get(G);if(re){const de=re[E.__cacheKey];de.usedTimes--,0===de.usedTimes&&L(N),0===Object.keys(re).length&&g.delete(G)}r.remove(N)}(E),E.isVideoTexture&&p.delete(E)}function U(N){const E=N.target;E.removeEventListener("dispose",U),function k(N){const E=N.texture,G=r.get(N),re=r.get(E);if(void 0!==re.__webglTexture&&(n.deleteTexture(re.__webglTexture),o.memory.textures--),N.depthTexture&&N.depthTexture.dispose(),N.isWebGLCubeRenderTarget)for(let de=0;de<6;de++)n.deleteFramebuffer(G.__webglFramebuffer[de]),G.__webglDepthbuffer&&n.deleteRenderbuffer(G.__webglDepthbuffer[de]);else n.deleteFramebuffer(G.__webglFramebuffer),G.__webglDepthbuffer&&n.deleteRenderbuffer(G.__webglDepthbuffer),G.__webglMultisampledFramebuffer&&n.deleteFramebuffer(G.__webglMultisampledFramebuffer),G.__webglColorRenderbuffer&&n.deleteRenderbuffer(G.__webglColorRenderbuffer),G.__webglDepthRenderbuffer&&n.deleteRenderbuffer(G.__webglDepthRenderbuffer);if(N.isWebGLMultipleRenderTargets)for(let de=0,ye=E.length;de<ye;de++){const Re=r.get(E[de]);Re.__webglTexture&&(n.deleteTexture(Re.__webglTexture),o.memory.textures--),r.remove(E[de])}r.remove(E),r.remove(N)}(E)}function L(N){const E=r.get(N);n.deleteTexture(E.__webglTexture),delete g.get(N.source)[E.__cacheKey],o.memory.textures--}let F=0;function j(N,E){const G=r.get(N);if(N.isVideoTexture&&function Dt(N){const E=o.render.frame;p.get(N)!==E&&(p.set(N,E),N.update())}(N),!1===N.isRenderTargetTexture&&N.version>0&&G.__version!==N.version){const re=N.image;if(null===re)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==re.complete)return void Ie(G,N,E);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.activeTexture(33984+E),t.bindTexture(3553,G.__webglTexture)}const Me={1e3:10497,[Jn]:33071,1002:33648},Ee={[vn]:9728,1004:9984,1005:9986,[an]:9729,1007:9985,1008:9987};function q(N,E,G){if(G?(n.texParameteri(N,10242,Me[E.wrapS]),n.texParameteri(N,10243,Me[E.wrapT]),(32879===N||35866===N)&&n.texParameteri(N,32882,Me[E.wrapR]),n.texParameteri(N,10240,Ee[E.magFilter]),n.texParameteri(N,10241,Ee[E.minFilter])):(n.texParameteri(N,10242,33071),n.texParameteri(N,10243,33071),(32879===N||35866===N)&&n.texParameteri(N,32882,33071),(E.wrapS!==Jn||E.wrapT!==Jn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(N,10240,R(E.magFilter)),n.texParameteri(N,10241,R(E.minFilter)),E.minFilter!==vn&&E.minFilter!==an&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const re=e.get("EXT_texture_filter_anisotropic");if(E.type===hs&&!1===e.has("OES_texture_float_linear")||!1===a&&E.type===Fc&&!1===e.has("OES_texture_half_float_linear"))return;(E.anisotropy>1||r.get(E).__currentAnisotropy)&&(n.texParameterf(N,re.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(E.anisotropy,i.getMaxAnisotropy())),r.get(E).__currentAnisotropy=E.anisotropy)}}function ht(N,E){let G=!1;void 0===N.__webglInit&&(N.__webglInit=!0,E.addEventListener("dispose",P));const re=E.source;let de=g.get(re);void 0===de&&(de={},g.set(re,de));const ye=function H(N){const E=[];return E.push(N.wrapS),E.push(N.wrapT),E.push(N.magFilter),E.push(N.minFilter),E.push(N.anisotropy),E.push(N.internalFormat),E.push(N.format),E.push(N.type),E.push(N.generateMipmaps),E.push(N.premultiplyAlpha),E.push(N.flipY),E.push(N.unpackAlignment),E.push(N.encoding),E.join()}(E);if(ye!==N.__cacheKey){void 0===de[ye]&&(de[ye]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,G=!0),de[ye].usedTimes++;const Re=de[N.__cacheKey];void 0!==Re&&(de[N.__cacheKey].usedTimes--,0===Re.usedTimes&&L(E)),N.__cacheKey=ye,N.__webglTexture=de[ye].texture}return G}function Ie(N,E,G){let re=3553;E.isDataArrayTexture&&(re=35866),E.isData3DTexture&&(re=32879);const de=ht(N,E),ye=E.source;if(t.activeTexture(33984+G),t.bindTexture(re,N.__webglTexture),ye.version!==ye.__currentVersion||!0===de){n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment),n.pixelStorei(37443,0);const Re=function x(N){return!a&&(N.wrapS!==Jn||N.wrapT!==Jn||N.minFilter!==vn&&N.minFilter!==an)}(E)&&!1===_(E.image);let z=M(E.image,Re,!1,u);z=St(E,z);const qe=_(z)||a,Ze=s.convert(E.format,E.encoding);let W,I=s.convert(E.type),D=b(E.internalFormat,Ze,I,E.encoding,E.isVideoTexture);q(re,E,qe);const Q=E.mipmaps,ve=a&&!0!==E.isVideoTexture,ge=void 0===N.__version||!0===de,Ae=C(E,z,qe);if(E.isDepthTexture)D=6402,a?D=E.type===hs?36012:1014===E.type?33190:E.type===Da?35056:33189:E.type===hs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),E.format===no&&6402===D&&E.type!==Lc&&1014!==E.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),E.type=Lc,I=s.convert(E.type)),E.format===Ta&&6402===D&&(D=34041,E.type!==Da&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),E.type=Da,I=s.convert(E.type))),ge&&(ve?t.texStorage2D(3553,1,D,z.width,z.height):t.texImage2D(3553,0,D,z.width,z.height,0,Ze,I,null));else if(E.isDataTexture)if(Q.length>0&&qe){ve&&ge&&t.texStorage2D(3553,Ae,D,Q[0].width,Q[0].height);for(let oe=0,Ce=Q.length;oe<Ce;oe++)W=Q[oe],ve?t.texSubImage2D(3553,oe,0,0,W.width,W.height,Ze,I,W.data):t.texImage2D(3553,oe,D,W.width,W.height,0,Ze,I,W.data);E.generateMipmaps=!1}else ve?(ge&&t.texStorage2D(3553,Ae,D,z.width,z.height),t.texSubImage2D(3553,0,0,0,z.width,z.height,Ze,I,z.data)):t.texImage2D(3553,0,D,z.width,z.height,0,Ze,I,z.data);else if(E.isCompressedTexture){ve&&ge&&t.texStorage2D(3553,Ae,D,Q[0].width,Q[0].height);for(let oe=0,Ce=Q.length;oe<Ce;oe++)W=Q[oe],E.format!==Dr?null!==Ze?ve?t.compressedTexSubImage2D(3553,oe,0,0,W.width,W.height,Ze,W.data):t.compressedTexImage2D(3553,oe,D,W.width,W.height,0,W.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ve?t.texSubImage2D(3553,oe,0,0,W.width,W.height,Ze,I,W.data):t.texImage2D(3553,oe,D,W.width,W.height,0,Ze,I,W.data)}else if(E.isDataArrayTexture)ve?(ge&&t.texStorage3D(35866,Ae,D,z.width,z.height,z.depth),t.texSubImage3D(35866,0,0,0,0,z.width,z.height,z.depth,Ze,I,z.data)):t.texImage3D(35866,0,D,z.width,z.height,z.depth,0,Ze,I,z.data);else if(E.isData3DTexture)ve?(ge&&t.texStorage3D(32879,Ae,D,z.width,z.height,z.depth),t.texSubImage3D(32879,0,0,0,0,z.width,z.height,z.depth,Ze,I,z.data)):t.texImage3D(32879,0,D,z.width,z.height,z.depth,0,Ze,I,z.data);else if(E.isFramebufferTexture){if(ge)if(ve)t.texStorage2D(3553,Ae,D,z.width,z.height);else{let oe=z.width,Ce=z.height;for(let tt=0;tt<Ae;tt++)t.texImage2D(3553,tt,D,oe,Ce,0,Ze,I,null),oe>>=1,Ce>>=1}}else if(Q.length>0&&qe){ve&&ge&&t.texStorage2D(3553,Ae,D,Q[0].width,Q[0].height);for(let oe=0,Ce=Q.length;oe<Ce;oe++)W=Q[oe],ve?t.texSubImage2D(3553,oe,0,0,Ze,I,W):t.texImage2D(3553,oe,D,Ze,I,W);E.generateMipmaps=!1}else ve?(ge&&t.texStorage2D(3553,Ae,D,z.width,z.height),t.texSubImage2D(3553,0,0,0,Ze,I,z)):t.texImage2D(3553,0,D,Ze,I,z);w(E,qe)&&A(re),ye.__currentVersion=ye.version,E.onUpdate&&E.onUpdate(E)}N.__version=E.version}function ae(N,E,G,re,de){const ye=s.convert(G.format,G.encoding),Re=s.convert(G.type),z=b(G.internalFormat,ye,Re,G.encoding);r.get(E).__hasExternalTextures||(32879===de||35866===de?t.texImage3D(de,0,z,E.width,E.height,E.depth,0,ye,Re,null):t.texImage2D(de,0,z,E.width,E.height,0,ye,Re,null)),t.bindFramebuffer(36160,N),De(E)?h.framebufferTexture2DMultisampleEXT(36160,re,de,r.get(G).__webglTexture,0,Ne(E)):n.framebufferTexture2D(36160,re,de,r.get(G).__webglTexture,0),t.bindFramebuffer(36160,null)}function et(N,E,G){if(n.bindRenderbuffer(36161,N),E.depthBuffer&&!E.stencilBuffer){let re=33189;if(G||De(E)){const de=E.depthTexture;de&&de.isDepthTexture&&(de.type===hs?re=36012:1014===de.type&&(re=33190));const ye=Ne(E);De(E)?h.renderbufferStorageMultisampleEXT(36161,ye,re,E.width,E.height):n.renderbufferStorageMultisample(36161,ye,re,E.width,E.height)}else n.renderbufferStorage(36161,re,E.width,E.height);n.framebufferRenderbuffer(36160,36096,36161,N)}else if(E.depthBuffer&&E.stencilBuffer){const re=Ne(E);G&&!1===De(E)?n.renderbufferStorageMultisample(36161,re,35056,E.width,E.height):De(E)?h.renderbufferStorageMultisampleEXT(36161,re,35056,E.width,E.height):n.renderbufferStorage(36161,34041,E.width,E.height),n.framebufferRenderbuffer(36160,33306,36161,N)}else{const re=!0===E.isWebGLMultipleRenderTargets?E.texture[0]:E.texture,de=s.convert(re.format,re.encoding),ye=s.convert(re.type),Re=b(re.internalFormat,de,ye,re.encoding),z=Ne(E);G&&!1===De(E)?n.renderbufferStorageMultisample(36161,z,Re,E.width,E.height):De(E)?h.renderbufferStorageMultisampleEXT(36161,z,Re,E.width,E.height):n.renderbufferStorage(36161,Re,E.width,E.height)}n.bindRenderbuffer(36161,null)}function Y(N){const E=r.get(N),G=!0===N.isWebGLCubeRenderTarget;if(N.depthTexture&&!E.__autoAllocateDepthBuffer){if(G)throw new Error("target.depthTexture not supported in Cube render targets");!function K(N,E){if(E&&E.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,N),!E.depthTexture||!E.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(E.depthTexture).__webglTexture||E.depthTexture.image.width!==E.width||E.depthTexture.image.height!==E.height)&&(E.depthTexture.image.width=E.width,E.depthTexture.image.height=E.height,E.depthTexture.needsUpdate=!0),j(E.depthTexture,0);const re=r.get(E.depthTexture).__webglTexture,de=Ne(E);if(E.depthTexture.format===no)De(E)?h.framebufferTexture2DMultisampleEXT(36160,36096,3553,re,0,de):n.framebufferTexture2D(36160,36096,3553,re,0);else{if(E.depthTexture.format!==Ta)throw new Error("Unknown depthTexture format");De(E)?h.framebufferTexture2DMultisampleEXT(36160,33306,3553,re,0,de):n.framebufferTexture2D(36160,33306,3553,re,0)}}(E.__webglFramebuffer,N)}else if(G){E.__webglDepthbuffer=[];for(let re=0;re<6;re++)t.bindFramebuffer(36160,E.__webglFramebuffer[re]),E.__webglDepthbuffer[re]=n.createRenderbuffer(),et(E.__webglDepthbuffer[re],N,!1)}else t.bindFramebuffer(36160,E.__webglFramebuffer),E.__webglDepthbuffer=n.createRenderbuffer(),et(E.__webglDepthbuffer,N,!1);t.bindFramebuffer(36160,null)}function Ne(N){return Math.min(d,N.samples)}function De(N){const E=r.get(N);return a&&N.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==E.__useRenderToTexture}function St(N,E){const G=N.encoding,re=N.format,de=N.type;return!0===N.isCompressedTexture||!0===N.isVideoTexture||1035===N.format||G!==Oi&&(G===Rt?!1===a?!0===e.has("EXT_sRGB")&&re===Dr?(N.format=1035,N.minFilter=an,N.generateMipmaps=!1):E=oo.sRGBToLinear(E):(re!==Dr||de!==to)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",G)),E}this.allocateTextureUnit=function J(){const N=F;return N>=l&&console.warn("THREE.WebGLTextures: Trying to use "+N+" texture units while this GPU supports only "+l),F+=1,N},this.resetTextureUnits=function X(){F=0},this.setTexture2D=j,this.setTexture2DArray=function ie(N,E){const G=r.get(N);N.version>0&&G.__version!==N.version?Ie(G,N,E):(t.activeTexture(33984+E),t.bindTexture(35866,G.__webglTexture))},this.setTexture3D=function ne(N,E){const G=r.get(N);N.version>0&&G.__version!==N.version?Ie(G,N,E):(t.activeTexture(33984+E),t.bindTexture(32879,G.__webglTexture))},this.setTextureCube=function le(N,E){const G=r.get(N);N.version>0&&G.__version!==N.version?function je(N,E,G){if(6!==E.image.length)return;const re=ht(N,E),de=E.source;if(t.activeTexture(33984+G),t.bindTexture(34067,N.__webglTexture),de.version!==de.__currentVersion||!0===re){n.pixelStorei(37440,E.flipY),n.pixelStorei(37441,E.premultiplyAlpha),n.pixelStorei(3317,E.unpackAlignment),n.pixelStorei(37443,0);const ye=E.isCompressedTexture||E.image[0].isCompressedTexture,Re=E.image[0]&&E.image[0].isDataTexture,z=[];for(let oe=0;oe<6;oe++)z[oe]=ye||Re?Re?E.image[oe].image:E.image[oe]:M(E.image[oe],!1,!0,c),z[oe]=St(E,z[oe]);const qe=z[0],Ze=_(qe)||a,I=s.convert(E.format,E.encoding),D=s.convert(E.type),W=b(E.internalFormat,I,D,E.encoding),Q=a&&!0!==E.isVideoTexture,ve=void 0===N.__version;let Ae,ge=C(E,qe,Ze);if(q(34067,E,Ze),ye){Q&&ve&&t.texStorage2D(34067,ge,W,qe.width,qe.height);for(let oe=0;oe<6;oe++){Ae=z[oe].mipmaps;for(let Ce=0;Ce<Ae.length;Ce++){const tt=Ae[Ce];E.format!==Dr?null!==I?Q?t.compressedTexSubImage2D(34069+oe,Ce,0,0,tt.width,tt.height,I,tt.data):t.compressedTexImage2D(34069+oe,Ce,W,tt.width,tt.height,0,tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Q?t.texSubImage2D(34069+oe,Ce,0,0,tt.width,tt.height,I,D,tt.data):t.texImage2D(34069+oe,Ce,W,tt.width,tt.height,0,I,D,tt.data)}}}else{Ae=E.mipmaps,Q&&ve&&(Ae.length>0&&ge++,t.texStorage2D(34067,ge,W,z[0].width,z[0].height));for(let oe=0;oe<6;oe++)if(Re){Q?t.texSubImage2D(34069+oe,0,0,0,z[oe].width,z[oe].height,I,D,z[oe].data):t.texImage2D(34069+oe,0,W,z[oe].width,z[oe].height,0,I,D,z[oe].data);for(let Ce=0;Ce<Ae.length;Ce++){const pt=Ae[Ce].image[oe].image;Q?t.texSubImage2D(34069+oe,Ce+1,0,0,pt.width,pt.height,I,D,pt.data):t.texImage2D(34069+oe,Ce+1,W,pt.width,pt.height,0,I,D,pt.data)}}else{Q?t.texSubImage2D(34069+oe,0,0,0,I,D,z[oe]):t.texImage2D(34069+oe,0,W,I,D,z[oe]);for(let Ce=0;Ce<Ae.length;Ce++){const tt=Ae[Ce];Q?t.texSubImage2D(34069+oe,Ce+1,0,0,I,D,tt.image[oe]):t.texImage2D(34069+oe,Ce+1,W,I,D,tt.image[oe])}}}w(E,Ze)&&A(34067),de.__currentVersion=de.version,E.onUpdate&&E.onUpdate(E)}N.__version=E.version}(G,N,E):(t.activeTexture(33984+E),t.bindTexture(34067,G.__webglTexture))},this.rebindTextures=function se(N,E,G){const re=r.get(N);void 0!==E&&ae(re.__webglFramebuffer,N,N.texture,36064,3553),void 0!==G&&Y(N)},this.setupRenderTarget=function be(N){const E=N.texture,G=r.get(N),re=r.get(E);N.addEventListener("dispose",U),!0!==N.isWebGLMultipleRenderTargets&&(void 0===re.__webglTexture&&(re.__webglTexture=n.createTexture()),re.__version=E.version,o.memory.textures++);const de=!0===N.isWebGLCubeRenderTarget,ye=!0===N.isWebGLMultipleRenderTargets,Re=_(N)||a;if(de){G.__webglFramebuffer=[];for(let z=0;z<6;z++)G.__webglFramebuffer[z]=n.createFramebuffer()}else if(G.__webglFramebuffer=n.createFramebuffer(),ye)if(i.drawBuffers){const z=N.texture;for(let qe=0,Ze=z.length;qe<Ze;qe++){const I=r.get(z[qe]);void 0===I.__webglTexture&&(I.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(a&&N.samples>0&&!1===De(N)){G.__webglMultisampledFramebuffer=n.createFramebuffer(),G.__webglColorRenderbuffer=n.createRenderbuffer(),n.bindRenderbuffer(36161,G.__webglColorRenderbuffer);const z=s.convert(E.format,E.encoding),qe=s.convert(E.type),Ze=b(E.internalFormat,z,qe,E.encoding),I=Ne(N);n.renderbufferStorageMultisample(36161,I,Ze,N.width,N.height),t.bindFramebuffer(36160,G.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064,36161,G.__webglColorRenderbuffer),n.bindRenderbuffer(36161,null),N.depthBuffer&&(G.__webglDepthRenderbuffer=n.createRenderbuffer(),et(G.__webglDepthRenderbuffer,N,!0)),t.bindFramebuffer(36160,null)}if(de){t.bindTexture(34067,re.__webglTexture),q(34067,E,Re);for(let z=0;z<6;z++)ae(G.__webglFramebuffer[z],N,E,36064,34069+z);w(E,Re)&&A(34067),t.unbindTexture()}else if(ye){const z=N.texture;for(let qe=0,Ze=z.length;qe<Ze;qe++){const I=z[qe],D=r.get(I);t.bindTexture(3553,D.__webglTexture),q(3553,I,Re),ae(G.__webglFramebuffer,N,I,36064+qe,3553),w(I,Re)&&A(3553)}t.unbindTexture()}else{let z=3553;(N.isWebGL3DRenderTarget||N.isWebGLArrayRenderTarget)&&(a?z=N.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(z,re.__webglTexture),q(z,E,Re),ae(G.__webglFramebuffer,N,E,36064,z),w(E,Re)&&A(z),t.unbindTexture()}N.depthBuffer&&Y(N)},this.updateRenderTargetMipmap=function pe(N){const E=_(N)||a,G=!0===N.isWebGLMultipleRenderTargets?N.texture:[N.texture];for(let re=0,de=G.length;re<de;re++){const ye=G[re];if(w(ye,E)){const Re=N.isWebGLCubeRenderTarget?34067:3553,z=r.get(ye).__webglTexture;t.bindTexture(Re,z),A(Re),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function We(N){if(a&&N.samples>0&&!1===De(N)){const E=N.width,G=N.height;let re=16384;const de=[36064],ye=N.stencilBuffer?33306:36096;N.depthBuffer&&de.push(ye);const Re=r.get(N),z=void 0!==Re.__ignoreDepthValues&&Re.__ignoreDepthValues;!1===z&&(N.depthBuffer&&(re|=256),N.stencilBuffer&&(re|=1024)),t.bindFramebuffer(36008,Re.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Re.__webglFramebuffer),!0===z&&(n.invalidateFramebuffer(36008,[ye]),n.invalidateFramebuffer(36009,[ye])),n.blitFramebuffer(0,0,E,G,0,0,E,G,re,9728),f&&n.invalidateFramebuffer(36008,de),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,Re.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=Y,this.setupFrameBufferTexture=ae,this.useMultisampledRTT=De}function hj(n,e,t){const r=t.isWebGL2;return{convert:function i(s,o=null){let a;if(s===to)return 5121;if(1017===s)return 32819;if(1018===s)return 32820;if(1010===s)return 5120;if(1011===s)return 5122;if(s===Lc)return 5123;if(1013===s)return 5124;if(1014===s)return 5125;if(s===hs)return 5126;if(s===Fc)return r?5131:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===s)return 6406;if(s===Dr)return 6408;if(1024===s)return 6409;if(1025===s)return 6410;if(s===no)return 6402;if(s===Ta)return 34041;if(1028===s)return 6403;if(1022===s)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===s)return a=e.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1029===s)return 36244;if(1030===s)return 33319;if(1031===s)return 33320;if(1033===s)return 36249;if(33776===s||33777===s||33778===s||33779===s)if(o===Rt){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(33776===s)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(33776===s)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===s||35841===s||35842===s||35843===s){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===s)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===s)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===s)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===s)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===s)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===s||37496===s){if(a=e.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===s)return o===Rt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===s||37809===s||37810===s||37811===s||37812===s||37813===s||37814===s||37815===s||37816===s||37817===s||37818===s||37819===s||37820===s||37821===s){if(a=e.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===s)return o===Rt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===s){if(a=e.get("EXT_texture_compression_bptc"),null===a)return null;if(36492===s)return o===Rt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}return s===Da?r?34042:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}fv.prototype.isMeshDistanceMaterial=!0;class nD extends Ut{constructor(e=[]){super(),this.cameras=e}}nD.prototype.isArrayCamera=!0;class Ka extends _t{constructor(){super(),this.type="Group"}}Ka.prototype.isGroup=!0;const fj={type:"move"};class pv{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ka,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ka,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new S,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new S),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ka,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new S,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new S),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,r){let i=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==a&&(i=t.getPose(e.targetRaySpace,r),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(fj))),c&&e.hand){o=!0;for(const m of e.hand.values()){const g=t.getJointPose(m,r);if(void 0===c.joints[m.jointName]){const y=new Ka;y.matrixAutoUpdate=!1,y.visible=!1,c.joints[m.jointName]=y,c.add(y)}const v=c.joints[m.jointName];null!==g&&(v.matrix.fromArray(g.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.jointRadius=g.radius),v.visible=null!==g}const h=c.joints["index-finger-tip"].position.distanceTo(c.joints["thumb-tip"].position),f=.02,p=.005;c.inputState.pinching&&h>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&(s=t.getPose(e.gripSpace,r),null!==s&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));return null!==a&&(a.visible=null!==i),null!==l&&(l.visible=null!==s),null!==c&&(c.visible=null!==o),this}}class rD extends zn{constructor(e,t,r,i,s,o,a,l,c,u){if((u=void 0!==u?u:no)!==no&&u!==Ta)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===r&&u===no&&(r=Lc),void 0===r&&u===Ta&&(r=Da),super(null,i,s,o,a,l,u,r,c),this.image={width:e,height:t},this.magFilter=void 0!==a?a:vn,this.minFilter=void 0!==l?l:vn,this.flipY=!1,this.generateMipmaps=!1}}rD.prototype.isDepthTexture=!0;class pj extends fs{constructor(e,t){super();const r=this;let i=null,s=1,o=null,a="local-floor",l=null,c=null,u=null,d=null,h=null,f=null;const p=t.getContextAttributes();let m=null,g=null;const v=[],y=new Map,M=new Ut;M.layers.enable(1),M.viewport=new wt;const _=new Ut;_.layers.enable(2),_.viewport=new wt;const x=[M,_],w=new nD;w.layers.enable(1),w.layers.enable(2);let A=null,b=null;function C(H){const j=y.get(H.inputSource);j&&j.dispatchEvent({type:H.type,data:H.inputSource})}function R(){y.forEach(function(H,j){H.disconnect(j)}),y.clear(),A=null,b=null,e.setRenderTarget(m),h=null,d=null,u=null,i=null,g=null,J.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function P(H){const j=i.inputSources;for(let ie=0;ie<j.length;ie++)y.set(j[ie],v["right"===j[ie].handedness?1:0]);for(let ie=0;ie<H.removed.length;ie++){const ne=H.removed[ie],le=y.get(ne);le&&(le.dispatchEvent({type:"disconnected",data:ne}),y.delete(ne))}for(let ie=0;ie<H.added.length;ie++){const ne=H.added[ie],le=y.get(ne);le&&le.dispatchEvent({type:"connected",data:ne})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(H){let j=v[H];return void 0===j&&(j=new pv,v[H]=j),j.getTargetRaySpace()},this.getControllerGrip=function(H){let j=v[H];return void 0===j&&(j=new pv,v[H]=j),j.getGripSpace()},this.getHand=function(H){let j=v[H];return void 0===j&&(j=new pv,v[H]=j),j.getHandSpace()},this.setFramebufferScaleFactor=function(H){s=H,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(H){a=H,!0===r.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(H){l=H},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return i},this.setSession=function(){var H=function ZB(n){return function(){var e=this,t=arguments;return new Promise(function(r,i){var s=n.apply(e,t);function o(l){EE(s,r,i,o,a,"next",l)}function a(l){EE(s,r,i,o,a,"throw",l)}o(void 0)})}}(function*(j){if(i=j,null!==i){if(m=e.getRenderTarget(),i.addEventListener("select",C),i.addEventListener("selectstart",C),i.addEventListener("selectend",C),i.addEventListener("squeeze",C),i.addEventListener("squeezestart",C),i.addEventListener("squeezeend",C),i.addEventListener("end",R),i.addEventListener("inputsourceschange",P),!0!==p.xrCompatible&&(yield t.makeXRCompatible()),void 0===i.renderState.layers||!1===e.capabilities.isWebGL2)h=new XRWebGLLayer(i,t,{antialias:void 0!==i.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:s}),i.updateRenderState({baseLayer:h}),g=new dr(h.framebufferWidth,h.framebufferHeight,{format:Dr,type:to,encoding:e.outputEncoding});else{let ie=null,ne=null,le=null;p.depth&&(le=p.stencil?35056:33190,ie=p.stencil?Ta:no,ne=p.stencil?Da:Lc);const Me={colorFormat:e.outputEncoding===Rt?35907:32856,depthFormat:le,scaleFactor:s};u=new XRWebGLBinding(i,t),d=u.createProjectionLayer(Me),i.updateRenderState({layers:[d]}),g=new dr(d.textureWidth,d.textureHeight,{format:Dr,type:to,depthTexture:new rD(d.textureWidth,d.textureHeight,ne,void 0,void 0,void 0,void 0,void 0,void 0,ie),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0}),e.properties.get(g).__ignoreDepthValues=d.ignoreDepthValues}g.isXRRenderTarget=!0,this.setFoveation(1),o=yield i.requestReferenceSpace(a),J.setContext(i),J.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}});return function(j){return H.apply(this,arguments)}}();const U=new S,Z=new S;function k(H,j){null===j?H.matrixWorld.copy(H.matrix):H.matrixWorld.multiplyMatrices(j.matrixWorld,H.matrix),H.matrixWorldInverse.copy(H.matrixWorld).invert()}this.updateCamera=function(H){if(null===i)return;w.near=_.near=M.near=H.near,w.far=_.far=M.far=H.far,(A!==w.near||b!==w.far)&&(i.updateRenderState({depthNear:w.near,depthFar:w.far}),A=w.near,b=w.far);const j=H.parent,ie=w.cameras;k(w,j);for(let le=0;le<ie.length;le++)k(ie[le],j);w.matrixWorld.decompose(w.position,w.quaternion,w.scale),H.position.copy(w.position),H.quaternion.copy(w.quaternion),H.scale.copy(w.scale),H.matrix.copy(w.matrix),H.matrixWorld.copy(w.matrixWorld);const ne=H.children;for(let le=0,Me=ne.length;le<Me;le++)ne[le].updateMatrixWorld(!0);2===ie.length?function L(H,j,ie){U.setFromMatrixPosition(j.matrixWorld),Z.setFromMatrixPosition(ie.matrixWorld);const ne=U.distanceTo(Z),le=j.projectionMatrix.elements,Me=ie.projectionMatrix.elements,Ee=le[14]/(le[10]-1),q=le[14]/(le[10]+1),ht=(le[9]+1)/le[5],Ie=(le[9]-1)/le[5],je=(le[8]-1)/le[0],ae=(Me[8]+1)/Me[0],et=Ee*je,K=Ee*ae,Y=ne/(-je+ae),se=Y*-je;j.matrixWorld.decompose(H.position,H.quaternion,H.scale),H.translateX(se),H.translateZ(Y),H.matrixWorld.compose(H.position,H.quaternion,H.scale),H.matrixWorldInverse.copy(H.matrixWorld).invert();const be=Ee+Y,pe=q+Y;H.projectionMatrix.makePerspective(et-se,K+(ne-se),ht*q/pe*be,Ie*q/pe*be,be,pe)}(w,M,_):w.projectionMatrix.copy(M.projectionMatrix)},this.getCamera=function(){return w},this.getFoveation=function(){return null!==d?d.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(H){null!==d&&(d.fixedFoveation=H),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=H)};let F=null;const J=new CC;J.setAnimationLoop(function X(H,j){if(c=j.getViewerPose(l||o),f=j,null!==c){const ne=c.views;null!==h&&(e.setRenderTargetFramebuffer(g,h.framebuffer),e.setRenderTarget(g));let le=!1;ne.length!==w.cameras.length&&(w.cameras.length=0,le=!0);for(let Me=0;Me<ne.length;Me++){const Ee=ne[Me];let q=null;if(null!==h)q=h.getViewport(Ee);else{const Ie=u.getViewSubImage(d,Ee);q=Ie.viewport,0===Me&&(e.setRenderTargetTextures(g,Ie.colorTexture,d.ignoreDepthValues?void 0:Ie.depthStencilTexture),e.setRenderTarget(g))}const ht=x[Me];ht.matrix.fromArray(Ee.transform.matrix),ht.projectionMatrix.fromArray(Ee.projectionMatrix),ht.viewport.set(q.x,q.y,q.width,q.height),0===Me&&w.matrix.copy(ht.matrix),!0===le&&w.cameras.push(ht)}}const ie=i.inputSources;for(let ne=0;ne<v.length;ne++){const le=ie[ne],Me=y.get(le);void 0!==Me&&Me.update(le,j,l||o)}F&&F(H,j),f=null}),this.setAnimationLoop=function(H){F=H},this.dispose=function(){}}}function gj(n,e){function i(m,g){m.opacity.value=g.opacity,g.color&&m.diffuse.value.copy(g.color),g.emissive&&m.emissive.value.copy(g.emissive).multiplyScalar(g.emissiveIntensity),g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.bumpMap&&(m.bumpMap.value=g.bumpMap,m.bumpScale.value=g.bumpScale,1===g.side&&(m.bumpScale.value*=-1)),g.displacementMap&&(m.displacementMap.value=g.displacementMap,m.displacementScale.value=g.displacementScale,m.displacementBias.value=g.displacementBias),g.emissiveMap&&(m.emissiveMap.value=g.emissiveMap),g.normalMap&&(m.normalMap.value=g.normalMap,m.normalScale.value.copy(g.normalScale),1===g.side&&m.normalScale.value.negate()),g.specularMap&&(m.specularMap.value=g.specularMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest);const v=e.get(g).envMap;if(v&&(m.envMap.value=v,m.flipEnvMap.value=v.isCubeTexture&&!1===v.isRenderTargetTexture?-1:1,m.reflectivity.value=g.reflectivity,m.ior.value=g.ior,m.refractionRatio.value=g.refractionRatio),g.lightMap){m.lightMap.value=g.lightMap;const _=!0!==n.physicallyCorrectLights?Math.PI:1;m.lightMapIntensity.value=g.lightMapIntensity*_}let y,M;g.aoMap&&(m.aoMap.value=g.aoMap,m.aoMapIntensity.value=g.aoMapIntensity),g.map?y=g.map:g.specularMap?y=g.specularMap:g.displacementMap?y=g.displacementMap:g.normalMap?y=g.normalMap:g.bumpMap?y=g.bumpMap:g.roughnessMap?y=g.roughnessMap:g.metalnessMap?y=g.metalnessMap:g.alphaMap?y=g.alphaMap:g.emissiveMap?y=g.emissiveMap:g.clearcoatMap?y=g.clearcoatMap:g.clearcoatNormalMap?y=g.clearcoatNormalMap:g.clearcoatRoughnessMap?y=g.clearcoatRoughnessMap:g.specularIntensityMap?y=g.specularIntensityMap:g.specularColorMap?y=g.specularColorMap:g.transmissionMap?y=g.transmissionMap:g.thicknessMap?y=g.thicknessMap:g.sheenColorMap?y=g.sheenColorMap:g.sheenRoughnessMap&&(y=g.sheenRoughnessMap),void 0!==y&&(y.isWebGLRenderTarget&&(y=y.texture),!0===y.matrixAutoUpdate&&y.updateMatrix(),m.uvTransform.value.copy(y.matrix)),g.aoMap?M=g.aoMap:g.lightMap&&(M=g.lightMap),void 0!==M&&(M.isWebGLRenderTarget&&(M=M.texture),!0===M.matrixAutoUpdate&&M.updateMatrix(),m.uv2Transform.value.copy(M.matrix))}return{refreshFogUniforms:function t(m,g){m.fogColor.value.copy(g.color),g.isFog?(m.fogNear.value=g.near,m.fogFar.value=g.far):g.isFogExp2&&(m.fogDensity.value=g.density)},refreshMaterialUniforms:function r(m,g,v,y,M){g.isMeshBasicMaterial||g.isMeshLambertMaterial?i(m,g):g.isMeshToonMaterial?(i(m,g),function u(m,g){g.gradientMap&&(m.gradientMap.value=g.gradientMap)}(m,g)):g.isMeshPhongMaterial?(i(m,g),function c(m,g){m.specular.value.copy(g.specular),m.shininess.value=Math.max(g.shininess,1e-4)}(m,g)):g.isMeshStandardMaterial?(i(m,g),function d(m,g){m.roughness.value=g.roughness,m.metalness.value=g.metalness,g.roughnessMap&&(m.roughnessMap.value=g.roughnessMap),g.metalnessMap&&(m.metalnessMap.value=g.metalnessMap),e.get(g).envMap&&(m.envMapIntensity.value=g.envMapIntensity)}(m,g),g.isMeshPhysicalMaterial&&function h(m,g,v){m.ior.value=g.ior,g.sheen>0&&(m.sheenColor.value.copy(g.sheenColor).multiplyScalar(g.sheen),m.sheenRoughness.value=g.sheenRoughness,g.sheenColorMap&&(m.sheenColorMap.value=g.sheenColorMap),g.sheenRoughnessMap&&(m.sheenRoughnessMap.value=g.sheenRoughnessMap)),g.clearcoat>0&&(m.clearcoat.value=g.clearcoat,m.clearcoatRoughness.value=g.clearcoatRoughness,g.clearcoatMap&&(m.clearcoatMap.value=g.clearcoatMap),g.clearcoatRoughnessMap&&(m.clearcoatRoughnessMap.value=g.clearcoatRoughnessMap),g.clearcoatNormalMap&&(m.clearcoatNormalScale.value.copy(g.clearcoatNormalScale),m.clearcoatNormalMap.value=g.clearcoatNormalMap,1===g.side&&m.clearcoatNormalScale.value.negate())),g.transmission>0&&(m.transmission.value=g.transmission,m.transmissionSamplerMap.value=v.texture,m.transmissionSamplerSize.value.set(v.width,v.height),g.transmissionMap&&(m.transmissionMap.value=g.transmissionMap),m.thickness.value=g.thickness,g.thicknessMap&&(m.thicknessMap.value=g.thicknessMap),m.attenuationDistance.value=g.attenuationDistance,m.attenuationColor.value.copy(g.attenuationColor)),m.specularIntensity.value=g.specularIntensity,m.specularColor.value.copy(g.specularColor),g.specularIntensityMap&&(m.specularIntensityMap.value=g.specularIntensityMap),g.specularColorMap&&(m.specularColorMap.value=g.specularColorMap)}(m,g,M)):g.isMeshMatcapMaterial?(i(m,g),function f(m,g){g.matcap&&(m.matcap.value=g.matcap)}(m,g)):g.isMeshDepthMaterial?i(m,g):g.isMeshDistanceMaterial?(i(m,g),function p(m,g){m.referencePosition.value.copy(g.referencePosition),m.nearDistance.value=g.nearDistance,m.farDistance.value=g.farDistance}(m,g)):g.isMeshNormalMaterial?i(m,g):g.isLineBasicMaterial?(function s(m,g){m.diffuse.value.copy(g.color),m.opacity.value=g.opacity}(m,g),g.isLineDashedMaterial&&function o(m,g){m.dashSize.value=g.dashSize,m.totalSize.value=g.dashSize+g.gapSize,m.scale.value=g.scale}(m,g)):g.isPointsMaterial?function a(m,g,v,y){let M;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.size.value=g.size*v,m.scale.value=.5*y,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?M=g.map:g.alphaMap&&(M=g.alphaMap),void 0!==M&&(!0===M.matrixAutoUpdate&&M.updateMatrix(),m.uvTransform.value.copy(M.matrix))}(m,g,v,y):g.isSpriteMaterial?function l(m,g){let v;m.diffuse.value.copy(g.color),m.opacity.value=g.opacity,m.rotation.value=g.rotation,g.map&&(m.map.value=g.map),g.alphaMap&&(m.alphaMap.value=g.alphaMap),g.alphaTest>0&&(m.alphaTest.value=g.alphaTest),g.map?v=g.map:g.alphaMap&&(v=g.alphaMap),void 0!==v&&(!0===v.matrixAutoUpdate&&v.updateMatrix(),m.uvTransform.value.copy(v.matrix))}(m,g):g.isShadowMaterial?(m.color.value.copy(g.color),m.opacity.value=g.opacity):g.isShaderMaterial&&(g.uniformsNeedUpdate=!1)}}}function Mt(n={}){const e=void 0!==n.canvas?n.canvas:function mj(){const n=Hc("canvas");return n.style.display="block",n}(),t=void 0!==n.context?n.context:null,r=void 0===n.depth||n.depth,i=void 0===n.stencil||n.stencil,s=void 0!==n.antialias&&n.antialias,o=void 0===n.premultipliedAlpha||n.premultipliedAlpha,a=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,l=void 0!==n.powerPreference?n.powerPreference:"default",c=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat;let u;u=null!==t?t.getContextAttributes().alpha:void 0!==n.alpha&&n.alpha;let d=null,h=null;const f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Oi,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const m=this;let g=!1,v=0,y=0,M=null,_=-1,x=null;const w=new wt,A=new wt;let b=null,C=e.width,R=e.height,P=1,U=null,Z=null;const L=new wt(0,0,C,R),k=new wt(0,0,C,R);let F=!1;const X=new Fh;let J=!1,H=!1,j=null;const ie=new Se,ne=new $,le=new S,Me={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Ee(){return null===M?P:1}let Ie,je,ae,et,K,Y,se,be,pe,We,Ne,De,Dt,St,N,E,G,re,de,ye,Re,z,qe,q=t;function ht(T,O){for(let V=0;V<T.length;V++){const ee=e.getContext(T[V],O);if(null!==ee)return ee}return null}try{const T={alpha:!0,depth:r,stencil:i,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r140"),e.addEventListener("webglcontextlost",D,!1),e.addEventListener("webglcontextrestored",W,!1),null===q){const O=["webgl2","webgl","experimental-webgl"];if(!0===m.isWebGL1Renderer&&O.shift(),q=ht(O,T),null===q)throw ht(O)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===q.getShaderPrecisionFormat&&(q.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(T){throw console.error("THREE.WebGLRenderer: "+T.message),T}function Ze(){Ie=new PV(q),je=new DV(q,Ie,n),Ie.init(je),z=new hj(q,Ie,je),ae=new uj(q,Ie,je),et=new OV(q),K=new Qz,Y=new dj(q,Ie,ae,K,je,z,et),se=new NV(m),be=new RV(m),pe=new TH(q,je),qe=new EV(q,Ie,pe,je),We=new LV(q,pe,et,qe),Ne=new HV(q,We,pe,et),de=new UV(q,je,Y),E=new TV(K),De=new Kz(m,se,be,Ie,je,qe,E),Dt=new gj(m,K),St=new tj,N=new aj(Ie,je),re=new SV(m,se,ae,Ne,u,o),G=new tD(m,Ne,je),ye=new CV(q,Ie,et,je),Re=new FV(q,Ie,et,je),et.programs=De.programs,m.capabilities=je,m.extensions=Ie,m.properties=K,m.renderLists=St,m.shadowMap=G,m.state=ae,m.info=et}Ze();const I=new pj(m,q);function D(T){T.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function W(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const T=et.autoReset,O=G.enabled,V=G.autoUpdate,B=G.needsUpdate,ee=G.type;Ze(),et.autoReset=T,G.enabled=O,G.autoUpdate=V,G.needsUpdate=B,G.type=ee}function Q(T){const O=T.target;O.removeEventListener("dispose",Q),function ve(T){(function ge(T){const O=K.get(T).programs;void 0!==O&&(O.forEach(function(V){De.releaseProgram(V)}),T.isShaderMaterial&&De.releaseShaderCache(T))})(T),K.remove(T)}(O)}this.xr=I,this.getContext=function(){return q},this.getContextAttributes=function(){return q.getContextAttributes()},this.forceContextLoss=function(){const T=Ie.get("WEBGL_lose_context");T&&T.loseContext()},this.forceContextRestore=function(){const T=Ie.get("WEBGL_lose_context");T&&T.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(T){void 0!==T&&(P=T,this.setSize(C,R,!1))},this.getSize=function(T){return T.set(C,R)},this.setSize=function(T,O,V){I.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=T,R=O,e.width=Math.floor(T*P),e.height=Math.floor(O*P),!1!==V&&(e.style.width=T+"px",e.style.height=O+"px"),this.setViewport(0,0,T,O))},this.getDrawingBufferSize=function(T){return T.set(C*P,R*P).floor()},this.setDrawingBufferSize=function(T,O,V){C=T,R=O,P=V,e.width=Math.floor(T*V),e.height=Math.floor(O*V),this.setViewport(0,0,T,O)},this.getCurrentViewport=function(T){return T.copy(w)},this.getViewport=function(T){return T.copy(L)},this.setViewport=function(T,O,V,B){T.isVector4?L.set(T.x,T.y,T.z,T.w):L.set(T,O,V,B),ae.viewport(w.copy(L).multiplyScalar(P).floor())},this.getScissor=function(T){return T.copy(k)},this.setScissor=function(T,O,V,B){T.isVector4?k.set(T.x,T.y,T.z,T.w):k.set(T,O,V,B),ae.scissor(A.copy(k).multiplyScalar(P).floor())},this.getScissorTest=function(){return F},this.setScissorTest=function(T){ae.setScissorTest(F=T)},this.setOpaqueSort=function(T){U=T},this.setTransparentSort=function(T){Z=T},this.getClearColor=function(T){return T.copy(re.getClearColor())},this.setClearColor=function(){re.setClearColor.apply(re,arguments)},this.getClearAlpha=function(){return re.getClearAlpha()},this.setClearAlpha=function(){re.setClearAlpha.apply(re,arguments)},this.clear=function(T=!0,O=!0,V=!0){let B=0;T&&(B|=16384),O&&(B|=256),V&&(B|=1024),q.clear(B)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",D,!1),e.removeEventListener("webglcontextrestored",W,!1),St.dispose(),N.dispose(),K.dispose(),se.dispose(),be.dispose(),Ne.dispose(),qe.dispose(),De.dispose(),I.dispose(),I.removeEventListener("sessionstart",Ce),I.removeEventListener("sessionend",tt),j&&(j.dispose(),j=null),pt.stop()},this.renderBufferDirect=function(T,O,V,B,ee,Be){null===O&&(O=Me);const Ke=ee.isMesh&&ee.matrixWorld.determinant()<0,ot=function I6(T,O,V,B,ee){!0!==O.isScene&&(O=Me),Y.resetTextureUnits();const Be=O.fog,ot=null===M?m.outputEncoding:!0===M.isXRRenderTarget?M.texture.encoding:Oi,nt=(B.isMeshStandardMaterial?be:se).get(B.envMap||(B.isMeshStandardMaterial?O.environment:null)),Et=!0===B.vertexColors&&!!V.attributes.color&&4===V.attributes.color.itemSize,gt=!!B.normalMap&&!!V.attributes.tangent,yt=!!V.morphAttributes.position,Jt=!!V.morphAttributes.normal,Do=!!V.morphAttributes.color,xl=B.toneMapped?m.toneMapping:0,wl=V.morphAttributes.position||V.morphAttributes.normal||V.morphAttributes.color,mi=void 0!==wl?wl.length:0,bt=K.get(B),Sl=h.state.lights;!0!==J||!0!==H&&T===x||E.setState(B,T,T===x&&B.id===_);let hn=!1;B.version===bt.__version?(bt.needsLights&&bt.lightsStateVersion!==Sl.state.version||bt.outputEncoding!==ot||ee.isInstancedMesh&&!1===bt.instancing||!ee.isInstancedMesh&&!0===bt.instancing||ee.isSkinnedMesh&&!1===bt.skinning||!ee.isSkinnedMesh&&!0===bt.skinning||bt.envMap!==nt||!0===B.fog&&bt.fog!==Be||void 0!==bt.numClippingPlanes&&(bt.numClippingPlanes!==E.numPlanes||bt.numIntersection!==E.numIntersection)||bt.vertexAlphas!==Et||bt.vertexTangents!==gt||bt.morphTargets!==yt||bt.morphNormals!==Jt||bt.morphColors!==Do||bt.toneMapping!==xl||!0===je.isWebGL2&&bt.morphTargetsCount!==mi)&&(hn=!0):(hn=!0,bt.__version=B.version);let yi=bt.currentProgram;!0===hn&&(yi=E_(B,O,ee));let Os=!1,Du=!1,C_=!1;const qn=yi.getUniforms(),Tu=bt.uniforms;if(ae.useProgram(yi.program)&&(Os=!0,Du=!0,C_=!0),B.id!==_&&(_=B.id,Du=!0),Os||x!==T){if(qn.setValue(q,"projectionMatrix",T.projectionMatrix),je.logarithmicDepthBuffer&&qn.setValue(q,"logDepthBufFC",2/(Math.log(T.far+1)/Math.LN2)),x!==T&&(x=T,Du=!0,C_=!0),B.isShaderMaterial||B.isMeshPhongMaterial||B.isMeshToonMaterial||B.isMeshStandardMaterial||B.envMap){const vi=qn.map.cameraPosition;void 0!==vi&&vi.setValue(q,le.setFromMatrixPosition(T.matrixWorld))}(B.isMeshPhongMaterial||B.isMeshToonMaterial||B.isMeshLambertMaterial||B.isMeshBasicMaterial||B.isMeshStandardMaterial||B.isShaderMaterial)&&qn.setValue(q,"isOrthographic",!0===T.isOrthographicCamera),(B.isMeshPhongMaterial||B.isMeshToonMaterial||B.isMeshLambertMaterial||B.isMeshBasicMaterial||B.isMeshStandardMaterial||B.isShaderMaterial||B.isShadowMaterial||ee.isSkinnedMesh)&&qn.setValue(q,"viewMatrix",T.matrixWorldInverse)}if(ee.isSkinnedMesh){qn.setOptional(q,ee,"bindMatrix"),qn.setOptional(q,ee,"bindMatrixInverse");const vi=ee.skeleton;vi&&(je.floatVertexTextures?(null===vi.boneTexture&&vi.computeBoneTexture(),qn.setValue(q,"boneTexture",vi.boneTexture,Y),qn.setValue(q,"boneTextureSize",vi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const D_=V.morphAttributes;return(void 0!==D_.position||void 0!==D_.normal||void 0!==D_.color&&!0===je.isWebGL2)&&de.update(ee,V,B,yi),(Du||bt.receiveShadow!==ee.receiveShadow)&&(bt.receiveShadow=ee.receiveShadow,qn.setValue(q,"receiveShadow",ee.receiveShadow)),Du&&(qn.setValue(q,"toneMappingExposure",m.toneMappingExposure),bt.needsLights&&function R6(T,O){T.ambientLightColor.needsUpdate=O,T.lightProbe.needsUpdate=O,T.directionalLights.needsUpdate=O,T.directionalLightShadows.needsUpdate=O,T.pointLights.needsUpdate=O,T.pointLightShadows.needsUpdate=O,T.spotLights.needsUpdate=O,T.spotLightShadows.needsUpdate=O,T.rectAreaLights.needsUpdate=O,T.hemisphereLights.needsUpdate=O}(Tu,C_),Be&&!0===B.fog&&Dt.refreshFogUniforms(Tu,Be),Dt.refreshMaterialUniforms(Tu,B,P,R,j),Ss.upload(q,bt.uniformsList,Tu,Y)),B.isShaderMaterial&&!0===B.uniformsNeedUpdate&&(Ss.upload(q,bt.uniformsList,Tu,Y),B.uniformsNeedUpdate=!1),B.isSpriteMaterial&&qn.setValue(q,"center",ee.center),qn.setValue(q,"modelViewMatrix",ee.modelViewMatrix),qn.setValue(q,"normalMatrix",ee.normalMatrix),qn.setValue(q,"modelMatrix",ee.matrixWorld),yi}(T,O,V,B,ee);ae.setMaterial(B,Ke);let nt=V.index;const Et=V.attributes.position;if(null===nt){if(void 0===Et||0===Et.count)return}else if(0===nt.count)return;let gt=1;!0===B.wireframe&&(nt=We.getWireframeAttribute(V),gt=2),qe.setup(ee,B,ot,V,nt);let yt,Jt=ye;null!==nt&&(yt=pe.get(nt),Jt=Re,Jt.setIndex(yt));const Do=null!==nt?nt.count:Et.count,xl=V.drawRange.start*gt,wl=V.drawRange.count*gt,mi=null!==Be?Be.start*gt:0,bt=null!==Be?Be.count*gt:1/0,Sl=Math.max(xl,mi),hn=Math.min(Do,xl+wl,mi+bt)-1,yi=Math.max(0,hn-Sl+1);if(0!==yi){if(ee.isMesh)!0===B.wireframe?(ae.setLineWidth(B.wireframeLinewidth*Ee()),Jt.setMode(1)):Jt.setMode(4);else if(ee.isLine){let Os=B.linewidth;void 0===Os&&(Os=1),ae.setLineWidth(Os*Ee()),Jt.setMode(ee.isLineSegments?1:ee.isLineLoop?2:3)}else ee.isPoints?Jt.setMode(0):ee.isSprite&&Jt.setMode(4);if(ee.isInstancedMesh)Jt.renderInstances(Sl,yi,ee.count);else if(V.isInstancedBufferGeometry){const Os=Math.min(V.instanceCount,V._maxInstanceCount);Jt.renderInstances(Sl,yi,Os)}else Jt.render(Sl,yi)}},this.compile=function(T,O){h=N.get(T),h.init(),p.push(h),T.traverseVisible(function(V){V.isLight&&V.layers.test(O.layers)&&(h.pushLight(V),V.castShadow&&h.pushShadow(V))}),h.setupLights(m.physicallyCorrectLights),T.traverse(function(V){const B=V.material;if(B)if(Array.isArray(B))for(let ee=0;ee<B.length;ee++)E_(B[ee],T,V);else E_(B,T,V)}),p.pop(),h=null};let Ae=null;function Ce(){pt.stop()}function tt(){pt.start()}const pt=new CC;function pi(T,O,V,B){if(!1===T.visible)return;if(T.layers.test(O.layers))if(T.isGroup)V=T.renderOrder;else if(T.isLOD)!0===T.autoUpdate&&T.update(O);else if(T.isLight)h.pushLight(T),T.castShadow&&h.pushShadow(T);else if(T.isSprite){if(!T.frustumCulled||X.intersectsSprite(T)){B&&le.setFromMatrixPosition(T.matrixWorld).applyMatrix4(ie);const Ke=Ne.update(T),ot=T.material;ot.visible&&d.push(T,Ke,ot,V,le.z,null)}}else if((T.isMesh||T.isLine||T.isPoints)&&(T.isSkinnedMesh&&T.skeleton.frame!==et.render.frame&&(T.skeleton.update(),T.skeleton.frame=et.render.frame),!T.frustumCulled||X.intersectsObject(T))){B&&le.setFromMatrixPosition(T.matrixWorld).applyMatrix4(ie);const Ke=Ne.update(T),ot=T.material;if(Array.isArray(ot)){const nt=Ke.groups;for(let Et=0,gt=nt.length;Et<gt;Et++){const yt=nt[Et],Jt=ot[yt.materialIndex];Jt&&Jt.visible&&d.push(T,Ke,Jt,V,le.z,yt)}}else ot.visible&&d.push(T,Ke,ot,V,le.z,null)}const Be=T.children;for(let Ke=0,ot=Be.length;Ke<ot;Ke++)pi(Be[Ke],O,V,B)}function gi(T,O,V,B){const ee=T.opaque,Be=T.transmissive,Ke=T.transparent;h.setupLightsView(V),Be.length>0&&function N6(T,O,V){const B=je.isWebGL2;null===j&&(j=new dr(1,1,{generateMipmaps:!0,type:Ie.has("EXT_color_buffer_half_float")?Fc:to,minFilter:1008,samples:B&&!0===s?4:0})),m.getDrawingBufferSize(ne),B?j.setSize(ne.x,ne.y):j.setSize(hh(ne.x),hh(ne.y));const ee=m.getRenderTarget();m.setRenderTarget(j),m.clear();const Be=m.toneMapping;m.toneMapping=0,Jf(T,O,V),m.toneMapping=Be,Y.updateMultisampleRenderTarget(j),Y.updateRenderTargetMipmap(j),m.setRenderTarget(ee)}(ee,O,V),B&&ae.viewport(w.copy(B)),ee.length>0&&Jf(ee,O,V),Be.length>0&&Jf(Be,O,V),Ke.length>0&&Jf(Ke,O,V),ae.buffers.depth.setTest(!0),ae.buffers.depth.setMask(!0),ae.buffers.color.setMask(!0),ae.setPolygonOffset(!1)}function Jf(T,O,V){const B=!0===O.isScene?O.overrideMaterial:null;for(let ee=0,Be=T.length;ee<Be;ee++){const Ke=T[ee],ot=Ke.object,nt=Ke.geometry,Et=null===B?Ke.material:B,gt=Ke.group;ot.layers.test(V.layers)&&A6(ot,O,V,nt,Et,gt)}}function A6(T,O,V,B,ee,Be){T.onBeforeRender(m,O,V,B,ee,Be),T.modelViewMatrix.multiplyMatrices(V.matrixWorldInverse,T.matrixWorld),T.normalMatrix.getNormalMatrix(T.modelViewMatrix),ee.onBeforeRender(m,O,V,B,T,Be),!0===ee.transparent&&2===ee.side?(ee.side=1,ee.needsUpdate=!0,m.renderBufferDirect(V,O,B,ee,T,Be),ee.side=0,ee.needsUpdate=!0,m.renderBufferDirect(V,O,B,ee,T,Be),ee.side=2):m.renderBufferDirect(V,O,B,ee,T,Be),T.onAfterRender(m,O,V,B,ee,Be)}function E_(T,O,V){!0!==O.isScene&&(O=Me);const B=K.get(T),ee=h.state.lights,Ke=ee.state.version,ot=De.getParameters(T,ee.state,h.state.shadowsArray,O,V),nt=De.getProgramCacheKey(ot);let Et=B.programs;B.environment=T.isMeshStandardMaterial?O.environment:null,B.fog=O.fog,B.envMap=(T.isMeshStandardMaterial?be:se).get(T.envMap||B.environment),void 0===Et&&(T.addEventListener("dispose",Q),Et=new Map,B.programs=Et);let gt=Et.get(nt);if(void 0!==gt){if(B.currentProgram===gt&&B.lightsStateVersion===Ke)return oA(T,ot),gt}else ot.uniforms=De.getUniforms(T),T.onBuild(V,ot,m),T.onBeforeCompile(ot,m),gt=De.acquireProgram(ot,nt),Et.set(nt,gt),B.uniforms=ot.uniforms;const yt=B.uniforms;(!T.isShaderMaterial&&!T.isRawShaderMaterial||!0===T.clipping)&&(yt.clippingPlanes=E.uniform),oA(T,ot),B.needsLights=function P6(T){return T.isMeshLambertMaterial||T.isMeshToonMaterial||T.isMeshPhongMaterial||T.isMeshStandardMaterial||T.isShadowMaterial||T.isShaderMaterial&&!0===T.lights}(T),B.lightsStateVersion=Ke,B.needsLights&&(yt.ambientLightColor.value=ee.state.ambient,yt.lightProbe.value=ee.state.probe,yt.directionalLights.value=ee.state.directional,yt.directionalLightShadows.value=ee.state.directionalShadow,yt.spotLights.value=ee.state.spot,yt.spotLightShadows.value=ee.state.spotShadow,yt.rectAreaLights.value=ee.state.rectArea,yt.ltc_1.value=ee.state.rectAreaLTC1,yt.ltc_2.value=ee.state.rectAreaLTC2,yt.pointLights.value=ee.state.point,yt.pointLightShadows.value=ee.state.pointShadow,yt.hemisphereLights.value=ee.state.hemi,yt.directionalShadowMap.value=ee.state.directionalShadowMap,yt.directionalShadowMatrix.value=ee.state.directionalShadowMatrix,yt.spotShadowMap.value=ee.state.spotShadowMap,yt.spotShadowMatrix.value=ee.state.spotShadowMatrix,yt.pointShadowMap.value=ee.state.pointShadowMap,yt.pointShadowMatrix.value=ee.state.pointShadowMatrix);const Jt=gt.getUniforms(),Do=Ss.seqWithValue(Jt.seq,yt);return B.currentProgram=gt,B.uniformsList=Do,gt}function oA(T,O){const V=K.get(T);V.outputEncoding=O.outputEncoding,V.instancing=O.instancing,V.skinning=O.skinning,V.morphTargets=O.morphTargets,V.morphNormals=O.morphNormals,V.morphColors=O.morphColors,V.morphTargetsCount=O.morphTargetsCount,V.numClippingPlanes=O.numClippingPlanes,V.numIntersection=O.numClipIntersection,V.vertexAlphas=O.vertexAlphas,V.vertexTangents=O.vertexTangents,V.toneMapping=O.toneMapping}pt.setAnimationLoop(function oe(T){Ae&&Ae(T)}),"undefined"!=typeof self&&pt.setContext(self),this.setAnimationLoop=function(T){Ae=T,I.setAnimationLoop(T),null===T?pt.stop():pt.start()},I.addEventListener("sessionstart",Ce),I.addEventListener("sessionend",tt),this.render=function(T,O){if(void 0===O||!0===O.isCamera){if(!0!==g){if(!0===T.autoUpdate&&T.updateMatrixWorld(),null===O.parent&&O.updateMatrixWorld(),!0===I.enabled&&!0===I.isPresenting&&(!0===I.cameraAutoUpdate&&I.updateCamera(O),O=I.getCamera()),!0===T.isScene&&T.onBeforeRender(m,T,O,M),h=N.get(T,p.length),h.init(),p.push(h),ie.multiplyMatrices(O.projectionMatrix,O.matrixWorldInverse),X.setFromProjectionMatrix(ie),H=this.localClippingEnabled,J=E.init(this.clippingPlanes,H,O),d=St.get(T,f.length),d.init(),f.push(d),pi(T,O,0,m.sortObjects),d.finish(),!0===m.sortObjects&&d.sort(U,Z),!0===J&&E.beginShadows(),G.render(h.state.shadowsArray,T,O),!0===J&&E.endShadows(),!0===this.info.autoReset&&this.info.reset(),re.render(d,T),h.setupLights(m.physicallyCorrectLights),O.isArrayCamera){const B=O.cameras;for(let ee=0,Be=B.length;ee<Be;ee++){const Ke=B[ee];gi(d,T,Ke,Ke.viewport)}}else gi(d,T,O);null!==M&&(Y.updateMultisampleRenderTarget(M),Y.updateRenderTargetMipmap(M)),!0===T.isScene&&T.onAfterRender(m,T,O),qe.resetDefaultState(),_=-1,x=null,p.pop(),h=p.length>0?p[p.length-1]:null,f.pop(),d=f.length>0?f[f.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return v},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return M},this.setRenderTargetTextures=function(T,O,V){K.get(T.texture).__webglTexture=O,K.get(T.depthTexture).__webglTexture=V;const B=K.get(T);B.__hasExternalTextures=!0,B.__hasExternalTextures&&(B.__autoAllocateDepthBuffer=void 0===V,B.__autoAllocateDepthBuffer||!0===Ie.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),B.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(T,O){const V=K.get(T);V.__webglFramebuffer=O,V.__useDefaultFramebuffer=void 0===O},this.setRenderTarget=function(T,O=0,V=0){M=T,v=O,y=V;let B=!0;if(T){const nt=K.get(T);void 0!==nt.__useDefaultFramebuffer?(ae.bindFramebuffer(36160,null),B=!1):void 0===nt.__webglFramebuffer?Y.setupRenderTarget(T):nt.__hasExternalTextures&&Y.rebindTextures(T,K.get(T.texture).__webglTexture,K.get(T.depthTexture).__webglTexture)}let ee=null,Be=!1,Ke=!1;if(T){const nt=T.texture;(nt.isData3DTexture||nt.isDataArrayTexture)&&(Ke=!0);const Et=K.get(T).__webglFramebuffer;T.isWebGLCubeRenderTarget?(ee=Et[O],Be=!0):ee=je.isWebGL2&&T.samples>0&&!1===Y.useMultisampledRTT(T)?K.get(T).__webglMultisampledFramebuffer:Et,w.copy(T.viewport),A.copy(T.scissor),b=T.scissorTest}else w.copy(L).multiplyScalar(P).floor(),A.copy(k).multiplyScalar(P).floor(),b=F;if(ae.bindFramebuffer(36160,ee)&&je.drawBuffers&&B&&ae.drawBuffers(T,ee),ae.viewport(w),ae.scissor(A),ae.setScissorTest(b),Be){const nt=K.get(T.texture);q.framebufferTexture2D(36160,36064,34069+O,nt.__webglTexture,V)}else if(Ke){const nt=K.get(T.texture);q.framebufferTextureLayer(36160,36064,nt.__webglTexture,V||0,O||0)}_=-1},this.readRenderTargetPixels=function(T,O,V,B,ee,Be,Ke){if(!T||!T.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ot=K.get(T).__webglFramebuffer;if(T.isWebGLCubeRenderTarget&&void 0!==Ke&&(ot=ot[Ke]),ot){ae.bindFramebuffer(36160,ot);try{const nt=T.texture,Et=nt.format,gt=nt.type;if(Et!==Dr&&z.convert(Et)!==q.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const yt=gt===Fc&&(Ie.has("EXT_color_buffer_half_float")||je.isWebGL2&&Ie.has("EXT_color_buffer_float"));if(!(gt===to||z.convert(gt)===q.getParameter(35738)||gt===hs&&(je.isWebGL2||Ie.has("OES_texture_float")||Ie.has("WEBGL_color_buffer_float"))||yt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");O>=0&&O<=T.width-B&&V>=0&&V<=T.height-ee&&q.readPixels(O,V,B,ee,z.convert(Et),z.convert(gt),Be)}finally{const nt=null!==M?K.get(M).__webglFramebuffer:null;ae.bindFramebuffer(36160,nt)}}},this.copyFramebufferToTexture=function(T,O,V=0){if(!0!==O.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const B=Math.pow(2,-V),ee=Math.floor(O.image.width*B),Be=Math.floor(O.image.height*B);Y.setTexture2D(O,0),q.copyTexSubImage2D(3553,V,0,0,T.x,T.y,ee,Be),ae.unbindTexture()},this.copyTextureToTexture=function(T,O,V,B=0){const ee=O.image.width,Be=O.image.height,Ke=z.convert(V.format),ot=z.convert(V.type);Y.setTexture2D(V,0),q.pixelStorei(37440,V.flipY),q.pixelStorei(37441,V.premultiplyAlpha),q.pixelStorei(3317,V.unpackAlignment),O.isDataTexture?q.texSubImage2D(3553,B,T.x,T.y,ee,Be,Ke,ot,O.image.data):O.isCompressedTexture?q.compressedTexSubImage2D(3553,B,T.x,T.y,O.mipmaps[0].width,O.mipmaps[0].height,Ke,O.mipmaps[0].data):q.texSubImage2D(3553,B,T.x,T.y,Ke,ot,O.image),0===B&&V.generateMipmaps&&q.generateMipmap(3553),ae.unbindTexture()},this.copyTextureToTexture3D=function(T,O,V,B,ee=0){if(m.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Be=T.max.x-T.min.x+1,Ke=T.max.y-T.min.y+1,ot=T.max.z-T.min.z+1,nt=z.convert(B.format),Et=z.convert(B.type);let gt;if(B.isData3DTexture)Y.setTexture3D(B,0),gt=32879;else{if(!B.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Y.setTexture2DArray(B,0),gt=35866}q.pixelStorei(37440,B.flipY),q.pixelStorei(37441,B.premultiplyAlpha),q.pixelStorei(3317,B.unpackAlignment);const yt=q.getParameter(3314),Jt=q.getParameter(32878),Do=q.getParameter(3316),xl=q.getParameter(3315),wl=q.getParameter(32877),mi=V.isCompressedTexture?V.mipmaps[0]:V.image;q.pixelStorei(3314,mi.width),q.pixelStorei(32878,mi.height),q.pixelStorei(3316,T.min.x),q.pixelStorei(3315,T.min.y),q.pixelStorei(32877,T.min.z),V.isDataTexture||V.isData3DTexture?q.texSubImage3D(gt,ee,O.x,O.y,O.z,Be,Ke,ot,nt,Et,mi.data):V.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),q.compressedTexSubImage3D(gt,ee,O.x,O.y,O.z,Be,Ke,ot,nt,mi.data)):q.texSubImage3D(gt,ee,O.x,O.y,O.z,Be,Ke,ot,nt,Et,mi),q.pixelStorei(3314,yt),q.pixelStorei(32878,Jt),q.pixelStorei(3316,Do),q.pixelStorei(3315,xl),q.pixelStorei(32877,wl),0===ee&&B.generateMipmaps&&q.generateMipmap(gt),ae.unbindTexture()},this.initTexture=function(T){Y.setTexture2D(T,0),ae.unbindTexture()},this.resetState=function(){v=0,y=0,M=null,ae.reset(),qe.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Mt.prototype.isWebGLRenderer=!0,class yj extends Mt{}.prototype.isWebGL1Renderer=!0;class Bh{constructor(e,t=25e-5){this.name="",this.color=new ce(e),this.density=t}clone(){return new Bh(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}Bh.prototype.isFogExp2=!0;class Uh{constructor(e,t=1,r=1e3){this.name="",this.color=new ce(e),this.near=t,this.far=r}clone(){return new Uh(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Uh.prototype.isFog=!0;class Hh extends _t{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}Hh.prototype.isScene=!0;class Qa{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=Oc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ur()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,r){e*=this.stride,r*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[r+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ur()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),r=new this.constructor(t,this.stride);return r.setUsage(this.usage),r}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ur()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}Qa.prototype.isInterleavedBuffer=!0;const $n=new S;class go{constructor(e,t,r,i=!1){this.name="",this.data=e,this.itemSize=t,this.offset=r,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,r=this.data.count;t<r;t++)$n.fromBufferAttribute(this,t),$n.applyMatrix4(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)$n.fromBufferAttribute(this,t),$n.applyNormalMatrix(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)$n.fromBufferAttribute(this,t),$n.transformDirection(e),this.setXYZ(t,$n.x,$n.y,$n.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,r){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=r,this}setXYZ(e,t,r,i){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this}setXYZW(e,t,r,i,s){return this.data.array[(e=e*this.data.stride+this.offset)+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new Pt(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new go(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let r=0;r<this.count;r++){const i=r*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}go.prototype.isInterleavedBufferAttribute=!0;class gv extends un{constructor(e){super(),this.type="SpriteMaterial",this.color=new ce(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let el;gv.prototype.isSpriteMaterial=!0;const qc=new S,tl=new S,nl=new S,rl=new $,Zc=new $,iD=new Se,Gh=new S,Xc=new S,Vh=new S,sD=new $,mv=new $,oD=new $;function zh(n,e,t,r,i,s){rl.subVectors(n,t).addScalar(.5).multiply(r),void 0!==i?(Zc.x=s*rl.x-i*rl.y,Zc.y=i*rl.x+s*rl.y):Zc.copy(rl),n.copy(e),n.x+=Zc.x,n.y+=Zc.y,n.applyMatrix4(iD)}(class aD extends _t{constructor(e){if(super(),this.type="Sprite",void 0===el){el=new Le;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),r=new Qa(t,5);el.setIndex([0,1,2,0,2,3]),el.setAttribute("position",new go(r,3,0,!1)),el.setAttribute("uv",new go(r,2,3,!1))}this.geometry=el,this.material=void 0!==e?e:new gv,this.center=new $(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),tl.setFromMatrixScale(this.matrixWorld),iD.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),nl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&tl.multiplyScalar(-nl.z);const r=this.material.rotation;let i,s;0!==r&&(s=Math.cos(r),i=Math.sin(r));const o=this.center;zh(Gh.set(-.5,-.5,0),nl,o,tl,i,s),zh(Xc.set(.5,-.5,0),nl,o,tl,i,s),zh(Vh.set(.5,.5,0),nl,o,tl,i,s),sD.set(0,0),mv.set(1,0),oD.set(1,1);let a=e.ray.intersectTriangle(Gh,Xc,Vh,!1,qc);if(null===a&&(zh(Xc.set(-.5,.5,0),nl,o,tl,i,s),mv.set(0,1),a=e.ray.intersectTriangle(Gh,Vh,Xc,!1,qc),null===a))return;const l=e.ray.origin.distanceTo(qc);l<e.near||l>e.far||t.push({distance:l,point:qc.clone(),uv:cn.getUV(qc,Gh,Xc,Vh,sD,mv,oD,new $),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}).prototype.isSprite=!0;const cD=new S,uD=new wt,dD=new wt,_j=new S,hD=new Se;class yv extends Mn{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Se,this.bindMatrixInverse=new Se}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new wt,t=this.geometry.attributes.skinWeight;for(let r=0,i=t.count;r<i;r++){e.fromBufferAttribute(t,r);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const r=this.skeleton,i=this.geometry;uD.fromBufferAttribute(i.attributes.skinIndex,e),dD.fromBufferAttribute(i.attributes.skinWeight,e),cD.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=dD.getComponent(s);if(0!==o){const a=uD.getComponent(s);hD.multiplyMatrices(r.bones[a].matrixWorld,r.boneInverses[a]),t.addScaledVector(_j.copy(cD).applyMatrix4(hD),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}yv.prototype.isSkinnedMesh=!0;(class vv extends _t{constructor(){super(),this.type="Bone"}}).prototype.isBone=!0;(class il extends zn{constructor(e=null,t=1,r=1,i,s,o,a,l,c=vn,u=vn,d,h){super(null,o,a,l,c,u,i,s,d,h),this.image={data:e,width:t,height:r},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}).prototype.isDataTexture=!0;class sl extends Pt{constructor(e,t,r,i=1){"number"==typeof r&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,r),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}sl.prototype.isInstancedBufferAttribute=!0;const pD=new Se,gD=new Se,Wh=[],Yc=new Mn;(class mD extends Mn{constructor(e,t,r){super(e,t),this.instanceMatrix=new sl(new Float32Array(16*r),16),this.instanceColor=null,this.count=r,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const r=this.matrixWorld,i=this.count;if(Yc.geometry=this.geometry,Yc.material=this.material,void 0!==Yc.material)for(let s=0;s<i;s++){this.getMatrixAt(s,pD),gD.multiplyMatrices(r,pD),Yc.matrixWorld=gD,Yc.raycast(e,Wh);for(let o=0,a=Wh.length;o<a;o++){const l=Wh[o];l.instanceId=s,l.object=this,t.push(l)}Wh.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new sl(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}).prototype.isInstancedMesh=!0;class An extends un{constructor(e){super(),this.type="LineBasicMaterial",this.color=new ce(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}An.prototype.isLineBasicMaterial=!0;const yD=new S,vD=new S,_D=new Se,Mv=new ho,$h=new uo;class mo extends _t{constructor(e=new Le,t=new An){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,r=[0];for(let i=1,s=t.count;i<s;i++)yD.fromBufferAttribute(t,i-1),vD.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=yD.distanceTo(vD);e.setAttribute("lineDistance",new we(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,o=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),$h.copy(r.boundingSphere),$h.applyMatrix4(i),$h.radius+=s,!1===e.ray.intersectsSphere($h))return;_D.copy(i).invert(),Mv.copy(e.ray).applyMatrix4(_D);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new S,u=new S,d=new S,h=new S,f=this.isLineSegments?2:1;if(r.isBufferGeometry){const p=r.index,g=r.attributes.position;if(null!==p)for(let M=Math.max(0,o.start),_=Math.min(p.count,o.start+o.count)-1;M<_;M+=f){const x=p.getX(M),w=p.getX(M+1);if(c.fromBufferAttribute(g,x),u.fromBufferAttribute(g,w),Mv.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:d.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}else for(let M=Math.max(0,o.start),_=Math.min(g.count,o.start+o.count)-1;M<_;M+=f){if(c.fromBufferAttribute(g,M),u.fromBufferAttribute(g,M+1),Mv.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const w=e.ray.origin.distanceTo(h);w<e.near||w>e.far||t.push({distance:w,point:d.clone().applyMatrix4(this.matrixWorld),index:M,face:null,faceIndex:null,object:this})}}else r.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}mo.prototype.isLine=!0;const MD=new S,bD=new S;class ol extends mo{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,r=[];for(let i=0,s=t.count;i<s;i+=2)MD.fromBufferAttribute(t,i),bD.fromBufferAttribute(t,i+1),r[i]=0===i?0:r[i-1],r[i+1]=r[i]+MD.distanceTo(bD);e.setAttribute("lineDistance",new we(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ol.prototype.isLineSegments=!0;(class xD extends mo{constructor(e,t){super(e,t),this.type="LineLoop"}}).prototype.isLineLoop=!0;class bv extends un{constructor(e){super(),this.type="PointsMaterial",this.color=new ce(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}bv.prototype.isPointsMaterial=!0;const wD=new Se,xv=new ho,qh=new uo,Zh=new S;function ED(n,e,t,r,i,s,o){const a=xv.distanceSqToPoint(n);if(a<t){const l=new S;xv.closestPointToPoint(n,l),l.applyMatrix4(r);const c=i.ray.origin.distanceTo(l);if(c<i.near||c>i.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:l,index:e,face:null,object:o})}}(class SD extends _t{constructor(e=new Le,t=new bv){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const r=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=r.drawRange;if(null===r.boundingSphere&&r.computeBoundingSphere(),qh.copy(r.boundingSphere),qh.applyMatrix4(i),qh.radius+=s,!1===e.ray.intersectsSphere(qh))return;wD.copy(i).invert(),xv.copy(e.ray).applyMatrix4(wD);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a;if(r.isBufferGeometry){const c=r.index,d=r.attributes.position;if(null!==c)for(let p=Math.max(0,o.start),m=Math.min(c.count,o.start+o.count);p<m;p++){const g=c.getX(p);Zh.fromBufferAttribute(d,g),ED(Zh,g,l,i,e,t,this)}else for(let p=Math.max(0,o.start),m=Math.min(d.count,o.start+o.count);p<m;p++)Zh.fromBufferAttribute(d,p),ED(Zh,p,l,i,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}).prototype.isPoints=!0,class bj extends zn{constructor(e,t,r,i,s,o,a,l,c){super(e,t,r,i,s,o,a,l,c),this.minFilter=void 0!==o?o:an,this.magFilter=void 0!==s?s:an,this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(function d(){u.needsUpdate=!0,e.requestVideoFrameCallback(d)})}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e==0&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}.prototype.isVideoTexture=!0,class xj extends zn{constructor(e,t,r){super({width:e,height:t}),this.format=r,this.magFilter=vn,this.minFilter=vn,this.generateMipmaps=!1,this.needsUpdate=!0}}.prototype.isFramebufferTexture=!0;(class CD extends zn{constructor(e,t,r,i,s,o,a,l,c,u,d,h){super(null,o,a,l,c,u,i,s,d,h),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}).prototype.isCompressedTexture=!0,class wj extends zn{constructor(e,t,r,i,s,o,a,l,c){super(e,t,r,i,s,o,a,l,c),this.needsUpdate=!0}}.prototype.isCanvasTexture=!0;class Ar{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const r=this.getUtoTmapping(e);return this.getPoint(r,t)}getPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return t}getSpacedPoints(e=5){const t=[];for(let r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let r,i=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)r=this.getPoint(o/e),s+=r.distanceTo(i),t.push(s),i=r;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const r=this.getLengths();let i=0;const s=r.length;let o;o=t||e*r[s-1];let c,a=0,l=s-1;for(;a<=l;)if(i=Math.floor(a+(l-a)/2),c=r[i]-o,c<0)a=i+1;else{if(!(c>0)){l=i;break}l=i-1}if(i=l,r[i]===o)return i/(s-1);const u=r[i];return(i+(o-u)/(r[i+1]-u))/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const o=this.getPoint(i),a=this.getPoint(s),l=t||(o.isVector2?new $:new S);return l.copy(a).sub(o).normalize(),l}getTangentAt(e,t){const r=this.getUtoTmapping(e);return this.getTangent(r,t)}computeFrenetFrames(e,t){const r=new S,i=[],s=[],o=[],a=new S,l=new Se;for(let f=0;f<=e;f++)i[f]=this.getTangentAt(f/e,new S);s[0]=new S,o[0]=new S;let c=Number.MAX_VALUE;const u=Math.abs(i[0].x),d=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=c&&(c=u,r.set(1,0,0)),d<=c&&(c=d,r.set(0,1,0)),h<=c&&r.set(0,0,1),a.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],a),o[0].crossVectors(i[0],s[0]);for(let f=1;f<=e;f++){if(s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),a.crossVectors(i[f-1],i[f]),a.length()>Number.EPSILON){a.normalize();const p=Math.acos(en(i[f-1].dot(i[f]),-1,1));s[f].applyMatrix4(l.makeRotationAxis(a,p))}o[f].crossVectors(i[f],s[f])}if(!0===t){let f=Math.acos(en(s[0].dot(s[e]),-1,1));f/=e,i[0].dot(a.crossVectors(s[0],s[e]))>0&&(f=-f);for(let p=1;p<=e;p++)s[p].applyMatrix4(l.makeRotationAxis(i[p],f*p)),o[p].crossVectors(i[p],s[p])}return{tangents:i,normals:s,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Xh extends Ar{constructor(e=0,t=0,r=1,i=1,s=0,o=2*Math.PI,a=!1,l=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=r,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=a,this.aRotation=l}getPoint(e,t){const r=t||new $,i=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(s=o?0:i),!0===this.aClockwise&&!o&&(s===i?s=-i:s-=i);const a=this.aStartAngle+e*s;let l=this.aX+this.xRadius*Math.cos(a),c=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const u=Math.cos(this.aRotation),d=Math.sin(this.aRotation),h=l-this.aX,f=c-this.aY;l=h*u-f*d+this.aX,c=h*d+f*u+this.aY}return r.set(l,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Xh.prototype.isEllipseCurve=!0;class DD extends Xh{constructor(e,t,r,i,s,o){super(e,t,r,r,i,s,o),this.type="ArcCurve"}}function wv(){let n=0,e=0,t=0,r=0;function i(s,o,a,l){n=s,e=a,t=-3*s+3*o-2*a-l,r=2*s-2*o+a+l}return{initCatmullRom:function(s,o,a,l,c){i(o,a,c*(a-s),c*(l-o))},initNonuniformCatmullRom:function(s,o,a,l,c,u,d){let h=(o-s)/c-(a-s)/(c+u)+(a-o)/u,f=(a-o)/u-(l-o)/(u+d)+(l-a)/d;h*=u,f*=u,i(o,a,h,f)},calc:function(s){const o=s*s;return n+e*s+t*o+r*(o*s)}}}DD.prototype.isArcCurve=!0;const Yh=new S,Sv=new wv,Ev=new wv,Cv=new wv;class TD extends Ar{constructor(e=[],t=!1,r="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=r,this.tension=i}getPoint(e,t=new S){const r=t,i=this.points,s=i.length,o=(s-(this.closed?0:1))*e;let c,u,a=Math.floor(o),l=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s:0===l&&a===s-1&&(a=s-2,l=1),this.closed||a>0?c=i[(a-1)%s]:(Yh.subVectors(i[0],i[1]).add(i[0]),c=Yh);const d=i[a%s],h=i[(a+1)%s];if(this.closed||a+2<s?u=i[(a+2)%s]:(Yh.subVectors(i[s-1],i[s-2]).add(i[s-1]),u=Yh),"centripetal"===this.curveType||"chordal"===this.curveType){const f="chordal"===this.curveType?.5:.25;let p=Math.pow(c.distanceToSquared(d),f),m=Math.pow(d.distanceToSquared(h),f),g=Math.pow(h.distanceToSquared(u),f);m<1e-4&&(m=1),p<1e-4&&(p=m),g<1e-4&&(g=m),Sv.initNonuniformCatmullRom(c.x,d.x,h.x,u.x,p,m,g),Ev.initNonuniformCatmullRom(c.y,d.y,h.y,u.y,p,m,g),Cv.initNonuniformCatmullRom(c.z,d.z,h.z,u.z,p,m,g)}else"catmullrom"===this.curveType&&(Sv.initCatmullRom(c.x,d.x,h.x,u.x,this.tension),Ev.initCatmullRom(c.y,d.y,h.y,u.y,this.tension),Cv.initCatmullRom(c.z,d.z,h.z,u.z,this.tension));return r.set(Sv.calc(l),Ev.calc(l),Cv.calc(l)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push((new S).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function ND(n,e,t,r,i){const s=.5*(r-e),o=.5*(i-t),a=n*n;return(2*t-2*r+s+o)*(n*a)+(-3*t+3*r-2*s-o)*a+s*n+t}function Jc(n,e,t,r){return function Sj(n,e){const t=1-n;return t*t*e}(n,e)+function Ej(n,e){return 2*(1-n)*n*e}(n,t)+function Cj(n,e){return n*n*e}(n,r)}function Kc(n,e,t,r,i){return function Dj(n,e){const t=1-n;return t*t*t*e}(n,e)+function Tj(n,e){const t=1-n;return 3*t*t*n*e}(n,t)+function Nj(n,e){return 3*(1-n)*n*n*e}(n,r)+function Aj(n,e){return n*n*n*e}(n,i)}TD.prototype.isCatmullRomCurve3=!0;class Dv extends Ar{constructor(e=new $,t=new $,r=new $,i=new $){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new $){const r=t,i=this.v0,s=this.v1,o=this.v2,a=this.v3;return r.set(Kc(e,i.x,s.x,o.x,a.x),Kc(e,i.y,s.y,o.y,a.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Dv.prototype.isCubicBezierCurve=!0;class AD extends Ar{constructor(e=new S,t=new S,r=new S,i=new S){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=r,this.v3=i}getPoint(e,t=new S){const r=t,i=this.v0,s=this.v1,o=this.v2,a=this.v3;return r.set(Kc(e,i.x,s.x,o.x,a.x),Kc(e,i.y,s.y,o.y,a.y),Kc(e,i.z,s.z,o.z,a.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}AD.prototype.isCubicBezierCurve3=!0;class Jh extends Ar{constructor(e=new $,t=new $){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new $){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const r=t||new $;return r.copy(this.v2).sub(this.v1).normalize(),r}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Jh.prototype.isLineCurve=!0;class Tv extends Ar{constructor(e=new $,t=new $,r=new $){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new $){const r=t,i=this.v0,s=this.v1,o=this.v2;return r.set(Jc(e,i.x,s.x,o.x),Jc(e,i.y,s.y,o.y)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Tv.prototype.isQuadraticBezierCurve=!0;class Nv extends Ar{constructor(e=new S,t=new S,r=new S){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=r}getPoint(e,t=new S){const r=t,i=this.v0,s=this.v1,o=this.v2;return r.set(Jc(e,i.x,s.x,o.x),Jc(e,i.y,s.y,o.y),Jc(e,i.z,s.z,o.z)),r}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Nv.prototype.isQuadraticBezierCurve3=!0;class Av extends Ar{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new $){const r=t,i=this.points,s=(i.length-1)*e,o=Math.floor(s),a=s-o,l=i[0===o?o:o-1],c=i[o],u=i[o>i.length-2?i.length-1:o+1],d=i[o>i.length-3?i.length-1:o+2];return r.set(ND(a,l.x,c.x,u.x,d.x),ND(a,l.y,c.y,u.y,d.y)),r}copy(e){super.copy(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++)this.points.push(e.points[t].clone());return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,r=this.points.length;t<r;t++)e.points.push(this.points[t].toArray());return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,r=e.points.length;t<r;t++){const i=e.points[t];this.points.push((new $).fromArray(i))}return this}}Av.prototype.isSplineCurve=!0;var Iv=Object.freeze({__proto__:null,ArcCurve:DD,CatmullRomCurve3:TD,CubicBezierCurve:Dv,CubicBezierCurve3:AD,EllipseCurve:Xh,LineCurve:Jh,LineCurve3:class Ij extends Ar{constructor(e=new S,t=new S){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new S){const r=t;return 1===e?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},QuadraticBezierCurve:Tv,QuadraticBezierCurve3:Nv,SplineCurve:Av});class Rj extends Ar{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Jh(t,e))}getPoint(e,t){const r=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=r){const o=i[s]-r,a=this.curves[s],l=a.getLength();return a.getPointAt(0===l?0:1-o/l,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let r;for(let i=0,s=this.curves;i<s.length;i++){const o=s[i],l=o.getPoints(o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e);for(let c=0;c<l.length;c++){const u=l[c];r&&r.equals(u)||(t.push(u),r=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,r=e.curves.length;t<r;t++)this.curves.push(e.curves[t].clone());return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,r=this.curves.length;t<r;t++)e.curves.push(this.curves[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,r=e.curves.length;t<r;t++){const i=e.curves[t];this.curves.push((new Iv[i.type]).fromJSON(i))}return this}}class Qc extends Rj{constructor(e){super(),this.type="Path",this.currentPoint=new $,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const r=new Jh(this.currentPoint.clone(),new $(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,r,i){const s=new Tv(this.currentPoint.clone(),new $(e,t),new $(r,i));return this.curves.push(s),this.currentPoint.set(r,i),this}bezierCurveTo(e,t,r,i,s,o){const a=new Dv(this.currentPoint.clone(),new $(e,t),new $(r,i),new $(s,o));return this.curves.push(a),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),r=new Av(t);return this.curves.push(r),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,r,i,s,o){return this.absarc(e+this.currentPoint.x,t+this.currentPoint.y,r,i,s,o),this}absarc(e,t,r,i,s,o){return this.absellipse(e,t,r,r,i,s,o),this}ellipse(e,t,r,i,s,o,a,l){return this.absellipse(e+this.currentPoint.x,t+this.currentPoint.y,r,i,s,o,a,l),this}absellipse(e,t,r,i,s,o,a,l){const c=new Xh(e,t,r,i,s,o,a,l);if(this.curves.length>0){const d=c.getPoint(0);d.equals(this.currentPoint)||this.lineTo(d.x,d.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}new S,new S,new S,new cn;class Wi extends Qc{constructor(e){super(e),this.uuid=ur(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,r=e.holes.length;t<r;t++)this.holes.push(e.holes[t].clone());return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,r=this.holes.length;t<r;t++)e.holes.push(this.holes[t].toJSON());return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,r=e.holes.length;t<r;t++){const i=e.holes[t];this.holes.push((new Qc).fromJSON(i))}return this}}function RD(n,e,t,r,i){let s,o;if(i===function Xj(n,e,t,r){let i=0;for(let s=e,o=t-r;s<t;s+=r)i+=(n[o]-n[s])*(n[s+1]+n[o+1]),o=s;return i}(n,e,t,r)>0)for(s=e;s<t;s+=r)o=FD(s,n[s],n[s+1],o);else for(s=t-r;s>=e;s-=r)o=FD(s,n[s],n[s+1],o);return o&&af(o,o.next)&&(ru(o),o=o.next),o}function Cs(n,e){if(!n)return n;e||(e=n);let r,t=n;do{if(r=!1,t.steiner||!af(t,t.next)&&0!==Wt(t.prev,t,t.next))t=t.next;else{if(ru(t),t=e=t.prev,t===t.next)break;r=!0}}while(r||t!==e);return e}function tu(n,e,t,r,i,s,o){if(!n)return;!o&&s&&function zj(n,e,t,r){let i=n;do{null===i.z&&(i.z=Pv(i.x,i.y,e,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==n);i.prevZ.nextZ=null,i.prevZ=null,function jj(n){let e,t,r,i,s,o,a,l,c=1;do{for(t=n,n=null,s=null,o=0;t;){for(o++,r=t,a=0,e=0;e<c&&(a++,r=r.nextZ,r);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||t.z<=r.z)?(i=t,t=t.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:n=i,i.prevZ=s,s=i;t=r}s.nextZ=null,c*=2}while(o>1)}(i)}(n,r,i,s);let l,c,a=n;for(;n.prev!==n.next;)if(l=n.prev,c=n.next,s?Fj(n,r,i,s):Lj(n))e.push(l.i/t),e.push(n.i/t),e.push(c.i/t),ru(n),n=c.next,a=c.next;else if((n=c)===a){o?1===o?tu(n=Oj(Cs(n),e,t),e,t,r,i,s,2):2===o&&kj(n,e,t,r,i,s):tu(Cs(n),e,t,r,i,s,1);break}}function Lj(n){const e=n.prev,t=n,r=n.next;if(Wt(e,t,r)>=0)return!1;let i=n.next.next;for(;i!==n.prev;){if(ll(e.x,e.y,t.x,t.y,r.x,r.y,i.x,i.y)&&Wt(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Fj(n,e,t,r){const i=n.prev,s=n,o=n.next;if(Wt(i,s,o)>=0)return!1;const c=i.x>s.x?i.x>o.x?i.x:o.x:s.x>o.x?s.x:o.x,u=i.y>s.y?i.y>o.y?i.y:o.y:s.y>o.y?s.y:o.y,d=Pv(i.x<s.x?i.x<o.x?i.x:o.x:s.x<o.x?s.x:o.x,i.y<s.y?i.y<o.y?i.y:o.y:s.y<o.y?s.y:o.y,e,t,r),h=Pv(c,u,e,t,r);let f=n.prevZ,p=n.nextZ;for(;f&&f.z>=d&&p&&p.z<=h;){if(f!==n.prev&&f!==n.next&&ll(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Wt(f.prev,f,f.next)>=0||(f=f.prevZ,p!==n.prev&&p!==n.next&&ll(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Wt(p.prev,p,p.next)>=0))return!1;p=p.nextZ}for(;f&&f.z>=d;){if(f!==n.prev&&f!==n.next&&ll(i.x,i.y,s.x,s.y,o.x,o.y,f.x,f.y)&&Wt(f.prev,f,f.next)>=0)return!1;f=f.prevZ}for(;p&&p.z<=h;){if(p!==n.prev&&p!==n.next&&ll(i.x,i.y,s.x,s.y,o.x,o.y,p.x,p.y)&&Wt(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Oj(n,e,t){let r=n;do{const i=r.prev,s=r.next.next;!af(i,s)&&PD(i,r,r.next,s)&&nu(i,s)&&nu(s,i)&&(e.push(i.i/t),e.push(r.i/t),e.push(s.i/t),ru(r),ru(r.next),r=n=s),r=r.next}while(r!==n);return Cs(r)}function kj(n,e,t,r,i,s){let o=n;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&$j(o,a)){let l=LD(o,a);return o=Cs(o,o.next),l=Cs(l,l.next),tu(o,e,t,r,i,s),void tu(l,e,t,r,i,s)}a=a.next}o=o.next}while(o!==n)}function Uj(n,e){return n.x-e.x}function Hj(n,e){if(e=function Gj(n,e){let t=e;const r=n.x,i=n.y;let o,s=-1/0;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const h=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=r&&h>s){if(s=h,h===r){if(i===t.y)return t;if(i===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(r===s)return o;const a=o,l=o.x,c=o.y;let d,u=1/0;t=o;do{r>=t.x&&t.x>=l&&r!==t.x&&ll(i<c?r:s,i,l,c,i<c?s:r,i,t.x,t.y)&&(d=Math.abs(i-t.y)/(r-t.x),nu(t,n)&&(d<u||d===u&&(t.x>o.x||t.x===o.x&&Vj(o,t)))&&(o=t,u=d)),t=t.next}while(t!==a);return o}(n,e),e){const t=LD(e,n);Cs(e,e.next),Cs(t,t.next)}}function Vj(n,e){return Wt(n.prev,n,e.prev)<0&&Wt(e.next,n,n.next)<0}function Pv(n,e,t,r,i){return(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)*i)|n<<8))|n<<4))|n<<2))|n<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Wj(n){let e=n,t=n;do{(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next}while(e!==n);return t}function ll(n,e,t,r,i,s,o,a){return(i-o)*(e-a)-(n-o)*(s-a)>=0&&(n-o)*(r-a)-(t-o)*(e-a)>=0&&(t-o)*(s-a)-(i-o)*(r-a)>=0}function $j(n,e){return n.next.i!==e.i&&n.prev.i!==e.i&&!function qj(n,e){let t=n;do{if(t.i!==n.i&&t.next.i!==n.i&&t.i!==e.i&&t.next.i!==e.i&&PD(t,t.next,n,e))return!0;t=t.next}while(t!==n);return!1}(n,e)&&(nu(n,e)&&nu(e,n)&&function Zj(n,e){let t=n,r=!1;const i=(n.x+e.x)/2,s=(n.y+e.y)/2;do{t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==n);return r}(n,e)&&(Wt(n.prev,n,e.prev)||Wt(n,e.prev,e))||af(n,e)&&Wt(n.prev,n,n.next)>0&&Wt(e.prev,e,e.next)>0)}function Wt(n,e,t){return(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y)}function af(n,e){return n.x===e.x&&n.y===e.y}function PD(n,e,t,r){const i=cf(Wt(n,e,t)),s=cf(Wt(n,e,r)),o=cf(Wt(t,r,n)),a=cf(Wt(t,r,e));return!!(i!==s&&o!==a||0===i&&lf(n,t,e)||0===s&&lf(n,r,e)||0===o&&lf(t,n,r)||0===a&&lf(t,e,r))}function lf(n,e,t){return e.x<=Math.max(n.x,t.x)&&e.x>=Math.min(n.x,t.x)&&e.y<=Math.max(n.y,t.y)&&e.y>=Math.min(n.y,t.y)}function cf(n){return n>0?1:n<0?-1:0}function nu(n,e){return Wt(n.prev,n,n.next)<0?Wt(n,e,n.next)>=0&&Wt(n,n.prev,e)>=0:Wt(n,e,n.prev)<0||Wt(n,n.next,e)<0}function LD(n,e){const t=new Lv(n.i,n.x,n.y),r=new Lv(e.i,e.x,e.y),i=n.next,s=e.prev;return n.next=e,e.prev=n,t.next=i,i.prev=t,r.next=t,t.prev=r,s.next=r,r.prev=s,r}function FD(n,e,t,r){const i=new Lv(n,e,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ru(n){n.next.prev=n.prev,n.prev.next=n.next,n.prevZ&&(n.prevZ.nextZ=n.nextZ),n.nextZ&&(n.nextZ.prevZ=n.prevZ)}function Lv(n,e,t){this.i=n,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class $i{static area(e){const t=e.length;let r=0;for(let i=t-1,s=0;s<t;i=s++)r+=e[i].x*e[s].y-e[s].x*e[i].y;return.5*r}static isClockWise(e){return $i.area(e)<0}static triangulateShape(e,t){const r=[],i=[],s=[];OD(e),kD(r,e);let o=e.length;t.forEach(OD);for(let l=0;l<t.length;l++)i.push(o),o+=t[l].length,kD(r,t[l]);const a=function(n,e,t=2){const r=e&&e.length,i=r?e[0]*t:n.length;let s=RD(n,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c,u,d,h,f;if(r&&(s=function Bj(n,e,t,r){const i=[];let s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:n.length,c=RD(n,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(Wj(c));for(i.sort(Uj),s=0;s<i.length;s++)Hj(i[s],t),t=Cs(t,t.next);return t}(n,e,s,t)),n.length>80*t){a=c=n[0],l=u=n[1];for(let p=t;p<i;p+=t)d=n[p],h=n[p+1],d<a&&(a=d),h<l&&(l=h),d>c&&(c=d),h>u&&(u=h);f=Math.max(c-a,u-l),f=0!==f?1/f:0}return tu(s,o,t,a,l,f),o}(r,i);for(let l=0;l<a.length;l+=3)s.push(a.slice(l,l+3));return s}}function OD(n){const e=n.length;e>2&&n[e-1].equals(n[0])&&n.pop()}function kD(n,e){for(let t=0;t<e.length;t++)n.push(e[t].x),n.push(e[t].y)}class Ds extends Le{constructor(e=new Wi([new $(.5,.5),new $(-.5,.5),new $(-.5,-.5),new $(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const r=this,i=[],s=[];for(let a=0,l=e.length;a<l;a++)o(e[a]);function o(a){const l=[],c=void 0!==t.curveSegments?t.curveSegments:12,u=void 0!==t.steps?t.steps:1;let d=void 0!==t.depth?t.depth:1,h=void 0===t.bevelEnabled||t.bevelEnabled,f=void 0!==t.bevelThickness?t.bevelThickness:.2,p=void 0!==t.bevelSize?t.bevelSize:f-.1,m=void 0!==t.bevelOffset?t.bevelOffset:0,g=void 0!==t.bevelSegments?t.bevelSegments:3;const v=t.extrudePath,y=void 0!==t.UVGenerator?t.UVGenerator:Yj;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=t.amount);let M,x,w,A,b,_=!1;v&&(M=v.getSpacedPoints(u),_=!0,h=!1,x=v.computeFrenetFrames(u,!1),w=new S,A=new S,b=new S),h||(g=0,f=0,p=0,m=0);const C=a.extractPoints(c);let R=C.shape;const P=C.holes;if(!$i.isClockWise(R)){R=R.reverse();for(let K=0,Y=P.length;K<Y;K++){const se=P[K];$i.isClockWise(se)&&(P[K]=se.reverse())}}const Z=$i.triangulateShape(R,P),L=R;for(let K=0,Y=P.length;K<Y;K++)R=R.concat(P[K]);function k(K,Y,se){return Y||console.error("THREE.ExtrudeGeometry: vec does not exist"),Y.clone().multiplyScalar(se).add(K)}const F=R.length,X=Z.length;function J(K,Y,se){let be,pe,We;const Ne=K.x-Y.x,De=K.y-Y.y,Dt=se.x-K.x,St=se.y-K.y,N=Ne*Ne+De*De;if(Math.abs(Ne*St-De*Dt)>Number.EPSILON){const G=Math.sqrt(N),re=Math.sqrt(Dt*Dt+St*St),de=Y.x-De/G,ye=Y.y+Ne/G,qe=((se.x-St/re-de)*St-(se.y+Dt/re-ye)*Dt)/(Ne*St-De*Dt);be=de+Ne*qe-K.x,pe=ye+De*qe-K.y;const Ze=be*be+pe*pe;if(Ze<=2)return new $(be,pe);We=Math.sqrt(Ze/2)}else{let G=!1;Ne>Number.EPSILON?Dt>Number.EPSILON&&(G=!0):Ne<-Number.EPSILON?Dt<-Number.EPSILON&&(G=!0):Math.sign(De)===Math.sign(St)&&(G=!0),G?(be=-De,pe=Ne,We=Math.sqrt(N)):(be=Ne,pe=De,We=Math.sqrt(N/2))}return new $(be/We,pe/We)}const H=[];for(let K=0,Y=L.length,se=Y-1,be=K+1;K<Y;K++,se++,be++)se===Y&&(se=0),be===Y&&(be=0),H[K]=J(L[K],L[se],L[be]);const j=[];let ie,ne=H.concat();for(let K=0,Y=P.length;K<Y;K++){const se=P[K];ie=[];for(let be=0,pe=se.length,We=pe-1,Ne=be+1;be<pe;be++,We++,Ne++)We===pe&&(We=0),Ne===pe&&(Ne=0),ie[be]=J(se[be],se[We],se[Ne]);j.push(ie),ne=ne.concat(ie)}for(let K=0;K<g;K++){const Y=K/g,se=f*Math.cos(Y*Math.PI/2),be=p*Math.sin(Y*Math.PI/2)+m;for(let pe=0,We=L.length;pe<We;pe++){const Ne=k(L[pe],H[pe],be);ht(Ne.x,Ne.y,-se)}for(let pe=0,We=P.length;pe<We;pe++){const Ne=P[pe];ie=j[pe];for(let De=0,Dt=Ne.length;De<Dt;De++){const St=k(Ne[De],ie[De],be);ht(St.x,St.y,-se)}}}const le=p+m;for(let K=0;K<F;K++){const Y=h?k(R[K],ne[K],le):R[K];_?(A.copy(x.normals[0]).multiplyScalar(Y.x),w.copy(x.binormals[0]).multiplyScalar(Y.y),b.copy(M[0]).add(A).add(w),ht(b.x,b.y,b.z)):ht(Y.x,Y.y,0)}for(let K=1;K<=u;K++)for(let Y=0;Y<F;Y++){const se=h?k(R[Y],ne[Y],le):R[Y];_?(A.copy(x.normals[K]).multiplyScalar(se.x),w.copy(x.binormals[K]).multiplyScalar(se.y),b.copy(M[K]).add(A).add(w),ht(b.x,b.y,b.z)):ht(se.x,se.y,d/u*K)}for(let K=g-1;K>=0;K--){const Y=K/g,se=f*Math.cos(Y*Math.PI/2),be=p*Math.sin(Y*Math.PI/2)+m;for(let pe=0,We=L.length;pe<We;pe++){const Ne=k(L[pe],H[pe],be);ht(Ne.x,Ne.y,d+se)}for(let pe=0,We=P.length;pe<We;pe++){const Ne=P[pe];ie=j[pe];for(let De=0,Dt=Ne.length;De<Dt;De++){const St=k(Ne[De],ie[De],be);_?ht(St.x,St.y+M[u-1].y,M[u-1].x+se):ht(St.x,St.y,d+se)}}}function q(K,Y){let se=K.length;for(;--se>=0;){const be=se;let pe=se-1;pe<0&&(pe=K.length-1);for(let We=0,Ne=u+2*g;We<Ne;We++){const De=F*We,Dt=F*(We+1);je(Y+be+De,Y+pe+De,Y+pe+Dt,Y+be+Dt)}}}function ht(K,Y,se){l.push(K),l.push(Y),l.push(se)}function Ie(K,Y,se){ae(K),ae(Y),ae(se);const be=i.length/3,pe=y.generateTopUV(r,i,be-3,be-2,be-1);et(pe[0]),et(pe[1]),et(pe[2])}function je(K,Y,se,be){ae(K),ae(Y),ae(be),ae(Y),ae(se),ae(be);const pe=i.length/3,We=y.generateSideWallUV(r,i,pe-6,pe-3,pe-2,pe-1);et(We[0]),et(We[1]),et(We[3]),et(We[1]),et(We[2]),et(We[3])}function ae(K){i.push(l[3*K+0]),i.push(l[3*K+1]),i.push(l[3*K+2])}function et(K){s.push(K.x),s.push(K.y)}(function Me(){const K=i.length/3;if(h){let Y=0,se=F*Y;for(let be=0;be<X;be++){const pe=Z[be];Ie(pe[2]+se,pe[1]+se,pe[0]+se)}Y=u+2*g,se=F*Y;for(let be=0;be<X;be++){const pe=Z[be];Ie(pe[0]+se,pe[1]+se,pe[2]+se)}}else{for(let Y=0;Y<X;Y++){const se=Z[Y];Ie(se[2],se[1],se[0])}for(let Y=0;Y<X;Y++){const se=Z[Y];Ie(se[0]+F*u,se[1]+F*u,se[2]+F*u)}}r.addGroup(K,i.length/3-K,0)})(),function Ee(){const K=i.length/3;let Y=0;q(L,Y),Y+=L.length;for(let se=0,be=P.length;se<be;se++){const pe=P[se];q(pe,Y),Y+=pe.length}r.addGroup(K,i.length/3-K,1)}()}this.setAttribute("position",new we(i,3)),this.setAttribute("uv",new we(s,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function Jj(n,e,t){if(t.shapes=[],Array.isArray(n))for(let r=0,i=n.length;r<i;r++)t.shapes.push(n[r].uuid);else t.shapes.push(n.uuid);return void 0!==e.extrudePath&&(t.options.extrudePath=e.extrudePath.toJSON()),t}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const r=[];for(let s=0,o=e.shapes.length;s<o;s++)r.push(t[e.shapes[s]]);const i=e.options.extrudePath;return void 0!==i&&(e.options.extrudePath=(new Iv[i.type]).fromJSON(i)),new Ds(r,e.options)}}const Yj={generateTopUV:function(n,e,t,r,i){const a=e[3*r],l=e[3*r+1],c=e[3*i],u=e[3*i+1];return[new $(e[3*t],e[3*t+1]),new $(a,l),new $(c,u)]},generateSideWallUV:function(n,e,t,r,i,s){const o=e[3*t],a=e[3*t+1],l=e[3*t+2],c=e[3*r],u=e[3*r+1],d=e[3*r+2],h=e[3*i],f=e[3*i+1],p=e[3*i+2],m=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(a-u)<Math.abs(o-c)?[new $(o,1-l),new $(c,1-d),new $(h,1-p),new $(m,1-v)]:[new $(a,1-l),new $(u,1-d),new $(f,1-p),new $(g,1-v)]}};class su extends Le{constructor(e=new Wi([new $(0,.5),new $(-.5,-.5),new $(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const r=[],i=[],s=[],o=[];let a=0,l=0;if(!1===Array.isArray(e))c(e);else for(let u=0;u<e.length;u++)c(e[u]),this.addGroup(a,l,u),a+=l,l=0;function c(u){const d=i.length/3,h=u.extractPoints(t);let f=h.shape;const p=h.holes;!1===$i.isClockWise(f)&&(f=f.reverse());for(let g=0,v=p.length;g<v;g++){const y=p[g];!0===$i.isClockWise(y)&&(p[g]=y.reverse())}const m=$i.triangulateShape(f,p);for(let g=0,v=p.length;g<v;g++)f=f.concat(p[g]);for(let g=0,v=f.length;g<v;g++){const y=f[g];i.push(y.x,y.y,0),s.push(0,0,1),o.push(y.x,y.y)}for(let g=0,v=m.length;g<v;g++){const y=m[g];r.push(y[0]+d,y[1]+d,y[2]+d),l+=3}}this.setIndex(r),this.setAttribute("position",new we(i,3)),this.setAttribute("normal",new we(s,3)),this.setAttribute("uv",new we(o,2))}toJSON(){const e=super.toJSON();return function Kj(n,e){if(e.shapes=[],Array.isArray(n))for(let t=0,r=n.length;t<r;t++)e.shapes.push(n[t].uuid);else e.shapes.push(n.uuid);return e}(this.parameters.shapes,e)}static fromJSON(e,t){const r=[];for(let i=0,s=e.shapes.length;i<s;i++)r.push(t[e.shapes[i]]);return new su(r,e.curveSegments)}}class GD extends un{constructor(e){super(),this.type="ShadowMaterial",this.color=new ce(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}GD.prototype.isShadowMaterial=!0;class VD extends qr{constructor(e){super(e),this.type="RawShaderMaterial"}}VD.prototype.isRawShaderMaterial=!0;class au extends un{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ce(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ce(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}au.prototype.isMeshStandardMaterial=!0;class zD extends au{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new $(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return en(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new ce(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ce(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ce(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}zD.prototype.isMeshPhysicalMaterial=!0;class jD extends un{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new ce(16777215),this.specular=new ce(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ce(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}jD.prototype.isMeshPhongMaterial=!0;class WD extends un{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ce(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ce(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}WD.prototype.isMeshToonMaterial=!0;class $D extends un{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}$D.prototype.isMeshNormalMaterial=!0;class qD extends un{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new ce(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ce(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}qD.prototype.isMeshLambertMaterial=!0;class ZD extends un{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ce(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}ZD.prototype.isMeshMatcapMaterial=!0;class XD extends An{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}XD.prototype.isLineDashedMaterial=!0;const Qj={ShadowMaterial:GD,SpriteMaterial:gv,RawShaderMaterial:VD,ShaderMaterial:qr,PointsMaterial:bv,MeshPhysicalMaterial:zD,MeshStandardMaterial:au,MeshPhongMaterial:jD,MeshToonMaterial:WD,MeshNormalMaterial:$D,MeshLambertMaterial:qD,MeshDepthMaterial:hv,MeshDistanceMaterial:fv,MeshBasicMaterial:vs,MeshMatcapMaterial:ZD,LineDashedMaterial:XD,LineBasicMaterial:An,Material:un};un.fromType=function(n){return new Qj[n]};const Ht={arraySlice:function(n,e,t){return Ht.isTypedArray(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)},convertArray:function(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)},isTypedArray:function(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)},getKeyframeOrder:function(n){const t=n.length,r=new Array(t);for(let i=0;i!==t;++i)r[i]=i;return r.sort(function e(i,s){return n[i]-n[s]}),r},sortedArray:function(n,e,t){const r=n.length,i=new n.constructor(r);for(let s=0,o=0;o!==r;++s){const a=t[s]*e;for(let l=0;l!==e;++l)i[o++]=n[a+l]}return i},flattenJSON:function(n,e,t,r){let i=1,s=n[0];for(;void 0!==s&&void 0===s[r];)s=n[i++];if(void 0===s)return;let o=s[r];if(void 0!==o)if(Array.isArray(o))do{o=s[r],void 0!==o&&(e.push(s.time),t.push.apply(t,o)),s=n[i++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[r],void 0!==o&&(e.push(s.time),o.toArray(t,t.length)),s=n[i++]}while(void 0!==s);else do{o=s[r],void 0!==o&&(e.push(s.time),t.push(o)),s=n[i++]}while(void 0!==s)},subclip:function(n,e,t,r,i=30){const s=n.clone();s.name=e;const o=[];for(let l=0;l<s.tracks.length;++l){const c=s.tracks[l],u=c.getValueSize(),d=[],h=[];for(let f=0;f<c.times.length;++f){const p=c.times[f]*i;if(!(p<t||p>=r)){d.push(c.times[f]);for(let m=0;m<u;++m)h.push(c.values[f*u+m])}}0!==d.length&&(c.times=Ht.convertArray(d,c.times.constructor),c.values=Ht.convertArray(h,c.values.constructor),o.push(c))}s.tracks=o;let a=1/0;for(let l=0;l<s.tracks.length;++l)a>s.tracks[l].times[0]&&(a=s.tracks[l].times[0]);for(let l=0;l<s.tracks.length;++l)s.tracks[l].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(n,e=0,t=n,r=30){r<=0&&(r=30);const i=t.tracks.length,s=e/r;for(let o=0;o<i;++o){const a=t.tracks[o],l=a.ValueTypeName;if("bool"===l||"string"===l)continue;const c=n.tracks.find(function(v){return v.name===a.name&&v.ValueTypeName===l});if(void 0===c)continue;let u=0;const d=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=d/3);let h=0;const f=c.getValueSize();c.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=f/3);const p=a.times.length-1;let m;if(s<=a.times[0])m=Ht.arraySlice(a.values,u,d-u);else if(s>=a.times[p]){const v=p*d+u;m=Ht.arraySlice(a.values,v,v+d-u)}else{const v=a.createInterpolant(),y=u,M=d-u;v.evaluate(s),m=Ht.arraySlice(v.resultBuffer,y,M)}"quaternion"===l&&(new ln).fromArray(m).normalize().conjugate().toArray(m);const g=c.times.length;for(let v=0;v<g;++v){const y=v*f+h;if("quaternion"===l)ln.multiplyQuaternionsFlat(c.values,y,m,0,c.values,y);else{const M=f-2*h;for(let _=0;_<M;++_)c.values[y+_]-=m[_]}}}return n.blendMode=2501,n}};class Ts{constructor(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let r=this._cachedIndex,i=t[r],s=t[r-1];e:{t:{let o;n:{r:if(!(e<i)){for(let a=r+2;;){if(void 0===i){if(e<s)break r;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,s)}if(r===a)break;if(s=i,i=t[++r],e<i)break t}o=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(r=2,s=a);for(let l=r-2;;){if(void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===l)break;if(i=s,s=t[--r-1],e>=s)break t}o=r,r=0}}for(;r<o;){const a=r+o>>>1;e<t[a]?o=a:r=a+1}if(i=t[r],s=t[r-1],void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,s,e)}this._cachedIndex=r,this.intervalChanged_(r,s,i)}return this.interpolate_(r,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,s=e*i;for(let o=0;o!==i;++o)t[o]=r[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Ts.prototype.beforeStart_=Ts.prototype.copySampleValue_,Ts.prototype.afterEnd_=Ts.prototype.copySampleValue_;class e4 extends Ts{constructor(e,t,r,i){super(e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Na,endingEnd:Na}}intervalChanged_(e,t,r){const i=this.parameterPositions;let s=e-2,o=e+1,a=i[s],l=i[o];if(void 0===a)switch(this.getSettings_().endingStart){case Aa:s=e,a=2*t-r;break;case 2402:s=i.length-2,a=t+i[s]-i[s+1];break;default:s=e,a=r}if(void 0===l)switch(this.getSettings_().endingEnd){case Aa:o=e,l=2*r-t;break;case 2402:o=1,l=r+i[1]-i[0];break;default:o=e-1,l=t}const c=.5*(r-t),u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-r),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(r-t)/(i-t),m=p*p,g=m*p,v=-h*g+2*h*m-h*p,y=(1+h)*g+(-1.5-2*h)*m+(-.5+h)*p+1,M=(-1-f)*g+(1.5+f)*m+.5*p,_=f*g-f*m;for(let x=0;x!==a;++x)s[x]=v*o[u+x]+y*o[c+x]+M*o[l+x]+_*o[d+x];return s}}class YD extends Ts{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(r-t)/(i-t),d=1-u;for(let h=0;h!==a;++h)s[h]=o[c+h]*d+o[l+h]*u;return s}}class t4 extends Ts{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class ci{constructor(e,t,r,i){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ht.convertArray(t,this.TimeBufferType),this.values=Ht.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let r;if(t.toJSON!==this.toJSON)r=t.toJSON(e);else{r={name:e.name,times:Ht.convertArray(e.times,Array),values:Ht.convertArray(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(r.interpolation=i)}return r.type=e.ValueTypeName,r}InterpolantFactoryMethodDiscrete(e){return new t4(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new YD(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new e4(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let r=0,i=t.length;r!==i;++r)t[r]*=e}return this}trim(e,t){const r=this.times,i=r.length;let s=0,o=i-1;for(;s!==i&&r[s]<e;)++s;for(;-1!==o&&r[o]>t;)--o;if(++o,0!==s||o!==i){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=Ht.arraySlice(r,s,o),this.values=Ht.arraySlice(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const r=this.times,i=this.values,s=r.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=r[a];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(void 0!==i&&Ht.isTypedArray(i))for(let a=0,l=i.length;a!==l;++a){const c=i[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=Ht.arraySlice(this.times),t=Ht.arraySlice(this.values),r=this.getValueSize(),i=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a];if(c!==e[a+1]&&(1!==a||c!==e[0]))if(i)l=!0;else{const d=a*r,h=d-r,f=d+r;for(let p=0;p!==r;++p){const m=t[d+p];if(m!==t[h+p]||m!==t[f+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*r,h=o*r;for(let f=0;f!==r;++f)t[h+f]=t[d+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*r,l=o*r,c=0;c!==r;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=Ht.arraySlice(e,0,o),this.values=Ht.arraySlice(t,0,o*r)):(this.times=e,this.values=t),this}clone(){const e=Ht.arraySlice(this.times,0),t=Ht.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}ci.prototype.TimeBufferType=Float32Array,ci.prototype.ValueBufferType=Float32Array,ci.prototype.DefaultInterpolation=2301;class cl extends ci{}cl.prototype.ValueTypeName="bool",cl.prototype.ValueBufferType=Array,cl.prototype.DefaultInterpolation=2300,cl.prototype.InterpolantFactoryMethodLinear=void 0,cl.prototype.InterpolantFactoryMethodSmooth=void 0;class JD extends ci{}JD.prototype.ValueTypeName="color";class mf extends ci{}mf.prototype.ValueTypeName="number";class n4 extends Ts{constructor(e,t,r,i){super(e,t,r,i)}interpolate_(e,t,r,i){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(r-t)/(i-t);let c=e*a;for(let u=c+a;c!==u;c+=4)ln.slerpFlat(s,0,o,c-a,o,c,l);return s}}class lu extends ci{InterpolantFactoryMethodLinear(e){return new n4(this.times,this.values,this.getValueSize(),e)}}lu.prototype.ValueTypeName="quaternion",lu.prototype.DefaultInterpolation=2301,lu.prototype.InterpolantFactoryMethodSmooth=void 0;class ul extends ci{}ul.prototype.ValueTypeName="string",ul.prototype.ValueBufferType=Array,ul.prototype.DefaultInterpolation=2300,ul.prototype.InterpolantFactoryMethodLinear=void 0,ul.prototype.InterpolantFactoryMethodSmooth=void 0;class yf extends ci{}yf.prototype.ValueTypeName="vector";class vf{constructor(e,t=-1,r,i=2500){this.name=e,this.tracks=r,this.duration=t,this.blendMode=i,this.uuid=ur(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],r=e.tracks,i=1/(e.fps||1);for(let o=0,a=r.length;o!==a;++o)t.push(i4(r[o]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,o=r.length;s!==o;++s)t.push(ci.toJSON(r[s]));return i}static CreateFromMorphTargetSequence(e,t,r,i){const s=t.length,o=[];for(let a=0;a<s;a++){let l=[],c=[];l.push((a+s-1)%s,a,(a+1)%s),c.push(0,1,0);const u=Ht.getKeyframeOrder(l);l=Ht.sortedArray(l,1,u),c=Ht.sortedArray(c,1,u),!i&&0===l[0]&&(l.push(s),c.push(c[0])),o.push(new mf(".morphTargetInfluences["+t[a].name+"]",l,c).scale(1/r))}return new this(e,-1,o)}static findByName(e,t){let r=e;if(!Array.isArray(e)){const i=e;r=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null}static CreateClipsFromMorphTargetSequences(e,t,r){const i={},s=/^([\w-]*?)([\d]+)$/;for(let a=0,l=e.length;a<l;a++){const c=e[a],u=c.name.match(s);if(u&&u.length>1){const d=u[1];let h=i[d];h||(i[d]=h=[]),h.push(c)}}const o=[];for(const a in i)o.push(this.CreateFromMorphTargetSequence(a,i[a],t,r));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const r=function(d,h,f,p,m){if(0!==f.length){const g=[],v=[];Ht.flattenJSON(f,g,v,p),0!==g.length&&m.push(new d(h,g,v))}},i=[],s=e.name||"default",o=e.fps||30,a=e.blendMode;let l=e.length||-1;const c=e.hierarchy||[];for(let d=0;d<c.length;d++){const h=c[d].keys;if(h&&0!==h.length)if(h[0].morphTargets){const f={};let p;for(p=0;p<h.length;p++)if(h[p].morphTargets)for(let m=0;m<h[p].morphTargets.length;m++)f[h[p].morphTargets[m]]=-1;for(const m in f){const g=[],v=[];for(let y=0;y!==h[p].morphTargets.length;++y){const M=h[p];g.push(M.time),v.push(M.morphTarget===m?1:0)}i.push(new mf(".morphTargetInfluence["+m+"]",g,v))}l=f.length*o}else{const f=".bones["+t[d].name+"]";r(yf,f+".position",h,"pos",i),r(lu,f+".quaternion",h,"rot",i),r(yf,f+".scale",h,"scl",i)}}return 0===i.length?null:new this(s,l,i,a)}resetDuration(){let t=0;for(let r=0,i=this.tracks.length;r!==i;++r){const s=this.tracks[r];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function i4(n){if(void 0===n.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function r4(n){switch(n.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return mf;case"vector":case"vector2":case"vector3":case"vector4":return yf;case"color":return JD;case"quaternion":return lu;case"bool":case"boolean":return cl;case"string":return ul}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+n)}(n.type);if(void 0===n.times){const t=[],r=[];Ht.flattenJSON(n.keys,t,r,"value"),n.times=t,n.values=r}return void 0!==e.parse?e.parse(n):new e(n.name,n.times,n.values,n.interpolation)}const dl={enabled:!1,files:{},add:function(n,e){!1!==this.enabled&&(this.files[n]=e)},get:function(n){if(!1!==this.enabled)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};const s4=new class KD{constructor(e,t,r){const i=this;let l,s=!1,o=0,a=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(u){a++,!1===s&&void 0!==i.onStart&&i.onStart(u,o,a),s=!0},this.itemEnd=function(u){o++,void 0!==i.onProgress&&i.onProgress(u,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(u){void 0!==i.onError&&i.onError(u)},this.resolveURL=function(u){return l?l(u):u},this.setURLModifier=function(u){return l=u,this},this.addHandler=function(u,d){return c.push(u,d),this},this.removeHandler=function(u){const d=c.indexOf(u);return-1!==d&&c.splice(d,2),this},this.getHandler=function(u){for(let d=0,h=c.length;d<h;d+=2){const f=c[d],p=c[d+1];if(f.global&&(f.lastIndex=0),f.test(u))return p}return null}}};class Ns{constructor(e){this.manager=void 0!==e?e:s4,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,s){r.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const qi={};class As extends Ns{constructor(e){super(e)}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=dl.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(void 0!==qi[e])return void qi[e].push({onLoad:t,onProgress:r,onError:i});qi[e]=[],qi[e].push({onLoad:t,onProgress:r,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,l=this.responseType;fetch(o).then(c=>{if(200===c.status||0===c.status){if(0===c.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===c.body||void 0===c.body.getReader)return c;const u=qi[e],d=c.body.getReader(),h=c.headers.get("Content-Length"),f=h?parseInt(h):0,p=0!==f;let m=0;const g=new ReadableStream({start(v){!function y(){d.read().then(({done:M,value:_})=>{if(M)v.close();else{m+=_.byteLength;const x=new ProgressEvent("progress",{lengthComputable:p,loaded:m,total:f});for(let w=0,A=u.length;w<A;w++){const b=u[w];b.onProgress&&b.onProgress(x)}v.enqueue(_),y()}})}()}});return new Response(g)}throw Error(`fetch for "${c.url}" responded with ${c.status}: ${c.statusText}`)}).then(c=>{switch(l){case"arraybuffer":return c.arrayBuffer();case"blob":return c.blob();case"document":return c.text().then(u=>(new DOMParser).parseFromString(u,a));case"json":return c.json();default:if(void 0===a)return c.text();{const d=/charset="?([^;"\s]*)"?/i.exec(a),h=d&&d[1]?d[1].toLowerCase():void 0,f=new TextDecoder(h);return c.arrayBuffer().then(p=>f.decode(p))}}}).then(c=>{dl.add(e,c);const u=qi[e];delete qi[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onLoad&&f.onLoad(c)}}).catch(c=>{const u=qi[e];if(void 0===u)throw this.manager.itemError(e),c;delete qi[e];for(let d=0,h=u.length;d<h;d++){const f=u[d];f.onError&&f.onError(c)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class _f extends Ns{constructor(e){super(e)}load(e,t,r,i){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=dl.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a=Hc("img");function l(){u(),dl.add(e,this),t&&t(this),s.manager.itemEnd(e)}function c(d){u(),i&&i(d),s.manager.itemError(e),s.manager.itemEnd(e)}function u(){a.removeEventListener("load",l,!1),a.removeEventListener("error",c,!1)}return a.addEventListener("load",l,!1),a.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),s.manager.itemStart(e),a.src=e,a}}class o4 extends Ns{constructor(e){super(e)}load(e,t,r,i){const s=new jc,o=new _f(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function l(c){o.load(e[c],function(u){s.images[c]=u,a++,6===a&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let c=0;c<e.length;++c)l(c);return s}}class a4 extends Ns{constructor(e){super(e)}load(e,t,r,i){const s=new zn,o=new _f(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){s.image=a,s.needsUpdate=!0,void 0!==t&&t(s)},r,i),s}}class ui extends _t{constructor(e,t=1){super(),this.type="Light",this.color=new ce(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}ui.prototype.isLight=!0;(class QD extends ui{constructor(e,t,r){super(e,r),this.type="HemisphereLight",this.position.copy(_t.DefaultUp),this.updateMatrix(),this.groundColor=new ce(t)}copy(e){return ui.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}).prototype.isHemisphereLight=!0;const eT=new Se,tT=new S,nT=new S;class Fv{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new $(512,512),this.map=null,this.mapPass=null,this.matrix=new Se,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Fh,this._frameExtents=new $(1,1),this._viewportCount=1,this._viewports=[new wt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,r=this.matrix;tT.setFromMatrixPosition(e.matrixWorld),t.position.copy(tT),nT.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(nT),t.updateMatrixWorld(),eT.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(eT),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),(512!==this.mapSize.x||512!==this.mapSize.y)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class rT extends Fv{constructor(){super(new Ut(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,r=2*Bc*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(r!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=r,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}rT.prototype.isSpotLightShadow=!0;class Ov extends ui{constructor(e,t,r=0,i=Math.PI/3,s=0,o=1){super(e,t),this.type="SpotLight",this.position.copy(_t.DefaultUp),this.updateMatrix(),this.target=new _t,this.distance=r,this.angle=i,this.penumbra=s,this.decay=o,this.shadow=new rT}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Ov.prototype.isSpotLight=!0;const iT=new Se,cu=new S,kv=new S;class sT extends Fv{constructor(){super(new Ut(90,1,.5,500)),this._frameExtents=new $(4,2),this._viewportCount=6,this._viewports=[new wt(2,1,1,1),new wt(0,1,1,1),new wt(3,1,1,1),new wt(1,1,1,1),new wt(3,0,1,1),new wt(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}updateMatrices(e,t=0){const r=this.camera,i=this.matrix,s=e.distance||r.far;s!==r.far&&(r.far=s,r.updateProjectionMatrix()),cu.setFromMatrixPosition(e.matrixWorld),r.position.copy(cu),kv.copy(r.position),kv.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(kv),r.updateMatrixWorld(),i.makeTranslation(-cu.x,-cu.y,-cu.z),iT.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(iT)}}sT.prototype.isPointLightShadow=!0;class Bv extends ui{constructor(e,t,r=0,i=1){super(e,t),this.type="PointLight",this.distance=r,this.decay=i,this.shadow=new sT}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}Bv.prototype.isPointLight=!0;class oT extends Fv{constructor(){super(new ws(-5,5,5,-5,.5,500))}}oT.prototype.isDirectionalLightShadow=!0;(class aT extends ui{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(_t.DefaultUp),this.updateMatrix(),this.target=new _t,this.shadow=new oT}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}).prototype.isDirectionalLight=!0;class Uv extends ui{constructor(e,t){super(e,t),this.type="AmbientLight"}}Uv.prototype.isAmbientLight=!0;(class lT extends ui{constructor(e,t,r=10,i=10){super(e,t),this.type="RectAreaLight",this.width=r,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}).prototype.isRectAreaLight=!0;class cT{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new S)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const r=e.x,i=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*r),t.addScaledVector(o[4],r*i*1.092548),t.addScaledVector(o[5],i*s*1.092548),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],r*s*1.092548),t.addScaledVector(o[8],.546274*(r*r-i*i)),t}getIrradianceAt(e,t){const r=e.x,i=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*i),t.addScaledVector(o[2],1.023328*s),t.addScaledVector(o[3],1.023328*r),t.addScaledVector(o[4],.858086*r*i),t.addScaledVector(o[5],.858086*i*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],.858086*r*s),t.addScaledVector(o[8],.429043*(r*r-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let r=0;r<9;r++)this.coefficients[r].addScaledVector(e.coefficients[r],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].fromArray(e,t+3*i);return this}toArray(e=[],t=0){const r=this.coefficients;for(let i=0;i<9;i++)r[i].toArray(e,t+3*i);return e}static getBasisAt(e,t){const r=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*r*s,t[8]=.546274*(r*r-i*i)}}cT.prototype.isSphericalHarmonics3=!0;class Mf extends ui{constructor(e=new cT,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Mf.prototype.isLightProbe=!0;let bf;(class uT extends Le{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}).prototype.isInstancedBufferGeometry=!0,class d4 extends Ns{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,r,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=dl.get(e);if(void 0!==o)return s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(l){dl.add(e,l),t&&t(l),s.manager.itemEnd(e)}).catch(function(l){i&&i(l),s.manager.itemError(e),s.manager.itemEnd(e)}),s.manager.itemStart(e)}}.prototype.isImageBitmapLoader=!0;class h4 extends Ns{constructor(e){super(e)}load(e,t,r,i){const s=this,o=new As(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{const l=a.slice(0);(void 0===bf&&(bf=new(window.AudioContext||window.webkitAudioContext)),bf).decodeAudioData(l,function(u){t(u)})}catch(l){i?i(l):console.error(l),s.manager.itemError(e)}},r,i)}}(class f4 extends Mf{constructor(e,t,r=1){super(void 0,r);const i=(new ce).set(e),s=(new ce).set(t),o=new S(i.r,i.g,i.b),a=new S(s.r,s.g,s.b),l=Math.sqrt(Math.PI),c=l*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(l),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(c)}}).prototype.isHemisphereLightProbe=!0,class p4 extends Mf{constructor(e,t=1){super(void 0,t);const r=(new ce).set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}}.prototype.isAmbientLightProbe=!0;class mT{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=yT(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=yT();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function yT(){return("undefined"==typeof performance?Date:performance).now()}class _4{constructor(e,t,r){let i,s,o;switch(this.binding=e,this.valueSize=r,t){case"quaternion":i=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:i=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const r=this.buffer,i=this.valueSize,s=e*i+i;let o=this.cumulativeWeight;if(0===o){for(let a=0;a!==i;++a)r[s+a]=r[a];o=t}else o+=t,this._mixBufferRegion(r,s,0,t/o,i);this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,r=this.valueSize,i=r*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,r),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,r=this.buffer,i=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1&&this._mixBufferRegion(r,i,t*this._origIndex,1-s,t),o>0&&this._mixBufferRegionAdditive(r,i,this._addIndex*t,1,t);for(let l=t,c=t+t;l!==c;++l)if(r[l]!==r[l+t]){a.setValue(r,i);break}}saveOriginalState(){const t=this.buffer,r=this.valueSize,i=r*this._origIndex;this.binding.getValue(t,i);for(let s=r,o=i;s!==o;++s)t[s]=t[i+s%r];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){this.binding.setValue(this.buffer,3*this.valueSize)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let r=e;r<t;r++)this.buffer[r]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let r=0;r<this.valueSize;r++)this.buffer[t+r]=this.buffer[e+r]}_select(e,t,r,i,s){if(i>=.5)for(let o=0;o!==s;++o)e[t+o]=e[r+o]}_slerp(e,t,r,i){ln.slerpFlat(e,t,e,t,e,r,i)}_slerpAdditive(e,t,r,i,s){const o=this._workIndex*s;ln.multiplyQuaternionsFlat(e,o,e,t,e,r),ln.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,r,i,s){const o=1-i;for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]*o+e[r+a]*i}}_lerpAdditive(e,t,r,i,s){for(let o=0;o!==s;++o){const a=t+o;e[a]=e[a]+e[r+o]*i}}}const Gv="\\[\\]\\.:\\/",M4=new RegExp("["+Gv+"]","g"),Vv="[^"+Gv+"]",b4="[^"+Gv.replace("\\.","")+"]",x4=/((?:WC+[\/:])*)/.source.replace("WC",Vv),w4=/(WCOD+)?/.source.replace("WCOD",b4),S4=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Vv),E4=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Vv),C4=new RegExp("^"+x4+w4+S4+E4+"$"),D4=["material","materials","bones"];class T4{constructor(e,t,r){const i=r||Ft.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const i=this._bindings[this._targetGroup.nCachedObjects_];void 0!==i&&i.getValue(e,t)}setValue(e,t){const r=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=r.length;i!==s;++i)r[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}let Ft=(()=>{class n{constructor(t,r,i){this.path=r,this.parsedPath=i||n.parseTrackName(r),this.node=n.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,r,i){return t&&t.isAnimationObjectGroup?new n.Composite(t,r,i):new n(t,r,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(M4,"")}static parseTrackName(t){const r=C4.exec(t);if(null===r)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:r[2],objectName:r[3],objectIndex:r[4],propertyName:r[5],propertyIndex:r[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=i.nodeName.substring(s+1);-1!==D4.indexOf(o)&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=o)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,r){if(void 0===r||""===r||"."===r||-1===r||r===t.name||r===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(r);if(void 0!==i)return i}if(t.children){const i=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===r||l.uuid===r)return l;const c=i(l.children);if(c)return c}return null},s=i(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,r){t[r]=this.targetObject[this.propertyName]}_getValue_array(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)t[r++]=i[s]}_getValue_arrayElement(t,r){t[r]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,r){this.resolvedProperty.toArray(t,r)}_setValue_direct(t,r){this.targetObject[this.propertyName]=t[r]}_setValue_direct_setNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,r){this.targetObject[this.propertyName]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++]}_setValue_array_setNeedsUpdate(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,r){const i=this.resolvedProperty;for(let s=0,o=i.length;s!==o;++s)i[s]=t[r++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,r){this.resolvedProperty[this.propertyIndex]=t[r]}_setValue_arrayElement_setNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty[this.propertyIndex]=t[r],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,r){this.resolvedProperty.fromArray(t,r)}_setValue_fromArray_setNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,r){this.resolvedProperty.fromArray(t,r),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,r){this.bind(),this.getValue(t,r)}_setValue_unbound(t,r){this.bind(),this.setValue(t,r)}bind(){let t=this.node;const r=this.parsedPath,i=r.objectName,s=r.propertyName;let o=r.propertyIndex;if(t||(t=n.findNode(this.rootNode,r.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let u=r.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===u){u=d;break}break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+r.nodeName+"."+s+" but it wasn't found.",t);let l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=T4,n})();Ft.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Ft.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Ft.prototype.GetterByBindingType=[Ft.prototype._getValue_direct,Ft.prototype._getValue_array,Ft.prototype._getValue_arrayElement,Ft.prototype._getValue_toArray],Ft.prototype.SetterByBindingTypeAndVersioning=[[Ft.prototype._setValue_direct,Ft.prototype._setValue_direct_setNeedsUpdate,Ft.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Ft.prototype._setValue_array,Ft.prototype._setValue_array_setNeedsUpdate,Ft.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Ft.prototype._setValue_arrayElement,Ft.prototype._setValue_arrayElement_setNeedsUpdate,Ft.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Ft.prototype._setValue_fromArray,Ft.prototype._setValue_fromArray_setNeedsUpdate,Ft.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class A4{constructor(e,t,r=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=r,this.blendMode=i;const s=t.tracks,o=s.length,a=new Array(o),l={endingStart:Na,endingEnd:Na};for(let c=0;c!==o;++c){const u=s[c].createInterpolant(null);a[c]=u,u.settings=l}this._interpolantSettings=l,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){const i=this._clip.duration,s=e._clip.duration,a=i/s;e.warp(1,s/i,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,r){return e.crossFadeFrom(this,t,r)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,r){const i=this._mixer,s=i.time,o=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,l[1]=s+r,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,r,i){if(!this.enabled)return void this._updateWeight(e);const s=this._startTime;if(null!==s){const l=(e-s)*r;if(l<0||0===r)return;this._startTime=null,t=r*l}t*=this._updateTimeScale(e);const o=this._updateTime(t),a=this._updateWeight(e);if(a>0){const l=this._interpolants,c=this._propertyBindings;if(2501===this.blendMode)for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(o),c[u].accumulateAdditive(a);else for(let u=0,d=l.length;u!==d;++u)l[u].evaluate(o),c[u].accumulate(i,a)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const r=this._weightInterpolant;if(null!==r){const i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const r=this._timeScaleInterpolant;null!==r&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,r=this.loop;let i=this.time+e,s=this._loopCount;const o=2202===r;if(0===e)return-1===s?i:o&&1==(1&s)?t-i:i;if(2200===r){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else{if(!(i<0)){this.time=i;break e}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),i>=t||i<0){const a=Math.floor(i/t);i-=t*a,s+=Math.abs(a);const l=this.repetitions-s;if(l<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===l){const c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=i;if(o&&1==(1&s))return t-i}return i}_setEndings(e,t,r){const i=this._interpolantSettings;r?(i.endingStart=Aa,i.endingEnd=Aa):(i.endingStart=e?this.zeroSlopeAtStart?Aa:Na:2402,i.endingEnd=t?this.zeroSlopeAtEnd?Aa:Na:2402)}_scheduleFading(e,t,r){const i=this._mixer,s=i.time;let o=this._weightInterpolant;null===o&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,l[0]=t,a[1]=s+e,l[1]=r,this}}(class I4 extends fs{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const r=e._localRoot||this._root,i=e._clip.tracks,s=i.length,o=e._propertyBindings,a=e._interpolants,l=r.uuid,c=this._bindingsByRootAndName;let u=c[l];void 0===u&&(u={},c[l]=u);for(let d=0;d!==s;++d){const h=i[d],f=h.name;let p=u[f];if(void 0!==p)++p.referenceCount,o[d]=p;else{if(p=o[d],void 0!==p){null===p._cacheIndex&&(++p.referenceCount,this._addInactiveBinding(p,l,f));continue}p=new _4(Ft.create(r,f,t&&t._propertyBindings[d].binding.parsedPath),h.ValueTypeName,h.getValueSize()),++p.referenceCount,this._addInactiveBinding(p,l,f),o[d]=p}a[d].resultBuffer=p.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const r=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,r)}const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];0==s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];0==--s.useCount&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,r){const i=this._actions,s=this._actionsByClip;let o=s[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[r]=e}_removeInactiveAction(e){const t=this._actions,r=t[t.length-1],i=e._cacheIndex;r._cacheIndex=i,t[i]=r,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,a=o[s],l=a.knownActions,c=l[l.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,l[u]=c,l.pop(),e._byClipCacheIndex=null,delete a.actionByRoot[(e._localRoot||this._root).uuid],0===l.length&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let r=0,i=t.length;r!==i;++r){const s=t[r];0==--s.referenceCount&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_takeBackAction(e){const t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_addInactiveBinding(e,t,r){const i=this._bindingsByRootAndName,s=this._bindings;let o=i[t];void 0===o&&(o={},i[t]=o),o[r]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,r=e.binding,i=r.rootNode.uuid,s=r.path,o=this._bindingsByRootAndName,a=o[i],l=t[t.length-1],c=e._cacheIndex;l._cacheIndex=c,t[c]=l,t.pop(),delete a[s],0===Object.keys(a).length&&delete o[i]}_lendBinding(e){const t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_takeBackBinding(e){const t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=r,t[r]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let r=e[t];return void 0===r&&(r=new YD(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),r.__cacheIndex=t,e[t]=r),r}_takeBackControlInterpolant(e){const t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=r,t[r]=s}clipAction(e,t,r){const i=t||this._root,s=i.uuid;let o="string"==typeof e?vf.findByName(i,e):e;const a=null!==o?o.uuid:e,l=this._actionsByClip[a];let c=null;if(void 0===r&&(r=null!==o?o.blendMode:2500),void 0!==l){const d=l.actionByRoot[s];if(void 0!==d&&d.blendMode===r)return d;c=l.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const u=new A4(this,o,t,r);return this._bindAction(u,c),this._addInactiveAction(u,a,s),u}existingAction(e,t){const r=t||this._root,i=r.uuid,s="string"==typeof e?vf.findByName(r,e):e,a=this._actionsByClip[s?s.uuid:e];return void 0!==a&&a.actionByRoot[i]||null}stopAllAction(){const e=this._actions;for(let r=this._nActiveActions-1;r>=0;--r)e[r].stop();return this}update(e){const t=this._actions,r=this._nActiveActions,i=this.time+=e*=this.timeScale,s=Math.sign(e),o=this._accuIndex^=1;for(let c=0;c!==r;++c)t[c]._update(i,e,s,o);const a=this._bindings,l=this._nActiveBindings;for(let c=0;c!==l;++c)a[c].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,r=e.uuid,i=this._actionsByClip,s=i[r];if(void 0!==s){const o=s.knownActions;for(let a=0,l=o.length;a!==l;++a){const c=o[a];this._deactivateAction(c);const u=c._cacheIndex,d=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,d._cacheIndex=u,t[u]=d,t.pop(),this._removeInactiveBindingsForAction(c)}delete i[r]}}uncacheRoot(e){const t=e.uuid,r=this._actionsByClip;for(const o in r){const l=r[o].actionByRoot[t];void 0!==l&&(this._deactivateAction(l),this._removeInactiveAction(l))}const s=this._bindingsByRootAndName[t];if(void 0!==s)for(const o in s){const a=s[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){const r=this.existingAction(e,t);null!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}}).prototype._controlInterpolantsResultBuffer=new Float32Array(1);class zv{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new zv(void 0===this.value.clone?this.value:this.value.clone())}}(class R4 extends Qa{constructor(e,t,r=1){super(e,t),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}).prototype.isInstancedInterleavedBuffer=!0;class L4{constructor(e,t,r=0,i=1/0){this.ray=new ho(e,t),this.near=r,this.far=i,this.camera=null,this.layers=new Ua,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,r=[]){return jv(e,this,r,t),r.sort(MT),r}intersectObjects(e,t=!0,r=[]){for(let i=0,s=e.length;i<s;i++)jv(e[i],this,r,t);return r.sort(MT),r}}function MT(n,e){return n.distance-e.distance}function jv(n,e,t,r){if(n.layers.test(e.layers)&&n.raycast(e,t),!0===r){const i=n.children;for(let s=0,o=i.length;s<o;s++)jv(i[s],e,t,!0)}}class bT{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(en(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}const xT=new $;class uu{constructor(e=new $(1/0,1/0),t=new $(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=xT.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return xT.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}uu.prototype.isBox2=!0;const Is=new S,wf=new Se,Wv=new Se;function ET(n){const e=[];!0===n.isBone&&e.push(n);for(let t=0;t<n.children.length;t++)e.push.apply(e,ET(n.children[t]));return e}const IT=new ArrayBuffer(4),Zr=(new Float32Array(IT),new Uint32Array(IT),new Uint32Array(512)),Xr=new Uint32Array(512);for(let n=0;n<256;++n){const e=n-127;e<-27?(Zr[n]=0,Zr[256|n]=32768,Xr[n]=24,Xr[256|n]=24):e<-14?(Zr[n]=1024>>-e-14,Zr[256|n]=1024>>-e-14|32768,Xr[n]=-e-1,Xr[256|n]=-e-1):e<=15?(Zr[n]=e+15<<10,Zr[256|n]=e+15<<10|32768,Xr[n]=13,Xr[256|n]=13):e<128?(Zr[n]=31744,Zr[256|n]=64512,Xr[n]=24,Xr[256|n]=24):(Zr[n]=31744,Zr[256|n]=64512,Xr[n]=13,Xr[256|n]=13)}const qv=new Uint32Array(2048),hl=new Uint32Array(64),LT=new Uint32Array(64);for(let n=1;n<1024;++n){let e=n<<13,t=0;for(;0==(8388608&e);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,qv[n]=e|t}for(let n=1024;n<2048;++n)qv[n]=939524096+(n-1024<<13);for(let n=1;n<31;++n)hl[n]=n<<23;hl[31]=1199570944,hl[32]=2147483648;for(let n=33;n<63;++n)hl[n]=2147483648+(n-32<<23);hl[63]=3347054592;for(let n=1;n<64;++n)32!==n&&(LT[n]=1024);Ar.create=function(n,e){return console.log("THREE.Curve.create() has been deprecated"),n.prototype=Object.create(Ar.prototype),n.prototype.constructor=n,n.prototype.getPoint=e,n},Qc.prototype.fromPoints=function(n){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(n)},class B4 extends ol{constructor(e=10,t=10,r=4473924,i=8947848){r=new ce(r),i=new ce(i);const s=t/2,o=e/t,a=e/2,l=[],c=[];for(let h=0,f=0,p=-a;h<=t;h++,p+=o){l.push(-a,0,p,a,0,p),l.push(p,0,-a,p,0,a);const m=h===s?r:i;m.toArray(c,f),f+=3,m.toArray(c,f),f+=3,m.toArray(c,f),f+=3,m.toArray(c,f),f+=3}const u=new Le;u.setAttribute("position",new we(l,3)),u.setAttribute("color",new we(c,3)),super(u,new An({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},class O4 extends ol{constructor(e){const t=ET(e),r=new Le,i=[],s=[],o=new ce(0,0,1),a=new ce(0,1,0);for(let c=0;c<t.length;c++){const u=t[c];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(o.r,o.g,o.b),s.push(a.r,a.g,a.b))}r.setAttribute("position",new we(i,3)),r.setAttribute("color",new we(s,3)),super(r,new An({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,r=this.geometry,i=r.getAttribute("position");Wv.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const a=t[s];a.parent&&a.parent.isBone&&(wf.multiplyMatrices(Wv,a.matrixWorld),Is.setFromMatrixPosition(wf),i.setXYZ(o,Is.x,Is.y,Is.z),wf.multiplyMatrices(Wv,a.parent.matrixWorld),Is.setFromMatrixPosition(wf),i.setXYZ(o+1,Is.x,Is.y,Is.z),o+=2)}r.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Ns.prototype.extractUrlBase=function(n){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),class Hv{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(r){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}.extractUrlBase(n)},Ns.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},uu.prototype.center=function(n){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(n)},uu.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},uu.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},uu.prototype.size=function(n){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(n)},Tr.prototype.center=function(n){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(n)},Tr.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Tr.prototype.isIntersectionBox=function(n){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},Tr.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)},Tr.prototype.size=function(n){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(n)},Hi.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},uo.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Fh.prototype.setFromMatrix=function(n){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(n)},Sn.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)},Sn.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)},Sn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Sn.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),n.applyMatrix3(this)},Sn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Sn.prototype.getInverse=function(n){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()},Se.prototype.extractPosition=function(n){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(n)},Se.prototype.flattenToArrayOffset=function(n,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(n,e)},Se.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new S).setFromMatrixColumn(this,3)},Se.prototype.setRotationFromQuaternion=function(n){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(n)},Se.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Se.prototype.multiplyVector3=function(n){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Se.prototype.multiplyVector4=function(n){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Se.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Se.prototype.rotateAxis=function(n){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),n.transformDirection(this)},Se.prototype.crossVector=function(n){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Se.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Se.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Se.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Se.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Se.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Se.prototype.applyToBufferAttribute=function(n){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),n.applyMatrix4(this)},Se.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Se.prototype.makeFrustum=function(n,e,t,r,i,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(n,e,r,t,i,s)},Se.prototype.getInverse=function(n){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(n).invert()},ji.prototype.isIntersectionLine=function(n){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(n)},ln.prototype.multiplyVector3=function(n){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),n.applyQuaternion(this)},ln.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},ho.prototype.isIntersectionBox=function(n){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(n)},ho.prototype.isIntersectionPlane=function(n){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(n)},ho.prototype.isIntersectionSphere=function(n){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(n)},cn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},cn.prototype.barycoordFromPoint=function(n,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(n,e)},cn.prototype.midpoint=function(n){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(n)},cn.prototypenormal=function(n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(n)},cn.prototype.plane=function(n){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(n)},cn.barycoordFromPoint=function(n,e,t,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),cn.getBarycoord(n,e,t,r,i)},cn.normal=function(n,e,t,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),cn.getNormal(n,e,t,r)},Wi.prototype.extractAllPoints=function(n){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(n)},Wi.prototype.extrude=function(n){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ds(this,n)},Wi.prototype.makeGeometry=function(n){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new su(this,n)},$.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},$.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)},$.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},S.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},S.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},S.prototype.getPositionFromMatrix=function(n){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(n)},S.prototype.getScaleFromMatrix=function(n){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(n)},S.prototype.getColumnFromMatrix=function(n,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,n)},S.prototype.applyProjection=function(n){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(n)},S.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},S.prototype.distanceToManhattan=function(n){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(n)},S.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},wt.prototype.fromAttribute=function(n,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(n,e,t)},wt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},_t.prototype.getChildByName=function(n){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(n)},_t.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},_t.prototype.translate=function(n,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,n)},_t.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},_t.prototype.applyMatrix=function(n){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)},Object.defineProperties(_t.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(n){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=n}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Mn.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Mn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),yv.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Ut.prototype.setLens=function(n,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(n)},Object.defineProperties(ui.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(n){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=n}},shadowCameraLeft:{set:function(n){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=n}},shadowCameraRight:{set:function(n){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=n}},shadowCameraTop:{set:function(n){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=n}},shadowCameraBottom:{set:function(n){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=n}},shadowCameraNear:{set:function(n){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=n}},shadowCameraFar:{set:function(n){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=n}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(n){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=n}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(n){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=n}},shadowMapHeight:{set:function(n){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=n}}}),Object.defineProperties(Pt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===kc},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(kc)}}}),Pt.prototype.setDynamic=function(n){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===n?kc:Oc),this},Pt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},Pt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Le.prototype.addIndex=function(n){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(n)},Le.prototype.addAttribute=function(n,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===n?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(n,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(n,new Pt(arguments[1],arguments[2])))},Le.prototype.addDrawCall=function(n,e,t){void 0!==t&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(n,e)},Le.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Le.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Le.prototype.removeAttribute=function(n){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(n)},Le.prototype.applyMatrix=function(n){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(n)},Object.defineProperties(Le.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Qa.prototype.setDynamic=function(n){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===n?kc:Oc),this},Qa.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ds.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Ds.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Ds.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Hh.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},zv.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(un.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ce}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(n){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(n){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=n}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(qr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(n){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=n}}}),Mt.prototype.clearTarget=function(n,e,t,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(n),this.clear(e,t,r)},Mt.prototype.animate=function(n){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(n)},Mt.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Mt.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Mt.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Mt.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Mt.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Mt.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Mt.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Mt.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Mt.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Mt.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Mt.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Mt.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Mt.prototype.enableScissorTest=function(n){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(n)},Mt.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Mt.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Mt.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Mt.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Mt.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Mt.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Mt.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Mt.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Mt.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Mt.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Mt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=n}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(n){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=n}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(n){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===n?Rt:Oi}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(tD.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(dr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=n}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(n){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=n}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=n}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(n){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=n}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(n){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=n}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(n){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=n}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(n){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=n}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(n){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=n}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(n){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=n}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(n){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=n}}}),class m4 extends _t{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}.prototype.load=function(n){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new h4).load(n,function(r){e.setBuffer(r)}),this},iv.prototype.updateCubeMap=function(n,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(n,e)},iv.prototype.clear=function(n,e,t,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(n,e,t,r)},oo.crossOrigin=void 0,oo.loadTexture=function(n,e,t,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new a4;i.setCrossOrigin(this.crossOrigin);const s=i.load(n,t,void 0,r);return e&&(s.mapping=e),s},oo.loadTextureCube=function(n,e,t,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new o4;i.setCrossOrigin(this.crossOrigin);const s=i.load(n,t,void 0,r);return e&&(s.mapping=e),s},oo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},oo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"140"}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="140");const U4=["rendererCanvas"];function H4(n,e){1&n&&rm(0,3),2&n&&(cx(),Zs("ngTemplateOutlet",Zg(4)))}function G4(n,e){1&n&&Ni(0)}const V4=["*"];class fl extends Er{constructor(e){super(e||null)}set(e){this.next("function"==typeof e?e(this.value):e)}}let Zv=(()=>{class n{constructor(){this.destroySubject$=new Nc(1),this.destroy$=this.destroySubject$.asObservable(),this.stateSubject$=new Nc(1)}ngOnDestroy(){this.stateSubject$.complete(),this.destroySubject$.next()}get(t){let r;return this.stateSubject$.pipe(Nl(1),du(),mt(i=>t?t(i):i),du()).subscribe(i=>{r=i}),r}set(t){const r="function"==typeof t?t(this.get()):t;this.updateState((i,s)=>Object.assign(Object.assign({},i),s))(r)}select(...t){if(0===t.length)return this.stateSubject$.pipe(du(),mE(),Lu({connector:()=>new Nc(1),resetOnComplete:!0,resetOnRefCountZero:!0,resetOnError:!0}),va(this.destroy$));_y(t[t.length-1])&&t.push(()=>({}));const{observables:r,projector:i}=function j4(n){const e=Array.from(n),t=e.pop();return{observables:e,projector:t}}(t);let s;return s=0===r.length?this.stateSubject$.pipe(du(),mt(i)):vE(r).pipe(mt(o=>i(...o))),s.pipe(du(),mE(),Lu({connector:()=>new Nc(1),resetOnComplete:!0,resetOnRefCountZero:!0,resetOnError:!0}),va(this.destroy$))}effect(t){const r=new er;return t(r).pipe(va(this.destroy$)).subscribe(),i=>(_y(i)?i:Oe(i)).pipe(va(this.destroy$)).subscribe(o=>{r.next(o)})}onCanvasReady(t,r,i=!1){return this.effect((i?di:jt)(()=>r()))(t)}subscribeTo(t){return this.effect(r=>r)(t)}updateState(t){return r=>(_y(r)?r:Oe(r)).pipe(_a(s=>e0([s],BB).pipe(xE(this.stateSubject$.pipe(nh({}))))),va(this.destroy$)).subscribe({next:([s,o])=>{this.stateSubject$.next(t(o||{},s))},error:s=>{this.stateSubject$.error(s)}})}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();function di(n){let r,e=Cl,t=!1;const i=s=>()=>{e&&e({prev:r,complete:!0,error:s})};return jt({next:s=>{e&&t&&e({prev:r,complete:!1,error:!1});const o=n(s);o&&(e=o),r=s,t||(t=!0)},complete:i(!1),unsubscribe:i(!1),error:i(!0)})}function du(){return Fi(n=>void 0!==n)}function Ge(){return nh(void 0)}const hu=new _e("NgtInstance ref"),Xv=new _e("NgtInstance ref of the host of the wrapper"),pl=new _e("NgtObject ref"),Tf=new _e("NgtObject ref of the host of the wrapper"),W4=new _e("Ref for root Camera"),$4=new _e("Ref for root Scene"),J4=(new _e("NgtCommonAttribute ref"),new _e("NgtCommonAudio ref"),new _e("NgtCommonCamera ref"),new _e("NgtCommonCurve ref"),new _e("NgtCommonGeometry ref")),Q4=(new _e("NgtCommonHelper ref"),new _e("NgtCommonLight ref")),tW=(new _e("NgtCommonLine ref"),new _e("NgtCommonMaterial ref")),nW=new _e("NgtMaterialGeometry ref"),rW=new _e("NgtCommonMesh ref");function xo(n){null!==n&&"object"==typeof n&&"needsUpdate"in n&&(n.needsUpdate=!0,"uniformsNeedUpdate"in n&&(n.uniformsNeedUpdate=!0))}new _e("NgtCommonObjectHelper ref"),new _e("NgtCommonSprite ref"),new _e("NgtCommonTexture ref"),new _e("NgtSkinnedMesh ref as parent host"),new _e("NgtBone ref as parent host"),new _e("NgtSkeleton ref as parent host");const Ve={obj:n=>n===Object(n)&&!Ve.arr(n)&&"function"!=typeof n,material:n=>!!n&&n.isMaterial,geometry:n=>!!n&&n.isBufferGeometry,orthographic:n=>!!n&&n.isOrthographicCamera,perspective:n=>!!n&&n.isPerspectiveCamera,camera:n=>!!n&&n.isCamera,glRenderer:n=>!!n&&n instanceof Mt,scene:n=>!!n&&n.isScene,object3d:n=>!!n&&n.isObject3D,instance:n=>!!n&&!!n.__ngt__,ref:n=>!!n&&n instanceof fl,vector3:n=>!!n&&n.isVector3,color:n=>!!n&&n.isColor,fun:n=>"function"==typeof n,str:n=>"string"==typeof n,num:n=>"number"==typeof n,boo:n=>"boolean"==typeof n,und:n=>void 0===n,arr:n=>Array.isArray(n),equ(n,e,{arrays:t="shallow",objects:r="reference",strict:i=!0}={}){if(typeof n!=typeof e||!!n!=!!e)return!1;if(Ve.str(n)||Ve.num(n))return n===e;const s=Ve.obj(n);if(s&&"reference"===r)return n===e;const o=Ve.arr(n);if(o&&"reference"===t)return n===e;if((o||s)&&n===e)return!0;let a;for(a in n)if(!(a in e))return!1;for(a in i?e:n)if(n[a]!==e[a])return!1;if(Ve.und(a)){if(o&&0===n.length&&0===e.length||s&&0===Object.keys(n).length&&0===Object.keys(e).length)return!0;if(n!==e)return!1}return!0}};function Rs(n,e){var t;if(!Object.keys(e).length)return;const i=(n.__ngt__||{}).root,s=null!==(t=null==i?void 0:i())&&void 0!==t?t:{};"__ngt__"in e&&(n.__ngt__=e.__ngt__);for(const o of Object.entries(e)){const a=o[0];let l=o[1];if("raycast"===a&&null==l)continue;Ve.ref(l)&&(l=l.value);const c=n,u=c[a];if(u&&u.set&&(u.copy||u instanceof Ua)){if(Ve.arr(l))u.fromArray?u.fromArray(l):u.set(...l);else if(u.copy&&l&&l.constructor&&u.constructor.name===l.constructor.name)u.copy(l);else if(void 0!==l){const d=u instanceof ce;!d&&u.setScalar?u.setScalar(l):u instanceof Ua&&l instanceof Ua?u.mask=l.mask:u.set(l),!Kn&&!s.linear&&d&&u.convertSRGBToLinear()}}else c[a]=l,!s.linear&&c[a]instanceof zn&&(c[a].encoding=Rt);xo(l),xo(u)}}function Qe(n){return null!=n&&"false"!=`${n}`}function ze(n,e=0){return function uW(n){return!isNaN(parseFloat(n))&&!isNaN(Number(n))}(n)?Number(n):e}const Nf=n=>{var e;return null===(e=n.__ngt__)||void 0===e?void 0:e.root()};function Yv(n,e,t,r,i=!1){var s,o,a,l,c,u,d,h,f,p,m,g,v;const y=t||(r?null===(o=null===(s=r.value)||void 0===s?void 0:s.__ngt__)||void 0===o?void 0:o.parent:void 0);return Ve.scene(n)&&Rs(n,{dispose:null}),Object.assign(n,{__ngt__:{root:e,primitive:i||(null===(l=null===(a=null==r?void 0:r.value)||void 0===a?void 0:a.__ngt__)||void 0===l?void 0:l.primitive),eventCount:null!==(d=null===(u=null===(c=null==r?void 0:r.value)||void 0===c?void 0:c.__ngt__)||void 0===u?void 0:u.eventCount)&&void 0!==d?d:0,handlers:null!==(p=null===(f=null===(h=null==r?void 0:r.value)||void 0===h?void 0:h.__ngt__)||void 0===f?void 0:f.handlers)&&void 0!==p?p:{},objects:null!==(v=null===(g=null===(m=null==r?void 0:r.value)||void 0===m?void 0:m.__ngt__)||void 0===g?void 0:g.objects)&&void 0!==v?v:new fl([]),parent:y?y===n?null:y:null}})}function FT(n){return n?n instanceof S?n:Ve.arr(n)?new S(...n):new S(n,n,n):new S}function OT(n,e){return e?e instanceof n?e:new n(...e):new n}function dW(n){return n?n instanceof ce?n:Ve.arr(n)?new ce(...n):new ce(n):new ce}function kT(n){return Ve.arr(n)?Math.min(Math.max(n[0],window.devicePixelRatio),n[1]):n}const BT={};function fu(n){if(n)return(n.eventObject||n.object).uuid+"/"+n.index+n.instanceId;const e=oH.generateUUID();return BT[e]?fu():(BT[e]=!0,e)}function UT(n,e,t,r){const i=t.get(e);i&&(t.delete(e),0===t.size&&(n.delete(r),i.target.releasePointerCapture(r)))}function Jv(n,e,t){const{decomposedPath:r,base:i}=function pW(n){return n.length<1?{base:"",decomposedPath:[]}:{base:n[0],decomposedPath:n}}(e);void 0!==i&&(function gW(n,e){!Object.prototype.hasOwnProperty.call(n,e)&&Reflect&&Reflect.has&&!Reflect.has(n,e)&&(n[e]={})}(n,i),r.length<=1?Rs(n,{[i]:t}):Jv(n[i],r.slice(1),t))}const HT=new _e("NgtPerformance options",{factory:()=>({current:1,min:.5,max:1,debounce:200})}),Af=new _e("window",{factory:()=>{const{defaultView:n}=Wl(Vn);if(!n)throw"window is not available!";return n}}),zT=new _e("ngtResizeObserver Options",{factory:()=>({box:"content-box",scroll:!1,offsetSize:!1,debounce:200})}),mW=new _e("Resize Observer API support",{factory:()=>{const n=Wl(Af);return"ResizeObserver"in n&&null!=n.ResizeObserver}});let jT=(()=>{class n extends Gt{constructor({nativeElement:t},r,i,s,o,{box:a,offsetSize:l,scroll:c,debounce:u}){let d,h,f=[];const p=new er,m=WT(t),g=u?"number"==typeof u?u:u.scroll:null,v=u?"number"==typeof u?u:u.resize:null,y=M=>R_(wE(null!=M?M:0),va(p));return super(M=>{if(o)return r.runOutsideAngular(()=>{const _=w=>{f=w;const{left:A,top:b,width:C,height:R,bottom:P,right:U,x:Z,y:L}=t.getBoundingClientRect(),k={left:A,top:b,width:C,height:R,bottom:P,right:U,x:Z,y:L};t instanceof HTMLElement&&l&&(k.height=t.offsetHeight,k.width=t.offsetWidth),Object.freeze(k),M.next(Object.assign({entries:w,dpr:s.devicePixelRatio},k)),vW(h||{},k)||(h=k)},x=()=>{_(f)};d=new ResizeObserver(_),d.observe(t,{box:a}),c&&(m&&m.forEach(w=>{Ic(w,"scroll",{capture:!0,passive:!0}).pipe(y(g)).subscribe(x)}),Ic(s,"scroll",{capture:!0,passive:!0}).pipe(y(g)).subscribe(x)),Ic(s,"resize").pipe(y(v)).subscribe(x)}),()=>{d&&(d.unobserve(t),d.disconnect()),p.next(),p.complete()};M.error("ResizeObserver is not supported in your browser. Please use a polyfill")}),this.pipe(wE(g||0),Lu({connector:()=>new Nc(1),resetOnRefCountZero:!0,resetOnComplete:!0}))}}return n.\u0275fac=function(t){return new(t||n)(xe(oi),xe(Bt),xe(Vn),xe(Af),xe(mW),xe(zT))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();function WT(n){const e=[];if(!n||n===document.body)return e;const{overflow:t,overflowX:r,overflowY:i}=window.getComputedStyle(n);return[t,r,i].some(s=>"auto"===s||"scroll"===s)&&e.push(n),[...e,...WT(n.parentElement)]}const yW=["x","y","top","bottom","left","right","width","height"],vW=(n,e)=>yW.every(t=>n[t]===e[t]),$T={click:!1,contextmenu:!1,dblclick:!1,wheel:!1,pointerdown:!0,pointerup:!0,pointerleave:!0,pointermove:!0,pointercancel:!0,lostpointercapture:!0};let gl=(()=>{class n extends Zv{constructor({nativeElement:{clientWidth:t,clientHeight:r}},i,{devicePixelRatio:s},o,a,l){super(),this.parentStore=o,this.resizeResult$=a,this.zone=l,this.pointer=new $,this.position=new S,this.defaultTarget=new S,this.tempTarget=new S,this.ready$=this.select(c=>c.ready).pipe(Fi(c=>c)),this.camera$=this.select(c=>c.camera),this.scene$=this.select(c=>c.scene),this.gl$=this.select(c=>c.gl),this.raycaster$=this.select(c=>c.raycaster),this.active$=this.select(c=>c.internal.active),this.allConstructed$=this.select(this.camera$,this.scene$,this.gl$,this.raycaster$,this.active$,(c,u,d,h,f)=>!!(c&&d&&u&&h&&!0===f)).pipe(mt(c=>({ready:c}))),this.performanceTimeoutId=void 0,this.dimensions$=this.select(this.select(c=>c.size),this.select(c=>c.viewport),(c,u)=>({size:c,viewport:u})),this.startLoop=this.effect(jt(({invalidate:c})=>{c()})),this.initRenderer=this.effect(di(({canvasElement:c,rootStateMap:u,advance:d})=>{var h,f,p,m;const g=this.get(),v=Yv(new Hh,()=>this.get(),(null===(h=this.parentStore)||void 0===h?void 0:h.get(P=>P.sceneRef))||null);Rs(v,g.sceneOptions),this.get(P=>P.sceneRef).set(v);let y=g.gl;g.gl||(y=function bW(n,e){const t="function"==typeof n?n(e):n;return null!=(null==t?void 0:t.render)?t:new Mt(Object.assign({powerPreference:"high-performance",canvas:e,antialias:!0,alpha:!0},n))}(g.glOptions,c)),this.set({gl:y});let M=g.raycaster;g.raycaster||(M=new L4);const _=g.raycasterOptions||{},{params:x}=_,w=ip(_,["params"]);Rs(M,Object.assign(Object.assign({enabled:!0},w),{params:Object.assign(Object.assign({},M.params),x||{})}));let A=g.camera;if(!g.camera){const P=Ve.camera(g.cameraOptions);if(A=P?g.cameraOptions:function MW(n){return n.orthographic?new ws(0,0,0,0,.1,1e3):new Ut(75,n.size.width/n.size.height,.1,1e3)}(g),!P){if(g.cameraOptions&&Rs(A,g.cameraOptions),(null===(f=g.cameraOptions)||void 0===f?void 0:f.position)||(A.position.z=5),!(null===(p=g.cameraOptions)||void 0===p?void 0:p.rotation))if(g.cameraOptions.lookAt){const U=g.cameraOptions.lookAt;Ve.arr(U)?A.lookAt(U[0],U[1],U[2]):A.lookAt(U)}else A.lookAt(0,0,0);A.updateProjectionMatrix()}Ve.instance(A)||(A=Yv(A,()=>this.get(),(null===(m=this.parentStore)||void 0===m?void 0:m.get(U=>U.cameraRef))||null)),this.get(U=>U.cameraRef).set(A)}let b=g.xr;if(!g.xr){const P=(Z,L)=>{const k=this.get();"never"!==k.frameloop&&d(Z,!0,()=>k,L)},U=()=>{const Z=this.get(L=>L.gl);Z.xr.enabled=Z.xr.isPresenting,Z.xr.setAnimationLoop(Z.xr.isPresenting?P:null)};b={connect:()=>{const Z=this.get(L=>L.gl);Z.xr.addEventListener("sessionstart",U),Z.xr.addEventListener("sessionend",U)},disconnect:()=>{const Z=this.get(L=>L.gl);Z.xr.removeEventListener("sessionstart",U),Z.xr.removeEventListener("sessionend",U)}},y.xr&&b.connect()}y.shadowMap&&g.shadows&&(y.shadowMap.enabled=!0,"object"==typeof g.shadows?Object.assign(y.shadowMap,g.shadows):y.shadowMap.type=2,xo(y.shadowMap)),Kn&&(Kn.legacyMode=g.legacy);const C=g.linear?Oi:Rt,R=g.flat?0:4;return y.outputEncoding!==C&&(y.outputEncoding=C),y.toneMapping!==R&&(y.toneMapping=R),y.setClearAlpha(0),y.setPixelRatio(kT(g.viewport.dpr)),y.setSize(g.size.width,g.size.height),"object"==typeof g.glOptions&&"function"!=typeof g.glOptions&&!Ve.glRenderer(g.glOptions)&&Rs(y,g.glOptions),this.set({gl:y,camera:A,scene:v,raycaster:M}),()=>{const{gl:P,xr:U,cameraRef:Z,sceneRef:L,events:k}=this.get();P&&(k.disconnect&&k.disconnect(),P.renderLists.dispose(),P.forceContextLoss(),P.xr&&P.xr.enabled&&(P.xr.setAnimationLoop(null),U.disconnect()),Z.complete(),L.complete(),this.set(F=>Object.assign(Object.assign({},F),{internal:Object.assign(Object.assign({},F.internal),{active:!1})})),u.delete(c))}})),this.resize=this.effect(jt(({width:c,height:u,dpr:d})=>{this.set(({viewport:h,camera:f})=>{const p={width:c,height:u};return{size:p,viewport:Object.assign(Object.assign(Object.assign({},h),h.getCurrentViewport(f,this.defaultTarget,p)),{dpr:kT(d)})}})})),this.updateDimensions=this.effect(jt(({size:c,viewport:u})=>{const{camera:d,gl:h,ready:f,cameraOptions:p}=this.get();f&&(function _W(n,e,t){Ve.camera(n)||e.manual||(Ve.orthographic(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}(p,d,c),h.setPixelRatio(u.dpr),h.setSize(c.width,c.height))})),this.registerBeforeRenderEffect=this.effect(di(c=>{var{uuid:u}=c,d=ip(c,["uuid"]);return u&&this.set(h=>({internal:Object.assign(Object.assign({},h.internal),{animations:new Map(h.internal.animations).set(u,d),priority:h.internal.priority+((d.priority||0)>0?1:0)})})),({prev:{uuid:h}={},complete:f})=>{(h!==u||f)&&this.unregisterBeforeRender(u)}})),this.updateSubscribers=this.effect(jt(({animations:c})=>{if(!c.size)return;const d=Array.from(c.values());d.sort((h,f)=>(h.priority||0)-(f.priority||0)),this.set(h=>({internal:Object.assign(Object.assign({},h.internal),{subscribers:d})}))})),this.set({ready:!1,clock:new mT,frameloop:"always",legacy:!1,linear:!1,flat:!1,orthographic:!1,shadows:!1,controls:null,pointer:this.pointer,mouse:this.pointer,sceneRef:new fl,cameraRef:new fl,events:{priority:1,enabled:!0,connected:void 0,handlers:{},compute:(c,u)=>{u.pointer.set(c.offsetX/u.size.width*2-1,-c.offsetY/u.size.height*2+1),u.raycaster.setFromCamera(u.pointer,u.camera)}},cameraOptions:{},glOptions:{},raycasterOptions:{},sceneOptions:{},pointerMissed:()=>{},internal:{active:!1,lastEvent:null,priority:0,frames:0,interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,animations:new Map},dpr:[1,2],size:{width:t,height:r},viewport:{initialDpr:s||1,dpr:s||1,width:t,height:r,aspect:t/r,distance:0,factor:0,getCurrentViewport:(c=this.get(h=>h.camera),u=this.defaultTarget,d=this.get(h=>h.size))=>{const{width:h,height:f}=d,p=h/f;u instanceof S?this.tempTarget.copy(u):this.tempTarget.set(...u);const m=c.getWorldPosition(this.position).distanceTo(this.tempTarget);if(Ve.orthographic(c))return{width:h/c.zoom,height:f/c.zoom,factor:1,distance:m,aspect:p};const g=c.fov*Math.PI/180,v=2*Math.tan(g/2)*m,y=v*(h/f);return{width:y,height:v,factor:h/y,distance:m,aspect:p}}},performance:Object.assign(Object.assign({},i),{regress:()=>{this.zone.runOutsideAngular(()=>{const c=this.get(u=>u.performance);this.performanceTimeoutId&&clearTimeout(this.performanceTimeoutId),c.current!==c.min&&this.set(u=>({performance:Object.assign(Object.assign({},u.performance),{current:c.min})})),this.performanceTimeoutId=setTimeout(()=>this.set(u=>({performance:Object.assign(Object.assign({},u.performance),{current:this.get(d=>d.performance.max)})})),c.debounce)})}}),previousState:null==o?void 0:o.get()})}init(t,r,i,s){this.initEvents(t),this.resize(this.resizeResult$),this.updateDimensions(this.dimensions$),this.initRenderer({canvasElement:t,rootStateMap:r,advance:s}),this.updateSubscribers(this.select(this.select(o=>o.internal.animations),this.select(o=>o.internal.priority),(o,a)=>({animations:o,priority:a}))),this.set(o=>({invalidate:()=>i(()=>this.get()),advance:(a,l)=>s(a,l,()=>this.get()),internal:Object.assign(Object.assign({},o.internal),{active:!0})})),this.set(this.allConstructed$)}registerBeforeRender(t){const r=Ve.object3d(t.obj)?t.obj.uuid:Ve.ref(t.obj)?t.obj.value.uuid:fu();return this.registerBeforeRenderEffect(Object.assign(Object.assign({},t),{uuid:r})),()=>{this.unregisterBeforeRender(r)}}unregisterBeforeRender(t){if(!t)return;const r=this.get(o=>o.internal.animations),i=r.get(t);r.delete(t)&&i&&this.set(o=>({internal:Object.assign(Object.assign({},o.internal),{animations:r,priority:o.internal.priority-((i.priority||0)>0?1:0)})}))}addInteraction(t){this.set(r=>Object.assign(Object.assign({},r),{internal:Object.assign(Object.assign({},r.internal),{interaction:[...r.internal.interaction,t]})}))}removeInteraction(t){this.set(r=>Object.assign(Object.assign({},r),{internal:Object.assign(Object.assign({},r.internal),{interaction:r.internal.interaction.filter(i=>i.uuid!==t)})}))}initEvents(t){const{handlePointer:r}=function fW(n){const e=new S;function r(c){return c.filter(u=>["move","over","enter","out","leave"].some(d=>{var h,f;return null===(f=null===(h=u.__ngt__)||void 0===h?void 0:h.handlers)||void 0===f?void 0:f["pointer"+d]}))}function o(c){const u=n().internal;Array.from(u.hovered.values()).forEach(d=>{var h,f;if(!c.length||!c.find(p=>p.object===d.object&&p.index===d.index&&p.instanceId===d.instanceId)){const m=d.eventObject.__ngt__,g=null==m?void 0:m.handlers;if(u.hovered.delete(fu(d)),null==m?void 0:m.eventCount){const v=Object.assign(Object.assign({},d),{intersections:c||[]});null===(h=g.pointerout)||void 0===h||h.call(g,v),null===(f=g.pointerleave)||void 0===f||f.call(g,v)}}})}function l(c,u){u.forEach(d=>{var h,f,p;return null===(p=null===(f=null===(h=d.__ngt__)||void 0===h?void 0:h.handlers)||void 0===f?void 0:f.pointermissed)||void 0===p?void 0:p.call(f,c)})}return{handlePointer:c=>{switch(c){case"pointerleave":case"pointercancel":return()=>o([]);case"lostpointercapture":return u=>{const d=n().internal;"pointerId"in u&&!d.capturedMap.has(u.pointerId)&&(d.capturedMap.delete(u.pointerId),o([]))}}return u=>{const{pointerMissed:d,internal:h}=n();h.lastEvent=u;const f="pointermove"===c,p="click"===c||"contextmenu"===c||"dblclick"===c,g=function i(c,u){var d,h,f;const p=n(),m=new Set,g=[],v=u?u(p.internal.interaction):p.internal.interaction;v.forEach(M=>{const _=Nf(M);_&&(_.raycaster.camera=void 0)}),p.previousState||null===(h=(d=p.events).compute)||void 0===h||h.call(d,c,p);let y=v.flatMap(M=>{var _,x;const w=Nf(M);return w&&w.events.enabled&&null!==w.raycaster.camera?(void 0===w.raycaster.camera&&(null===(x=(_=w.events).compute)||void 0===x||x.call(_,c,w,w.previousState),void 0===w.raycaster.camera&&(w.raycaster.camera=null)),w.raycaster.camera?w.raycaster.intersectObject(M,!0):[]):[]}).sort((M,_)=>{const x=Nf(M.object),w=Nf(_.object);return x&&w?w.events.priority-x.events.priority||M.distance-_.distance:0}).filter(M=>{const _=fu(M);return!m.has(_)&&(m.add(_),!0)});p.events.filter&&(y=p.events.filter(y,p));for(const M of y){let _=M.object;for(;_;)(null===(f=_.__ngt__)||void 0===f?void 0:f.eventCount)&&g.push(Object.assign(Object.assign({},M),{eventObject:_})),_=_.parent}if("pointerId"in c&&p.internal.capturedMap.has(c.pointerId))for(const M of p.internal.capturedMap.get(c.pointerId).values())g.push(M.intersection);return g}(u,f?r:void 0),v=p?function t(c){const u=n().internal,d=c.offsetX-u.initialClick[0],h=c.offsetY-u.initialClick[1];return Math.round(Math.sqrt(d*d+h*h))}(u):0;"pointerdown"===c&&(h.initialClick=[u.offsetX,u.offsetY],h.initialHits=g.map(y=>y.eventObject)),p&&!g.length&&v<=2&&(l(u,h.interaction),d&&d(u)),f&&o(g),function s(c,u,d,h){const{raycaster:f,pointer:p,camera:m,internal:g}=n();if(c.length){const v=e.set(p.x,p.y,0).unproject(m),y={stopped:!1};for(const M of c){const _=C=>{var R,P;return null!==(P=null===(R=g.capturedMap.get(C))||void 0===R?void 0:R.has(M.eventObject))&&void 0!==P&&P},x=C=>{const R={intersection:M,target:u.target};g.capturedMap.has(C)?g.capturedMap.get(C).set(M.eventObject,R):g.capturedMap.set(C,new Map([[M.eventObject,R]])),u.target.setPointerCapture(C)},w=C=>{const R=g.capturedMap.get(C);R&&UT(g.capturedMap,M.eventObject,R,C)},A={};for(const C in u){const R=u[C];"function"!=typeof R&&(A[C]=R)}const b=Object.assign(Object.assign(Object.assign({},M),A),{pointer:p,intersections:c,stopped:y.stopped,delta:d,unprojectedPoint:v,ray:f.ray,camera:m,stopPropagation:()=>{const C="pointerId"in u&&g.capturedMap.get(u.pointerId);(!C||C.has(M.eventObject))&&(b.stopped=y.stopped=!0,g.hovered.size&&Array.from(g.hovered.values()).find(R=>R.eventObject===M.eventObject))&&o([...c.slice(0,c.indexOf(M)),M])},target:{hasPointerCapture:_,setPointerCapture:x,releasePointerCapture:w},currentTarget:{hasPointerCapture:_,setPointerCapture:x,releasePointerCapture:w},nativeEvent:u});if(h(b),!0===y.stopped)break}}}(g,u,v,y=>{var M,_,x;const w=y.eventObject,A=w.__ngt__,b=null==A?void 0:A.handlers;if(null==A?void 0:A.eventCount)if(f){if(b.pointerover||b.pointerenter||b.pointerout||b.pointerleave){const C=fu(y),R=h.hovered.get(C);R?R.stopped&&y.stopPropagation():(h.hovered.set(C,y),null===(M=b.pointerover)||void 0===M||M.call(b,y),null===(_=b.pointerenter)||void 0===_||_.call(b,y))}null===(x=b.pointermove)||void 0===x||x.call(b,y)}else{const C=b[c];C?(!p||h.initialHits.includes(w))&&(l(u,h.interaction.filter(R=>!h.initialHits.includes(R))),C(y)):p&&h.initialHits.includes(w)&&l(u,h.interaction.filter(R=>!h.initialHits.includes(R)))}})}}}}(()=>this.get());this.set(i=>({events:Object.assign(Object.assign({},i.events),{handlers:Object.keys($T).reduce((s,o)=>(s[o]=r(o),s),{})})})),this.connectElement(t)}connectElement(t){this.set(i=>({events:Object.assign(Object.assign({},i.events),{connected:t})}));const r=this.get(i=>i.events.handlers);Object.entries(null!=r?r:{}).forEach(([i,s])=>{t.addEventListener(i,s,{passive:$T[i]})})}disconnectElement(){const{handlers:t,connected:r}=this.get(i=>i.events);r&&Object.entries(null!=t?t:{}).forEach(([i,s])=>{r instanceof HTMLElement&&r.removeEventListener(i,s)})}ngOnDestroy(){this.disconnectElement(),super.ngOnDestroy()}}return n.\u0275fac=function(t){return new(t||n)(xe(oi),xe(HT),xe(Af),xe(n,12),xe(jT),xe(Bt))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})(),pu=(()=>{class n extends Zv{constructor(t,r,i,s){super(),this.zone=t,this.store=r,this.parentRef=i,this.parentHostRef=s,this.ready=new ct,this.hasEmittedAlready=!1,this.instance$=this.select(o=>o.instance).pipe(us(o=>o.pipe(Fi(a=>null!=a)))),this.instanceArgs$=this.select(o=>o.instanceArgs),this.isPrimitive=!1,this.isWrapper=!1,this.isRaw=!1,this.instanceReady=this.effect(di(()=>{const o=this.setOptions(this.select(this.options$,this.setOptionsTrigger$,a=>a));return this.get(a=>a.noAttach)||this.attachToParent(),()=>{o.unsubscribe()}})),this.setOptions=this.effect(jt(o=>{if(0!==Object.keys(o).length&&this.instanceValue){if(Ve.material(this.instanceValue))return;const a=this.get(),l={},{rotation:c,quaternion:u}=o,d=ip(o,["rotation","quaternion"]);c?l.rotation=a.rotation:u&&(l.quaternion=a.quaternion);for(const h of Object.keys(d))null!=a[h]&&(l[h]=a[h]);Rs(this.instanceValue,l),this.postSetOptions(this.instanceValue),this.checkUpdate(this.instanceValue)}})),this.attachToParent=this.effect(R_(xE(this.select(o=>o.attach)),jt(([,o])=>{var a;let l=this.__ngt__.parent;if(!l||!l.value){if(!(null===(a=this.parent)||void 0===a?void 0:a.value))return;this.__ngt__.parent=this.parent,l=this.parent}if("function"==typeof o){const c=o(l,this.instance);c&&(this.__ngt__.previousAttach=c)}else{const c=[...o];if(0===c.length)return;"material"===c[0]&&c[1]&&Ve.num(Number(c[1]))&&Ve.material(this.instanceValue)&&(Ve.arr(l.value.material)||(l.value.material=[])),this.__ngt__.previousAttachValue=c.reduce((u,d)=>u[d],l.value),Jv(l.value,c,this.instanceValue),this.__ngt__&&this.__ngt__.root().invalidate(),l.value.__ngt__&&l.value.__ngt__.root().invalidate(),this.__ngt__.previousAttach=c,this.set({attach:c})}this.checkUpdate(l.value),this.checkUpdate(this.instanceValue)}))),this.set({instance:new fl(null),instanceArgs:[],attach:[],noAttach:!1,skipParent:!1})}set ref(t){this.set({instance:t})}set skipParent(t){this.set({attachExplicit:!0,skipParent:Qe(t)})}get skipParent(){return this.get(t=>t.skipParent)}set noAttach(t){this.set({noAttachExplicit:!0,noAttach:Qe(t)})}get noAttach(){return this.get(t=>t.noAttach)}set attach(t){t&&this.set({skipParentExplicit:!0,attach:"function"==typeof t||Ve.arr(t)?t:[t]})}get attach(){return this.get(t=>t.attach)}get instance(){return this.get(t=>t.instance)}get instanceValue(){return this.isRaw?this.instance.value.valueOf():this.instance.value}get __ngt__(){return this.instance.value.__ngt__}get parent(){var t,r,i;return this.skipParent?(null===(r=this.parentHostRef)||void 0===r?void 0:r.call(this))||(null===(i=this.parentRef)||void 0===i?void 0:i.call(this)):null===(t=this.parentRef)||void 0===t?void 0:t.call(this)}set instanceArgs(t){this.set({instanceArgs:Ve.arr(t)?t:[t]})}get instanceArgs(){return this.get(t=>t.instanceArgs)}ngOnInit(){this.zone.runOutsideAngular(()=>{this.preInit(),this.onCanvasReady(this.store.ready$,()=>{this.instanceReady(this.instance$)})})}preInit(){}postInit(){}emitReady(){this.hasEmittedAlready||(this.ready.emit(this.instanceValue),this.hasEmittedAlready=!0)}prepareInstance(t,r){var i,s,o;r&&"uuid"in t&&(t.uuid=r);const a=Yv(t,()=>this.store.get(),this.parent,this.instance,this.isPrimitive);if(this.postPrepare(a),this.instance.set(a),this.emitReady(),!Ve.object3d(a)&&!this.noAttach&&!this.skipParent){const l=null===(o=null===(s=null===(i=a.__ngt__.parent)||void 0===i?void 0:i.value)||void 0===s?void 0:s.__ngt__)||void 0===o?void 0:o.objects;l&&l.set([...l.value,this.instance])}return a}adjustCtorParams(t){return t}get ctorParams$(){return this.instanceArgs$.pipe(mt(()=>({})))}destroy(){if(this.instanceValue){if(Ve.object3d(this.instanceValue)){const r=this.parent;r&&Ve.object3d(r.value)&&function hW(n,e){const t=n().internal;t.interaction=t.interaction.filter(r=>r!==e),t.initialHits=t.initialHits.filter(r=>r!==e),t.hovered.forEach((r,i)=>{(r.eventObject===e||r.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((r,i)=>{UT(t.capturedMap,e,r,i)})}(this.__ngt__.root.bind(this.__ngt__),this.instanceValue),null!=this.instanceValue.clear&&this.instanceValue.clear()}else{const r=this.__ngt__.previousAttach;if(null!=r)if("function"==typeof r)r(),this.__ngt__.parent&&this.__ngt__.parent.value&&xo(this.__ngt__.parent.value);else{const i=this.__ngt__.previousAttachValue;this.__ngt__.parent&&this.__ngt__.parent.value&&(Jv(this.__ngt__.parent.value,r,i),xo(this.__ngt__.parent.value))}}const t=this.instanceValue.dispose;t&&"function"==typeof t&&t.apply(this.instanceValue)}this.set({attach:[]}),this.instance.complete()}postPrepare(t){}get optionFields(){return{}}get options$(){const t=Object.entries(this.optionFields);return 0===t.length?Oe({}):this.select(...t.map(([r,i])=>{const s=this.select(o=>o[r]);return i?s.pipe(Ge()):s}),(...r)=>r.reduce((i,s,o)=>(i[t[o][0]]=s,i),{})).pipe(nh({}),function qB(){return $t((n,e)=>{let t,r=!1;n.subscribe(Vt(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}(),mt(([r,i])=>Object.entries(i).reduce((s,[o,a])=>(Ve.equ(r[o],a)||(s[o]=a),s),{})))}ngOnDestroy(){this.zone.runOutsideAngular(()=>{this.destroy()}),super.ngOnDestroy()}postSetOptions(t){}get setOptionsTrigger$(){return Oe({})}checkUpdate(t){Ve.object3d(t)?t.updateMatrix():Ve.camera(t)&&((Ve.perspective(t)||Ve.orthographic(t))&&t.updateProjectionMatrix(),t.updateMatrixWorld()),xo(t)}}return n.\u0275fac=function(t){return new(t||n)(fe(Bt),fe(gl),fe(hu,12),fe(Xv,12))},n.\u0275dir=Ot({type:n,inputs:{ref:"ref",skipParent:"skipParent",noAttach:"noAttach",attach:"attach"},outputs:{ready:"ready"},features:[wn]}),n})();const xW=["click","contextmenu","dblclick","pointerup","pointerdown","pointerover","pointerout","pointerenter","pointerleave","pointermove","pointermissed","pointercancel","wheel"];let wW=(()=>{class n extends pu{constructor(t,r,i,s){super(t,r,i,s),this.parentObjectRef=i,this.parentObjectHostRef=s,this.click=new ct,this.contextmenu=new ct,this.dblclick=new ct,this.pointerup=new ct,this.pointerdown=new ct,this.pointerover=new ct,this.pointerout=new ct,this.pointerenter=new ct,this.pointerleave=new ct,this.pointermove=new ct,this.pointermissed=new ct,this.pointercancel=new ct,this.wheel=new ct,this.shouldPassThroughRef=!0,this.set({name:"",position:new S,rotation:new Hi,quaternion:new ln,scale:new S(1,1,1),color:new ce,castShadow:!1,receiveShadow:!1,priority:0,visible:!0,matrixAutoUpdate:!0,appendMode:"immediate",userData:{}})}set name(t){this.set({nameExplicit:!0,name:t})}get name(){return this.get(t=>t.name)}set position(t){this.set({positionExplicit:!0,position:FT(t)})}get position(){return this.get(t=>t.position)}get rotation(){return this.get(t=>t.rotation)}set rotation(t){this.set({rotationExplicit:!0,rotation:OT(Hi,t)})}get quaternion(){return this.get(t=>t.quaternion)}set quaternion(t){this.set({quaternionExplicit:!0,quaternion:OT(ln,t)})}get scale(){return this.get(t=>t.scale)}set scale(t){this.set({scaleExplicit:!0,scale:FT(t)})}get color(){return this.get(t=>t.color)}set color(t){this.set({colorExplicit:!0,color:dW(t)})}get castShadow(){return this.get(t=>t.castShadow)}set castShadow(t){this.set({castShadowExplicit:!0,castShadow:Qe(t)})}get receiveShadow(){return this.get(t=>t.receiveShadow)}set receiveShadow(t){this.set({receiveShadowExplicit:!0,receiveShadow:Qe(t)})}get priority(){return this.get(t=>t.priority)}set priority(t){this.set({priorityExplicit:!0,priority:ze(t)})}get visible(){return this.get(t=>t.visible)}set visible(t){this.set({visibleExplicit:!0,visible:Qe(t)})}get matrixAutoUpdate(){return this.get(t=>t.matrixAutoUpdate)}set matrixAutoUpdate(t){this.set({matrixAutoUpdateExplicit:!0,matrixAutoUpdate:Qe(t)})}get userData(){return this.get(t=>t.userData)}set userData(t){this.set({userDataExplicit:!0,userData:t})}get dispose(){return this.get(t=>t.dispose)}set dispose(t){this.set({disposeExplicit:!0,dispose:t})}get raycast(){return this.get(t=>t.raycast)}set raycast(t){this.set({raycastExplicit:!0,raycast:t})}get appendMode(){return this.get(t=>t.appendMode)}set appendMode(t){this.set({appendModeExplicit:!0,appendMode:t})}get appendTo(){return this.get(t=>t.appendTo)}set appendTo(t){this.set({appendToExplicit:!0,appendTo:t?Ve.ref(t)?t:new fl(t):void 0})}get optionFields(){return{name:!1,position:!1,rotation:!1,quaternion:!1,scale:!1,color:!1,castShadow:!1,receiveShadow:!1,visible:!1,matrixAutoUpdate:!1,userData:!1,dispose:!0,raycast:!0}}}return n.\u0275fac=function(t){return new(t||n)(fe(Bt),fe(gl),fe(pl,12),fe(Tf,12))},n.\u0275dir=Ot({type:n,inputs:{name:"name",position:"position",rotation:"rotation",quaternion:"quaternion",scale:"scale",color:"color",castShadow:"castShadow",receiveShadow:"receiveShadow",priority:"priority",visible:"visible",matrixAutoUpdate:"matrixAutoUpdate",userData:"userData",dispose:"dispose",raycast:"raycast",appendMode:"appendMode",appendTo:"appendTo"},outputs:{click:"click",contextmenu:"contextmenu",dblclick:"dblclick",pointerup:"pointerup",pointerdown:"pointerdown",pointerover:"pointerover",pointerout:"pointerout",pointerenter:"pointerenter",pointerleave:"pointerleave",pointermove:"pointermove",pointermissed:"pointermissed",pointercancel:"pointercancel",wheel:"wheel"},features:[wn]}),n})(),If=(()=>{class n extends wW{constructor(){super(...arguments),this.appended=new ct,this.beforeRender=new ct,this.animateReady=this.beforeRender}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.preObjectInit?this.preObjectInit(()=>this.init()):this.init()})})}get preObjectInit(){}init(){var t,r;if(this.instance.value&&this.__ngt__?this.switch():this.prepareInstance(this.objectInitFn(),null===(r=null===(t=this.instance)||void 0===t?void 0:t.value)||void 0===r?void 0:r.uuid),this.instance.value){this.postInit&&this.postInit();const i=xW.reduce((s,o)=>{const a=this[o].observed?this[o]:null;return a&&(s.handlers[o]=this.eventNameToHandler(a),s.eventCount+=1),s},{handlers:{},eventCount:0});Rs(this.__ngt__,{handlers:i.handlers,eventCount:i.eventCount}),i.eventCount>0&&this.store.addInteraction(this.instance.value),Ve.object3d(this.instance.value)&&this.appendToParent(),this.beforeRender.observed&&this.store.registerBeforeRender({obj:this.instance,callback:s=>{this.beforeRender.emit({state:s,object:this.instance.value})},priority:this.get(s=>s.priority)})}}destroy(){this.instance.value&&(this.store.unregisterBeforeRender(this.instance.value.uuid),this.__ngt__.eventCount>0&&this.store.removeInteraction(this.instance.value.uuid),this.remove()),super.destroy()}appendToParent(){requestAnimationFrame(()=>{const t=this.get(i=>i.appendTo);if(t&&t.value)return t.value.add(this.instance.value),void this.appended.emit(this.instance.value);const r=this.get(i=>i.appendMode);if("none"!==r){if("root"===r)return this.addToScene(),void this.appended.emit(this.instance.value);"immediate"===r&&(this.addToParent(),this.appended.emit(this.instance.value))}})}addToScene(){const t=this.store.get(r=>r.scene);t&&t.add(this.instance.value)}addToParent(){var t;let r=this.parent;this.shouldUseParent(r)?r.value.add(this.instance.value):(r=null===(t=this.parentHostRef)||void 0===t?void 0:t.call(this),this.shouldUseParent(r)?r.value.add(this.instance.value):this.addToScene())}shouldUseParent(t){return t&&t.value&&t.value.uuid!==this.instance.value.uuid}remove(){const{appendMode:t,appendTo:r}=this.get();if(r&&r.value)r.value.remove(this.instance.value);else if(this.shouldUseParent(this.parent)&&"immediate"===t)this.parent.value.remove(this.instance.value);else{const i=this.store.get(s=>s.scene);i&&i.remove(this.instance.value)}}switch(){const t=this.objectInitFn();this.instance.value.children&&(this.instance.value.traverse(r=>{r!==this.instance.value&&r.parent===this.instance.value&&(r.parent=t)}),this.instance.value.children=[]),this.__ngt__.eventCount>0&&this.store.removeInteraction(this.instance.value.uuid),this.remove(),this.prepareInstance(t)}eventNameToHandler(t){return r=>{this.zone.run(()=>{t.emit(r)})}}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275dir=Ot({type:n,outputs:{appended:"appended",beforeRender:"beforeRender",animateReady:"animateReady"},features:[wn]}),n})(),qT=(()=>{class n extends If{set material(t){this.set({material:t})}set geometry(t){this.set({geometry:t})}set morphTargetInfluences(t){this.set({morphTargetInfluences:t})}set morphTargetDictionary(t){this.set({morphTargetDictionary:t})}objectInitFn(){const t=this.get(),r=this.argsKeys.reduce((s,o)=>(s.push(t[o]),s),[]),i=new this.objectType(Ve.ref(t.geometry)?t.geometry.value:t.geometry,Ve.arr(t.material)?t.material.map(s=>Ve.ref(s)?s.value:s):Ve.ref(t.material)?t.material.value:t.material,...r);return t.morphTargetDictionary&&"morphTargetDictionary"in i&&(i.morphTargetDictionary=t.morphTargetDictionary),t.morphTargetInfluences&&"morphTargetInfluences"in i&&(i.morphTargetInfluences=t.morphTargetInfluences),i}get argsKeys(){return[]}get optionFields(){return Object.assign(Object.assign({},super.optionFields),{material:!0,geometry:!0,morphTargetInfluences:!0,morphTargetDictionary:!0})}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275dir=Ot({type:n,inputs:{material:"material",geometry:"geometry",morphTargetInfluences:"morphTargetInfluences",morphTargetDictionary:"morphTargetDictionary"},features:[wn]}),n})();function Ps(n,e){return[{provide:pu,useExisting:n},{provide:hu,useFactory:t=>()=>(null==e?void 0:e(t))||t.instance,deps:[n]}]}function ml(n,e){return[Ps(n,e),{provide:If,useExisting:n},{provide:pl,useFactory:t=>()=>(null==e?void 0:e(t))||t.instance,deps:[n]}]}function SW(n){return[{provide:hu,useFactory:e=>()=>e.sceneRef,deps:[n]},{provide:pl,useFactory:e=>()=>e.sceneRef,deps:[n]},{provide:$4,useFactory:e=>()=>e.sceneRef,deps:[n]},{provide:W4,useFactory:e=>()=>e.cameraRef,deps:[n]}]}const Rf=[],Pf=[],Kv=[];function gu(n,e){for(let t=0,r=n.length;t<r;t++)n[t](e)}function e_(n,e,t){const r=e();let i=r.clock.getDelta();"never"===r.frameloop&&"number"==typeof n&&(i=n-r.clock.elapsedTime,r.clock.oldTime=r.clock.elapsedTime,r.clock.elapsedTime=n);for(const s of r.internal.subscribers){const o=Ve.ref(s.obj)?s.obj.value:s.obj;s.callback(Object.assign(Object.assign({},r),{delta:i,frame:t}),o)}return!r.internal.priority&&r.gl.render&&r.gl.render(r.scene,r.camera),r.internal.frames=Math.max(0,r.internal.frames-1),"always"===r.frameloop?1:r.internal.frames}const t_=new Map,{invalidate:CW,advance:DW}=function EW(n){let t,r,i,e=!1;function s(l){if(r=requestAnimationFrame(s),e=!0,t=0,Rf.length&&gu(Rf,l),n.forEach(c=>{var u;i=c(),i.internal.active&&("always"===i.frameloop||i.internal.frames>0)&&!(null===(u=i.gl.xr)||void 0===u?void 0:u.isPresenting)&&(t+=e_(l,c))}),Pf.length&&gu(Pf,l),0===t)return Kv.length&&gu(Kv,l),e=!1,cancelAnimationFrame(r)}return{loop:s,advance:function a(l,c=!0,u,d){c&&gu(Rf,l);const h=null==u?void 0:u();h?e_(l,()=>h,d):n.forEach(f=>e_(l,f)),c&&gu(Pf,l)},invalidate:function o(l){var c;const u=null==l?void 0:l();if(!u)return n.forEach(d=>o(d));(null===(c=u.gl.xr)||void 0===c?void 0:c.isPresenting)||!u.internal.active||"never"===u.frameloop||(u.internal.frames=Math.min(60,u.internal.frames+1),e||(e=!0,requestAnimationFrame(s)))}}}(t_);let TW=(()=>{class n extends Zv{constructor(t,r){super(),this.zone=t,this.store=r,this.hostClass=!0,this._initialLog=!1,this._projectContent=!1,this.created=new ct,this.pointermissed=new ct}set linear(t){this.store.set({linear:Qe(t)})}set legacy(t){this.store.set({legacy:Qe(t)})}set flat(t){this.store.set({flat:Qe(t)})}set frameloop(t){this.store.set({frameloop:t})}set orthographic(t){this.store.set({orthographic:Qe(t)})}set dpr(t){this.store.set({dpr:t})}set raycaster(t){this.store.set({raycasterOptions:t})}set shadows(t){this.store.set({shadows:"object"==typeof t?t:Qe(t)})}set camera(t){this.store.set({cameraOptions:t})}get cameraRef(){return this.store.get(t=>t.cameraRef)}set scene(t){this.store.set({sceneOptions:t})}get sceneRef(){return this.store.get(t=>t.sceneRef)}set gl(t){this.store.set({glOptions:t})}get initialLog(){return this._initialLog}set initialLog(t){this._initialLog=Qe(t)}get projectContent(){return this._projectContent}set projectContent(t){this._projectContent=Qe(t)}ngOnInit(){this.zone.runOutsideAngular(()=>{this.pointermissed.observed&&this.store.set({pointerMissed:t=>{this.pointermissed.emit(t)}}),t_.set(this.rendererCanvas.nativeElement,()=>this.store.get()),this.store.init(this.rendererCanvas.nativeElement,t_,CW,DW),this.onCanvasReady(this.store.ready$,()=>{const t=this.store.get();this.created.emit(t),this.initialLog&&(console.group("[NgtCanvas] Initialized"),console.log(t),console.groupEnd()),this.store.startLoop(this.store.select())})})}}return n.\u0275fac=function(t){return new(t||n)(fe(Bt),fe(gl))},n.\u0275cmp=rr({type:n,selectors:[["ngt-canvas"]],viewQuery:function(t,r){if(1&t&&Cm(U4,7),2&t){let i;Mc(i=bc())&&(r.rendererCanvas=i.first)}},hostVars:2,hostBindings:function(t,r){2&t&&om("ngt-canvas",r.hostClass)},inputs:{linear:"linear",legacy:"legacy",flat:"flat",frameloop:"frameloop",orthographic:"orthographic",dpr:"dpr",raycaster:"raycaster",shadows:"shadows",camera:"camera",scene:"scene",gl:"gl",initialLog:"initialLog",projectContent:"projectContent"},outputs:{created:"created",pointermissed:"pointermissed"},features:[Ai([gl,jT,SW(n)]),wn],ngContentSelectors:V4,decls:5,vars:1,consts:[["rendererCanvas",""],[3,"ngTemplateOutlet",4,"ngIf"],["contentTemplate",""],[3,"ngTemplateOutlet"]],template:function(t,r){1&t&&(Ti(),ua(0,"canvas",null,0),qg(2,H4,1,1,"ng-container",1),qg(3,G4,1,0,"ng-template",null,2,Zw)),2&t&&(nc(2),Zs("ngIf",r.projectContent))},directives:[YS,QS],styles:["[_nghost-%COMP%]{display:block;position:relative;width:100%;height:100%;overflow:hidden}[_nghost-%COMP%]   canvas[_ngcontent-%COMP%]{display:block}"],changeDetection:0}),n})(),NW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({imports:[[tE]]}),n})(),ZT=(()=>{class n extends pu{constructor(t,r,i,s){super(t,r,i,s),this.init=this.effect(di(()=>{const o=this.get(c=>c.instanceArgs),a=this.adjustCtorParams(o),l=this.prepareInstance(new this.geometryType(...a));return()=>{l.dispose()}}))}set args(t){this.instanceArgs=t}preInit(){this.set(t=>({attach:t.attach.length?t.attach:["geometry"]}))}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.init(this.ctorParams$),this.postInit()})})}}return n.\u0275fac=function(t){return new(t||n)(fe(Bt),fe(gl),fe(pl,12),fe(Tf,12))},n.\u0275dir=Ot({type:n,inputs:{args:"args"},features:[wn]}),n})();function LW(n,e){return[Ps(n,e),{provide:ZT,useExisting:n},{provide:J4,useFactory:t=>()=>(null==e?void 0:e(t))||t.instance,deps:[n]}]}new _e("isWebGLAvailable",{factory:()=>{const n=Wl(Vn),e=Wl(Af);try{const t=n.createElement("canvas");return!(!e.WebGL2RenderingContext||!t.getContext("webgl2"))}catch(t){return!1}}});let Lf=(()=>{class n extends If{set args(t){this.instanceArgs=t}set intensity(t){this.set({intensity:ze(t)})}objectInitFn(){const{intensity:t,instanceArgs:r}=this.get(),i=new this.lightType(...r);return null!=t&&(i.intensity=t),i}get preObjectInit(){return t=>{this.set(r=>{var i;return{intensity:null!==(i=r.intensity)&&void 0!==i?i:1}}),t()}}get optionFields(){return Object.assign(Object.assign({},super.optionFields),{intensity:!1})}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275dir=Ot({type:n,inputs:{args:"args",intensity:"intensity"},features:[wn]}),n})();function n_(n,e){return[ml(n,e),{provide:Lf,useExisting:n},{provide:Q4,useFactory:t=>()=>(null==e?void 0:e(t))||t.instance,deps:[n]}]}function XT(n,e){return[ml(n,e),{provide:qT,useExisting:n},{provide:nW,useFactory:t=>()=>(null==e?void 0:e(t))||t.instance,deps:[n]}]}let YT=(()=>{class n extends pu{constructor(t,r,i,s){super(t,r,i,s),this.init=this.effect(di(()=>{const o=this.prepareInstance(new this.materialType);return()=>{o.dispose()}})),this.setParameters=this.effect(jt(({parameters:o,material:a})=>{a.setValues(Object.assign(Object.entries(o).reduce((l,[c,u])=>(void 0!==u&&(l[c]=u),l),{}),"uniforms"in a&&"uniforms"in o?{uniforms:Object.assign(Object.assign({},a.uniforms),o.uniforms)}:{})),xo(a)})),this.parameters$=this.select(this.select(o=>o.alphaTest).pipe(Ge()),this.select(o=>o.alphaToCoverage).pipe(Ge()),this.select(o=>o.blendDst).pipe(Ge()),this.select(o=>o.blendDstAlpha).pipe(Ge()),this.select(o=>o.blendEquation).pipe(Ge()),this.select(o=>o.blendEquationAlpha).pipe(Ge()),this.select(o=>o.blending).pipe(Ge()),this.select(o=>o.blendSrc).pipe(Ge()),this.select(o=>o.blendSrcAlpha).pipe(Ge()),this.select(o=>o.clipIntersection).pipe(Ge()),this.select(o=>o.clippingPlanes).pipe(Ge()),this.select(o=>o.clipShadows).pipe(Ge()),this.select(o=>o.colorWrite).pipe(Ge()),this.select(o=>o.defines).pipe(Ge()),this.select(o=>o.depthFunc).pipe(Ge()),this.select(o=>o.depthTest).pipe(Ge()),this.select(o=>o.depthWrite).pipe(Ge()),this.select(o=>o.fog).pipe(Ge()),this.select(o=>o.name).pipe(Ge()),this.select(o=>o.opacity).pipe(Ge()),this.select(o=>o.polygonOffset).pipe(Ge()),this.select(o=>o.polygonOffsetFactor).pipe(Ge()),this.select(o=>o.polygonOffsetUnits).pipe(Ge()),this.select(o=>o.precision).pipe(Ge()),this.select(o=>o.premultipliedAlpha).pipe(Ge()),this.select(o=>o.dithering).pipe(Ge()),this.select(o=>o.side).pipe(Ge()),this.select(o=>o.shadowSide).pipe(Ge()),this.select(o=>o.toneMapped).pipe(Ge()),this.select(o=>o.transparent).pipe(Ge()),this.select(o=>o.vertexColors).pipe(Ge()),this.select(o=>o.visible).pipe(Ge()),this.select(o=>o.format).pipe(Ge()),this.select(o=>o.stencilWrite).pipe(Ge()),this.select(o=>o.stencilFunc).pipe(Ge()),this.select(o=>o.stencilRef).pipe(Ge()),this.select(o=>o.stencilWriteMask).pipe(Ge()),this.select(o=>o.stencilFuncMask).pipe(Ge()),this.select(o=>o.stencilFail).pipe(Ge()),this.select(o=>o.stencilZFail).pipe(Ge()),this.select(o=>o.stencilZPass).pipe(Ge()),this.select(o=>o.userData).pipe(Ge()),(o,a,l,c,u,d,h,f,p,m,g,v,y,M,_,x,w,A,b,C,R,P,U,Z,L,k,F,X,J,H,j,ie,ne,le,Me,Ee,q,ht,Ie,je,ae,et)=>({alphaTest:o,alphaToCoverage:a,blendDst:l,blendDstAlpha:c,blendEquation:u,blendEquationAlpha:d,blending:h,blendSrc:f,blendSrcAlpha:p,clipIntersection:m,clippingPlanes:g,clipShadows:v,colorWrite:y,defines:M,depthFunc:_,depthTest:x,depthWrite:w,fog:A,name:b,opacity:C,polygonOffset:R,polygonOffsetFactor:P,polygonOffsetUnits:U,precision:Z,premultipliedAlpha:L,dithering:k,side:F,shadowSide:X,toneMapped:J,transparent:H,vertexColors:j,visible:ie,format:ne,stencilWrite:le,stencilFunc:Me,stencilRef:Ee,stencilWriteMask:q,stencilFuncMask:ht,stencilFail:Ie,stencilZFail:je,stencilZPass:ae,userData:et}))}set alphaTest(t){this.set({alphaTest:ze(t)})}set alphaToCoverage(t){this.set({alphaToCoverage:Qe(t)})}set blendDst(t){this.set({blendDst:t})}set blendDstAlpha(t){this.set({blendDstAlpha:ze(t)})}set blendEquation(t){this.set({blendEquation:t})}set blendEquationAlpha(t){this.set({blendEquationAlpha:ze(t)})}set blending(t){this.set({blending:t})}set blendSrc(t){this.set({blendSrc:t})}set blendSrcAlpha(t){this.set({blendSrcAlpha:ze(t)})}set clipIntersection(t){this.set({clipIntersection:Qe(t)})}set clippingPlanes(t){this.set({clippingPlanes:t})}set clipShadows(t){this.set({clipShadows:Qe(t)})}set colorWrite(t){this.set({colorWrite:Qe(t)})}set defines(t){this.set({defines:t})}set depthFunc(t){this.set({depthFunc:t})}set depthTest(t){this.set({depthTest:Qe(t)})}set depthWrite(t){this.set({depthWrite:Qe(t)})}set fog(t){this.set({fog:Qe(t)})}set name(t){this.set({name:t})}set opacity(t){this.set({opacity:ze(t)})}set polygonOffset(t){this.set({polygonOffset:Qe(t)})}set polygonOffsetFactor(t){this.set({polygonOffsetFactor:ze(t)})}set polygonOffsetUnits(t){this.set({polygonOffsetUnits:ze(t)})}set precision(t){this.set({precision:t})}set premultipliedAlpha(t){this.set({premultipliedAlpha:Qe(t)})}set dithering(t){this.set({dithering:Qe(t)})}set side(t){this.set({side:t})}set shadowSide(t){this.set({shadowSide:t})}set toneMapped(t){this.set({toneMapped:Qe(t)})}set transparent(t){this.set({transparent:Qe(t)})}set vertexColors(t){this.set({vertexColors:Qe(t)})}set visible(t){this.set({visible:Qe(t)})}set format(t){this.set({format:t})}set stencilWrite(t){this.set({stencilWrite:Qe(t)})}set stencilFunc(t){this.set({stencilFunc:t})}set stencilRef(t){this.set({stencilRef:ze(t)})}set stencilWriteMask(t){this.set({stencilWriteMask:ze(t)})}set stencilFuncMask(t){this.set({stencilFuncMask:ze(t)})}set stencilFail(t){this.set({stencilFail:t})}set stencilZFail(t){this.set({stencilZFail:t})}set stencilZPass(t){this.set({stencilZPass:t})}set userData(t){this.set({userData:t})}set parameters(t){this.set({materialParameters:t})}get parameters(){return this.get(t=>t.materialParameters)}preInit(){this.set(t=>({attach:t.attach.length?t.attach:["material"],materialParameters:t.materialParameters||{}}))}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.init(),this.postInit(),this.setParameters(this.select(this.instance$,this.select(t=>t.materialParameters),this.parameters$,this.subParameters$,(t,r,i,s)=>({material:t,parameters:Object.keys(r).length?r:Object.assign(Object.assign({},i),s)})))})})}get subParameters$(){const t=Object.entries(this.optionFields);return 0===t.length?Oe({}):this.select(...t.map(([r,i])=>{const s=this.select(o=>o[r]);return i?s.pipe(Ge()):s}),(...r)=>r.reduce((i,s,o)=>(i[t[o][0]]=s,i),{}))}}return n.\u0275fac=function(t){return new(t||n)(fe(Bt),fe(gl),fe(pl,12),fe(Tf,12))},n.\u0275dir=Ot({type:n,inputs:{alphaTest:"alphaTest",alphaToCoverage:"alphaToCoverage",blendDst:"blendDst",blendDstAlpha:"blendDstAlpha",blendEquation:"blendEquation",blendEquationAlpha:"blendEquationAlpha",blending:"blending",blendSrc:"blendSrc",blendSrcAlpha:"blendSrcAlpha",clipIntersection:"clipIntersection",clippingPlanes:"clippingPlanes",clipShadows:"clipShadows",colorWrite:"colorWrite",defines:"defines",depthFunc:"depthFunc",depthTest:"depthTest",depthWrite:"depthWrite",fog:"fog",name:"name",opacity:"opacity",polygonOffset:"polygonOffset",polygonOffsetFactor:"polygonOffsetFactor",polygonOffsetUnits:"polygonOffsetUnits",precision:"precision",premultipliedAlpha:"premultipliedAlpha",dithering:"dithering",side:"side",shadowSide:"shadowSide",toneMapped:"toneMapped",transparent:"transparent",vertexColors:"vertexColors",visible:"visible",format:"format",stencilWrite:"stencilWrite",stencilFunc:"stencilFunc",stencilRef:"stencilRef",stencilWriteMask:"stencilWriteMask",stencilFuncMask:"stencilFuncMask",stencilFail:"stencilFail",stencilZFail:"stencilZFail",stencilZPass:"stencilZPass",userData:"userData",parameters:"parameters"},features:[wn]}),n})();function kW(n,e){return[Ps(n,e),{provide:YT,useExisting:n},{provide:tW,useFactory:t=>()=>(null==e?void 0:e(t))||t.instance,deps:[n]}]}let JT=(()=>{class n extends qT{get objectType(){return this.meshType}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275dir=Ot({type:n,features:[wn]}),n})();function BW(n,e){return[XT(n,e),{provide:JT,useExisting:n},{provide:rW,useFactory:t=>()=>(null==e?void 0:e(t))||t.instance,deps:[n]}]}const VW=["*"];let zW=(()=>{class n extends JT{get meshType(){return Mn}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275cmp=rr({type:n,selectors:[["ngt-mesh"]],features:[Ai([BW(n)]),wn],ngContentSelectors:VW,decls:1,vars:0,template:function(t,r){1&t&&(Ti(),Ni(0))},encapsulation:2,changeDetection:0}),n})(),jW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})();const WW=["*"];let $W=(()=>{class n extends ZT{get geometryType(){return xs}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275cmp=rr({type:n,selectors:[["ngt-box-geometry"]],features:[Ai([LW(n)]),wn],ngContentSelectors:WW,decls:1,vars:0,template:function(t,r){1&t&&(Ti(),Ni(0))},encapsulation:2,changeDetection:0}),n})(),qW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})(),ZW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})(),XW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})();const YW=["*"];let JW=(()=>{class n extends YT{set color(t){this.set({color:t})}set roughness(t){this.set({roughness:ze(t)})}set metalness(t){this.set({metalness:ze(t)})}set map(t){this.set({map:t})}set lightMap(t){this.set({lightMap:t})}set lightMapIntensity(t){this.set({lightMapIntensity:ze(t)})}set aoMap(t){this.set({aoMap:t})}set aoMapIntensity(t){this.set({aoMapIntensity:ze(t)})}set emissive(t){this.set({emissive:t})}set emissiveIntensity(t){this.set({emissiveIntensity:ze(t)})}set emissiveMap(t){this.set({emissiveMap:t})}set bumpMap(t){this.set({bumpMap:t})}set bumpScale(t){this.set({bumpScale:ze(t)})}set normalMap(t){this.set({normalMap:t})}set normalMapType(t){this.set({normalMapType:t})}set normalScale(t){this.set({normalScale:t})}set displacementMap(t){this.set({displacementMap:t})}set displacementScale(t){this.set({displacementScale:ze(t)})}set displacementBias(t){this.set({displacementBias:ze(t)})}set roughnessMap(t){this.set({roughnessMap:t})}set metalnessMap(t){this.set({metalnessMap:t})}set alphaMap(t){this.set({alphaMap:t})}set envMap(t){this.set({envMap:t})}set envMapIntensity(t){this.set({envMapIntensity:ze(t)})}set wireframe(t){this.set({wireframe:Qe(t)})}set wireframeLinewidth(t){this.set({wireframeLinewidth:ze(t)})}set flatShading(t){this.set({flatShading:Qe(t)})}get materialType(){return au}get optionFields(){return Object.assign(Object.assign({},super.optionFields),{color:!0,roughness:!0,metalness:!0,map:!0,lightMap:!0,lightMapIntensity:!0,aoMap:!0,aoMapIntensity:!0,emissive:!0,emissiveIntensity:!0,emissiveMap:!0,bumpMap:!0,bumpScale:!0,normalMap:!0,normalMapType:!0,normalScale:!0,displacementMap:!0,displacementScale:!0,displacementBias:!0,roughnessMap:!0,metalnessMap:!0,alphaMap:!0,envMap:!0,envMapIntensity:!0,wireframe:!0,wireframeLinewidth:!0,flatShading:!0})}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275cmp=rr({type:n,selectors:[["ngt-mesh-standard-material"]],inputs:{color:"color",roughness:"roughness",metalness:"metalness",map:"map",lightMap:"lightMap",lightMapIntensity:"lightMapIntensity",aoMap:"aoMap",aoMapIntensity:"aoMapIntensity",emissive:"emissive",emissiveIntensity:"emissiveIntensity",emissiveMap:"emissiveMap",bumpMap:"bumpMap",bumpScale:"bumpScale",normalMap:"normalMap",normalMapType:"normalMapType",normalScale:"normalScale",displacementMap:"displacementMap",displacementScale:"displacementScale",displacementBias:"displacementBias",roughnessMap:"roughnessMap",metalnessMap:"metalnessMap",alphaMap:"alphaMap",envMap:"envMap",envMapIntensity:"envMapIntensity",wireframe:"wireframe",wireframeLinewidth:"wireframeLinewidth",flatShading:"flatShading"},features:[Ai([kW(n)]),wn],ngContentSelectors:YW,decls:1,vars:0,template:function(t,r){1&t&&(Ti(),Ni(0))},encapsulation:2,changeDetection:0}),n})(),KW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})();const r_=["*"];let QW=(()=>{class n extends Lf{get lightType(){return Uv}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275cmp=rr({type:n,selectors:[["ngt-ambient-light"]],features:[Ai([n_(n)]),wn],ngContentSelectors:r_,decls:1,vars:0,template:function(t,r){1&t&&(Ti(),Ni(0))},encapsulation:2,changeDetection:0}),n})(),e5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})(),t5=(()=>{class n extends Lf{set distance(t){this.set({distance:ze(t)})}set decay(t){this.set({decay:ze(t)})}set power(t){this.set({power:ze(t)})}get lightType(){return Bv}get optionFields(){return Object.assign(Object.assign({},super.optionFields),{distance:!0,decay:!0,power:!0})}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275cmp=rr({type:n,selectors:[["ngt-point-light"]],inputs:{distance:"distance",decay:"decay",power:"power"},features:[Ai([n_(n)]),wn],ngContentSelectors:r_,decls:1,vars:0,template:function(t,r){1&t&&(Ti(),Ni(0))},encapsulation:2,changeDetection:0}),n})(),n5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})(),r5=(()=>{class n extends Lf{set distance(t){this.set({distance:ze(t)})}set angle(t){this.set({angle:ze(t)})}set penumbra(t){this.set({penumbra:ze(t)})}set decay(t){this.set({decay:ze(t)})}set target(t){this.set({target:t})}set power(t){this.set({power:ze(t)})}get lightType(){return Ov}get optionFields(){return Object.assign(Object.assign({},super.optionFields),{distance:!0,angle:!0,penumbra:!0,decay:!0,target:!0,power:!0})}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275cmp=rr({type:n,selectors:[["ngt-spot-light"]],inputs:{distance:"distance",angle:"angle",penumbra:"penumbra",decay:"decay",target:"target",power:"power"},features:[Ai([n_(n)]),wn],ngContentSelectors:r_,decls:1,vars:0,template:function(t,r){1&t&&(Ti(),Ni(0))},encapsulation:2,changeDetection:0}),n})(),i5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})();function $e(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}const KT=(n,e)=>(n%e+e)%e;class s5 extends fs{constructor(e,t){super(),$e(this,"object",void 0),$e(this,"domElement",void 0),$e(this,"enabled",!0),$e(this,"target",new S),$e(this,"minDistance",0),$e(this,"maxDistance",1/0),$e(this,"minZoom",0),$e(this,"maxZoom",1/0),$e(this,"minPolarAngle",0),$e(this,"maxPolarAngle",Math.PI),$e(this,"minAzimuthAngle",-1/0),$e(this,"maxAzimuthAngle",1/0),$e(this,"enableDamping",!1),$e(this,"dampingFactor",.05),$e(this,"enableZoom",!0),$e(this,"zoomSpeed",1),$e(this,"enableRotate",!0),$e(this,"rotateSpeed",1),$e(this,"enablePan",!0),$e(this,"panSpeed",1),$e(this,"screenSpacePanning",!0),$e(this,"keyPanSpeed",7),$e(this,"autoRotate",!1),$e(this,"autoRotateSpeed",2),$e(this,"reverseOrbit",!1),$e(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),$e(this,"mouseButtons",{LEFT:0,MIDDLE:1,RIGHT:2}),$e(this,"touches",{ONE:0,TWO:2}),$e(this,"target0",void 0),$e(this,"position0",void 0),$e(this,"zoom0",void 0),$e(this,"_domElementKeyEvents",null),$e(this,"getPolarAngle",void 0),$e(this,"getAzimuthalAngle",void 0),$e(this,"setPolarAngle",void 0),$e(this,"setAzimuthalAngle",void 0),$e(this,"getDistance",void 0),$e(this,"listenToKeyEvents",void 0),$e(this,"saveState",void 0),$e(this,"reset",void 0),$e(this,"update",void 0),$e(this,"connect",void 0),$e(this,"dispose",void 0),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object instanceof Ut?this.object.zoom:1,this.getPolarAngle=()=>u.phi,this.getAzimuthalAngle=()=>u.theta,this.setPolarAngle=I=>{let D=KT(I,2*Math.PI),W=u.phi;W<0&&(W+=2*Math.PI),D<0&&(D+=2*Math.PI);let Q=Math.abs(D-W);2*Math.PI-Q<Q&&(D<W?D+=2*Math.PI:W+=2*Math.PI),d.phi=D-W,r.update()},this.setAzimuthalAngle=I=>{let D=KT(I,2*Math.PI),W=u.theta;W<0&&(W+=2*Math.PI),D<0&&(D+=2*Math.PI);let Q=Math.abs(D-W);2*Math.PI-Q<Q&&(D<W?D+=2*Math.PI:W+=2*Math.PI),d.theta=D-W,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=I=>{I.addEventListener("keydown",G),this._domElementKeyEvents=I},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object instanceof Ut?r.object.zoom:1},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object instanceof Ut&&(r.object.zoom=r.zoom0,r.object.updateProjectionMatrix()),r.dispatchEvent(i),r.update(),l=a.NONE},this.update=(()=>{const I=new S,D=(new ln).setFromUnitVectors(e.up,new S(0,1,0)),W=D.clone().invert(),Q=new S,ve=new ln,ge=2*Math.PI;return function(){const oe=r.object.position;I.copy(oe).sub(r.target),I.applyQuaternion(D),u.setFromVector3(I),r.autoRotate&&l===a.NONE&&U(function R(){return 2*Math.PI/60/60*r.autoRotateSpeed}()),r.enableDamping?(u.theta+=d.theta*r.dampingFactor,u.phi+=d.phi*r.dampingFactor):(u.theta+=d.theta,u.phi+=d.phi);let Ce=r.minAzimuthAngle,tt=r.maxAzimuthAngle;return isFinite(Ce)&&isFinite(tt)&&(Ce<-Math.PI?Ce+=ge:Ce>Math.PI&&(Ce-=ge),tt<-Math.PI?tt+=ge:tt>Math.PI&&(tt-=ge),u.theta=Ce<=tt?Math.max(Ce,Math.min(tt,u.theta)):u.theta>(Ce+tt)/2?Math.max(Ce,u.theta):Math.min(tt,u.theta)),u.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,u.phi)),u.makeSafe(),u.radius*=h,u.radius=Math.max(r.minDistance,Math.min(r.maxDistance,u.radius)),!0===r.enableDamping?r.target.addScaledVector(f,r.dampingFactor):r.target.add(f),I.setFromSpherical(u),I.applyQuaternion(W),oe.copy(r.target).add(I),r.object.lookAt(r.target),!0===r.enableDamping?(d.theta*=1-r.dampingFactor,d.phi*=1-r.dampingFactor,f.multiplyScalar(1-r.dampingFactor)):(d.set(0,0,0),f.set(0,0,0)),h=1,!!(p||Q.distanceToSquared(r.object.position)>c||8*(1-ve.dot(r.object.quaternion))>c)&&(r.dispatchEvent(i),Q.copy(r.object.position),ve.copy(r.object.quaternion),p=!1,!0)}})(),this.connect=I=>{I===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),r.domElement=I,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",ye),r.domElement.addEventListener("pointerdown",We),r.domElement.addEventListener("pointercancel",Dt),r.domElement.addEventListener("wheel",E)},this.dispose=()=>{var I,D,W,Q,ve,ge;null===(I=r.domElement)||void 0===I||I.removeEventListener("contextmenu",ye),null===(D=r.domElement)||void 0===D||D.removeEventListener("pointerdown",We),null===(W=r.domElement)||void 0===W||W.removeEventListener("pointercancel",Dt),null===(Q=r.domElement)||void 0===Q||Q.removeEventListener("wheel",E),null===(ve=r.domElement)||void 0===ve||ve.ownerDocument.removeEventListener("pointermove",Ne),null===(ge=r.domElement)||void 0===ge||ge.ownerDocument.removeEventListener("pointerup",De),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",G)};const r=this,i={type:"change"},s={type:"start"},o={type:"end"},a={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=a.NONE;const c=1e-6,u=new bT,d=new bT;let h=1;const f=new S;let p=!1;const m=new $,g=new $,v=new $,y=new $,M=new $,_=new $,x=new $,w=new $,A=new $,b=[],C={};function P(){return Math.pow(.95,r.zoomSpeed)}function U(I){r.reverseOrbit?d.theta+=I:d.theta-=I}function Z(I){r.reverseOrbit?d.phi+=I:d.phi-=I}const L=(()=>{const I=new S;return function(W,Q){I.setFromMatrixColumn(Q,0),I.multiplyScalar(-W),f.add(I)}})(),k=(()=>{const I=new S;return function(W,Q){!0===r.screenSpacePanning?I.setFromMatrixColumn(Q,1):(I.setFromMatrixColumn(Q,0),I.crossVectors(r.object.up,I)),I.multiplyScalar(W),f.add(I)}})(),F=(()=>{const I=new S;return function(W,Q){const ve=r.domElement;if(ve&&r.object instanceof Ut&&r.object.isPerspectiveCamera){I.copy(r.object.position).sub(r.target);let Ae=I.length();Ae*=Math.tan(r.object.fov/2*Math.PI/180),L(2*W*Ae/ve.clientHeight,r.object.matrix),k(2*Q*Ae/ve.clientHeight,r.object.matrix)}else ve&&r.object instanceof ws&&r.object.isOrthographicCamera?(L(W*(r.object.right-r.object.left)/r.object.zoom/ve.clientWidth,r.object.matrix),k(Q*(r.object.top-r.object.bottom)/r.object.zoom/ve.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function X(I){r.object instanceof Ut&&r.object.isPerspectiveCamera?h/=I:r.object instanceof ws&&r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom*I)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function J(I){r.object instanceof Ut&&r.object.isPerspectiveCamera?h*=I:r.object instanceof ws&&r.object.isOrthographicCamera?(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/I)),r.object.updateProjectionMatrix(),p=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function H(I){m.set(I.clientX,I.clientY)}function ie(I){y.set(I.clientX,I.clientY)}function ht(){1==b.length?m.set(b[0].pageX,b[0].pageY):m.set(.5*(b[0].pageX+b[1].pageX),.5*(b[0].pageY+b[1].pageY))}function Ie(){1==b.length?y.set(b[0].pageX,b[0].pageY):y.set(.5*(b[0].pageX+b[1].pageX),.5*(b[0].pageY+b[1].pageY))}function je(){const I=b[0].pageX-b[1].pageX,D=b[0].pageY-b[1].pageY,W=Math.sqrt(I*I+D*D);x.set(0,W)}function K(I){if(1==b.length)g.set(I.pageX,I.pageY);else{const W=Ze(I);g.set(.5*(I.pageX+W.x),.5*(I.pageY+W.y))}v.subVectors(g,m).multiplyScalar(r.rotateSpeed);const D=r.domElement;D&&(U(2*Math.PI*v.x/D.clientHeight),Z(2*Math.PI*v.y/D.clientHeight)),m.copy(g)}function Y(I){if(1==b.length)M.set(I.pageX,I.pageY);else{const D=Ze(I);M.set(.5*(I.pageX+D.x),.5*(I.pageY+D.y))}_.subVectors(M,y).multiplyScalar(r.panSpeed),F(_.x,_.y),y.copy(M)}function se(I){const D=Ze(I),W=I.pageX-D.x,Q=I.pageY-D.y,ve=Math.sqrt(W*W+Q*Q);w.set(0,ve),A.set(0,Math.pow(w.y/x.y,r.zoomSpeed)),X(A.y),x.copy(w)}function We(I){var D,W;!1!==r.enabled&&(0===b.length&&(null===(D=r.domElement)||void 0===D||D.ownerDocument.addEventListener("pointermove",Ne),null===(W=r.domElement)||void 0===W||W.ownerDocument.addEventListener("pointerup",De)),function Re(I){b.push(I)}(I),"touch"===I.pointerType?function re(I){switch(qe(I),b.length){case 1:switch(r.touches.ONE){case 0:if(!1===r.enableRotate)return;ht(),l=a.TOUCH_ROTATE;break;case 1:if(!1===r.enablePan)return;Ie(),l=a.TOUCH_PAN;break;default:l=a.NONE}break;case 2:switch(r.touches.TWO){case 2:if(!1===r.enableZoom&&!1===r.enablePan)return;(function ae(){r.enableZoom&&je(),r.enablePan&&Ie()})(),l=a.TOUCH_DOLLY_PAN;break;case 3:if(!1===r.enableZoom&&!1===r.enableRotate)return;(function et(){r.enableZoom&&je(),r.enableRotate&&ht()})(),l=a.TOUCH_DOLLY_ROTATE;break;default:l=a.NONE}break;default:l=a.NONE}l!==a.NONE&&r.dispatchEvent(s)}(I):function St(I){let D;switch(I.button){case 0:D=r.mouseButtons.LEFT;break;case 1:D=r.mouseButtons.MIDDLE;break;case 2:D=r.mouseButtons.RIGHT;break;default:D=-1}switch(D){case 1:if(!1===r.enableZoom)return;(function j(I){x.set(I.clientX,I.clientY)})(I),l=a.DOLLY;break;case 0:if(I.ctrlKey||I.metaKey||I.shiftKey){if(!1===r.enablePan)return;ie(I),l=a.PAN}else{if(!1===r.enableRotate)return;H(I),l=a.ROTATE}break;case 2:if(I.ctrlKey||I.metaKey||I.shiftKey){if(!1===r.enableRotate)return;H(I),l=a.ROTATE}else{if(!1===r.enablePan)return;ie(I),l=a.PAN}break;default:l=a.NONE}l!==a.NONE&&r.dispatchEvent(s)}(I))}function Ne(I){!1!==r.enabled&&("touch"===I.pointerType?function de(I){switch(qe(I),l){case a.TOUCH_ROTATE:if(!1===r.enableRotate)return;K(I),r.update();break;case a.TOUCH_PAN:if(!1===r.enablePan)return;Y(I),r.update();break;case a.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;(function be(I){r.enableZoom&&se(I),r.enablePan&&Y(I)})(I),r.update();break;case a.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;(function pe(I){r.enableZoom&&se(I),r.enableRotate&&K(I)})(I),r.update();break;default:l=a.NONE}}(I):function N(I){if(!1!==r.enabled)switch(l){case a.ROTATE:if(!1===r.enableRotate)return;!function ne(I){g.set(I.clientX,I.clientY),v.subVectors(g,m).multiplyScalar(r.rotateSpeed);const D=r.domElement;D&&(U(2*Math.PI*v.x/D.clientHeight),Z(2*Math.PI*v.y/D.clientHeight)),m.copy(g),r.update()}(I);break;case a.DOLLY:if(!1===r.enableZoom)return;!function le(I){w.set(I.clientX,I.clientY),A.subVectors(w,x),A.y>0?X(P()):A.y<0&&J(P()),x.copy(w),r.update()}(I);break;case a.PAN:if(!1===r.enablePan)return;!function Me(I){M.set(I.clientX,I.clientY),_.subVectors(M,y).multiplyScalar(r.panSpeed),F(_.x,_.y),y.copy(M),r.update()}(I)}}(I))}function De(I){var D,W,Q;z(I),0===b.length&&(null===(D=r.domElement)||void 0===D||D.releasePointerCapture(I.pointerId),null===(W=r.domElement)||void 0===W||W.ownerDocument.removeEventListener("pointermove",Ne),null===(Q=r.domElement)||void 0===Q||Q.ownerDocument.removeEventListener("pointerup",De)),r.dispatchEvent(o),l=a.NONE}function Dt(I){z(I)}function E(I){!1===r.enabled||!1===r.enableZoom||l!==a.NONE&&l!==a.ROTATE||(I.preventDefault(),r.dispatchEvent(s),function Ee(I){I.deltaY<0?J(P()):I.deltaY>0&&X(P()),r.update()}(I),r.dispatchEvent(o))}function G(I){!1===r.enabled||!1===r.enablePan||function q(I){let D=!1;switch(I.code){case r.keys.UP:F(0,r.keyPanSpeed),D=!0;break;case r.keys.BOTTOM:F(0,-r.keyPanSpeed),D=!0;break;case r.keys.LEFT:F(r.keyPanSpeed,0),D=!0;break;case r.keys.RIGHT:F(-r.keyPanSpeed,0),D=!0}D&&(I.preventDefault(),r.update())}(I)}function ye(I){!1!==r.enabled&&I.preventDefault()}function z(I){delete C[I.pointerId];for(let D=0;D<b.length;D++)if(b[D].pointerId==I.pointerId)return void b.splice(D,1)}function qe(I){let D=C[I.pointerId];void 0===D&&(D=new $,C[I.pointerId]=D),D.set(I.pageX,I.pageY)}function Ze(I){return C[(I.pointerId===b[0].pointerId?b[1]:b[0]).pointerId]}void 0!==t&&this.connect(t),this.update()}}const o5=["*"];let l5=(()=>{class n extends pu{constructor(){super(...arguments),this.change=new ct,this.start=new ct,this.end=new ct,this.init=this.effect(jt(()=>{const t=this.get(r=>r.camera);t&&this.prepareInstance(new s5(t))})),this.setBeforeRender=this.effect(di(()=>this.store.registerBeforeRender({priority:-1,callback:()=>{this.instance.value.enabled&&this.instance.value.update()}}))),this.connectDomElement=this.effect(di(()=>{const t=this.get(r=>r.domElement)||this.store.get(r=>r.events.connected)||this.store.get(r=>r.gl.domElement);return this.instance.value.connect(t),()=>{this.instance.value.dispose()}})),this.setEvents=this.effect(di(()=>{const{invalidate:t,performance:r}=this.store.get(),i=this.get(l=>l.regress),s=l=>{t(),i&&r.regress(),this.change.observed&&this.change.emit(l)};let o,a;return this.instance.value.addEventListener("change",s),this.start.observed&&(o=l=>{this.start.emit(l)},this.instance.value.addEventListener("start",o)),this.end.observed&&(a=l=>{this.end.emit(l)},this.instance.value.addEventListener("end",a)),()=>{this.instance.value.removeEventListener("change",s),a&&this.instance.value.removeEventListener("end",a),o&&this.instance.value.removeEventListener("start",o)}})),this.setDefaultControls=this.effect(di(()=>{if(this.get(r=>r.makeDefault)){const r=this.store.get(i=>i.controls);return this.store.set({controls:this.instance.value}),()=>{this.store.set({controls:r})}}}))}set enabled(t){this.set({enabled:Qe(t)})}set camera(t){this.set({camera:t})}set domElement(t){this.set({domElement:t})}set makeDefault(t){this.set({makeDefault:Qe(t)})}set regress(t){this.set({regress:Qe(t)})}set target(t){this.set({target:t})}set enableDamping(t){this.set({enableDamping:Qe(t)})}set minDistance(t){this.set({minDistance:ze(t)})}set maxDistance(t){this.set({maxDistance:ze(t)})}set minZoom(t){this.set({minZoom:ze(t)})}set maxZoom(t){this.set({maxZoom:ze(t)})}set minPolarAngle(t){this.set({minPolarAngle:ze(t)})}set maxPolarAngle(t){this.set({maxPolarAngle:ze(t)})}set minAzimuthAngle(t){this.set({minAzimuthAngle:ze(t)})}set maxAzimuthAngle(t){this.set({maxAzimuthAngle:ze(t)})}set dampingFactor(t){this.set({dampingFactor:ze(t)})}set enableZoom(t){this.set({enableZoom:Qe(t)})}set zoomSpeed(t){this.set({zoomSpeed:ze(t)})}set enableRotate(t){this.set({enableRotate:Qe(t)})}set rotateSpeed(t){this.set({rotateSpeed:ze(t)})}set enablePan(t){this.set({enablePan:Qe(t)})}set panSpeed(t){this.set({panSpeed:ze(t)})}set screenSpacePanning(t){this.set({screenSpacePanning:Qe(t)})}set keyPanSpeed(t){this.set({keyPanSpeed:ze(t)})}set autoRotate(t){this.set({autoRotate:Qe(t)})}set autoRotateSpeed(t){this.set({autoRotateSpeed:ze(t)})}set reverseOrbit(t){this.set({reverseOrbit:Qe(t)})}set keys(t){this.set({keys:t})}set mouseButtons(t){this.set({mouseButtons:t})}set touches(t){this.set({touches:t})}preInit(){this.set(t=>{var r,i,s,o;return{enabled:null===(r=t.enabled)||void 0===r||r,enableDamping:null===(i=t.enableDamping)||void 0===i||i,domElement:null!==(o=null!==(s=t.domElement)&&void 0!==s?s:this.store.get(a=>a.events.connected))&&void 0!==o?o:this.store.get(a=>a.gl.domElement)}})}ngOnInit(){super.ngOnInit(),this.zone.runOutsideAngular(()=>{this.onCanvasReady(this.store.ready$,()=>{this.get(t=>t.camera)||this.set(this.store.select(t=>t.camera).pipe(mt(t=>({camera:t})))),this.init(this.select(t=>t.camera)),this.setBeforeRender(),this.connectDomElement(this.select(this.instance$,this.select(t=>t.domElement))),this.setEvents(this.instance$),this.setDefaultControls(this.select(this.instance$,this.select(t=>t.makeDefault)))})})}get optionFields(){return Object.assign(Object.assign({},super.optionFields),{enabled:!1,target:!0,enableDamping:!1,minDistance:!0,maxDistance:!0,minZoom:!0,maxZoom:!0,minPolarAngle:!0,maxPolarAngle:!0,minAzimuthAngle:!0,maxAzimuthAngle:!0,dampingFactor:!0,enableZoom:!0,zoomSpeed:!0,enableRotate:!0,rotateSpeed:!0,enablePan:!0,panSpeed:!0,screenSpacePanning:!0,keyPanSpeed:!0,autoRotate:!0,autoRotateSpeed:!0,reverseOrbit:!0,keys:!0,mouseButtons:!0,touches:!0})}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=Mr(n)))(r||n)}}(),n.\u0275cmp=rr({type:n,selectors:[["ngt-soba-orbit-controls"]],inputs:{enabled:"enabled",camera:"camera",domElement:"domElement",makeDefault:"makeDefault",regress:"regress",target:"target",enableDamping:"enableDamping",minDistance:"minDistance",maxDistance:"maxDistance",minZoom:"minZoom",maxZoom:"maxZoom",minPolarAngle:"minPolarAngle",maxPolarAngle:"maxPolarAngle",minAzimuthAngle:"minAzimuthAngle",maxAzimuthAngle:"maxAzimuthAngle",dampingFactor:"dampingFactor",enableZoom:"enableZoom",zoomSpeed:"zoomSpeed",enableRotate:"enableRotate",rotateSpeed:"rotateSpeed",enablePan:"enablePan",panSpeed:"panSpeed",screenSpacePanning:"screenSpacePanning",keyPanSpeed:"keyPanSpeed",autoRotate:"autoRotate",autoRotateSpeed:"autoRotateSpeed",reverseOrbit:"reverseOrbit",keys:"keys",mouseButtons:"mouseButtons",touches:"touches"},outputs:{change:"change",start:"start",end:"end"},features:[Ai([Ps(n)]),wn],ngContentSelectors:o5,decls:1,vars:0,template:function(t,r){1&t&&(Ti(),Ni(0))},encapsulation:2,changeDetection:0}),n})(),c5=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})();function Ff(n,e){const t=dt(n)?n:()=>n,r=i=>i.error(t());return new Gt(e?i=>e.schedule(r,0,i):r)}const Of=El(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"});function QT(n){return new Gt(e=>{gr(n()).subscribe(e)})}function eN(){return $t((n,e)=>{let t=null;n._refCount++;const r=Vt(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const i=n._connection,s=t;t=null,i&&(!s||i===s)&&i.unsubscribe(),e.unsubscribe()});n.subscribe(r),r.closed||(t=n.connect())})}class u5 extends Gt{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,O_(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,null==e||e.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Qn;const t=this.getSubject();e.add(this.source.subscribe(Vt(t,void 0,()=>{this._teardown(),t.complete()},r=>{this._teardown(),t.error(r)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Qn.EMPTY)}return e}refCount(){return eN()(this)}}function d5(n,e,t,r,i){return(s,o)=>{let a=t,l=e,c=0;s.subscribe(Vt(o,u=>{const d=c++;l=a?n(l,u,d):(a=!0,u),r&&o.next(l)},i&&(()=>{a&&o.next(l),o.complete()})))}}function tN(n,e){return $t(d5(n,e,arguments.length>=2,!0))}function Ls(n){return $t((e,t)=>{let s,r=null,i=!1;r=e.subscribe(Vt(t,void 0,void 0,o=>{s=gr(n(o,Ls(n)(e))),r?(r.unsubscribe(),r=null,s.subscribe(t)):i=!0})),i&&(r.unsubscribe(),r=null,s.subscribe(t))})}function i_(n){return n<=0?()=>bi:$t((e,t)=>{let r=[];e.subscribe(Vt(t,i=>{r.push(i),n<r.length&&r.shift()},()=>{for(const i of r)t.next(i);t.complete()},void 0,()=>{r=null}))})}function nN(n=h5){return $t((e,t)=>{let r=!1;e.subscribe(Vt(t,i=>{r=!0,t.next(i)},()=>r?t.complete():t.error(n())))})}function h5(){return new Of}function rN(n){return $t((e,t)=>{let r=!1;e.subscribe(Vt(t,i=>{r=!0,t.next(i)},()=>{r||t.next(n),t.complete()}))})}function yl(n,e){const t=arguments.length>=2;return r=>r.pipe(n?Fi((i,s)=>n(i,s,r)):_i,Nl(1),t?rN(e):nN(()=>new Of))}class Zi{constructor(e,t){this.id=e,this.url=t}}class s_ extends Zi{constructor(e,t,r="imperative",i=null){super(e,t),this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class mu extends Zi{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class iN extends Zi{constructor(e,t,r){super(e,t),this.reason=r}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class g5 extends Zi{constructor(e,t,r){super(e,t),this.error=r}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class m5 extends Zi{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class y5 extends Zi{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class v5 extends Zi{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class _5 extends Zi{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class M5 extends Zi{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class sN{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class oN{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class b5{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class x5{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class w5{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class S5{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class aN{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const st="primary";class E5{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function vl(n){return new E5(n)}const lN="ngNavigationCancelingError";function o_(n){const e=Error("NavigationCancelingError: "+n);return e[lN]=!0,e}function D5(n,e,t){const r=t.path.split("/");if(r.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||r.length<n.length))return null;const i={};for(let s=0;s<r.length;s++){const o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function hi(n,e){const t=n?Object.keys(n):void 0,r=e?Object.keys(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!cN(n[i],e[i]))return!1;return!0}function cN(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}return n===e}function uN(n){return Array.prototype.concat.apply([],n)}function dN(n){return n.length>0?n[n.length-1]:null}function In(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function fi(n){return sx(n)?n:Sd(n)?Cn(Promise.resolve(n)):Oe(n)}const A5={exact:function pN(n,e,t){if(!So(n.segments,e.segments)||!kf(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const r in e.children)if(!n.children[r]||!pN(n.children[r],e.children[r],t))return!1;return!0},subset:gN},hN={exact:function I5(n,e){return hi(n,e)},subset:function R5(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>cN(n[t],e[t]))},ignored:()=>!0};function fN(n,e,t){return A5[t.paths](n.root,e.root,t.matrixParams)&&hN[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function gN(n,e,t){return mN(n,e,e.segments,t)}function mN(n,e,t,r){if(n.segments.length>t.length){const i=n.segments.slice(0,t.length);return!(!So(i,t)||e.hasChildren()||!kf(i,t,r))}if(n.segments.length===t.length){if(!So(n.segments,t)||!kf(n.segments,t,r))return!1;for(const i in e.children)if(!n.children[i]||!gN(n.children[i],e.children[i],r))return!1;return!0}{const i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(So(n.segments,i)&&kf(n.segments,i,r)&&n.children[st])&&mN(n.children[st],e,s,r)}}function kf(n,e,t){return e.every((r,i)=>hN[t](n[i].parameters,r.parameters))}class wo{constructor(e,t,r){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vl(this.queryParams)),this._queryParamMap}toString(){return F5.serialize(this)}}class ut{constructor(e,t){this.segments=e,this.children=t,this.parent=null,In(t,(r,i)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Bf(this)}}class yu{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=vl(this.parameters)),this._parameterMap}toString(){return bN(this)}}function So(n,e){return n.length===e.length&&n.every((t,r)=>t.path===e[r].path)}class yN{}class vN{parse(e){const t=new j5(e);return new wo(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${vu(e.root,!0)}`,r=function B5(n){const e=Object.keys(n).map(t=>{const r=n[t];return Array.isArray(r)?r.map(i=>`${Uf(t)}=${Uf(i)}`).join("&"):`${Uf(t)}=${Uf(r)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${r}${"string"==typeof e.fragment?`#${function O5(n){return encodeURI(n)}(e.fragment)}`:""}`}}const F5=new vN;function Bf(n){return n.segments.map(e=>bN(e)).join("/")}function vu(n,e){if(!n.hasChildren())return Bf(n);if(e){const t=n.children[st]?vu(n.children[st],!1):"",r=[];return In(n.children,(i,s)=>{s!==st&&r.push(`${s}:${vu(i,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}{const t=function L5(n,e){let t=[];return In(n.children,(r,i)=>{i===st&&(t=t.concat(e(r,i)))}),In(n.children,(r,i)=>{i!==st&&(t=t.concat(e(r,i)))}),t}(n,(r,i)=>i===st?[vu(n.children[st],!1)]:[`${i}:${vu(r,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[st]?`${Bf(n)}/${t[0]}`:`${Bf(n)}/(${t.join("//")})`}}function _N(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Uf(n){return _N(n).replace(/%3B/gi,";")}function a_(n){return _N(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Hf(n){return decodeURIComponent(n)}function MN(n){return Hf(n.replace(/\+/g,"%20"))}function bN(n){return`${a_(n.path)}${function k5(n){return Object.keys(n).map(e=>`;${a_(e)}=${a_(n[e])}`).join("")}(n.parameters)}`}const U5=/^[^\/()?;=#]+/;function Gf(n){const e=n.match(U5);return e?e[0]:""}const H5=/^[^=?&#]+/,V5=/^[^&#]+/;class j5{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ut([],{}):new ut([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[st]=new ut(e,t)),r}parseSegment(){const e=Gf(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new yu(Hf(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=Gf(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const i=Gf(this.remaining);i&&(r=i,this.capture(r))}e[Hf(t)]=Hf(r)}parseQueryParam(e){const t=function G5(n){const e=n.match(H5);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){const o=function z5(n){const e=n.match(V5);return e?e[0]:""}(this.remaining);o&&(r=o,this.capture(r))}const i=MN(t),s=MN(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=Gf(this.remaining),i=this.remaining[r.length];if("/"!==i&&")"!==i&&";"!==i)throw new Error(`Cannot parse url '${this.url}'`);let s;r.indexOf(":")>-1?(s=r.substr(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=st);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[st]:new ut([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class xN{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=l_(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){const t=l_(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=c_(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return c_(e,this._root).map(t=>t.value)}}function l_(n,e){if(n===e.value)return e;for(const t of e.children){const r=l_(n,t);if(r)return r}return null}function c_(n,e){if(n===e.value)return[e];for(const t of e.children){const r=c_(n,t);if(r.length)return r.unshift(e),r}return[]}class Xi{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function _l(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class wN extends xN{constructor(e,t){super(e),this.snapshot=t,u_(this,e)}toString(){return this.snapshot.toString()}}function SN(n,e){const t=function W5(n,e){const o=new Vf([],{},{},"",{},st,e,null,n.root,-1,{});return new CN("",new Xi(o,[]))}(n,e),r=new Er([new yu("",{})]),i=new Er({}),s=new Er({}),o=new Er({}),a=new Er(""),l=new Ml(r,i,o,a,s,st,e,t.root);return l.snapshot=t.root,new wN(new Xi(l,[]),t)}class Ml{constructor(e,t,r,i,s,o,a,l){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this._futureSnapshot=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(mt(e=>vl(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(mt(e=>vl(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function EN(n,e="emptyOnly"){const t=n.pathFromRoot;let r=0;if("always"!==e)for(r=t.length-1;r>=1;){const i=t[r],s=t[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(s.component)break;r--}}return function $5(n){return n.reduce((e,t)=>({params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}),{params:{},data:{},resolve:{}})}(t.slice(r))}class Vf{constructor(e,t,r,i,s,o,a,l,c,u,d){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._urlSegment=c,this._lastPathIndex=u,this._resolve=d}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=vl(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=vl(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class CN extends xN{constructor(e,t){super(t),this.url=e,u_(this,t)}toString(){return DN(this._root)}}function u_(n,e){e.value._routerState=n,e.children.forEach(t=>u_(n,t))}function DN(n){const e=n.children.length>0?` { ${n.children.map(DN).join(", ")} } `:"";return`${n.value}${e}`}function d_(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,hi(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),hi(e.params,t.params)||n.params.next(t.params),function T5(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!hi(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),hi(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function h_(n,e){const t=hi(n.params,e.params)&&function P5(n,e){return So(n,e)&&n.every((t,r)=>hi(t.parameters,e[r].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||h_(n.parent,e.parent))}function _u(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const r=t.value;r._futureSnapshot=e.value;const i=function Z5(n,e,t){return e.children.map(r=>{for(const i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return _u(n,r,i);return _u(n,r)})}(n,e,t);return new Xi(r,i)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>_u(n,a)),o}}const r=function X5(n){return new Ml(new Er(n.url),new Er(n.params),new Er(n.queryParams),new Er(n.fragment),new Er(n.data),n.outlet,n.component,n)}(e.value),i=e.children.map(s=>_u(n,s));return new Xi(r,i)}}function zf(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function Mu(n){return"object"==typeof n&&null!=n&&n.outlets}function f_(n,e,t,r,i){let s={};if(r&&In(r,(a,l)=>{s[l]=Array.isArray(a)?a.map(c=>`${c}`):`${a}`}),n===e)return new wo(t,s,i);const o=TN(n,e,t);return new wo(o,s,i)}function TN(n,e,t){const r={};return In(n.children,(i,s)=>{r[s]=i===e?t:TN(i,e,t)}),new ut(n.segments,r)}class NN{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&zf(r[0]))throw new Error("Root segment cannot have matrix parameters");const i=r.find(Mu);if(i&&i!==dN(r))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class p_{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}}function AN(n,e,t){if(n||(n=new ut([],{})),0===n.segments.length&&n.hasChildren())return jf(n,e,t);const r=function t8(n,e,t){let r=0,i=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;const o=n.segments[i],a=t[r];if(Mu(a))break;const l=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!RN(l,c,o))return s;r+=2}else{if(!RN(l,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){const s=new ut(n.segments.slice(0,r.pathIndex),{});return s.children[st]=new ut(n.segments.slice(r.pathIndex),n.children),jf(s,0,i)}return r.match&&0===i.length?new ut(n.segments,{}):r.match&&!n.hasChildren()?g_(n,e,t):r.match?jf(n,0,i):g_(n,e,t)}function jf(n,e,t){if(0===t.length)return new ut(n.segments,{});{const r=function e8(n){return Mu(n[0])?n[0].outlets:{[st]:n}}(t),i={};return In(r,(s,o)=>{"string"==typeof s&&(s=[s]),null!==s&&(i[o]=AN(n.children[o],e,s))}),In(n.children,(s,o)=>{void 0===r[o]&&(i[o]=s)}),new ut(n.segments,i)}}function g_(n,e,t){const r=n.segments.slice(0,e);let i=0;for(;i<t.length;){const s=t[i];if(Mu(s)){const l=n8(s.outlets);return new ut(r,l)}if(0===i&&zf(t[0])){r.push(new yu(n.segments[e].path,IN(t[0]))),i++;continue}const o=Mu(s)?s.outlets[st]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&zf(a)?(r.push(new yu(o,IN(a))),i+=2):(r.push(new yu(o,{})),i++)}return new ut(r,{})}function n8(n){const e={};return In(n,(t,r)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[r]=g_(new ut([],{}),0,t))}),e}function IN(n){const e={};return In(n,(t,r)=>e[r]=`${t}`),e}function RN(n,e,t){return n==t.path&&hi(e,t.parameters)}class i8{constructor(e,t,r,i){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i}activate(e){const t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),d_(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){const i=_l(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),In(i,(s,o)=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){const i=e.value,s=t?t.value:null;if(i===s)if(i.component){const o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=_l(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);if(r&&r.outlet){const o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=_l(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],i);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(e,t,r){const i=_l(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new S5(s.value.snapshot))}),e.children.length&&this.forwardEvent(new x5(e.value.snapshot))}activateRoutes(e,t,r){const i=e.value,s=t?t.value:null;if(d_(i),i===s)if(i.component){const o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){const o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){const a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),d_(a.route.value),this.activateChildRoutes(e,null,o.children)}else{const a=function s8(n){for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(i.snapshot),l=a?a.module.componentFactoryResolver:null;o.attachRef=null,o.route=i,o.resolver=l,o.outlet&&o.outlet.activateWith(i,l),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}}class m_{constructor(e,t){this.routes=e,this.module=t}}function Fs(n){return"function"==typeof n}function Eo(n){return n instanceof wo}const bu=Symbol("INITIAL_VALUE");function xu(){return us(n=>vE(n.map(e=>e.pipe(Nl(1),nh(bu)))).pipe(tN((e,t)=>{let r=!1;return t.reduce((i,s,o)=>i!==bu?i:(s===bu&&(r=!0),r||!1!==s&&o!==t.length-1&&!Eo(s)?i:s),e)},bu),Fi(e=>e!==bu),mt(e=>Eo(e)?e:!0===e),Nl(1)))}class d8{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new wu,this.attachRef=null}}class wu{constructor(){this.contexts=new Map}onChildOutletCreated(e,t){const r=this.getOrCreateContext(e);r.outlet=t,this.contexts.set(e,r)}onChildOutletDestroyed(e){const t=this.getContext(e);t&&(t.outlet=null,t.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let t=this.getContext(e);return t||(t=new d8,this.contexts.set(e,t)),t}getContext(e){return this.contexts.get(e)||null}}let PN=(()=>{class n{constructor(t,r,i,s,o){this.parentContexts=t,this.location=r,this.resolver=i,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new ct,this.deactivateEvents=new ct,this.attachEvents=new ct,this.detachEvents=new ct,this.name=s||st,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,r){this.activated=t,this._activatedRoute=r,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,r){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const o=(r=r||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),a=this.parentContexts.getOrCreateContext(this.name).children,l=new h8(t,a,this.location.injector);this.activated=this.location.createComponent(o,this.location.length,l),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)(fe(wu),fe(Gr),fe(mc),function Ul(n){return function Z1(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const r=t.length;let i=0;for(;i<r;){const s=t[i];if(A0(s))break;if(0===s)i+=2;else if("number"==typeof s)for(i++;i<r&&"string"==typeof t[i];)i++;else{if(s===e)return t[i+1];i+=2}}}return null}(pn(),n)}("name"),fe(jm))},n.\u0275dir=Ot({type:n,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),n})();class h8{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Ml?this.route:e===wu?this.childContexts:this.parent.get(e,t)}}let LN=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=rr({type:n,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,r){1&t&&ua(0,"router-outlet")},directives:[PN],encapsulation:2}),n})();function FN(n,e=""){for(let t=0;t<n.length;t++){const r=n[t];f8(r,p8(e,r))}}function f8(n,e){n.children&&FN(n.children,e)}function p8(n,e){return e?n||e.path?n&&!e.path?`${n}/`:!n&&e.path?e.path:`${n}/${e.path}`:"":n}function y_(n){const e=n.children&&n.children.map(y_),t=e?Object.assign(Object.assign({},n),{children:e}):Object.assign({},n);return!t.component&&(e||t.loadChildren)&&t.outlet&&t.outlet!==st&&(t.component=LN),t}function Ir(n){return n.outlet||st}function ON(n,e){const t=n.filter(r=>Ir(r)===e);return t.push(...n.filter(r=>Ir(r)!==e)),t}const kN={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Wf(n,e,t){var r;if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?Object.assign({},kN):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const s=(e.matcher||D5)(t,n,e);if(!s)return Object.assign({},kN);const o={};In(s.posParams,(l,c)=>{o[c]=l.path});const a=s.consumed.length>0?Object.assign(Object.assign({},o),s.consumed[s.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:s.consumed,remainingSegments:t.slice(s.consumed.length),parameters:a,positionalParamSegments:null!==(r=s.posParams)&&void 0!==r?r:{}}}function $f(n,e,t,r,i="corrected"){if(t.length>0&&function y8(n,e,t){return t.some(r=>qf(n,e,r)&&Ir(r)!==st)}(n,t,r)){const o=new ut(e,function m8(n,e,t,r){const i={};i[st]=r,r._sourceSegment=n,r._segmentIndexShift=e.length;for(const s of t)if(""===s.path&&Ir(s)!==st){const o=new ut([],{});o._sourceSegment=n,o._segmentIndexShift=e.length,i[Ir(s)]=o}return i}(n,e,r,new ut(t,n.children)));return o._sourceSegment=n,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:[]}}if(0===t.length&&function v8(n,e,t){return t.some(r=>qf(n,e,r))}(n,t,r)){const o=new ut(n.segments,function g8(n,e,t,r,i,s){const o={};for(const a of r)if(qf(n,t,a)&&!i[Ir(a)]){const l=new ut([],{});l._sourceSegment=n,l._segmentIndexShift="legacy"===s?n.segments.length:e.length,o[Ir(a)]=l}return Object.assign(Object.assign({},i),o)}(n,e,t,r,n.children,i));return o._sourceSegment=n,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:t}}const s=new ut(n.segments,n.children);return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:t}}function qf(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function BN(n,e,t,r){return!!(Ir(n)===r||r!==st&&qf(e,t,n))&&("**"===n.path||Wf(e,n,t).matched)}function UN(n,e,t){return 0===e.length&&!n.children[t]}class Zf{constructor(e){this.segmentGroup=e||null}}class HN{constructor(e){this.urlTree=e}}function Su(n){return Ff(new Zf(n))}function GN(n){return Ff(new HN(n))}class x8{constructor(e,t,r,i,s){this.configLoader=t,this.urlSerializer=r,this.urlTree=i,this.config=s,this.allowRedirects=!0,this.ngModule=e.get(Ii)}apply(){const e=$f(this.urlTree.root,[],[],this.config).segmentGroup,t=new ut(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,t,st).pipe(mt(s=>this.createUrlTree(v_(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ls(s=>{if(s instanceof HN)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Zf?this.noMatchError(s):s}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,st).pipe(mt(i=>this.createUrlTree(v_(i),e.queryParams,e.fragment))).pipe(Ls(i=>{throw i instanceof Zf?this.noMatchError(i):i}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,t,r){const i=e.segments.length>0?new ut([],{[st]:e}):e;return new wo(i,t,r)}expandSegmentGroup(e,t,r,i){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(e,t,r).pipe(mt(s=>new ut([],s))):this.expandSegment(e,r,t,r.segments,i,!0)}expandChildren(e,t,r){const i=[];for(const s of Object.keys(r.children))"primary"===s?i.unshift(s):i.push(s);return Cn(i).pipe(_a(s=>{const o=r.children[s],a=ON(t,s);return this.expandSegmentGroup(e,a,o,s).pipe(mt(l=>({segment:l,outlet:s})))}),tN((s,o)=>(s[o.outlet]=o.segment,s),{}),function f5(n,e){const t=arguments.length>=2;return r=>r.pipe(n?Fi((i,s)=>n(i,s,r)):_i,i_(1),t?rN(e):nN(()=>new Of))}())}expandSegment(e,t,r,i,s,o){return Cn(r).pipe(_a(a=>this.expandSegmentAgainstRoute(e,t,r,a,i,s,o).pipe(Ls(c=>{if(c instanceof Zf)return Oe(null);throw c}))),yl(a=>!!a),Ls((a,l)=>{if(a instanceof Of||"EmptyError"===a.name)return UN(t,i,s)?Oe(new ut([],{})):Su(t);throw a}))}expandSegmentAgainstRoute(e,t,r,i,s,o,a){return BN(i,t,s,o)?void 0===i.redirectTo?this.matchSegmentAgainstRoute(e,t,i,s,o):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o):Su(t):Su(t)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){return"**"===i.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,r,i,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,r,i){const s=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?GN(s):this.lineralizeSegments(r,s).pipe(fn(o=>{const a=new ut(o,{});return this.expandSegment(e,a,t,o,i,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){const{matched:a,consumedSegments:l,remainingSegments:c,positionalParamSegments:u}=Wf(t,i,s);if(!a)return Su(t);const d=this.applyRedirectCommands(l,i.redirectTo,u);return i.redirectTo.startsWith("/")?GN(d):this.lineralizeSegments(i,d).pipe(fn(h=>this.expandSegment(e,t,r,h.concat(c),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){if("**"===r.path)return r.loadChildren?(r._loadedConfig?Oe(r._loadedConfig):this.configLoader.load(e.injector,r)).pipe(mt(d=>(r._loadedConfig=d,new ut(i,{})))):Oe(new ut(i,{}));const{matched:o,consumedSegments:a,remainingSegments:l}=Wf(t,r,i);return o?this.getChildConfig(e,r,i).pipe(fn(u=>{const d=u.module,h=u.routes,{segmentGroup:f,slicedSegments:p}=$f(t,a,l,h),m=new ut(f.segments,f.children);if(0===p.length&&m.hasChildren())return this.expandChildren(d,h,m).pipe(mt(M=>new ut(a,M)));if(0===h.length&&0===p.length)return Oe(new ut(a,{}));const g=Ir(r)===s;return this.expandSegment(d,m,h,p,g?st:s,!0).pipe(mt(y=>new ut(a.concat(y.segments),y.children)))})):Su(t)}getChildConfig(e,t,r){return t.children?Oe(new m_(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?Oe(t._loadedConfig):this.runCanLoadGuards(e.injector,t,r).pipe(fn(i=>i?this.configLoader.load(e.injector,t).pipe(mt(s=>(t._loadedConfig=s,s))):function M8(n){return Ff(o_(`Cannot load children because the guard of the route "path: '${n.path}'" returned false`))}(t))):Oe(new m_([],e))}runCanLoadGuards(e,t,r){const i=t.canLoad;return i&&0!==i.length?Oe(i.map(o=>{const a=e.get(o);let l;if(function a8(n){return n&&Fs(n.canLoad)}(a))l=a.canLoad(t,r);else{if(!Fs(a))throw new Error("Invalid CanLoad guard");l=a(t,r)}return fi(l)})).pipe(xu(),jt(o=>{if(!Eo(o))return;const a=o_(`Redirecting to "${this.urlSerializer.serialize(o)}"`);throw a.url=o,a}),mt(o=>!0===o)):Oe(!0)}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),0===i.numberOfChildren)return Oe(r);if(i.numberOfChildren>1||!i.children[st])return Ff(new Error(`Only absolute redirects can have named outlets. redirectTo: '${e.redirectTo}'`));i=i.children[st]}}applyRedirectCommands(e,t,r){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,r)}applyRedirectCreatreUrlTree(e,t,r,i){const s=this.createSegmentGroup(e,t.root,r,i);return new wo(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const r={};return In(e,(i,s)=>{if("string"==typeof i&&i.startsWith(":")){const a=i.substring(1);r[s]=t[a]}else r[s]=i}),r}createSegmentGroup(e,t,r,i){const s=this.createSegments(e,t.segments,r,i);let o={};return In(t.children,(a,l)=>{o[l]=this.createSegmentGroup(e,a,r,i)}),new ut(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){const i=r[t.path.substring(1)];if(!i)throw new Error(`Cannot redirect to '${e}'. Cannot find '${t.path}'.`);return i}findOrReturn(e,t){let r=0;for(const i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}}function v_(n){const e={};for(const r of Object.keys(n.children)){const s=v_(n.children[r]);(s.segments.length>0||s.hasChildren())&&(e[r]=s)}return function w8(n){if(1===n.numberOfChildren&&n.children[st]){const e=n.children[st];return new ut(n.segments.concat(e.segments),e.children)}return n}(new ut(n.segments,e))}class VN{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class Xf{constructor(e,t){this.component=e,this.route=t}}function E8(n,e,t){const r=n._root;return Eu(r,e?e._root:null,t,[r.value])}function Yf(n,e,t){const r=function D8(n){if(!n)return null;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(r?r.module.injector:t).get(n)}function Eu(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=_l(e);return n.children.forEach(o=>{(function T8(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function N8(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!So(n.url,e.url);case"pathParamsOrQueryParamsChange":return!So(n.url,e.url)||!hi(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!h_(n,e)||!hi(n.queryParams,e.queryParams);default:return!h_(n,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?i.canActivateChecks.push(new VN(r)):(s.data=o.data,s._resolvedData=o._resolvedData),Eu(n,e,s.component?a?a.children:null:t,r,i),l&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new Xf(a.outlet.component,o))}else o&&Cu(e,a,i),i.canActivateChecks.push(new VN(r)),Eu(n,null,s.component?a?a.children:null:t,r,i)})(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),In(s,(o,a)=>Cu(o,t.getContext(a),i)),i}function Cu(n,e,t){const r=_l(n),i=n.value;In(r,(s,o)=>{Cu(s,i.component?e?e.children.getContext(o):null:e,t)}),t.canDeactivateChecks.push(new Xf(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}class B8{}function zN(n){return new Gt(e=>e.error(n))}class H8{constructor(e,t,r,i,s,o){this.rootComponentType=e,this.config=t,this.urlTree=r,this.url=i,this.paramsInheritanceStrategy=s,this.relativeLinkResolution=o}recognize(){const e=$f(this.urlTree.root,[],[],this.config.filter(o=>void 0===o.redirectTo),this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,st);if(null===t)return null;const r=new Vf([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},st,this.rootComponentType,null,this.urlTree.root,-1,{}),i=new Xi(r,t),s=new CN(this.url,i);return this.inheritParamsAndData(s._root),s}inheritParamsAndData(e){const t=e.value,r=EN(t,this.paramsInheritanceStrategy);t.params=Object.freeze(r.params),t.data=Object.freeze(r.data),e.children.forEach(i=>this.inheritParamsAndData(i))}processSegmentGroup(e,t,r){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,r)}processChildren(e,t){const r=[];for(const s of Object.keys(t.children)){const o=t.children[s],a=ON(e,s),l=this.processSegmentGroup(a,o,s);if(null===l)return null;r.push(...l)}const i=jN(r);return function G8(n){n.sort((e,t)=>e.value.outlet===st?-1:t.value.outlet===st?1:e.value.outlet.localeCompare(t.value.outlet))}(i),i}processSegment(e,t,r,i){for(const s of e){const o=this.processSegmentAgainstRoute(s,t,r,i);if(null!==o)return o}return UN(t,r,i)?[]:null}processSegmentAgainstRoute(e,t,r,i){if(e.redirectTo||!BN(e,t,r,i))return null;let s,o=[],a=[];if("**"===e.path){const f=r.length>0?dN(r).parameters:{};s=new Vf(r,f,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,qN(e),Ir(e),e.component,e,WN(t),$N(t)+r.length,ZN(e))}else{const f=Wf(t,e,r);if(!f.matched)return null;o=f.consumedSegments,a=f.remainingSegments,s=new Vf(o,f.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,qN(e),Ir(e),e.component,e,WN(t),$N(t)+o.length,ZN(e))}const l=function V8(n){return n.children?n.children:n.loadChildren?n._loadedConfig.routes:[]}(e),{segmentGroup:c,slicedSegments:u}=$f(t,o,a,l.filter(f=>void 0===f.redirectTo),this.relativeLinkResolution);if(0===u.length&&c.hasChildren()){const f=this.processChildren(l,c);return null===f?null:[new Xi(s,f)]}if(0===l.length&&0===u.length)return[new Xi(s,[])];const d=Ir(e)===i,h=this.processSegment(l,c,u,d?st:i);return null===h?null:[new Xi(s,h)]}}function z8(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function jN(n){const e=[],t=new Set;for(const r of n){if(!z8(r)){e.push(r);continue}const i=e.find(s=>r.value.routeConfig===s.value.routeConfig);void 0!==i?(i.children.push(...r.children),t.add(i)):e.push(r)}for(const r of t){const i=jN(r.children);e.push(new Xi(r.value,i))}return e.filter(r=>!t.has(r))}function WN(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function $N(n){let e=n,t=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift?e._segmentIndexShift:0;return t-1}function qN(n){return n.data||{}}function ZN(n){return n.resolve||{}}function XN(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function __(n){return us(e=>{const t=n(e);return t?Cn(t).pipe(mt(()=>e)):Oe(e)})}class J8 extends class Y8{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}{}const M_=new _e("ROUTES");class YN{constructor(e,t,r,i){this.injector=e,this.compiler=t,this.onLoadStartListener=r,this.onLoadEndListener=i}load(e,t){if(t._loader$)return t._loader$;this.onLoadStartListener&&this.onLoadStartListener(t);const i=this.loadModuleFactory(t.loadChildren).pipe(mt(s=>{this.onLoadEndListener&&this.onLoadEndListener(t);const o=s.create(e);return new m_(uN(o.injector.get(M_,void 0,ke.Self|ke.Optional)).map(y_),o)}),Ls(s=>{throw t._loader$=void 0,s}));return t._loader$=new u5(i,()=>new er).pipe(eN()),t._loader$}loadModuleFactory(e){return fi(e()).pipe(fn(t=>t instanceof Iw?Oe(t):Cn(this.compiler.compileModuleAsync(t))))}}class Q8{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,t){return e}}function e6(n){throw n}function t6(n,e,t){return e.parse("/")}function JN(n,e){return Oe(null)}const n6={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},r6={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let pr=(()=>{class n{constructor(t,r,i,s,o,a,l){this.rootComponentType=t,this.urlSerializer=r,this.rootContexts=i,this.location=s,this.config=l,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new er,this.errorHandler=e6,this.malformedUriErrorHandler=t6,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:JN,afterPreactivation:JN},this.urlHandlingStrategy=new Q8,this.routeReuseStrategy=new J8,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=o.get(Ii),this.console=o.get(D2);const d=o.get(Bt);this.isNgZoneEnabled=d instanceof Bt&&Bt.isInAngularZone(),this.resetConfig(l),this.currentUrlTree=function N5(){return new wo(new ut([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new YN(o,a,h=>this.triggerEvent(new sN(h)),h=>this.triggerEvent(new oN(h))),this.routerState=SN(this.currentUrlTree,this.rootComponentType),this.transitions=new Er({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var t;return null===(t=this.location.getState())||void 0===t?void 0:t.\u0275routerPageId}setupNavigations(t){const r=this.events;return t.pipe(Fi(i=>0!==i.id),mt(i=>Object.assign(Object.assign({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),us(i=>{let s=!1,o=!1;return Oe(i).pipe(jt(a=>{this.currentNavigation={id:a.id,initialUrl:a.currentRawUrl,extractedUrl:a.extractedUrl,trigger:a.source,extras:a.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),us(a=>{const l=this.browserUrlTree.toString(),c=!this.navigated||a.extractedUrl.toString()!==l||l!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||c)&&this.urlHandlingStrategy.shouldProcessUrl(a.rawUrl))return KN(a.source)&&(this.browserUrlTree=a.extractedUrl),Oe(a).pipe(us(d=>{const h=this.transitions.getValue();return r.next(new s_(d.id,this.serializeUrl(d.extractedUrl),d.source,d.restoredState)),h!==this.transitions.getValue()?bi:Promise.resolve(d)}),function S8(n,e,t,r){return us(i=>function b8(n,e,t,r,i){return new x8(n,e,t,r,i).apply()}(n,e,t,i.extractedUrl,r).pipe(mt(s=>Object.assign(Object.assign({},i),{urlAfterRedirects:s}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),jt(d=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:d.urlAfterRedirects})}),function j8(n,e,t,r,i){return fn(s=>function U8(n,e,t,r,i="emptyOnly",s="legacy"){try{const o=new H8(n,e,t,r,i,s).recognize();return null===o?zN(new B8):Oe(o)}catch(o){return zN(o)}}(n,e,s.urlAfterRedirects,t(s.urlAfterRedirects),r,i).pipe(mt(o=>Object.assign(Object.assign({},s),{targetSnapshot:o}))))}(this.rootComponentType,this.config,d=>this.serializeUrl(d),this.paramsInheritanceStrategy,this.relativeLinkResolution),jt(d=>{if("eager"===this.urlUpdateStrategy){if(!d.extras.skipLocationChange){const f=this.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl);this.setBrowserUrl(f,d)}this.browserUrlTree=d.urlAfterRedirects}const h=new m5(d.id,this.serializeUrl(d.extractedUrl),this.serializeUrl(d.urlAfterRedirects),d.targetSnapshot);r.next(h)}));if(c&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:h,extractedUrl:f,source:p,restoredState:m,extras:g}=a,v=new s_(h,this.serializeUrl(f),p,m);r.next(v);const y=SN(f,this.rootComponentType).snapshot;return Oe(Object.assign(Object.assign({},a),{targetSnapshot:y,urlAfterRedirects:f,extras:Object.assign(Object.assign({},g),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=a.rawUrl,a.resolve(null),bi}),__(a=>{const{targetSnapshot:l,id:c,extractedUrl:u,rawUrl:d,extras:{skipLocationChange:h,replaceUrl:f}}=a;return this.hooks.beforePreactivation(l,{navigationId:c,appliedUrlTree:u,rawUrlTree:d,skipLocationChange:!!h,replaceUrl:!!f})}),jt(a=>{const l=new y5(a.id,this.serializeUrl(a.extractedUrl),this.serializeUrl(a.urlAfterRedirects),a.targetSnapshot);this.triggerEvent(l)}),mt(a=>Object.assign(Object.assign({},a),{guards:E8(a.targetSnapshot,a.currentSnapshot,this.rootContexts)})),function A8(n,e){return fn(t=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?Oe(Object.assign(Object.assign({},t),{guardsResult:!0})):function I8(n,e,t,r){return Cn(n).pipe(fn(i=>function k8(n,e,t,r,i){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?Oe(s.map(a=>{const l=Yf(a,e,i);let c;if(function u8(n){return n&&Fs(n.canDeactivate)}(l))c=fi(l.canDeactivate(n,e,t,r));else{if(!Fs(l))throw new Error("Invalid CanDeactivate guard");c=fi(l(n,e,t,r))}return c.pipe(yl())})).pipe(xu()):Oe(!0)}(i.component,i.route,t,e,r)),yl(i=>!0!==i,!0))}(o,r,i,n).pipe(fn(a=>a&&function o8(n){return"boolean"==typeof n}(a)?function R8(n,e,t,r){return Cn(e).pipe(_a(i=>My(function L8(n,e){return null!==n&&e&&e(new b5(n)),Oe(!0)}(i.route.parent,r),function P8(n,e){return null!==n&&e&&e(new w5(n)),Oe(!0)}(i.route,r),function O8(n,e,t){const r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function C8(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(o)).filter(o=>null!==o).map(o=>QT(()=>Oe(o.guards.map(l=>{const c=Yf(l,o.node,t);let u;if(function c8(n){return n&&Fs(n.canActivateChild)}(c))u=fi(c.canActivateChild(r,n));else{if(!Fs(c))throw new Error("Invalid CanActivateChild guard");u=fi(c(r,n))}return u.pipe(yl())})).pipe(xu())));return Oe(s).pipe(xu())}(n,i.path,t),function F8(n,e,t){const r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||0===r.length)return Oe(!0);const i=r.map(s=>QT(()=>{const o=Yf(s,e,t);let a;if(function l8(n){return n&&Fs(n.canActivate)}(o))a=fi(o.canActivate(e,n));else{if(!Fs(o))throw new Error("Invalid CanActivate guard");a=fi(o(e,n))}return a.pipe(yl())}));return Oe(i).pipe(xu())}(n,i.route,t))),yl(i=>!0!==i,!0))}(r,s,n,e):Oe(a)),mt(a=>Object.assign(Object.assign({},t),{guardsResult:a})))})}(this.ngModule.injector,a=>this.triggerEvent(a)),jt(a=>{if(Eo(a.guardsResult)){const c=o_(`Redirecting to "${this.serializeUrl(a.guardsResult)}"`);throw c.url=a.guardsResult,c}const l=new v5(a.id,this.serializeUrl(a.extractedUrl),this.serializeUrl(a.urlAfterRedirects),a.targetSnapshot,!!a.guardsResult);this.triggerEvent(l)}),Fi(a=>!!a.guardsResult||(this.restoreHistory(a),this.cancelNavigationTransition(a,""),!1)),__(a=>{if(a.guards.canActivateChecks.length)return Oe(a).pipe(jt(l=>{const c=new _5(l.id,this.serializeUrl(l.extractedUrl),this.serializeUrl(l.urlAfterRedirects),l.targetSnapshot);this.triggerEvent(c)}),us(l=>{let c=!1;return Oe(l).pipe(function W8(n,e){return fn(t=>{const{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return Oe(t);let s=0;return Cn(i).pipe(_a(o=>function $8(n,e,t,r){return function q8(n,e,t,r){const i=XN(n);if(0===i.length)return Oe({});const s={};return Cn(i).pipe(fn(o=>function Z8(n,e,t,r){const i=Yf(n,e,r);return fi(i.resolve?i.resolve(e,t):i(e,t))}(n[o],e,t,r).pipe(jt(a=>{s[o]=a}))),i_(1),fn(()=>XN(s).length===i.length?Oe(s):bi))}(n._resolve,n,e,r).pipe(mt(s=>(n._resolvedData=s,n.data=Object.assign(Object.assign({},n.data),EN(n,t).resolve),null)))}(o.route,r,n,e)),jt(()=>s++),i_(1),fn(o=>s===i.length?Oe(t):bi))})}(this.paramsInheritanceStrategy,this.ngModule.injector),jt({next:()=>c=!0,complete:()=>{c||(this.restoreHistory(l),this.cancelNavigationTransition(l,"At least one route resolver didn't emit any value."))}}))}),jt(l=>{const c=new M5(l.id,this.serializeUrl(l.extractedUrl),this.serializeUrl(l.urlAfterRedirects),l.targetSnapshot);this.triggerEvent(c)}))}),__(a=>{const{targetSnapshot:l,id:c,extractedUrl:u,rawUrl:d,extras:{skipLocationChange:h,replaceUrl:f}}=a;return this.hooks.afterPreactivation(l,{navigationId:c,appliedUrlTree:u,rawUrlTree:d,skipLocationChange:!!h,replaceUrl:!!f})}),mt(a=>{const l=function q5(n,e,t){const r=_u(n,e._root,t?t._root:void 0);return new wN(r,e)}(this.routeReuseStrategy,a.targetSnapshot,a.currentRouterState);return Object.assign(Object.assign({},a),{targetRouterState:l})}),jt(a=>{this.currentUrlTree=a.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(a.urlAfterRedirects,a.rawUrl),this.routerState=a.targetRouterState,"deferred"===this.urlUpdateStrategy&&(a.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,a),this.browserUrlTree=a.urlAfterRedirects)}),((n,e,t)=>mt(r=>(new i8(e,r.targetRouterState,r.currentRouterState,t).activate(n),r)))(this.rootContexts,this.routeReuseStrategy,a=>this.triggerEvent(a)),jt({next(){s=!0},complete(){s=!0}}),function p5(n){return $t((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}(()=>{var a;s||o||this.cancelNavigationTransition(i,`Navigation ID ${i.id} is not equal to the current navigation id ${this.navigationId}`),(null===(a=this.currentNavigation)||void 0===a?void 0:a.id)===i.id&&(this.currentNavigation=null)}),Ls(a=>{if(o=!0,function C5(n){return n&&n[lN]}(a)){const l=Eo(a.url);l||(this.navigated=!0,this.restoreHistory(i,!0));const c=new iN(i.id,this.serializeUrl(i.extractedUrl),a.message);r.next(c),l?setTimeout(()=>{const u=this.urlHandlingStrategy.merge(a.url,this.rawUrlTree),d={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||KN(i.source)};this.scheduleNavigation(u,"imperative",null,d,{resolve:i.resolve,reject:i.reject,promise:i.promise})},0):i.resolve(!1)}else{this.restoreHistory(i,!0);const l=new g5(i.id,this.serializeUrl(i.extractedUrl),a);r.next(l);try{i.resolve(this.errorHandler(a))}catch(c){i.reject(c)}}return bi}))}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const r="popstate"===t.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{var i;const s={replaceUrl:!0},o=(null===(i=t.state)||void 0===i?void 0:i.navigationId)?t.state:null;if(o){const l=Object.assign({},o);delete l.navigationId,delete l.\u0275routerPageId,0!==Object.keys(l).length&&(s.state=l)}const a=this.parseUrl(t.url);this.scheduleNavigation(a,r,o,s)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){FN(t),this.config=t.map(y_),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,r={}){const{relativeTo:i,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=r,c=i||this.routerState.root,u=l?this.currentUrlTree.fragment:o;let d=null;switch(a){case"merge":d=Object.assign(Object.assign({},this.currentUrlTree.queryParams),s);break;case"preserve":d=this.currentUrlTree.queryParams;break;default:d=s||null}return null!==d&&(d=this.removeEmptyProps(d)),function Y5(n,e,t,r,i){if(0===t.length)return f_(e.root,e.root,e.root,r,i);const s=function J5(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new NN(!0,0,n);let e=0,t=!1;const r=n.reduce((i,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return In(s.outlets,(l,c)=>{a[c]="string"==typeof l?l.split("/"):l}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return"string"!=typeof s?[...i,s]:0===o?(s.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?t=!0:".."===a?e++:""!=a&&i.push(a))}),i):[...i,s]},[]);return new NN(t,e,r)}(t);if(s.toRoot())return f_(e.root,e.root,new ut([],{}),r,i);const o=function K5(n,e,t){if(n.isAbsolute)return new p_(e.root,!0,0);if(-1===t.snapshot._lastPathIndex){const s=t.snapshot._urlSegment;return new p_(s,s===e.root,0)}const r=zf(n.commands[0])?0:1;return function Q5(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new p_(r,!1,i-s)}(t.snapshot._urlSegment,t.snapshot._lastPathIndex+r,n.numberOfDoubleDots)}(s,e,n),a=o.processChildren?jf(o.segmentGroup,o.index,s.commands):AN(o.segmentGroup,o.index,s.commands);return f_(e.root,o.segmentGroup,a,r,i)}(c,this.currentUrlTree,t,d,null!=u?u:null)}navigateByUrl(t,r={skipLocationChange:!1}){const i=Eo(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(i,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,r)}navigate(t,r={skipLocationChange:!1}){return function i6(n){for(let e=0;e<n.length;e++){const t=n[e];if(null==t)throw new Error(`The requested path contains ${t} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,r),r)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let r;try{r=this.urlSerializer.parse(t)}catch(i){r=this.malformedUriErrorHandler(i,this.urlSerializer,t)}return r}isActive(t,r){let i;if(i=!0===r?Object.assign({},n6):!1===r?Object.assign({},r6):r,Eo(t))return fN(this.currentUrlTree,t,i);const s=this.parseUrl(t);return fN(this.currentUrlTree,s,i)}removeEmptyProps(t){return Object.keys(t).reduce((r,i)=>{const s=t[i];return null!=s&&(r[i]=s),r},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId,this.events.next(new mu(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,t.resolve(!0)},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}scheduleNavigation(t,r,i,s,o){var a,l;if(this.disposed)return Promise.resolve(!1);let c,u,d;o?(c=o.resolve,u=o.reject,d=o.promise):d=new Promise((p,m)=>{c=p,u=m});const h=++this.navigationId;let f;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(i=this.location.getState()),f=i&&i.\u0275routerPageId?i.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?null!==(a=this.browserPageId)&&void 0!==a?a:0:(null!==(l=this.browserPageId)&&void 0!==l?l:0)+1):f=0,this.setTransition({id:h,targetPageId:f,source:r,restoredState:i,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:s,resolve:c,reject:u,promise:d,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),d.catch(p=>Promise.reject(p))}setBrowserUrl(t,r){const i=this.urlSerializer.serialize(t),s=Object.assign(Object.assign({},r.extras.state),this.generateNgRouterState(r.id,r.targetPageId));this.location.isCurrentPathEqualTo(i)||r.extras.replaceUrl?this.location.replaceState(i,"",s):this.location.go(i,"",s)}restoreHistory(t,r=!1){var i,s;if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(i=this.currentNavigation)||void 0===i?void 0:i.finalUrl)||0===o?this.currentUrlTree===(null===(s=this.currentNavigation)||void 0===s?void 0:s.finalUrl)&&0===o&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(o)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(t,r){const i=new iN(t.id,this.serializeUrl(t.extractedUrl),r);this.triggerEvent(i),t.resolve(!1)}generateNgRouterState(t,r){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:r}:{navigationId:t}}}return n.\u0275fac=function(t){Qg()},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();function KN(n){return"imperative"!==n}class QN{}class eA{preload(e,t){return Oe(null)}}let tA=(()=>{class n{constructor(t,r,i,s){this.router=t,this.injector=i,this.preloadingStrategy=s,this.loader=new YN(i,r,l=>t.triggerEvent(new sN(l)),l=>t.triggerEvent(new oN(l)))}setUpPreloading(){this.subscription=this.router.events.pipe(Fi(t=>t instanceof mu),_a(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(Ii);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,r){const i=[];for(const s of r)if(s.loadChildren&&!s.canLoad&&s._loadedConfig){const o=s._loadedConfig;i.push(this.processRoutes(o.module,o.routes))}else s.loadChildren&&!s.canLoad?i.push(this.preloadConfig(t,s)):s.children&&i.push(this.processRoutes(t,s.children));return Cn(i).pipe(Dl(),mt(s=>{}))}preloadConfig(t,r){return this.preloadingStrategy.preload(r,()=>(r._loadedConfig?Oe(r._loadedConfig):this.loader.load(t.injector,r)).pipe(fn(s=>(r._loadedConfig=s,this.processRoutes(s.module,s.routes)))))}}return n.\u0275fac=function(t){return new(t||n)(xe(pr),xe(gS),xe(cr),xe(QN))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})(),w_=(()=>{class n{constructor(t,r,i={}){this.router=t,this.viewportScroller=r,this.options=i,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},i.scrollPositionRestoration=i.scrollPositionRestoration||"disabled",i.anchorScrolling=i.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof s_?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof mu&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof aN&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,r){this.router.triggerEvent(new aN(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return n.\u0275fac=function(t){Qg()},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();const Co=new _e("ROUTER_CONFIGURATION"),nA=new _e("ROUTER_FORROOT_GUARD"),l6=[Jm,{provide:yN,useClass:vN},{provide:pr,useFactory:function f6(n,e,t,r,i,s,o={},a,l){const c=new pr(null,n,e,t,r,i,uN(s));return a&&(c.urlHandlingStrategy=a),l&&(c.routeReuseStrategy=l),function p6(n,e){n.errorHandler&&(e.errorHandler=n.errorHandler),n.malformedUriErrorHandler&&(e.malformedUriErrorHandler=n.malformedUriErrorHandler),n.onSameUrlNavigation&&(e.onSameUrlNavigation=n.onSameUrlNavigation),n.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=n.paramsInheritanceStrategy),n.relativeLinkResolution&&(e.relativeLinkResolution=n.relativeLinkResolution),n.urlUpdateStrategy&&(e.urlUpdateStrategy=n.urlUpdateStrategy),n.canceledNavigationResolution&&(e.canceledNavigationResolution=n.canceledNavigationResolution)}(o,c),o.enableTracing&&c.events.subscribe(u=>{var d,h;null===(d=console.group)||void 0===d||d.call(console,`Router Event: ${u.constructor.name}`),console.log(u.toString()),console.log(u),null===(h=console.groupEnd)||void 0===h||h.call(console)}),c},deps:[yN,wu,Jm,cr,gS,M_,Co,[class K8{},new ns],[class X8{},new ns]]},wu,{provide:Ml,useFactory:function g6(n){return n.routerState.root},deps:[pr]},tA,eA,class a6{preload(e,t){return t().pipe(Ls(()=>Oe(null)))}},{provide:Co,useValue:{enableTracing:!1}}];function c6(){return new MS("Router",pr)}let rA=(()=>{class n{constructor(t,r){}static forRoot(t,r){return{ngModule:n,providers:[l6,iA(t),{provide:nA,useFactory:h6,deps:[[pr,new ns,new ql]]},{provide:Co,useValue:r||{}},{provide:ya,useFactory:d6,deps:[Ks,[new od(Ym),new ns],Co]},{provide:w_,useFactory:u6,deps:[pr,Uk,Co]},{provide:QN,useExisting:r&&r.preloadingStrategy?r.preloadingStrategy:eA},{provide:MS,multi:!0,useFactory:c6},[S_,{provide:Pm,multi:!0,useFactory:m6,deps:[S_]},{provide:sA,useFactory:y6,deps:[S_]},{provide:pS,multi:!0,useExisting:sA}]]}}static forChild(t){return{ngModule:n,providers:[iA(t)]}}}return n.\u0275fac=function(t){return new(t||n)(xe(nA,8),xe(pr,8))},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({}),n})();function u6(n,e,t){return t.scrollOffset&&e.setOffset(t.scrollOffset),new w_(n,e,t)}function d6(n,e,t={}){return t.useHash?new M3(n,e):new US(n,e)}function h6(n){return"guarded"}function iA(n){return[{provide:Q1,multi:!0,useValue:n},{provide:M_,multi:!0,useValue:n}]}let S_=(()=>{class n{constructor(t){this.injector=t,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new er}appInitializer(){return this.injector.get(y3,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let r=null;const i=new Promise(a=>r=a),s=this.injector.get(pr),o=this.injector.get(Co);return"disabled"===o.initialNavigation?(s.setUpLocationChangeListener(),r(!0)):"enabled"===o.initialNavigation||"enabledBlocking"===o.initialNavigation?(s.hooks.afterPreactivation=()=>this.initNavigation?Oe(null):(this.initNavigation=!0,r(!0),this.resultOfPreactivationDone),s.initialNavigation()):r(!0),i})}bootstrapListener(t){const r=this.injector.get(Co),i=this.injector.get(tA),s=this.injector.get(w_),o=this.injector.get(pr),a=this.injector.get(Vm);t===a.components[0]&&(("enabledNonBlocking"===r.initialNavigation||void 0===r.initialNavigation)&&o.initialNavigation(),i.setUpPreloading(),s.init(),o.resetRootComponentType(a.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return n.\u0275fac=function(t){return new(t||n)(xe(cr))},n.\u0275prov=rt({token:n,factory:n.\u0275fac}),n})();function m6(n){return n.appInitializer.bind(n)}function y6(n){return n.bootstrapListener.bind(n)}const sA=new _e("Router Initializer"),_6=[];let M6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n}),n.\u0275inj=bn({imports:[[rA.forRoot(_6)],rA]}),n})();let S6=(()=>{class n{constructor(){this.sphereColorChange=new er}getRandomColor(){let t=Number("0x"+Math.round(16777215*Math.random()).toString(16));return new ce(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=rt({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const E6=["cube"];let C6=(()=>{class n{constructor(t){this.geometryService=t,this.cubes=[],this.runOnce=!1}ngOnInit(){}onCubeReady(t){}onCubeBeforeRender(t){let r=t.object,i=t.state.scene;this.runOnce||this.spawnCubes(r,t.state),this.runOnce=!0,i.remove(r),this.cubes.forEach(s=>{s.position.z-=.04,s.position.z<-50&&i.remove(s)})}spawnCubes(t,r){let i=r.scene;(function w6(n=0,e=by){return n<0&&(n=0),function x6(n=0,e,t=HB){let r=-1;return null!=e&&(X_(e)?t=e:r=e),new Gt(i=>{let s=function b6(n){return n instanceof Date&&!isNaN(n)}(n)?+n-t.now():n;s<0&&(s=0);let o=0;return t.schedule(function(){i.closed||(i.next(o++),0<=r?this.schedule(void 0,r):i.complete())},s)})}(n,n,e)})(250).subscribe(()=>{let s=[Math.random()>.5?9*-Math.random():4.5*Math.random(),Math.random()>.5?8*-Math.random():4*Math.random(),5];const o=t.clone();o.position.set(s[0],s[1],s[2]),o.material=new au({color:this.geometryService.getRandomColor()}),i.add(o),this.cubes.push(o)})}}return n.\u0275fac=function(t){return new(t||n)(fe(S6))},n.\u0275cmp=rr({type:n,selectors:[["app-cube-spawner"]],viewQuery:function(t,r){if(1&t&&Cm(E6,5),2&t){let i;Mc(i=bc())&&(r.cube=i.first)}},inputs:{canvas:"canvas"},decls:4,vars:0,consts:[[3,"ready","beforeRender"],["cube",""]],template:function(t,r){1&t&&(lc(0,"ngt-mesh",0,1),uc("ready",function(s){return r.onCubeReady(s)})("beforeRender",function(s){return r.onCubeBeforeRender(s)}),ua(2,"ngt-box-geometry")(3,"ngt-mesh-standard-material"),cc())},directives:[zW,$W,JW],styles:[""]}),n})(),D6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=rr({type:n,selectors:[["app-root"]],decls:8,vars:3,consts:[[1,"canvas-container"],["canvas",""],["intensity","0.5"],["angle","1","penumbra","1",3,"position"],[3,"position"],[3,"canvas"]],template:function(t,r){if(1&t&&(lc(0,"div",0)(1,"ngt-canvas",null,1),ua(3,"ngt-ambient-light",2)(4,"ngt-spot-light",3)(5,"ngt-point-light",4)(6,"app-cube-spawner",5)(7,"ngt-soba-orbit-controls"),cc()()),2&t){const i=Zg(2);nc(4),Zs("position",10),nc(1),Zs("position",-10),nc(1),Zs("canvas",i)}},directives:[TW,QW,r5,t5,C6,l5],styles:[".canvas-container[_ngcontent-%COMP%]{height:100%}"]}),n})(),T6=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=Tn({type:n,bootstrap:[D6]}),n.\u0275inj=bn({providers:[],imports:[[fB,M6,NW,jW,qW,ZW,XW,KW,e5,i5,n5,c5]]}),n})();(function X2(){ES=!1})(),dB().bootstrapModule(T6).catch(n=>console.error(n))}},dt=>{dt(dt.s=322)}]);